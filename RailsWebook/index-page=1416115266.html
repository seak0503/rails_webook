<!DOCTYPE html>
<html
  lang="ja"
data-avail-langs="ja en"

data-page="index"
data-static-domain="https://blog.st-hatena.com"
data-blog="ruby-rails.hatenadiary.com"
data-blog-name="Rails Webook"
data-blogs-uri-base="http://ruby-rails.hatenadiary.com"
data-globalheader-color="b"
data-author="nipe880324"
data-version="228df9a6e5a3ae04fdb53d33befa3556"
data-blog-comments-top-is-new=""
data-plus-available=""



data-admin-domain="http://blog.hatena.ne.jp"

data-brand="hatenablog"

data-has-touch-view="1"


itemscope
itemtype="http://schema.org/Blog"


  data-device="pc"
  data-globalheader-type="pc"
  >
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
    
    
    

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=7; IE=9; IE=10; IE=11" />
    <title>Rails Webook</title>

    

    
      <link rel="canonical" href="index.html"/>
    

    
    

<meta itemprop="name" content="Rails Webook"/>

  <meta itemprop="image" content="https://blog.st-hatena.com/images/theme/og-image-1500.png"/>


    <meta property="og:title" content="Rails Webook"/>
<meta property="og:type" content="blog"/>
<meta property="og:url" content="http://ruby-rails.hatenadiary.com/"/>

  
  
  
  <meta property="og:image" content="https://blog.st-hatena.com/images/theme/og-image-1500.png"/>

  <meta property="og:description" content="自社のECを開発している会社で働いています。Rails情報やサービスを成長させる方法を書いていきます" />
<meta property="og:site_name" content="http://ruby-rails.hatenadiary.com/"/>

        <meta name="twitter:card"   content="gallery" />
    <meta name="twitter:image0" content="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108221903.png" />
    <meta name="twitter:image1" content="http://f.st-hatena.com/images/fotolife/n/nipe880324/20140802/20140802105152.png" />
    <meta name="twitter:image2" content="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108204010.png" />
    <meta name="twitter:image3" content="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108173340.png" />  <meta name="twitter:title" content="Rails Webook" />  <meta name="twitter:description" content="自社のECを開発している会社で働いています。Rails情報やサービスを成長させる方法を書いていきます" />  <meta name="twitter:app:name:iphone" content="はてなブログアプリ" />
  <meta name="twitter:app:id:iphone" content="583299321" />
  <meta name="twitter:app:url:iphone" content="hatenablog:///open?uri=http%3A%2F%2Fruby-rails.hatenadiary.com%2F%3Fpage%3D1416115266" />  <meta name="twitter:site" content="@nipe032488" />
    
    <meta name="description" content="毎週更新。Railsプログラマがソフトウェア開発を効果的・効率的にするために、分かりやすく・使いやすい形でRailsに関する技術情報を記載。">    <meta name="google-site-verification" content="OyOieuLgSrQckqbACTn_Q3G1dPq6LMlTqBRHa6V1XsA">    <meta name="keywords" content="Rails,Ruby on Rails,gem,Webアプリケーション,開発,構築,運用,インフラ">

    
<script type="text/javascript">
// <!--

if (~navigator.userAgent.indexOf('Mac OS X')) {
  document.write('<style type="text/css">html, body { font-family: \x27Helvetica\x27, \x27Arial\x27, \x27ヒラギノ角ゴ Pro W3\x27, \x27Hiragino Kaku Gothic Pro\x27, sans-serif; } </style>');
} else {
  document.write('<style type="text/css">html, body { font-family: \x27Helvetica\x27, \x27Arial\x27, \x27メイリオ\x27, \x27Meiryo\x27, \x27MS PGothic\x27, sans-serif; } </style>');
}

// -->
</script>

<!--[if lt IE 9]>
<script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->




    <link rel="shortcut icon" href="https://blog.st-hatena.com/images/favicon.ico">
<link rel="icon" sizes="192x192" href="https://blog.st-hatena.com/images/common/meta-icon-global.png">

    
<link rel="alternate" type="application/atom+xml" title="Atom" href="feed"/>
<link rel="alternate" type="application/rss+xml" title="RSS2.0" href="rss.rss"/>


      <link rel="author" href="http://www.hatena.ne.jp/nipe880324/">
    

    <link rel="stylesheet" type="text/css" href="https://blog.st-hatena.com/css/blog.css?version=228df9a6e5a3ae04fdb53d33befa3556"/>

    
  <link rel="stylesheet" type="text/css" href="http://blog.hatena.ne.jp/-/blog_style/12921228815727789780/a052dbbef76fd4380abc811c11814f2d9f990b9a"/>

    <script></script>

    
<style>div#google_afc_user,
  div#google_afc_user_container_0,
  div#google_afc_user_container_1,
  div#google_afc_user_container_2,
  div#google_afc_user_container_3,
  div#google_afc_user_container_4,
  div#google_afc_user_container_5,
  div.google_afc_image,
  div.google_afc_blocklink {
      display: block !important;
  }
</style>


    
  </head>

  <body class="page-index enable-top-editarea enable-bottom-editarea">
    <!-- Google Universal Analytics -->
<script id="google-analytics-script">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-29716941-6', 'auto', {'name': 'HatenaBlogTracker', 'sampleRate': 1});
  ga('HatenaBlogTracker.require', 'displayfeatures');
  ga('HatenaBlogTracker.send', 'pageview');
  ga('create', 'UA-29716941-26', 'auto', {'name': 'HatenaBlogSeparatedTracker', 'sampleRate': 10});
  ga('HatenaBlogSeparatedTracker.require', 'displayfeatures');
  ga('HatenaBlogSeparatedTracker.send', 'pageview');

    
      ga('create', 'UA-45988509-6', 'auto', {'name': 'HatenaBlogUserTracker'});
      ga('HatenaBlogUserTracker.require', 'displayfeatures');
      ga('HatenaBlogUserTracker.send', 'pageview');
    
  
  ga('create', 'UA-7855606-1', 'auto', {'name': 'HatenaGlobalTracker', 'sampleRate': 1});
  ga('HatenaGlobalTracker.require', 'displayfeatures');
  ga('HatenaGlobalTracker.send', 'pageview');
</script>
<!-- End Google Universal Analytics -->

    
    <div id="header-container">
     <div id="sp-suggest" style="display: none;"><a id="sp-suggest-link" href="index-page=1416115266.html#">スマートフォン用の表示で見る</a></div>
    </div>

    

<div class="quote-box">
  <div class="tooltip-quote tooltip-quote-star">
    <i class="blogicon-star" title="引用スターをつける"></i>
  </div>
  <div class="tooltip-quote tooltip-quote-stock">
    <i class="blogicon-quote" title="引用をストック"></i>
  </div>
</div>

<div class="message-box" id="quote-star-message-box" style="display: none; position: absolute;">
  スターをつけました
</div>

<div class="quote-stock-panel" id="quote-stock-message-box" style="position: absolute; z-index: 3000">
  <div class="message-box" id="quote-stock-succeeded-message" style="display: none">
    <p>引用をストックしました</p>
    <button class="btn btn-primary" id="quote-stock-show-editor-button" data-track-name="curation-quote-edit-button">ストック一覧を見る</button>
    <button class="btn quote-stock-close-message-button">閉じる</button>
  </div>

  <div class="message-box" id="quote-login-required-message" style="display: none">
    <p>引用するにはまずログインしてください</p>
    <button class="btn btn-primary" id="quote-login-button">ログイン</button>
    <button class="btn quote-stock-close-message-button">閉じる</button>
  </div>

  <div class="error-box" id="quote-stock-failed-message" style="display: none">
    <p>引用をストックできませんでした。再度お試しください</p>
    <button class="btn quote-stock-close-message-button">閉じる</button>
  </div>

  <div class="error-box" id="unstockable-quote-message-box" style="display: none; position: absolute; z-index: 3000;">
    <p>限定公開記事のため引用できません。</p>
  </div>
</div>

<script type="x-underscore-template" id="js-requote-button-template">
  <div class="requote-button js-requote-button">
    <button class="requote-button-btn tipsy-top" title="引用する"><i class="blogicon-quote"></i></button>
  </div>
</script>


    <div id="globalheader-container" >
  <iframe id="globalheader" height="37" frameborder="0" allowTransparency="true"></iframe>
</div>


    
    <div id="hidden-subscribe-button">
      <div class="hatena-follow-button-box btn-subscribe js-hatena-follow-button-box"
  
  >

  <a href="index-page=1416115266.html#" class="hatena-follow-button js-hatena-follow-button">
    <span class="subscribing">
      <span class="foreground">読者です</span>
      <span class="background">読者をやめる</span>
    </span>
    <span class="unsubscribing" data-track-name="profile-widget-subscribe-button" data-track-once>
      <span class="foreground">読者になる</span>
      <span class="background">読者になる</span>
    </span>
  </a>
  <div class="subscription-count-box js-subscription-count-box">
    <i></i>
    <u></u>
    <span class="subscription-count js-subscription-count">
    </span>
  </div>
</div>

    </div>

    <div id="container">
      <div id="container-inner">
        <header id="blog-title" data-brand="hatenablog">
  <div id="blog-title-inner" >
    <div id="blog-title-content">
      <h1 id="title"><a href="index.html">Rails Webook</a></h1>
      
        <h2 id="blog-description">自社のECを開発している会社で働いています。Rails情報やサービスを成長させる方法を書いていきます</h2>
      
    </div>
  </div>
</header>

        
          <div id="top-editarea">
            <!-- start Mixpanel --><script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
mixpanel.init("16db652100dca0a23c6a55a9205f0824");</script><!-- end Mixpanel -->
<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- rails top bar 728 x 90 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-2736751992834286"
     data-ad-slot="6687328050"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

          </div>
        
        
        



<div id="content" class="hfeed"
  
  >
  <div id="content-inner">
    <div id="wrapper">
      <div id="main">
        <div id="main-inner">
          
            
            <!-- google_ad_section_start -->
            <!-- rakuten_ad_target_begin -->
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-3600 words-400 mode-hatena entry-odd" id="entry-8454420450072954966" data-keyword-campaign="" data-uuid="8454420450072954966">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/15.html" rel="nofollow">
          <time pubdate datetime="2014-11-15T03:24:46Z" title="2014-11-15T03:24:46Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">15</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141115/1416021886.html" class="entry-title-link bookmark">RailsでInfinite Scrollとkaminariを使いスクロールによる動的にページロード機能を実装する</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%20gem.html">Rails gem</a>
          
          <a href="archive/category/UI%7CUX.html">UI/UX</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        
<div class="section">
    <h3>infinite scrollとは</h3>
    <p><a href="https://github.com/paulirish/infinite-scroll" target="_blank">infinite scroll</a>とは、TwitterやFacebookのようにページの下までスクロールしたら、動的により下のコンテンツが表示されるようにするjQueryプラグインです。</p><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108221903.png" alt="f:id:nipe880324:20141108221903p:plain:w320" title="f:id:nipe880324:20141108221903p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><p></p>

</div>
<div class="section">
    <h3>動作確認環境</h3>
    
<ul>
<li>Ruby 2.1.0</li>
<li>Rails 4.1</li>
<li>kaminari 0.16.1</li>
<li>infinite scroll 2.0.2</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1416115266.html#infinite-scroll-create">Railsプロジェクトの作成</a></li>
<li><a href="index-page=1416115266.html#infinite-scroll-install">スクロールによる動的ページロードの実装</a></li>
</ol><p><br />
<h3 id="infinite-scroll-create">1. Railsプロジェクトの作成</h3>まずはRailsプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new infinite_scrolling_kaminari_test
cd infinite_scrolling_kaminari_test</pre><p>次にInfinite Scrollの挙動を確認するために、ShopをScaffoldで作成します。</p>
<pre class="code" data-lang="" data-unlink>rails g scaffold Shop name zipcode address tel</pre><p>データをseeds.rbに記載します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># db/seeds.rb</span>

<span class="synConstant">1000</span>.times <span class="synStatement">do</span> |<span class="synIdentifier">i</span>|
  <span class="synType">Shop</span>.create!(
    <span class="synConstant">name</span>:    <span class="synSpecial">&quot;</span><span class="synConstant">店名</span><span class="synSpecial">#{</span>i<span class="synSpecial">}&quot;</span>,
    <span class="synConstant">zipcode</span>: <span class="synSpecial">&quot;</span><span class="synConstant">111-</span><span class="synSpecial">#{</span>sprintf(<span class="synSpecial">&quot;</span><span class="synConstant">%04d</span><span class="synSpecial">&quot;</span>, i)<span class="synSpecial">}&quot;</span>,
    <span class="synConstant">address</span>: <span class="synSpecial">&quot;</span><span class="synConstant">住所</span><span class="synSpecial">#{</span>i<span class="synSpecial">}&quot;</span>,
    <span class="synConstant">tel</span>:     <span class="synSpecial">&quot;</span><span class="synConstant">00-1234-</span><span class="synSpecial">#{</span>sprintf(<span class="synSpecial">&quot;</span><span class="synConstant">%04d</span><span class="synSpecial">&quot;</span>, i)<span class="synSpecial">}&quot;</span>
  )
<span class="synStatement">end</span>
</pre><p>マイグレーションを実行し、データを投入します。</p>
<pre class="code" data-lang="" data-unlink>rake db:migrate
rake db:seed</pre><p><br />
では、<code>rails s</code>でサーバーを起動してみましょう。<br />
縦になが〜くデータが1000件表示されていると思います。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108210935.png" alt="f:id:nipe880324:20141108210935p:plain:w320" title="f:id:nipe880324:20141108210935p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<br />
<p><h3 id="infinite-scroll-install">2. スクロールによる動的ページロードの実装</h3>Gemfileに<code>kaminari</code>を追加します</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Gemfile</span>

gem <span class="synSpecial">&quot;</span><span class="synConstant">jquery-turbolinks</span><span class="synSpecial">&quot;</span> <span class="synComment"># Turbolinksで遷移したときもjQuery.ready()を呼び出してくれる</span>
gem <span class="synSpecial">&quot;</span><span class="synConstant">kaminari</span><span class="synSpecial">&quot;</span>
</pre><p>そして、Bundlerでgemをインストールします。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p>infinitescroll.jsをGitHubのmasterから取得します。</p>
<pre class="code" data-lang="" data-unlink>curl -k -o vendor/assets/javascripts/jquery.infinitescroll.js https://raw.githubusercontent.com/paulirish/infinite-scroll/master/jquery.infinitescroll.js</pre><p>application.jsに<code>jquery.infinitescroll</code>を追加します。</p>
<pre class="code" data-lang="" data-unlink># app/assets/javascripts/application.js

...
//= require jquery
//= require jquery.turbolinks
//= require jquery_ujs
//= require jquery.infinitescroll
//= require turbolinks
//= require_tree .</pre><p>コントローラーのindexアクションを次のように変え、ページ単位で取得するようにします。<br />
params[:page]にはページ番号が入っているので、kaminariは自動的にオフセットを計算して値を取得してくれます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/controllers/shops_controller.rb</span>

  <span class="synPreProc">def</span> <span class="synIdentifier">index</span>
    <span class="synIdentifier">@shops</span> = <span class="synType">Shop</span>.page(params[<span class="synConstant">:page</span>])
  <span class="synPreProc">end</span>
</pre><p>ページネーションを一覧画面の一番下に追加します。<br />
また、データを表示している箇所を部分テンプレートにするため、<code>render</code>に書き換えます。<br />
また、<code>id="shops"</code>と<code>class="page"</code>をjsで使うので忘れないでください。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/shops/index.html.erb

<span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>Listing shops<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>

<span class="synComment">&lt;!-- 修正箇所 開始 --&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">table</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;shops&quot;</span><span class="synIdentifier">&gt;</span>
<span class="synComment">&lt;!-- 修正箇所 終了 --&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Name<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Zipcode<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Address<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Tel<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier"> </span><span class="synType">colspan</span><span class="synIdentifier">=</span><span class="synConstant">&quot;3&quot;</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>

  <span class="synComment">&lt;!-- 修正箇所 開始 --&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">tbody</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;page&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> render</span><span class="synIdentifier"> @shops %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">tbody</span><span class="synIdentifier">&gt;</span>
  <span class="synComment">&lt;!-- 修正箇所 終了 --&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'New Shop'</span><span class="synIdentifier">, new_shop_path %&gt;</span>

<span class="synComment">&lt;!--一番下に追加 --&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> paginate</span><span class="synIdentifier"> @shops %&gt;</span>
</pre><p>部分テンプレートを作成します。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/shops/_shop.html.erb

<span class="synComment">&lt;!-- class=&quot;shop&quot; は重要なので忘れないように --&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;shop&quot;</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> shop.name</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> shop.zipcode</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> shop.address</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> shop.tel</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Show'</span><span class="synIdentifier">, shop %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Edit'</span><span class="synIdentifier">, edit_shop_path(shop) %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Destroy'</span><span class="synIdentifier">, shop, </span><span class="synType">method</span><span class="synIdentifier">: :delete, </span><span class="synType">data</span><span class="synIdentifier">: { confirm: </span><span class="synConstant">'Are you sure?'</span><span class="synIdentifier"> } %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
</pre><p>そして、JavaScriptリクエストのために、部分テンプレートをappendするビューを記載します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/views/shops/index.js.erb</span>

<span class="synError">$(</span><span class="synSpecial">&quot;</span><span class="synConstant">#shops</span><span class="synSpecial">&quot;</span>).append(<span class="synSpecial">&quot;</span><span class="synConstant">&lt;tbody class='page'&gt;&lt;%= escape_javascript(render(@posts)) %&gt;&lt;/tbody&gt;</span><span class="synSpecial">&quot;</span>);
</pre><p><br />
そして、最後にinitial scrollで動的にページをロードするJavaScriptを記載します。</p>
<pre class="code" data-lang="" data-unlink>$ -&gt;
  $(&#34;#shops .page&#34;).infinitescroll
    loading: {
      img:     &#34;http://www.mytreedb.com/uploads/mytreedb/loader/ajax_loader_blue_48.gif&#34;
      msgText: &#34;ロード中...&#34;
    }
    navSelector: &#34;nav.pagination&#34; # selector for the paged navigation (it will be hidden)
    nextSelector: &#34;nav.pagination a[rel=next]&#34; # selector for the NEXT link (to page 2)
    itemSelector: &#34;#shops tr.shop&#34; # selector for all items you&#39;ll retrieve</pre><p><br />
ではサーバーを起動して、一覧画面を下にスクロールしましょう。<br />
すると、動的に画面が表示されます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108221903.png" alt="f:id:nipe880324:20141108221903p:plain:w320" title="f:id:nipe880324:20141108221903p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<p>以上です。<br />
<br />
</p>

</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li><a href="https://github.com/mislav/will_paginate/wiki">Home &middot; mislav/will_paginate Wiki &middot; GitHub</a></li>
<li><a href="http://www.infinite-scroll.com/">Infinite Scroll | jQuery plugin, Wordpress plugin, interaction design pattern</a></li>
</ul>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141115/1416021886.html"><time data-relative datetime="2014-11-15T03:24:46Z" title="2014-11-15T03:24:46Z" pubdate class="updated">2014-11-15 12:24</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141115/1416021886" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141115%2F1416021886" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141115/1416021886" data-count="vertical" data-text="RailsでInfinite Scrollとkaminariを使いスクロールによる動的にページロード機能を実装する - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141115/1416021886" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_0', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_0" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-2800 words-400 mode-hatena entry-even" id="entry-8454420450072950891" data-keyword-campaign="" data-uuid="8454420450072950891">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/14.html" rel="nofollow">
          <time pubdate datetime="2014-11-14T12:13:26Z" title="2014-11-14T12:13:26Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">14</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141114/1415967206.html" class="entry-title-link bookmark">Railsでwill_paginateを使ってページネーションを実現する</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%20gem.html">Rails gem</a>
          
          <a href="archive/category/UI%7CUX.html">UI/UX</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        
<div class="section">
    <h3>will_paginateとは</h3>
    <p><a href="https://github.com/mislav/will_paginate" target="_blank">will_pagenate</a>とは、ページネーションを作成するGemです。</p><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108212535.png" alt="f:id:nipe880324:20141108212535p:plain:w320" title="f:id:nipe880324:20141108212535p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><p></p>

</div>
<div class="section">
    <h3>動作確認環境</h3>
    
<ul>
<li>Ruby 2.1.0</li>
<li>Rails 4.1</li>
<li>will_paginate 3.0.7</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1416115266.html#will_paginate-create">Railsプロジェクトの作成</a></li>
<li><a href="index-page=1416115266.html#will_paginate-install">will_paginateのインストール</a></li>
<li><a href="index-page=1416115266.html#will_paginate-setting">will_paginateの設定</a></li>
<li><a href="index-page=1416115266.html#will_paginate-i18n">will_paginateのi18n</a></li>
</ol><p><br />
<h3 id="will_paginate-create">1. Railsプロジェクトの作成</h3>まずはRailsプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new will_paginate_test
cd will_paginate_test</pre><p>次にwill_paginateによるページネーションの挙動を確認するために、ShopをScaffoldで作成します。</p>
<pre class="code" data-lang="" data-unlink>rails g scaffold Shop name zipcode address tel</pre><p>データをseeds.rbに記載します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># db/seeds.rb</span>

<span class="synConstant">1000</span>.times <span class="synStatement">do</span> |<span class="synIdentifier">i</span>|
  <span class="synType">Shop</span>.create!(
    <span class="synConstant">name</span>:    <span class="synSpecial">&quot;</span><span class="synConstant">店名</span><span class="synSpecial">#{</span>i<span class="synSpecial">}&quot;</span>,
    <span class="synConstant">zipcode</span>: <span class="synSpecial">&quot;</span><span class="synConstant">111-</span><span class="synSpecial">#{</span>sprintf(<span class="synSpecial">&quot;</span><span class="synConstant">%04d</span><span class="synSpecial">&quot;</span>, i)<span class="synSpecial">}&quot;</span>,
    <span class="synConstant">address</span>: <span class="synSpecial">&quot;</span><span class="synConstant">住所</span><span class="synSpecial">#{</span>i<span class="synSpecial">}&quot;</span>,
    <span class="synConstant">tel</span>:     <span class="synSpecial">&quot;</span><span class="synConstant">00-1234-</span><span class="synSpecial">#{</span>sprintf(<span class="synSpecial">&quot;</span><span class="synConstant">%04d</span><span class="synSpecial">&quot;</span>, i)<span class="synSpecial">}&quot;</span>
  )
<span class="synStatement">end</span>
</pre><p>マイグレーションを実行し、データを投入します。</p>
<pre class="code" data-lang="" data-unlink>rake db:migrate
rake db:seed</pre><p><br />
では、<code>rails s</code>でサーバーを起動してみましょう。<br />
縦になが〜くデータが1000件表示されていると思います。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108210935.png" alt="f:id:nipe880324:20141108210935p:plain:w320" title="f:id:nipe880324:20141108210935p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<br />
<p><h3 id="will_paginate-install">2. will_paginateのインストール</h3>まずは、Gemfileに<code>kaminari</code>を追加します</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Gemfile</span>

gem <span class="synSpecial">'</span><span class="synConstant">will_paginate</span><span class="synSpecial">'</span>, <span class="synSpecial">'</span><span class="synConstant">~&gt; 3.0</span><span class="synSpecial">'</span>
</pre><p>そしてBundlerを実行します。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p><br />
次に、一覧画面のテーブルの上側に現在いくつ表示しているかを表示します。<br />
また、テーブルの一番下にページネーションのリンクを追加します。<br />
will_paginateではヘルパーが用意されているので、それぞれ1行ずつ追加するだけなので簡単です。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/shops/index.html.erb
<span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>Listing shops<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>

<span class="synComment">&lt;!-- 追加箇所開始 --&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> page_entries_info</span><span class="synIdentifier"> @shops %&gt;</span>
<span class="synComment">&lt;!-- 追加箇所終了 --&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Name<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Zipcode<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Address<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Tel<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier"> </span><span class="synType">colspan</span><span class="synIdentifier">=</span><span class="synConstant">&quot;3&quot;</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">tbody</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;% @shops.each do |shop| %&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> shop.name</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> shop.zipcode</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> shop.address</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> shop.tel</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Show'</span><span class="synIdentifier">, shop %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Edit'</span><span class="synIdentifier">, edit_shop_path(shop) %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Destroy'</span><span class="synIdentifier">, shop, </span><span class="synType">method</span><span class="synIdentifier">: :delete, </span><span class="synType">data</span><span class="synIdentifier">: { confirm: </span><span class="synConstant">'Are you sure?'</span><span class="synIdentifier"> } %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;% end %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">tbody</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'New Shop'</span><span class="synIdentifier">, new_shop_path %&gt;</span>


<span class="synComment">&lt;!-- 追加箇所開始 --&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> will_paginate</span><span class="synIdentifier"> @shops %&gt;</span>
<span class="synComment">&lt;!-- 追加箇所終了 --&gt;</span>
</pre><p>そして、コントローラーのindexアクションを次のように変えます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/controllers/shops_controller.rb</span>

  <span class="synPreProc">def</span> <span class="synIdentifier">index</span>
    <span class="synIdentifier">@shops</span> = <span class="synType">Shop</span>.page(params[<span class="synConstant">:page</span>])
  <span class="synPreProc">end</span>
</pre><p><br />
では、サーバーを再起動して一覧画面を確認してみましょう。<br />
画面下部にページのリンクが追加され、１ページあたり30件表示されています。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108212553.png" alt="f:id:nipe880324:20141108212553p:plain:w320" title="f:id:nipe880324:20141108212553p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<br />
<br />
<p><h3 id="will_paginate-setting">3. will_paginateの設定</h3>次のようにモデル単位とアプリケーション単位での１ページあたりの項目表示数を設定できます。</p><p>モデル単位で設定</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">Shop</span>
  <span class="synConstant">self</span>.per_page = <span class="synConstant">10</span>
<span class="synPreProc">end</span>
</pre><p>アプリケーション単位で設定</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">WillPaginate</span>.per_page = <span class="synConstant">10</span>
</pre><p></p><br />
<p><h3 id="will_paginate-i18n">will_paginateのi18n</h3>i18nでは、次の項目が設定可能です。</p>
<pre class="code lang-yaml" data-lang="yaml" data-unlink><span class="synIdentifier">en</span><span class="synSpecial">:</span>
  <span class="synIdentifier">will_paginate</span><span class="synSpecial">:</span>
    <span class="synIdentifier">previous_label</span><span class="synSpecial">:</span> <span class="synConstant">&quot;&amp;#8592; Previous&quot;</span>
    <span class="synIdentifier">next_label</span><span class="synSpecial">:</span> <span class="synConstant">&quot;Next &amp;#8594;&quot;</span>
    <span class="synIdentifier">page_gap</span><span class="synSpecial">:</span> <span class="synConstant">&quot;&amp;hellip;&quot;</span>

    <span class="synIdentifier">page_entries_info</span><span class="synSpecial">:</span>
      <span class="synIdentifier">single_page</span><span class="synSpecial">:</span>
        <span class="synIdentifier">zero</span><span class="synSpecial">:</span>  <span class="synConstant">&quot;No %{model} found&quot;</span>
        <span class="synIdentifier">one</span><span class="synSpecial">:</span>   <span class="synConstant">&quot;Displaying 1 %{model}&quot;</span>
        <span class="synIdentifier">other</span><span class="synSpecial">:</span> <span class="synConstant">&quot;Displaying all %{count} %{model}&quot;</span>
      <span class="synIdentifier">single_page_html</span><span class="synSpecial">:</span>
        <span class="synIdentifier">zero</span><span class="synSpecial">:</span>  <span class="synConstant">&quot;No %{model} found&quot;</span>
        <span class="synIdentifier">one</span><span class="synSpecial">:</span>   <span class="synConstant">&quot;Displaying &lt;b&gt;1&lt;/b&gt; %{model}&quot;</span>
        <span class="synIdentifier">other</span><span class="synSpecial">:</span> <span class="synConstant">&quot;Displaying &lt;b&gt;all&amp;nbsp;%{count}&lt;/b&gt; %{model}&quot;</span>

      <span class="synIdentifier">multi_page</span><span class="synSpecial">:</span> <span class="synConstant">&quot;Displaying %{model} %{from} - %{to} of %{count} in total&quot;</span>
      <span class="synIdentifier">multi_page_html</span><span class="synSpecial">:</span> <span class="synConstant">&quot;Displaying %{model} &lt;b&gt;%{from}&amp;nbsp;-&amp;nbsp;%{to}&lt;/b&gt; of &lt;b&gt;%{count}&lt;/b&gt; in total&quot;</span>
</pre><p><br />
以上です。<br />
もし、何か詰まったら、参考文献のページを確認してみてください。<br />
<br />
</p>

</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li><a href="https://github.com/mislav/will_paginate/wiki">Home &middot; mislav/will_paginate Wiki &middot; GitHub</a></li>
</ul>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141114/1415967206.html"><time data-relative datetime="2014-11-14T12:13:26Z" title="2014-11-14T12:13:26Z" pubdate class="updated">2014-11-14 21:13</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141114/1415967206" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141114%2F1415967206" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141114/1415967206" data-count="vertical" data-text="Railsでwill_paginateを使ってページネーションを実現する - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141114/1415967206" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
          <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4438296558807254"
     data-ad-slot="4370884664"
     data-ad-format="horizontal"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-3600 words-400 mode-hatena entry-odd" id="entry-8454420450072948386" data-keyword-campaign="" data-uuid="8454420450072948386">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/13.html" rel="nofollow">
          <time pubdate datetime="2014-11-13T10:31:23Z" title="2014-11-13T10:31:23Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">13</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141113/1415874683.html" class="entry-title-link bookmark">Railsでkaminariを使ってページネーションを実現する</a>
      </h1>
      
      
      

      
    </header>
        
    <div class="entry-content">

      
        
<div class="section">
    <h3>kaminariとは</h3>
    <p><a href="https://github.com/amatsuda/kaminari" target="_blank">kaminari</a>とは、ページネーションを作成するGemです。</p><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108204010.png" alt="f:id:nipe880324:20141108204010p:plain:w320" title="f:id:nipe880324:20141108204010p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span><br />
</p>

</div>
<div class="section">
    <h3>サポートバージョン</h3>
    
<ul>
<li>Ruby 1.8.7, 1.9.2, 1.9.3, 2.0.0, 2.1.x</li>
<li>Rails 3.0, 3.1, 3.2, 4.0, 4.1</li>
<li>Haml 3+</li>
<li>Mongoid 2+</li>
<li>MongoMapper 0.9+</li>
<li>DataMapper 1.1.0+</li>
</ul>
</div>
<div class="section">
    <h3>動作確認環境</h3>
    
<ul>
<li>Ruby 2.1.0</li>
<li>Rails 4.1</li>
<li>kaminari 0.16.1</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1416115266.html#kaminari-create">Railsプロジェクトの作成</a></li>
<li><a href="index-page=1416115266.html#kaminari-install">kaminariのインストール</a></li>
<li><a href="index-page=1416115266.html#kaminari-setting">kaminariの設定</a></li>
<li><a href="index-page=1416115266.html#kaminari-i18n">kaminariのi18n</a></li>
<li><a href="index-page=1416115266.html#kaminari-install-with-bootstrap">Twitter Bootstrapを適用させる</a></li>
</ol><p><br />
<h3 id="kaminari-create">1. Railsプロジェクトの作成</h3>まずはRailsプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new kaminari_test
cd kaminari_test</pre><p>次にkaminariによるページネーションの挙動を確認するために、ShopをScaffoldで作成します。</p>
<pre class="code" data-lang="" data-unlink>rails g scaffold Shop name zipcode address tel</pre><p>データをseeds.rbに記載します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># db/seeds.rb</span>

<span class="synConstant">1000</span>.times <span class="synStatement">do</span> |<span class="synIdentifier">i</span>|
  <span class="synType">Shop</span>.create!(
    <span class="synConstant">name</span>:    <span class="synSpecial">&quot;</span><span class="synConstant">店名</span><span class="synSpecial">#{</span>i<span class="synSpecial">}&quot;</span>,
    <span class="synConstant">zipcode</span>: <span class="synSpecial">&quot;</span><span class="synConstant">111-</span><span class="synSpecial">#{</span>sprintf(<span class="synSpecial">&quot;</span><span class="synConstant">%04d</span><span class="synSpecial">&quot;</span>, i)<span class="synSpecial">}&quot;</span>,
    <span class="synConstant">address</span>: <span class="synSpecial">&quot;</span><span class="synConstant">住所</span><span class="synSpecial">#{</span>i<span class="synSpecial">}&quot;</span>,
    <span class="synConstant">tel</span>:     <span class="synSpecial">&quot;</span><span class="synConstant">00-1234-</span><span class="synSpecial">#{</span>sprintf(<span class="synSpecial">&quot;</span><span class="synConstant">%04d</span><span class="synSpecial">&quot;</span>, i)<span class="synSpecial">}&quot;</span>
  )
<span class="synStatement">end</span>
</pre><p>マイグレーションを実行し、データを投入します。</p>
<pre class="code" data-lang="" data-unlink>rake db:migrate
rake db:seed</pre><p><br />
では、<code>rails s</code>でサーバーを起動してみましょう。<br />
縦になが〜くデータが1000件表示されていると思います。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108210935.png" alt="f:id:nipe880324:20141108210935p:plain:w380" title="f:id:nipe880324:20141108210935p:plain:w380" class="hatena-fotolife" style="width:380px" itemprop="image"></span></p><br />
<br />
<br />
<p><h3 id="kaminari-install">2. kaminariのインストール</h3>まずは、Gemfileに<code>kaminari</code>を追加します</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Gemfile</span>

gem <span class="synSpecial">'</span><span class="synConstant">kaminari</span><span class="synSpecial">'</span>
</pre><p>そしてBundlerを実行します。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p><br />
次に、一覧画面のテーブルの上側に現在いくつ表示しているかを表示します。<br />
また、テーブルの一番下にページネーションのリンクを追加します。<br />
kaminariではヘルパーが用意されているので、それぞれ1行ずつ追加するだけなので簡単です。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/shops/index.html.erb
<span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>Listing shops<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>

<span class="synComment">&lt;!-- 追加箇所開始 --&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> page_entries_info</span><span class="synIdentifier"> @shops %&gt;</span>
<span class="synComment">&lt;!-- 追加箇所終了 --&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Name<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Zipcode<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Address<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Tel<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier"> </span><span class="synType">colspan</span><span class="synIdentifier">=</span><span class="synConstant">&quot;3&quot;</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">tbody</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;% @shops.each do |shop| %&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> shop.name</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> shop.zipcode</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> shop.address</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> shop.tel</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Show'</span><span class="synIdentifier">, shop %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Edit'</span><span class="synIdentifier">, edit_shop_path(shop) %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Destroy'</span><span class="synIdentifier">, shop, </span><span class="synType">method</span><span class="synIdentifier">: :delete, </span><span class="synType">data</span><span class="synIdentifier">: { confirm: </span><span class="synConstant">'Are you sure?'</span><span class="synIdentifier"> } %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;% end %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">tbody</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'New Shop'</span><span class="synIdentifier">, new_shop_path %&gt;</span>


<span class="synComment">&lt;!-- 追加箇所開始 --&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> paginate</span><span class="synIdentifier"> @shops %&gt;</span>
<span class="synComment">&lt;!-- 追加箇所終了 --&gt;</span>
</pre><p>そして、コントローラーのindexアクションを次のように変えます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/controllers/shops_controller.rb</span>

  <span class="synPreProc">def</span> <span class="synIdentifier">index</span>
    <span class="synIdentifier">@shops</span> = <span class="synType">Shop</span>.page(params[<span class="synConstant">:page</span>])
  <span class="synPreProc">end</span>
</pre><p><br />
では、サーバーを再起動して一覧画面を確認してみましょう。<br />
画面下部にページのリンクが追加され、１ページあたり25件表示されています。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108204137.png" alt="f:id:nipe880324:20141108204137p:plain:w380" title="f:id:nipe880324:20141108204137p:plain:w380" class="hatena-fotolife" style="width:380px" itemprop="image"></span></p><br />
<br />
<br />
<p><h3 id="kaminari-setting">3. kaminariの設定</h3>次のコマンドでkaminariの設定ファイルを作成することができます。</p>
<pre class="code" data-lang="" data-unlink>rails g kaminari:config</pre><p>1ページ辺りの表示数や、パラメーターの名前など次の項目を設定可能です。<br />
コメントアウトされていますが、記載されている値はデフォルト値です。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">Kaminari</span>.configure <span class="synStatement">do</span> |<span class="synIdentifier">config</span>|
  <span class="synComment"># config.default_per_page = 25 # 1ページ辺りの項目数</span>
  <span class="synComment"># config.max_per_page = nil    # 1ページ辺りの最大数</span>
  <span class="synComment"># config.window = 4            # ex 値が2の場合 .. 2 3 (4) 5 6 ..</span>
  <span class="synComment"># config.outer_window = 0      # ex 値が2の場合 .. (4) .. 99 100</span>
  <span class="synComment"># config.left = 0              # ...になったときの左側の表示数</span>
  <span class="synComment"># config.right = 0             # ...になったときの右側の表示数</span>
  <span class="synComment"># config.page_method_name = :page # メソッド名</span>
  <span class="synComment"># config.param_name = :page    # ページネーションのパラメーターの名前</span>
<span class="synStatement">end</span>
</pre><p>また、上記は全体的な設定であり、次のように個別に設定することも可能です。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/shop.rb</span>

<span class="synPreProc">class</span> <span class="synType">Shop</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  paginates_per <span class="synConstant">5</span>  <span class="synComment"># 1ページあたり5項目表示</span>
<span class="synPreProc">end</span>
</pre><pre class="code lang-html" data-lang="html" data-unlink># app/views/shops/index.html.erb

...
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> paginate</span><span class="synIdentifier"> @shops, outer_window: 4 %&gt;</span>
</pre><p>画面は次のようになります。<br />
1ページに5項目しか表示されなくなります。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108204158.png" alt="f:id:nipe880324:20141108204158p:plain:w380" title="f:id:nipe880324:20141108204158p:plain:w380" class="hatena-fotolife" style="width:380px" itemprop="image"></span></p><br />
<br />
<br />
<p><h3 id="kaminari-i18n">4. kaminariのi18n</h3>i18nでは、次の項目が設定可能です。</p>
<pre class="code lang-yaml" data-lang="yaml" data-unlink><span class="synIdentifier">en</span><span class="synSpecial">:</span>
  <span class="synIdentifier">views</span><span class="synSpecial">:</span>
    <span class="synIdentifier">pagination</span><span class="synSpecial">:</span>
      <span class="synIdentifier">first</span><span class="synSpecial">:</span>    <span class="synConstant">&quot;&amp;laquo;&quot;</span>
      <span class="synIdentifier">last</span><span class="synSpecial">:</span>     <span class="synConstant">&quot;&amp;raquo;&quot;</span>
      <span class="synIdentifier">previous</span><span class="synSpecial">:</span> <span class="synConstant">&quot;&amp;lsaquo;&quot;</span>
      <span class="synIdentifier">next</span><span class="synSpecial">:</span>     <span class="synConstant">&quot;&amp;rsaquo;&quot;</span>
      <span class="synIdentifier">truncate</span><span class="synSpecial">:</span> <span class="synConstant">&quot;&amp;hellip;&quot;</span>
  <span class="synIdentifier">helpers</span><span class="synSpecial">:</span>
    <span class="synIdentifier">page_entries_info</span><span class="synSpecial">:</span>
      <span class="synIdentifier">one_page</span><span class="synSpecial">:</span>
        <span class="synIdentifier">display_entries</span><span class="synSpecial">:</span>
          <span class="synIdentifier">zero</span><span class="synSpecial">:</span> <span class="synConstant">&quot;No %{entry_name} found&quot;</span>
          <span class="synIdentifier">one</span><span class="synSpecial">:</span> <span class="synConstant">&quot;Displaying &lt;b&gt;1&lt;/b&gt; %{entry_name}&quot;</span>
          <span class="synIdentifier">other</span><span class="synSpecial">:</span> <span class="synConstant">&quot;Displaying &lt;b&gt;all %{count}&lt;/b&gt; %{entry_name}&quot;</span>
      <span class="synIdentifier">more_pages</span><span class="synSpecial">:</span>
        <span class="synIdentifier">display_entries</span><span class="synSpecial">:</span> <span class="synConstant">&quot;Displaying %{entry_name} &lt;b&gt;%{first}&amp;nbsp;-&amp;nbsp;%{last}&lt;/b&gt; of &lt;b&gt;%{total}&lt;/b&gt; in total&quot;</span>
</pre><p></p><br />
<p><h3 id="kaminari-install-with-bootstrap">Twitter Bootstrapを適用させる</h3></p><p>次の記事の「インストール方法1」を見て、Twitter Bootstrapを導入します。</p>

<ul>
<li><a href="entry/20140801/1406818800.html" target="_blank">Bootstrpのインストール</a></li>
</ul><p>そして、次のコマンドでページネーションのアンカーのビューファイルをBootstrap3で作成します。</p>
<pre class="code" data-lang="" data-unlink>rails g kaminari:views bootstrap</pre><p>画面を確認してみます。ページネーション部分だけBootstrap化されています。<br />
<code>app/views/kaminari/</code>配下にページネーションのビューファイルが配置されたので、これを修正することでデザインを修正することが可能です。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108204246.png" alt="f:id:nipe880324:20141108204246p:plain:w380" title="f:id:nipe880324:20141108204246p:plain:w380" class="hatena-fotolife" style="width:380px" itemprop="image"></span></p><br />
<p>以上です。<br />
もし、何か捕まったら、参考文献のページを確認してみてください。<br />
<br />
</p>

</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li><a href="https://github.com/amatsuda/kaminari">amatsuda/kaminari &middot; GitHub</a></li>
<li><a href="https://github.com/amatsuda/kaminari/wiki/Kaminari-recipes">Kaminari recipes &middot; amatsuda/kaminari Wiki &middot; GitHub</a></li>
</ul>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141113/1415874683.html"><time data-relative datetime="2014-11-13T10:31:23Z" title="2014-11-13T10:31:23Z" pubdate class="updated">2014-11-13 19:31</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141113/1415874683" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141113%2F1415874683" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141113/1415874683" data-count="vertical" data-text="Railsでkaminariを使ってページネーションを実現する - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141113/1415874683" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user_2nd', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_1', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_1" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-2800 words-200 mode-hatena entry-even" id="entry-8454420450072935634" data-keyword-campaign="" data-uuid="8454420450072935634">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/12.html" rel="nofollow">
          <time pubdate datetime="2014-11-12T14:54:36Z" title="2014-11-12T14:54:36Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">12</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141112/1415804076.html" class="entry-title-link bookmark">Railsで検索可能なセレクトボックスのselect2を使う方法</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%20gem.html">Rails gem</a>
          
          <a href="archive/category/UI%7CUX.html">UI/UX</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        
<div class="section">
    <h3>select2とは</h3>
    <p><a href="http://ivaynberg.github.io/select2/#top" target="_blank">select2</a>とは、セレクトボックスを検索可能なセレクトボックスにしてくれるjQueryプラグインです。<br />
セレクトボックスの項目が多い場合、検索できないと選択が大変なのでとても便利です。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108173340.png" alt="f:id:nipe880324:20141108173340p:plain:w260" title="f:id:nipe880324:20141108173340p:plain:w260" class="hatena-fotolife" style="width:260px" itemprop="image"></span></p><br />
<p><i>※ Chosen という同じようなjQueryプラグインもあるのですが、Enterキーの処理がうまく動かなく日本語で検索しづらいのでこちらの方がオススメです。</i><br />
</p>

</div>
<div class="section">
    <h3>動作確認環境</h3>
    
<ul>
<li>Rails 4.1</li>
<li>select2-rails 3.5.9.1</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1416115266.html#select2-create">Railsプロジェクトの作成</a></li>
<li><a href="index-page=1416115266.html#select2-install">select2-railsのインストール</a></li>
<li><a href="index-page=1416115266.html#select2-install-with-bootstrap">select2にtwitter-bootstrapをインストール</a></li>
</ol><p><br />
<h3 id="select2-create">Railsプロジェクトの作成</h3>まずはRailsプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new select2_test
cd select2_test</pre><p>次にselect2の挙動を確認するために、PersonをScaffoldで作成します。</p>
<pre class="code" data-lang="" data-unlink>rails g scaffold Person name:string</pre><p>セレクトボックスで表示するためのデータをseeds.rbに記載します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># db/seeds.rb</span>

<span class="synType">Person</span>.create <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">鈴木太郎</span><span class="synSpecial">&quot;</span>
<span class="synType">Person</span>.create <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">鈴木一郎</span><span class="synSpecial">&quot;</span>
<span class="synType">Person</span>.create <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">田中太郎</span><span class="synSpecial">&quot;</span>
<span class="synType">Person</span>.create <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">田中一郎</span><span class="synSpecial">&quot;</span>
</pre><p>マイグレーションを実行し、データを投入します。</p>
<pre class="code" data-lang="" data-unlink>rake db:migrate
rake db:seed</pre><p>そして、ここでは便宜上、一覧画面にセレクトボックスを追加します。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/people/index.html.erb

<span class="synComment">&lt;!-- 一番下の行に追加 --&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> select_tag</span><span class="synIdentifier"> :person, options_from_collection_for_select(@people, :</span><span class="synType">id</span><span class="synIdentifier">, :</span><span class="synType">name</span><span class="synIdentifier">), include_blank: true %&gt;</span>
</pre><p><br />
では、<code>rails s</code>でサーバーを起動し、セレクトボックスを確認してみます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108173202.png" alt="f:id:nipe880324:20141108173202p:plain:w320" title="f:id:nipe880324:20141108173202p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<br />
<br />
<p><h3 id="select2-install">select2-railsのインストール</h3></p><p>Gemfileに<code>select2-rails</code>を追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Gemfile</span>

gem <span class="synSpecial">&quot;</span><span class="synConstant">jquery-turbolinks</span><span class="synSpecial">&quot;</span> <span class="synComment"># Turbolinksで遷移したときもjQuery.ready()を呼び出してくれる</span>
gem <span class="synSpecial">&quot;</span><span class="synConstant">select2-rails</span><span class="synSpecial">&quot;</span>
</pre><p>そして、Bundlerでgemをインストールします。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p><br />
次に、assetsのapplication.jsにjQuery-turbolinksとselect2を追加します。</p>
<pre class="code" data-lang="" data-unlink># app/assets/javascripts/application.js

...
//
//= require jquery
//= require jquery.turbolinks
//= require jquery_ujs
//= require select2
//= require turbolinks
//= require_tree .</pre><p><br />
assetsのapplication.cssにもselect2を追加します。</p>
<pre class="code" data-lang="" data-unlink># app/assets/stylesheets/application.css

 ...
 *= require select2
 *= require_tree .
 *= require_self
 */</pre><p>そして、CofffeeScriptを追記します。</p>
<pre class="code" data-lang="" data-unlink># app/assets/javascripts/people.js.coffee

$ -&gt;
  $(&#34;.searchable&#34;).select2({
      width:      200,  # 横幅
      allowClear: true  # x で選択したものを削除できる
      # 詳細は http://ivaynberg.github.io/select2/#documentation
    })
</pre><p>これで、select2を使いたいセレクトボックスのclass属性に<code>searchable</code>を追加するだけでselect2が使えるようになります。<br />
では、<code>searchable</code>を追加しましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/people/index.html.erb

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> select_tag</span><span class="synIdentifier"> :person, options_from_collection_for_select(@people, :</span><span class="synType">id</span><span class="synIdentifier">, :</span><span class="synType">name</span><span class="synIdentifier">), include_blank: true, </span><span class="synType">class</span><span class="synIdentifier">: </span><span class="synConstant">&quot;searchable&quot;</span><span class="synIdentifier"> %&gt;</span>
</pre><p><br />
再度<code>rails s</code>でサーバーを起動し、セレクトボックスを確認してみます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108173220.png" alt="f:id:nipe880324:20141108173220p:plain:w320" title="f:id:nipe880324:20141108173220p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<br />
<p>ちなみに、次のように<code>multiple: true</code>を追加することで、複数選択にも対応しています。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/people/index.html.erb

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> select_tag</span><span class="synIdentifier"> :person, options_from_collection_for_select(@people, :</span><span class="synType">id</span><span class="synIdentifier">, :</span><span class="synType">name</span><span class="synIdentifier">), include_blank: true, </span><span class="synType">multiple</span><span class="synIdentifier">: true, </span><span class="synType">class</span><span class="synIdentifier">: </span><span class="synConstant">&quot;searchable&quot;</span><span class="synIdentifier"> %&gt;</span>
</pre><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108173232.png" alt="f:id:nipe880324:20141108173232p:plain:w320" title="f:id:nipe880324:20141108173232p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<br />
<p>もし、Twitter Bootstrapを使っている場合は、次の１行をapplication.cssに追加してください。</p>
<pre class="code" data-lang="" data-unlink># app/assets/stylesheets/application.css

 ...
 *= require select2
 *= require select2-bootstrap
 *= require_tree .
 *= require_self
 */</pre><p><br />
以上です。</p>

</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li><a href="http://ivaynberg.github.io/select2/#top">Select2 has moved!</a></li>
<li><a href="https://github.com/argerim/select2-rails">argerim/select2-rails &middot; GitHub</a></li>
<li><a href="http://qiita.com/saboyutaka/items/bcc0966313c6f7399a6e">Rails - Turbolinks&#x3092;&#x30AA;&#x30D5;&#x3057;&#x306A;&#x3044;&#x305F;&#x3081;&#x306B;&#x3084;&#x3063;&#x305F;&#x4E8B; - Qiita</a></li>
</ul>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141112/1415804076.html"><time data-relative datetime="2014-11-12T14:54:36Z" title="2014-11-12T14:54:36Z" pubdate class="updated">2014-11-12 23:54</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141112/1415804076" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141112%2F1415804076" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141112/1415804076" data-count="vertical" data-text="Railsで検索可能なセレクトボックスのselect2を使う方法 - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141112/1415804076" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
          <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4438296558807254"
     data-ad-slot="4370884664"
     data-ad-format="horizontal"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-3200 words-400 mode-hatena entry-odd" id="entry-8454420450072926620" data-keyword-campaign="" data-uuid="8454420450072926620">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/11.html" rel="nofollow">
          <time pubdate datetime="2014-11-11T11:58:21Z" title="2014-11-11T11:58:21Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">11</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141111/1415707101.html" class="entry-title-link bookmark">Railsでrescue_fromメソッドを使ってエラーハンドリングをする方法</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/%E9%81%8B%E7%94%A8.html">運用</a>
          
          <a href="archive/category/%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0.html">エラーハンドリング</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p>運用をしていくと、Railsアプリケーション内で例外が発生した場合に、適切な例外処理をする必要があります。<br />
Railsでは、コントローラー内に<code>rescue_from</code>メソッドを使って、例外をキャッチし例外処理を記述することが一般的です。</p>

<div class="section">
    <h3>確認環境</h3>
    
<ul>
<li>Ruby   2.1.2</li>
<li>Rails  4.1</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1416115266.html#rails-error-handling-create-rails">Railsプロジェクトの作成</a></li>
<li><a href="index-page=1416115266.html#rails-error-handling-getting-started">エラーハンドリング処理の追加</a></li>
<li><a href="index-page=1416115266.html#rails-error-handling-confirmation">エラーハンドリング処理の確認</a></li>
</ol><p></p><p><h3 id="rails-error-handling-create-rails">1. Railsプロジェクトの作成</h3>まずはRailsプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new error_handling_test
cd error_handling_test</pre><p>次にエラーハンドリングの挙動を確認するために、PostをScaffoldで作成します。</p>
<pre class="code" data-lang="" data-unlink>rails g scaffold Post title:string content:text
rake db:migrate</pre><p></p><p><h3 id="rails-error-handling-getting-started">2. エラーハンドリング処理の追加</h3>では、Railsにエラーハンドリングを追加していきましょう。</p><p>まず、ApplicationControllerにエラーハンドリング処理を追加します。<br />
<code>rescue_from</code>メソッドにより、アプリケーション内のException(例外)をキャッチし、適切な処理をさせるという流れです。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/controllers/application_controller.rb</span>

<span class="synPreProc">class</span> <span class="synType">ApplicationController</span> &lt; <span class="synType">ActionController</span>::<span class="synType">Base</span>
  <span class="synComment"># Prevent CSRF attacks by raising an exception.</span>
  <span class="synComment"># For APIs, you may want to use :null_session instead.</span>
  protect_from_forgery <span class="synConstant">with</span>: <span class="synConstant">:exception</span>

  <span class="synComment"># 他のエラーハンドリングでキャッチできなかった場合に</span>
  <span class="synComment"># 500 Internal Server Error(システムエラー)を発生させる</span>
  <span class="synComment"># </span><span class="synTodo">NOTE</span><span class="synComment">: rescue_from は下から評価されるので記載箇所はここが正解</span>
  rescue_from <span class="synType">Exception</span>, <span class="synConstant">with</span>: <span class="synConstant">:handle_500</span> <span class="synStatement">unless</span> <span class="synType">Rails</span>.env.development?

  <span class="synComment"># 例外に合わせたエラーハンドリング</span>
  <span class="synComment"># 404 Not Found リソースが見つからない。アクセス権がない場合にも使用される</span>
  rescue_from <span class="synType">ActionController</span>::<span class="synType">RoutingError</span>, <span class="synConstant">with</span>: <span class="synConstant">:handle_404</span> <span class="synStatement">unless</span> <span class="synType">Rails</span>.env.development?
  rescue_from <span class="synType">ActiveRecord</span>::<span class="synType">RecordNotFound</span>,   <span class="synConstant">with</span>: <span class="synConstant">:handle_404</span> <span class="synStatement">unless</span> <span class="synType">Rails</span>.env.development?
  <span class="synComment">#rescue_from ActiveRecord::RecordNotUnique, with: :render_409</span>
  <span class="synComment">#rescue_from UnauthorizedError,             with: :render_401</span>
  <span class="synComment">#rescue_from IllegalAccessError,            with: :render_403</span>

  <span class="synComment"># エラーハンドリング処理</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">handle_500</span>(exception = <span class="synConstant">nil</span>)
    logger.info <span class="synSpecial">&quot;</span><span class="synConstant">Rendering 500 with exception: </span><span class="synSpecial">#{</span>exception.message<span class="synSpecial">}&quot;</span> <span class="synStatement">if</span> exception

    <span class="synStatement">if</span> request.xhr?
      <span class="synComment"># Ajaxのための処理</span>
      render <span class="synConstant">json</span>: { <span class="synConstant">error</span>: <span class="synSpecial">'</span><span class="synConstant">500 error</span><span class="synSpecial">'</span> }, <span class="synConstant">status</span>: <span class="synConstant">500</span>
    <span class="synStatement">else</span>
      render <span class="synConstant">template</span>: <span class="synSpecial">'</span><span class="synConstant">errors/error_500</span><span class="synSpecial">'</span>, <span class="synConstant">status</span>: <span class="synConstant">500</span>, <span class="synConstant">layout</span>: <span class="synSpecial">'</span><span class="synConstant">application</span><span class="synSpecial">'</span>, <span class="synConstant">content_type</span>: <span class="synSpecial">'</span><span class="synConstant">text/html</span><span class="synSpecial">'</span>
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>

  <span class="synPreProc">def</span> <span class="synIdentifier">handle_404</span>(exception = <span class="synConstant">nil</span>)
    logger.info <span class="synSpecial">&quot;</span><span class="synConstant">Rendering 404 with exception: </span><span class="synSpecial">#{</span>exception.message<span class="synSpecial">}&quot;</span> <span class="synStatement">if</span> exception

    <span class="synStatement">if</span> request.xhr?
      <span class="synComment"># Ajaxのための処理</span>
      render <span class="synConstant">json</span>: { <span class="synConstant">error</span>: <span class="synSpecial">'</span><span class="synConstant">404 error</span><span class="synSpecial">'</span> }, <span class="synConstant">status</span>: <span class="synConstant">404</span>
    <span class="synStatement">else</span>
      render <span class="synConstant">template</span>: <span class="synSpecial">'</span><span class="synConstant">errors/error_404</span><span class="synSpecial">'</span>, <span class="synConstant">status</span>: <span class="synConstant">404</span>, <span class="synConstant">layout</span>: <span class="synSpecial">'</span><span class="synConstant">application</span><span class="synSpecial">'</span>, <span class="synConstant">content_type</span>: <span class="synSpecial">'</span><span class="synConstant">text/html</span><span class="synSpecial">'</span>
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>

<span class="synPreProc">end</span>
</pre><p><br />
次に、エラーハンドリング時に表示させるビューを作成します。</p><p>500エラー時のビューです。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/errors/error_500.html.erb
システムエラーが発生しました。<span class="synIdentifier">&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>
管理者にご連絡してください。
</pre><p> 404エラー時のビューです。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/errors/error_404.html.erb
ご指定になったページは存在しません。
</pre><p><br />
ルーティングに定義されていなURLの場合、エラーはRack MIddlewareで発生するので、<code>rescue_from</code>メソッドでキャッチできません。<br />
そのため、ルーティング設定の最後にすべてのURLをキャッチするようにして対応します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># config/routes.rb</span>

<span class="synType">Rails</span>.application.routes.draw <span class="synStatement">do</span>
  resources <span class="synConstant">:posts</span>

  root <span class="synSpecial">&quot;</span><span class="synConstant">posts#index</span><span class="synSpecial">&quot;</span>

  match <span class="synSpecial">&quot;</span><span class="synConstant">*path</span><span class="synSpecial">&quot;</span> =&gt; <span class="synSpecial">&quot;</span><span class="synConstant">application#handle_404</span><span class="synSpecial">&quot;</span>, <span class="synConstant">via</span>: <span class="synConstant">:all</span>
<span class="synStatement">end</span>
</pre><p>これでエラーハンドリングの実装は完了です。</p><br />
<br />
<br />
<p><h3 id="rails-error-handling-confirmation">3. エラーハンドリング処理の確認</h3></p><p>では、<code>production</code>モードでサーバーを起動させ、エラーハンドリング処理の確認をしましょう。<br />
<b>productionモードでのサーバーの起動方法は、<a href="entry/20141111/1415707101.html" target="_blank">こちら</a></b></p><br />
<p><code>localhost:3000</code>にアクセスしましょう。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108151607.png" alt="f:id:nipe880324:20141108151607p:plain:w480" title="f:id:nipe880324:20141108151607p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<p>では、Postを作成してましょう。問題なく登録できます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108151634.png" alt="f:id:nipe880324:20141108151634p:plain:w480" title="f:id:nipe880324:20141108151634p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<p>次に、URLを適当な値にし、存在しないIDにアクセスしてみましょう。404エラー画面に遷移します。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108151717.png" alt="f:id:nipe880324:20141108151717p:plain:w480" title="f:id:nipe880324:20141108151717p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<p>また、存在しないURLにアクセスした場合も、404エラーが発生します。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108151737.png" alt="f:id:nipe880324:20141108151737p:plain:w480" title="f:id:nipe880324:20141108151737p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<p>最後に、シンタックスエラーなどにし、サーバーを再起動しアクセスすると、500エラーが発生します。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108151757.png" alt="f:id:nipe880324:20141108151757p:plain:w480" title="f:id:nipe880324:20141108151757p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<p>以上です。<br />
<br />
</p>

</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li>本「パーフェクトRuby on Rails」</li>
<li>[<a href="http://qiita.com/ms2sato/items/249ec3aa186dd42176fb">Rails - rescue_from&#x306E;&#x8D70;&#x67FB;&#x306F;&#x4E0B;&#x304B;&#x3089;&#x4E0A;&#x3060;&#x3063;&#x305F;&#x3002; - Qiita</a></li>
<li><a href="http://ja.wikipedia.org/wiki/HTTP%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89">HTTP&#x30B9;&#x30C6;&#x30FC;&#x30BF;&#x30B9;&#x30B3;&#x30FC;&#x30C9; - Wikipedia</a></li>
</ul>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141111/1415707101.html"><time data-relative datetime="2014-11-11T11:58:21Z" title="2014-11-11T11:58:21Z" pubdate class="updated">2014-11-11 20:58</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141111/1415707101" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141111%2F1415707101" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141111/1415707101" data-count="vertical" data-text="Railsでrescue_fromメソッドを使ってエラーハンドリングをする方法 - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141111/1415707101" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user_2nd', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_2', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_2" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-1600 words-100 mode-hatena entry-even" id="entry-8454420450072928979" data-keyword-campaign="" data-uuid="8454420450072928979">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/10.html" rel="nofollow">
          <time pubdate datetime="2014-11-10T12:47:50Z" title="2014-11-10T12:47:50Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">10</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141110/1415623670.html" class="entry-title-link bookmark">RailsをローカルでProductionモードで起動させる方法</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%E5%88%9D%E7%B4%9A.html">Rails初級</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p>ローカル環境でRailsを<code>production</code>モードで起動させようとするといろいろと詰まるので起動方法をまとめました。<br />
<br />
</p>

<div class="section">
    <h3>確認環境</h3>
    
<ul>
<li>Rails 4.1</li>
<li>Rails 4.2</li>
</ul>
</div>
<div class="section">
    <h3>productionモードで起動させる方法</h3>
    <p>まず、production環境のDBを作成します。</p>
<pre class="code lang-sh" data-lang="sh" data-unlink>bin/rake db:migrate <span class="synIdentifier">RAILS_ENV</span>=production
</pre><p><br />
<code>production</code>モードでは静的ファイルはNginxやApacheなどのWebサーバーが配信するのが適切なのですが、今回は、Webサーバーを立てるのがめんどくさいので、Rails側で静的ファイルを配信しなければなりません。<br />
そのため、以下の設定を<code>true</code>にします。<br />
NginxやApacheなどのWebサーバー経由でアクセスする場合は、下記は必要ありません。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># config/environments/production.rb</span>

<span class="synComment"># Rails 4.1の場合</span>
<span class="synComment"># Disable Rails's static asset server (Apache or nginx will already do this).</span>
<span class="synComment"># config.serve_static_assets = false</span>
config.serve_static_assets = <span class="synConstant">true</span>


<span class="synComment"># Rails 4.2の場合は、次のようになっています。</span>
<span class="synComment"># 特に修正する必要はないが、起動時にRAILS_SERVE_STATIC_FILES という環境変数を指定する必要があります。</span>
<span class="synComment"># Disable serving static files from the `/public` folder by default since</span>
<span class="synComment"># Apache or NGINX already handles this.</span>
config.serve_static_files = <span class="synIdentifier">ENV</span>[<span class="synSpecial">'</span><span class="synConstant">RAILS_SERVE_STATIC_FILES</span><span class="synSpecial">'</span>].present?
</pre><p><br />
そして、静的ファイルをPreCompileしておきます。</p>
<pre class="code" data-lang="" data-unlink>rake assets:precompile RAILS_ENV=production</pre><p></p><br />
<p><code>production</code>モードでは、<code>secret_key_base</code>が必要なので作成し、一時的に設定します。<br />
そして、サーバーを<code>production</code>モードで起動します。<br />
本番のときは、SECRET_KEY_BASEは環境変数に設定し、起動するたびに変更しないようにしてください。</p>
<pre class="code lang-sh" data-lang="sh" data-unlink>// Rails 4.1 の場合
<span class="synIdentifier">SECRET_KEY_BASE</span>=<span class="synPreProc">$(</span><span class="synSpecial">rake secret</span><span class="synPreProc">)</span> rails s <span class="synSpecial">-eproduction</span>

// Rails 4.2 の場合
<span class="synIdentifier">SECRET_KEY_BASE</span>=<span class="synPreProc">$(</span><span class="synSpecial">rake secret</span><span class="synPreProc">)</span> <span class="synIdentifier">RAILS_SERVE_STATIC_FILES</span>=<span class="synStatement">true</span> rails s <span class="synSpecial">-eproduction</span>
</pre><p></p><br />
<p>最後に、実際に画面にアクセスし、スタイルシートやJSファイルが読み込まれているか確認してください。<br />
うまく読み込まれていない場合は、ブラウザのログにスタイルシートやJSが見つからないといったような、<br />
次のようにエラーが出ているはずです。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108153747.png" alt="f:id:nipe880324:20141108153747p:plain:w480" title="f:id:nipe880324:20141108153747p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>以上です。</p>

</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141110/1415623670.html"><time data-relative datetime="2014-11-10T12:47:50Z" title="2014-11-10T12:47:50Z" pubdate class="updated">2014-11-10 21:47</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141110/1415623670" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141110%2F1415623670" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141110/1415623670" data-count="vertical" data-text="RailsをローカルでProductionモードで起動させる方法 - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141110/1415623670" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
          <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4438296558807254"
     data-ad-slot="4370884664"
     data-ad-format="horizontal"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-6400 words-800 mode-hatena entry-odd" id="entry-8454420450072917496" data-keyword-campaign="" data-uuid="8454420450072917496">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/09.html" rel="nofollow">
          <time pubdate datetime="2014-11-09T08:37:22Z" title="2014-11-09T08:37:22Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">09</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141109/1415522242.html" class="entry-title-link bookmark">Railsでbulletを使ってN+1問題を発見しDBアクセスのパフォーマンスを向上させる</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%20gem.html">Rails gem</a>
          
          <a href="archive/category/%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9.html">パフォーマンス</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p><a href="https://github.com/flyerhzm/bullet" target="_blnak">bullet</a>とは、N+1問題や使われていないEager Loadingを発見するためのツールです。<br />
これらの問題があると無駄なSQLクエリが実行されるので、パフォーマンスを落としてしまいます。<br />
気をつけていてもN+1問題は発生してしまう可能性があるので、bulletを導入して自動で発見できるようにしてみます。</p><p><i>※ N+1問題やEager Loadingについてよくわからない方は、<a href="entry/20141108/1415418367.html" target="_blank">N+1問題 / Eager Loading とは</a>を参照ください。</i></p><p></p>

<div class="section">
    <h3>確認環境</h3>
    
<ul>
<li>Ruby   2.1.2</li>
<li>Rails  4.1</li>
<li>bullet 4.14.0</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1416115266.html#rails-bullet-create-rails">Railsプロジェクトの作成</a></li>
<li><a href="index-page=1416115266.html#rails-bullet-getting-started">Bulletのインストール方法</a></li>
<li><a href="index-page=1416115266.html#rails-bullet-whitelist">Bulletのホワイトリストの設定</a></li>
<li><a href="index-page=1416115266.html#rails-bullet-run-in-tests">Bulletをテストで実行</a></li>
</ol><p></p><p><h3 id="rails-bullet-create-rails">1. Railsプロジェクトの作成</h3>まずはRailsプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new bullet_test
cd bullet_test</pre><p>次に<code>bullet</code>の挙動を確認するために、N+1問題を発生させるために必要なソースを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails g scaffold Post title:string content:text user_id:integer
rails g model User name:string</pre><p>Modelに関連を追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/user.rb</span>
<span class="synPreProc">class</span> <span class="synType">User</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  has_many <span class="synConstant">:posts</span>
<span class="synPreProc">end</span>

<span class="synComment"># app/models/post.rb</span>
<span class="synPreProc">class</span> <span class="synType">Post</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  belongs_to <span class="synConstant">:user</span>
<span class="synPreProc">end</span>
</pre><p>Postの一覧画面でUserモデルも表示するようにします。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/posts/index.html.erb
    ...
    <span class="synIdentifier">&lt;% @posts.each do |post| %&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> post.title</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> post.content</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synComment">&lt;!-- 修正箇所開始 --&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> post.user.name</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synComment">&lt;!-- 修正箇所完了 --&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Show'</span><span class="synIdentifier">, post %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Edit'</span><span class="synIdentifier">, edit_post_path(post) %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Destroy'</span><span class="synIdentifier">, post, </span><span class="synType">method</span><span class="synIdentifier">: :delete, </span><span class="synType">data</span><span class="synIdentifier">: { confirm: </span><span class="synConstant">'Are you sure?'</span><span class="synIdentifier"> } %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;% end %&gt;</span>
    ...
</pre><p>seeds.rbに初期データを追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># db/seeds.rb</span>
<span class="synConstant">10</span>.times <span class="synStatement">do</span> |<span class="synIdentifier">i</span>|
  user = <span class="synType">User</span>.create <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">ユーザー名</span><span class="synSpecial">#{</span>i<span class="synSpecial">}&quot;</span>
  user.posts.create <span class="synConstant">title</span>: <span class="synSpecial">&quot;</span><span class="synConstant">タイトル</span><span class="synSpecial">#{</span>i<span class="synSpecial">}&quot;</span>, <span class="synConstant">content</span>: <span class="synSpecial">&quot;</span><span class="synConstant">本文</span><span class="synSpecial">#{</span>i<span class="synSpecial">}&quot;</span>
<span class="synStatement">end</span>
</pre><p>マイグレーションを実行し、データを投入します。</p>
<pre class="code" data-lang="" data-unlink>rake db:migrate
rake db:seed</pre><p>では、<code>rails s</code>でサーバーを起動し、<code>http://localhost:3000/posts</code>にアクセスしてみてください。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108134446.png" alt="f:id:nipe880324:20141108134446p:plain:w480" title="f:id:nipe880324:20141108134446p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>このときの、サーバーのログを確認すると次のようになっていて、Postの表示数（10回)+1回のSQlが実行されているので、<b>N+1問題</b>が発生しています。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">Started</span> <span class="synType">GET</span> <span class="synSpecial">&quot;</span><span class="synConstant">/posts</span><span class="synSpecial">&quot;</span> <span class="synStatement">for</span> <span class="synConstant">127.0</span>.<span class="synConstant">0.1</span> at <span class="synConstant">2014</span>-<span class="synConstant">11</span>-08 <span class="synConstant">12</span>:<span class="synConstant">58</span>:<span class="synConstant">51</span> +0900
<span class="synType">Processing</span> by <span class="synType">PostsController</span><span class="synComment">#index as HTML</span>
  <span class="synType">Post</span> Load (<span class="synConstant">0</span>.3ms) <span class="synType">SELECT</span> <span class="synSpecial">&quot;</span><span class="synConstant">posts</span><span class="synSpecial">&quot;</span>.* <span class="synType">FROM</span> <span class="synSpecial">&quot;</span><span class="synConstant">posts</span><span class="synSpecial">&quot;</span>
  <span class="synType">User</span> Load (<span class="synConstant">0</span>.3ms) <span class="synType">SELECT</span>  <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.* <span class="synType">FROM</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>  <span class="synType">WHERE</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span> = ? <span class="synType">LIMIT</span> <span class="synConstant">1</span>  [[<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>, <span class="synConstant">1</span>]]
  <span class="synType">User</span> Load (<span class="synConstant">0</span>.1ms) <span class="synType">SELECT</span>  <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.* <span class="synType">FROM</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>  <span class="synType">WHERE</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span> = ? <span class="synType">LIMIT</span> <span class="synConstant">1</span>  [[<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>, <span class="synConstant">2</span>]]
  <span class="synType">User</span> Load (<span class="synConstant">0</span>.1ms) <span class="synType">SELECT</span>  <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.* <span class="synType">FROM</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>  <span class="synType">WHERE</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span> = ? <span class="synType">LIMIT</span> <span class="synConstant">1</span>  [[<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>, <span class="synConstant">3</span>]]
  <span class="synType">User</span> Load (<span class="synConstant">0</span>.1ms) <span class="synType">SELECT</span>  <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.* <span class="synType">FROM</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>  <span class="synType">WHERE</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span> = ? <span class="synType">LIMIT</span> <span class="synConstant">1</span>  [[<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>, <span class="synConstant">4</span>]]
  <span class="synType">User</span> Load (<span class="synConstant">0</span>.1ms) <span class="synType">SELECT</span>  <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.* <span class="synType">FROM</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>  <span class="synType">WHERE</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span> = ? <span class="synType">LIMIT</span> <span class="synConstant">1</span>  [[<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>, <span class="synConstant">5</span>]]
  <span class="synType">User</span> Load (<span class="synConstant">0</span>.1ms) <span class="synType">SELECT</span>  <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.* <span class="synType">FROM</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>  <span class="synType">WHERE</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span> = ? <span class="synType">LIMIT</span> <span class="synConstant">1</span>  [[<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>, <span class="synConstant">6</span>]]
  <span class="synType">User</span> Load (<span class="synConstant">0</span>.1ms) <span class="synType">SELECT</span>  <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.* <span class="synType">FROM</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>  <span class="synType">WHERE</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span> = ? <span class="synType">LIMIT</span> <span class="synConstant">1</span>  [[<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>, <span class="synConstant">7</span>]]
  <span class="synType">User</span> Load (<span class="synConstant">0</span>.1ms) <span class="synType">SELECT</span>  <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.* <span class="synType">FROM</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>  <span class="synType">WHERE</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span> = ? <span class="synType">LIMIT</span> <span class="synConstant">1</span>  [[<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>, <span class="synConstant">8</span>]]
  <span class="synType">User</span> Load (<span class="synConstant">0</span>.1ms) <span class="synType">SELECT</span>  <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.* <span class="synType">FROM</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>  <span class="synType">WHERE</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span> = ? <span class="synType">LIMIT</span> <span class="synConstant">1</span>  [[<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>, <span class="synConstant">9</span>]]
  <span class="synType">User</span> Load (<span class="synConstant">0</span>.1ms) <span class="synType">SELECT</span>  <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.* <span class="synType">FROM</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>  <span class="synType">WHERE</span> <span class="synSpecial">&quot;</span><span class="synConstant">users</span><span class="synSpecial">&quot;</span>.<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span> = ? <span class="synType">LIMIT</span> <span class="synConstant">1</span>  [[<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>, <span class="synConstant">10</span>]]
  <span class="synType">Rendered</span> posts/index.html.erb within layouts/application (<span class="synConstant">56</span>.1ms)
<span class="synType">Completed</span> <span class="synConstant">200</span> <span class="synType">OK</span> <span class="synStatement">in</span> 107ms (<span class="synConstant">Views</span>: <span class="synConstant">101</span>.4ms | <span class="synConstant">ActiveRecord</span>: <span class="synConstant">2</span>.2ms)
</pre><p></p><br />
<p><h3 id="rails-bullet-getting-started">2. Bulletのインストール方法</h3>では、N+1問題を自動的に発見するために<code>bullet</code>をインストールしていきましょう。</p><p><code>Gemfile</code>にbulletを追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Gemfile</span>

group <span class="synConstant">:development</span> <span class="synStatement">do</span>
  gem <span class="synSpecial">'</span><span class="synConstant">bullet</span><span class="synSpecial">'</span>
<span class="synStatement">end</span>
</pre><p>Bundlerを実行します。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p><code>bullet</code>は明示的に設定を記載しないと何もしないので、設定を記載します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># config/environments/development.rb</span>

<span class="synType">Rails</span>.application.configure <span class="synStatement">do</span>
  ...

  config.after_initialize <span class="synStatement">do</span>
    <span class="synType">Bullet</span>.enable  = <span class="synConstant">true</span>   <span class="synComment"># bullet を有効にする</span>

    <span class="synComment"># 以下はN+1問題を発見した時のユーザーへの通知方法</span>
    <span class="synType">Bullet</span>.alert   = <span class="synConstant">true</span>   <span class="synComment"># ブラウザのJavaScriptアラート</span>
    <span class="synType">Bullet</span>.bullet_logger = <span class="synConstant">true</span> <span class="synComment"># Rails.root/log/bullet.log</span>
    <span class="synType">Bullet</span>.console = <span class="synConstant">true</span>   <span class="synComment"># ブラウザの console.log の出力先</span>
    <span class="synComment">#Bullet.growl   = true   # Growl</span>
    <span class="synComment">#Bullet.xmpp = { :account  =&gt; 'bullets_account@jabber.org',</span>
    <span class="synComment">#                :password =&gt; 'bullets_password_for_jabber',</span>
    <span class="synComment">#                :receiver =&gt; 'your_account@jabber.org',</span>
    <span class="synComment">#                :show_online_status =&gt; true }</span>
    <span class="synType">Bullet</span>.rails_logger = <span class="synConstant">true</span> <span class="synComment"># Railsのログ</span>
    <span class="synComment">#Bullet.bugsnag      = true # 総合デバッガツールbugsnag</span>
    <span class="synComment">#Bullet.airbrake     = true # Airbrake</span>
    <span class="synComment">#Bullet.raise        = true # Exceptionを発生</span>
    <span class="synType">Bullet</span>.add_footer   = <span class="synConstant">true</span> <span class="synComment"># 画面の下部に表示</span>
    <span class="synComment"># include paths with any of these substrings in the stack trace,</span>
    <span class="synComment"># even if they are not in your main app</span>
    <span class="synComment">#Bullet.stacktrace_includes = [ 'your_gem', 'your_middleware' ]</span>
  <span class="synStatement">end</span>
<span class="synStatement">end</span>
</pre><p><br />
では、サーバーを再起動し、一覧画面にアクセスし、BulletがN+1問題を検出していることを確認しましょう。<br />
まず、<code>Bullet.alert = true</code>により次のようにJavaScriptのアラートが表示されます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108134453.png" alt="f:id:nipe880324:20141108134453p:plain:w320" title="f:id:nipe880324:20141108134453p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<p>さらに、<code>Bullet.add_footer</code>により画面左下部にも表示されています。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108134458.png" alt="f:id:nipe880324:20141108134458p:plain:w480" title="f:id:nipe880324:20141108134458p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<p><span style="color: #ff2600">画面に表示する系統の問題点として、JSONなどの非同期処理の場合だとうまく表示されないので、<code>Bullet.raise = true</code>などにしておくことをお勧めします。</span></p><p>そして、<code>Bullet.rails_logger = true</code>で<code>development.log</code>にも表示されます。</p>
<pre class="code" data-lang="" data-unlink># log/development.log

N+1 Query detected
  Post =&gt; [:user]
  Add to your finder: :include =&gt; [:user]
N+1 Query method call stack
  /Users/nipe0324/rails_samples/bullet_test/app/views/posts/index.html.erb:18:in `block in _app_views_posts_index_html_erb__4222087890434289677_70113588353160&#39;
  /Users/nipe0324/rails_samples/bullet_test/app/views/posts/index.html.erb:14:in `_app_views_posts_index_html_erb__4222087890434289677_70113588353160&#39;</pre><p>最後に、<code>Bullet.bullet_logger = true</code>で<code>bullet.log</code>にも表示されます。</p>
<pre class="code" data-lang="" data-unlink># log/bullet.log

2014-11-08 13:20:47[WARN] user: nipe0324
http://localhost:3000/posts
N+1 Query detected
  Post =&gt; [:user]
  Add to your finder: :include =&gt; [:user]
N+1 Query method call stack
  /Users/nipe0324/rails_samples/bullet_test/app/views/posts/index.html.erb:18:in `block in _app_views_posts_index_html_erb__4222087890434289677_70113588353160&#39;
  /Users/nipe0324/rails_samples/bullet_test/app/views/posts/index.html.erb:14:in `_app_views_posts_index_html_erb__4222087890434289677_70113588353160&#39;</pre><p><br />
では、N+1問題を解決しましょう。<br />
次のように記載されているので、Post取得時に<code>includes(:user)</code>を追記しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">N</span>+<span class="synConstant">1</span> <span class="synType">Query</span> detected
  <span class="synType">Post</span> =&gt; [<span class="synConstant">:user</span>]
  <span class="synType">Add</span> to your <span class="synConstant">finder</span>: <span class="synConstant">:include</span> =&gt; [<span class="synConstant">:user</span>]
</pre><pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/controllers/posts_controller.rb</span>

  <span class="synComment"># GET /posts</span>
  <span class="synComment"># GET /posts.json</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">index</span>
    <span class="synIdentifier">@posts</span> = <span class="synType">Post</span>.all.includes(<span class="synConstant">:user</span>)
  <span class="synPreProc">end</span>
</pre><p>画面を再表示させるとJSのアラートも、画面下部にも何も表示さていないと思います。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141108/20141108134446.png" alt="f:id:nipe880324:20141108134446p:plain:w480" title="f:id:nipe880324:20141108134446p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<br />
<br />
<p><h3 id="rails-bullet-whitelist">3. Bulletのホワイトリストの設定</h3>次のようにホワイトを記載することで、N+1問題を無視させることも可能です。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">Bullet</span>.add_whitelist <span class="synConstant">:type</span> =&gt; <span class="synConstant">:n_plus_one_query</span>, <span class="synConstant">:class_name</span> =&gt; <span class="synSpecial">&quot;</span><span class="synConstant">Post</span><span class="synSpecial">&quot;</span>, <span class="synConstant">:association</span> =&gt; <span class="synConstant">:comments</span>
<span class="synType">Bullet</span>.add_whitelist <span class="synConstant">:type</span> =&gt; <span class="synConstant">:unused_eager_loading</span>, <span class="synConstant">:class_name</span> =&gt; <span class="synSpecial">&quot;</span><span class="synConstant">Post</span><span class="synSpecial">&quot;</span>, <span class="synConstant">:association</span> =&gt; <span class="synConstant">:comments</span>
<span class="synType">Bullet</span>.add_whitelist <span class="synConstant">:type</span> =&gt; <span class="synConstant">:counter_cache</span>, <span class="synConstant">:class_name</span> =&gt; <span class="synSpecial">&quot;</span><span class="synConstant">Country</span><span class="synSpecial">&quot;</span>, <span class="synConstant">:association</span> =&gt; <span class="synConstant">:cities</span>
</pre><p></p><p><h3 id="rails-bullet-run-in-tests">4. Bulletをテストで実行</h3></p><p>まず、bulletをtestでも使えるようにします。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Gemfile</span>

group <span class="synConstant">:development</span>, <span class="synConstant">:test</span> <span class="synStatement">do</span>
  gem <span class="synSpecial">'</span><span class="synConstant">bullet</span><span class="synSpecial">'</span>

  gem <span class="synSpecial">'</span><span class="synConstant">rspec-rails</span><span class="synSpecial">'</span>
<span class="synStatement">end</span>
</pre><p>次に、インストールします。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p><br />
テスト環境でもbulletを有効化させます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># config/environments/test.rb</span>

<span class="synType">Rails</span>.application.configure <span class="synStatement">do</span>
  ...

  <span class="synComment"># bullet for detecting N+1</span>
  config.after_initialize <span class="synStatement">do</span>
    <span class="synType">Bullet</span>.enable = <span class="synConstant">true</span>
    <span class="synType">Bullet</span>.bullet_logger = <span class="synConstant">true</span>
    <span class="synType">Bullet</span>.raise  = <span class="synConstant">true</span> <span class="synComment"># N+1問題が発見された時にErrorを発生させる</span>
  <span class="synStatement">end</span>
<span class="synStatement">end</span>
</pre><p>次に各テストにBulletのAPIを実行させます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># spec/rails_helper.rb</span>
<span class="synStatement">if</span> <span class="synType">Bullet</span>.enable?
  config.before(<span class="synConstant">:each</span>) <span class="synStatement">do</span>
    <span class="synType">Bullet</span>.start_request
  <span class="synStatement">end</span>

  config.after(<span class="synConstant">:each</span>) <span class="synStatement">do</span>
    <span class="synType">Bullet</span>.perform_out_of_channel_notifications <span class="synStatement">if</span> <span class="synType">Bullet</span>.notification?
    <span class="synType">Bullet</span>.end_request
  <span class="synStatement">end</span>
<span class="synStatement">end</span>
</pre><p><br />
以上です。</p>

</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li><a href="https://github.com/flyerhzm/bullet">flyerhzm/bullet &middot; GitHub</a></li>
</ul>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141109/1415522242.html"><time data-relative datetime="2014-11-09T08:37:22Z" title="2014-11-09T08:37:22Z" pubdate class="updated">2014-11-09 17:37</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141109/1415522242" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141109%2F1415522242" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141109/1415522242" data-count="vertical" data-text="Railsでbulletを使ってN+1問題を発見しDBアクセスのパフォーマンスを向上させる - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141109/1415522242" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user_2nd', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_3', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_3" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
            <!-- rakuten_ad_target_end -->
            <!-- google_ad_section_end -->

            
              <div class="pager autopagerize_insert_before">
                <span class="pager-next">
                  <a href="index-page=1415522242.html" rel="next">次のページ</a>
                </span>
              </div>
            
          
        </div>
      </div>

      
      <aside id="box1">
        <div id="box1-inner">
        </div>
      </aside>

    </div><!-- #wrapper -->

    <aside id="box2">
  
  <div id="box2-inner">
    
      
<div class="hatena-module hatena-module-html">
  <div class="hatena-module-body">
    <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-2736751992834286"
     data-ad-slot="8116686456"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>
</div>

      
      
    
      

<div class="hatena-module hatena-module-profile">
  <div class="hatena-module-title">
    プロフィール
  </div>
  <div class="hatena-module-body">
    
    <a href="about.html" class="profile-icon-link">
      <img src="http://cdn1.www.st-hatena.com/users/ni/nipe880324/profile.gif?1406435422"
      alt="id:nipe880324" class="profile-icon" />
    </a>
    

    
    <span class="id">
      <a href="about.html" class="hatena-id-link"><span data-load-nickname="1" data-user-name="nipe880324">id:nipe880324</span></a>
      
  
    
    
  


    </span>
    

    

    
      <div class="hatena-follow-button-box btn-subscribe js-hatena-follow-button-box"
  
  >

  <a href="index-page=1416115266.html#" class="hatena-follow-button js-hatena-follow-button">
    <span class="subscribing">
      <span class="foreground">読者です</span>
      <span class="background">読者をやめる</span>
    </span>
    <span class="unsubscribing" data-track-name="profile-widget-subscribe-button" data-track-once>
      <span class="foreground">読者になる</span>
      <span class="background">読者になる</span>
    </span>
  </a>
  <div class="subscription-count-box js-subscription-count-box">
    <i></i>
    <u></u>
    <span class="subscription-count js-subscription-count">
    </span>
  </div>
</div>

    

    

    

    
  </div>
</div>

      
      
    
      
<div class="hatena-module hatena-module-entries-access-ranking"
     data-count="4"
     data-display_entry_category="1"
     data-display_entry_image="0"
     data-display_entry_image_size_width="100"
     data-display_entry_image_size_height="100"
     data-display_entry_body_length="0"
     data-display_entry_date="1"
     data-display_bookmark_count="0"
     data-source="access"
>
  <div class="hatena-module-title">
    
      最近のアクセス
    
  </div>
  <div class="hatena-module-body">
    
  </div>
</div>

      
      
    
      
<div class="hatena-module hatena-module-html">
    <div class="hatena-module-title">    </div>
  <div class="hatena-module-body">
    <nav>
  <div class="side-category">
    <span class="side-category-title">Rails 入門</span>
    <ul class="side-category-list">
      <li><a href="entry/20140713/1405251091.html">RailsのためのRuby基礎</a></li>
      <li><a href="entry/20140813/1407915718.html">Rails入門者向け ブログ開発</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Railsコマンド</span>
    <ul class="side-category-list">
      <li><a href="entry/20140713/1405251709.html">rails new / server / console</a></li>
      <li><a href="entry/20150204/1423055537.html">rails new時の有用な6つの設定</a></li>
      <li><a href="entry/20150208/1423391199.html">rails new時のテンプレート</a></li>
      <li><a href="entry/20140802/1406948695.html">rails generate</a></li>
      <li><a href="entry/20141116/1416115266.html">rakeコマンド一覧</a></li>
      <li><a href="entry/20141117/1416225563.html">自前rakeコマンド</a></li>
      <li><a href="entry/20141110/1415623670.html">productionモードで起動</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Route / Controller</span>
    <ul class="side-category-list">
      <li><a href="entry/20140716/1405451238.html">Routing</a></li>
      <li><a href="entry/20140810/1407603600.html">レイアウトファイルを指定</a></li>
      <li><a href="entry/20141125/1416918957.html">ビューを返す(render)</a></li>
      <li><a href="entry/20140808/1407427457.html">リダイレクトする(redirect_to)</a></li>
      <li><a href="entry/20141126/1417012848.html">Strong Parameters</a></li>
      <li><a href="entry/20141129/1417223453.html">フィルタ(before_action, after_action)</a></li>
      <li><a href="entry/20141127/1417086075.html">簡易なメッセージ表示(Flash)</a></li>
      <li><a href="entry/20141130/1417334030.html">セッション(session)</a></li>
      <li><a href="entry/20141201/1417432408.html">リクエストヘッダ、レスポンスヘッダ(request, response)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Model, Migration</span>
    <ul class="side-category-list">
      <li><a href="entry/20140724/1406142120.html">CRUD</a></li>
      <li><a href="entry/20141203/1417601540.html">1対多関連</a></li>
      <li><a href="entry/20141204/1417688260.html">多対多関連</a></li>
      <li><a href="entry/20141205/1417779929.html">1対1関連</a></li>
      <li><a href="entry/20141206/1417839458.html">STI(単一継承テーブル)</a></li>
      <li><a href="entry/20141207/1417926599.html">ポリモフィック関連</a></li>
      <li><a href="entry/20141208/1418018874.html">複数の子レコードを作成/更新</a></li>
      <li><a href="entry/20140724/1406145303.html">バリデーション(validation)</a></li>
      <li><a href="entry/20140810/1407623400.html">バリデーションエラー(validation errors)</a></li>
      <li><a href="entry/20140814/1407994568.html">スコープ(scope)</a></li>
      <li><a href="entry/20141211/1418301640.html">コールバック(callback)</a></li>
      <li><a href="entry/20150428/1430154446.html">複雑なSELECT文のまとめ</a></li>
      <li><a href="entry/20150710/1436461745.html">enum (Rails 4.1以上)</a></li>
      <li><a href="entry/20141209/1418123425.html">楽観的ロック</a></li>
      <li><a href="entry/20141210/1418207618.html">悲観的ロック</a></li>
      <li><a href="entry/20140810/1407634200.html">Migration(マイグレーション)</a></li>
      <li><a href="entry/20150607/1433606267.html">Postgresとマイグレーション</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">API</span>
    <ul class="side-category-list">
      <li><a href="entry/20150708/1436284476.html">Roar</a></li>
      <li>ActiveSerializer</li>
      <li>Versioning</li>
      <li>CORS</li>
    </ul>
  </div>

  <div class="side-category">
    <span class="side-category-title">View, Helper, Presenter</span>
    <ul class="side-category-list">
      <li><a href="entry/20140810/1407603600.html">レイアウトファイルを指定</a></li>
      <li><a href="entry/20140807/1407419013.html">部分テンプレート</a></li>
      <li><a href="entry/20140727/1406448610.html">フォーム周りのMVC連携フロー</a></li>
      <li><a href="entry/20150113/1421149061.html">ビューヘルパーまとめ(View Helper)</a></li>
      <li><a href="entry/20140802/1406969793.html">フォーマットヘルパー</a></li>
      <li><a href="entry/20140803/1407049200.html">独自ヘルパー作成</a></li>
      <li><a href="entry/20141208/1418018874.html">複数の子レコード(has_many)を作成/更新するフォーム</a></li>
      <li><a href="entry/20141225/1419515057.html">1フォームに複数のSubmitボタンを配置</a></li>
      <li><a href="entry/20140730/1406700205.html">simple_form</a></li>
      <li><a href="entry/20150415/1429031791.html">Draper</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">テンプレートエンジン</span>
    <ul class="side-category-list">
      <li><a href="entry/20140929/1411997071.html">HTMLテンプレートエンジンまとめ</a></li>
      <li><a href="entry/20140929/1411997071.html">Slim</a></li>
      <li><a href="entry/20141001/1412097051.html">Haml</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ActionSupport / ActionMailer / ActiveJob / i18n</span>
    <ul class="side-category-list">
      <li><a href="entry/20141217/1418817120.html">タイムゾーン、時刻処理</a></li>
      <li><a href="entry/20141218/1418901424.html">Timecop 時刻処理のテスト</a></li>
      <li><a href="entry/20141216/1418729961.html">クラス名,DB名,ファイル名の変換</a></li>
      <li><a href="entry/20141230/1419936984.html">JSON, XML, YAMLの読み書き</a></li>
      <li><a href="entry/20141030/1414599853.html">文字コード/エンコード</a></li>
      <li><a href="entry/20140828/1409236436.html">メール送信</a></li>
      <li><a href="entry/20150304/1425396671.html">DelayedJob バックグラウンド処理</a></li>
      <li><a href="entry/20150110/1420863998.html">ログ・ログレベル・ログフォーマット(log, logger)</a></li>
      <li><a href="entry/20150226/1424937175.html">i18nまとめ</a></li>
      <li><a href="entry/20141111/1415707101.html">エラーハンドリング</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">テスト</span>
    <ul class="side-category-list">
      <li><a href="entry/20150101/1420093487.html">RSpec/Capybaraの導入方法</a></li>
      <li><a href="entry/20150103/1420280252.html">RSpec/Capybaraのレシピ集</a></li>
      <li><a href="entry/20150101/1420093487.html">FactoryGirlのレシピ集</a></li>
      <li><a href="entry/20150105/1420465062.html">Jasmine(Javascriptの単体テスト)</a></li>
      <li><a href="entry/20150108/1420675366.html">APIの作成とテスト</a></li>
      <li><a href="entry/20150106/1420545920.html">RSpecテストを速くする</a></li>
      <li><a href="entry/20150108/1420721205.html">デバッグ(debug)</a></li>
      <li><a href="entry/20150420/1429462755.html">Seleniumでスタンドアローンなテスト</a></li>
      <li><a href="entry/20140719/1405708234.html">Cucumber+RSpec+Capybara インストール</a></li>
      <li><a href="entry/20140719/1405777918.html">Cucumber+RSpec+Capybara BDD/TDD開発例</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Security</span>
    <ul class="side-category-list">
      <li><a href="entry/20141215/1418641291.html">ログ上での秘密情報のフィルタリング</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">パフォーマンス</span>
    <ul class="side-category-list">
      <li><a href="entry/20141109/1415522242.html">Bullet</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">設定</span>
    <ul class="side-category-list">
      <li><a href="entry/20141224/1419414316.html">新しいEnvironmentを追加</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">UI/UX</span>
    <ul class="side-category-list">
      <li><a href="entry/20140801/1406818800.html">Twitter Bootstrap 3</a></li>
      <li><a href="entry/20141112/1415804076.html">select2</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Gemの基礎</span>
    <ul class="side-category-list">
      <li><a href="entry/20140715/1405361727.html">RubyGemsの選び方</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ログイン/認証機能</span>
    <ul class="side-category-list">
      <li><a href="entry/20140801/1406907000.html">devise1 インストール</a></li>
      <li><a href="entry/20140804/1407168000.html">devise2 カスタマイズ</a></li>
      <li><a href="entry/20140805/1407200400.html">devise3 Twitterでログイン(OAuth連携)</a></li>
      <li><a href="entry/20141212/1418380288.html">devise4 ゲストユーザー(Guest)作成</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ファイルアップロード機能</span>
    <ul class="side-category-list">
      <li><a href="entry/20140716/1405443484.html">PaperClip</a></li>
      <li><a href="entry/20141015/1413300088.html">CarrierWave1 インストール</a></li>
      <li><a href="entry/20141022/1413907332.html">CarrierWave2 カスタマイズ</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">検索機能・Elasticsearch</span>
    <ul class="side-category-list">
      <li><a href="entry/20141008/1412774436.html">Ransack 検索機能</a></li>
      <li><a href="entry/20150224/1424776132.html">Sunspot 全文検索</a></li>
      <li><a href="entry/20151018/1445142266.html">Elasticsearch 1: 全文検索・フィルタ</a></li>
      <li><a href="entry/20151019/1445265581.html">Elasticsearch 2: ページネーション</a></li>
      <li><a href="entry/20151021/1445353566.html">Elasticsearch 3: ソート</a></li>
      <li><a href="entry/20151022/1445439798.html">Elasticsearch 4: アグリゲーション（ファセット）・post_filter</a></li>
      <li><a href="20151025/1445703231.html">Elasticsearch 5: ハイライト</a></li>
      <li><a href="entry/20151027/1445957667.html">Elasticsearch 6: サジェスト</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ページネーション</span>
    <ul class="side-category-list">
      <li><a href="entry/20141118/1416314608.html">ページネーションまとめ</a></li>
      <li><a href="entry/20141113/1415874683.html">kaminari</a></li>
      <li><a href="entry/20141114/1415967206.html">will_paginate</a></li>
      <li><a href="entry/20141115/1416021886.html">動的ページロード</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">CSV</span>
    <ul class="side-category-list">
      <li><a href="entry/20141119/1416398472.html">CSVダウンロード</a></li>
      <li><a href="entry/20141120/1416483136.html">CSVアップロード</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">PDFファイル作成機能</span>
    <ul class="side-category-list">
      <li><a href="entry/20140906/1409995011.html">PDF作成Gem まとめ</a></li>
      <li><a href="entry/20140907/1410078997.html">コードのみでPDF作成 Prawn</a></li>
      <li><a href="entry/20140908/1410176894.html">HTMLを変換してPDF作成 PDFKit + wkhtmltopdf</a></li>
      <li><a href="entry/20140909/1410241835.html">GUIツールでPDF作成 ThinReports</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">開発効率をあげる</span>
    <ul class="side-category-list">
      <li><a href="entry/20141026/1414289421.html">Spring</a></li>
      <li><a href="entry/20141016/1413389293.html">Guard-LiveReload</a></li>
      <li><a href="entry/20141021/1413819783.html">Guard-RSpec</a></li>
      <li><a href="entry/20141019/1413698128.html">Guard-RuboCop</a></li>
      <li><a href="entry/20141024/1414081224.html">Pry-Rails / Pry-BuyBug</a></li>
      <li><a href="entry/20141024/1414160189.html">Hirb</a></li>
      <li><a href="entry/20141028/1414505988.html">Awesome Print</a></li>
      <li><a href="entry/20141029/1414584929.html">Quiet Assets</a></li>
      <li><a href="entry/20141025/1414225490.html">Better_Errors</a></li>
      <li><a href="entry/20141027/1414409495.html">Rails-ERD</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">その他Gem</span>
    <ul class="side-category-list">
      <li><a href="entry/20150225/1424858414.html">acts-as-taggable-on タグ管理</a></li>
      <li><a href="entry/20141016/1413389293.html">wenerber Cron設定</a></li>
      <li><a href="entry/20150221/1424489524.html">friendly_id URLスラッグ</a></li>
      <li><a href="entry/20150216/1424092796.html">awesome_nested_set ツリー構造</a></li>
      <li><a href="entry/20150217/1424179269.html">awesome_nested_set にjsTreeを追加</a></li>
      <li><a href="entry/20150214/1423923524.html">PaperTrail 取り消し機能</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Tips</span>
    <ul class="side-category-list">
      <li><a href="entry/20141229/1419856433.html">Virtual Attributes(仮想属性)</a></li>
      <li><a href="entry/20141226/1419600679.html">日付/時刻のフォーマット</a></li>
      <li><a href="entry/20141225/1419515057.html">1フォームに複数のSubmitボタンを配置</a></li>
      <li><a href="entry/20141223/1419334845.html">URLのパーマリンクをID以外に変更</a></li>
      <li><a href="entry/20141220/1419058040.html">CSSスタイリングのコントローラー単位で分割</a></li>
      <li><a href="entry/20141219/1418990626.html">ページタイトルの変更</a></li>
      <li><a href="entry/20150101/1420049679.html">Ruby/Railsの便利なメソッド(useful methods)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Rubyテクニック</span>
    <ul class="side-category-list">
      <li><a href="entry/20150921/1442839934.html">キーワード引数</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">良い設計/リファクタリング</span>
    <ul class="side-category-list">
      <li><a href="entry/20150922/1442923521.html">デメテルの法則(Law of Demeter)</a></li>
      <li><a href="entry/20150312/1426141352.html">HTML/CSS/JSを疎結合にする方法</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">JavaScript</span>
    <ul class="side-category-list">
      <li><a href="entry/20150311/1426062668.html">オブジェクト指向</a></li>
      <li><a href="entry/20150313/1426238835.html">thisの参照先</a></li>
      <li><a href="entry/20150317/1426599220.html">設定データを分離</a></li>
      <li><a href="entry/20150607/1433652441.html">ページを離れる時にアラートを出す</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">jQuery</span>
    <ul class="side-category-list">
      <li><a href="entry/20150325/1427291741.html">Ajax</a></li>
      <li><a href="entry/20150326/1427379215.html">イベント処理(Event)</a></li>
      <li><a href="entry/20150331/1427809820.html">DOM操作</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">React.js</span>
    <ul class="side-category-list">
      <li><a href="entry/20151122/1448118932.html">React.jsチュートリアル: メッセージボックス</a></li>
      <li><a href="entry/20151124/1448300267.html">サーバーレンダリング</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">AngularJS</span>
    <ul class="side-category-list">
      <li><a href="entry/20150114/1421235346.html">AngularJSのインストール</a></li>
      <li><a href="entry/20150115/1421316461.html">UI Bootstrapのインストール</a></li>
      <li><a href="entry/20150116/1421407124.html">AngularJS Controller</a>
      <li><a href="entry/20150119/1421666497.html">ngResource + RailsでAPI作成</a></li>
      <li><a href="entry/20150120/1421761471.html">ngRoute</a></li>
      <li><a href="entry/20150126/1422276839.html">編集可能(Editable)</a></li>
      <li><a href="entry/20150127/1422357163.html">ソート可能(Sortable)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">開発手法</span>
    <ul class="side-category-list">
      <li><a href="entry/20140917/1410963376.html">スクラム開発</a></li>
      <li><a href="entry/20141010/1412867452.html">カイゼンフレームワークKPT</a>
      <li><a href="entry/20140816/1408126999.html">GitHubを使ったチーム開発フロー</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">開発ツール</span>
    <ul class="side-category-list">
      <li><a href="entry/20141103/1414940400.html">git - 初期設定と便利なエイリアス</a></li>
      <li><a href="entry/20140713/1405248403.html">git - よく使うコマンド</a></li>
      <li><a href="entry/20140724/1406137504.html">SublimeText3 - 便利コマンドとプラグイン</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">DB</span>
    <ul class="side-category-list">
      <li><a href="entry/20140726/1406331785.html">MongoDBの基礎入門 CRUD操作</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">インフラ</span>
    <ul class="side-category-list">
      <li><a href="entry/20150719/1437249020.html">Vagrant</a></li>
      <li><a href="entry/20150721/1437404524.html">Chef(Rails環境構築)</a></li>
      <li><a href="entry/20150314/1426332751.html">Herokuの準備とデプロイ</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">リファレンス</span>
    <ul class="side-category-list">
      <li><a href="https://github.com/" target="_blank">GitHub</a></li>
      <li><a href="http://guides.rubyonrails.org/index.html" target="_blank">RailsGuides</a></li>
      <li><a href="http://railscasts.com/" target="_blank">RailsCast</a></li>
      <li><a href="https://rubygems.org/" target="_blank">RubyGems</a></li>
      <li><a href="https://www.ruby-toolbox.com/" target="_blank">RubyToolbox</a></li>
      <li><a href="http://rubular.com/" target="_blank">正規表現 Rubular</a></li>
      <li><a href="http://ruby-doc.org/core-2.1/" target="_blank">Ruby API (2.1)</a></li>
      <li><a href="http://api.rubyonrails.org/" target="_blank">Ruby on Rails API (4.1)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Phoenix</span>
    <ul class="side-category-list">
      <li><a href="entry/20151011/1444560106.html">Phoenix環境設定(Phoenix入門1)</a></li>
      <li><a href="entry/20151013/1444662887.html">基本的な認証機能(Phoenix入門2)</a></li>
      <li><a href="entry/20151016/1444930756.html">基本的なチャット機能(Phoenix入門3)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">その他</span>
    <ul class="side-category-list">
      <li><a href="entry/20150401/1427898898.html">広告収入向上</a></li>
      <li><a href="entry/20140830/1409361710.html">著者が読んだ本</a></li>
    </ul>
  </div>
</nav>

  </div>
</div>

      
      
    
      

<div class="hatena-module hatena-module-archive" data-archive-type="default" data-archive-url="http://ruby-rails.hatenadiary.com/archive">
  <div class="hatena-module-title">
    <a href="archive.html">月別アーカイブ</a>
  </div>
  <div class="hatena-module-body">
  </div>
</div>

      
      
    
    
  </div>
</aside>

  </div>
</div>




        
        
          <script type="text/javascript" src="http://b.hatena.ne.jp/js/hatena_dfp2.js"></script>
        
        
          <div id="bottom-editarea">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
$('.unsubscribing').on('click', function() {
    ga('send', 'event', 'button', 'click', 'hatenaReader');  
});
</script>
          </div>
        
      </div>
    </div>

    
      <footer id="footer" data-brand="hatenablog">
  <div id="footer-inner">
    <address>
      
      <a href="about.html"><img src="http://cdn1.www.st-hatena.com/users/ni/nipe880324/profile.gif" width="16" height="16" alt=""/>
        <span data-load-nickname="1" data-user-name="nipe880324">nipe880324</span>
      </a>
    </address>
    <p class="services">Powered by <a href="http://hatenablog.com/">Hatena Blog</a></p>
  </div>
</footer>

    

    
  <script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>


    

    <script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js">
  {"parsetags": "explicit"}
</script>
<script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>



  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-with-addons.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.min.js"></script>


<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery/jquery-ui.1.10.0.custom.min.js"></script>
<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery/jquery.flot.0.8.3.js"></script>
<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery/jquery.flot.time.0.8.3.js"></script>



<script id="hatenablog-js" data-env="production"
  type="text/javascript" src="https://blog.st-hatena.com/js/hatenablog.js?version=228df9a6e5a3ae04fdb53d33befa3556" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://blog.st-hatena.com/js/texts-ja.js?version=228df9a6e5a3ae04fdb53d33befa3556"></script>


  <script type="text/javascript">Hatena.Diary.GlobalHeader.init()</script>


<script src="https://www.google.com/recaptcha/api.js" async defer></script>




    


    
       

  <script id="hatena-counter-script" type="text/javascript"><!--
      hatena_counter_name = "nipe880324";
      hatena_counter_id = "102";
      hatena_counter_ref = document.referrer+"";
      hatena_counter_screen = screen.width + "x" + screen.height+","+screen.colorDepth;
  //--></script>
  <script type="text/javascript" src="http://counter.hatena.ne.jp/js/counter.js"></script>
  <noscript><img src="http://counter.hatena.ne.jp/nipe880324/102" border="0" alt="counter"></noscript>


    

  </body>
</html>

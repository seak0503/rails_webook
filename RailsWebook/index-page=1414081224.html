<!DOCTYPE html>
<html
  lang="ja"
data-avail-langs="ja en"

data-page="index"
data-static-domain="https://blog.st-hatena.com"
data-blog="ruby-rails.hatenadiary.com"
data-blog-name="Rails Webook"
data-blogs-uri-base="http://ruby-rails.hatenadiary.com"
data-globalheader-color="b"
data-author="nipe880324"
data-version="228df9a6e5a3ae04fdb53d33befa3556"
data-blog-comments-top-is-new=""
data-plus-available=""



data-admin-domain="http://blog.hatena.ne.jp"

data-brand="hatenablog"

data-has-touch-view="1"


itemscope
itemtype="http://schema.org/Blog"


  data-device="pc"
  data-globalheader-type="pc"
  >
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
    
    
    

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=7; IE=9; IE=10; IE=11" />
    <title>Rails Webook</title>

    

    
      <link rel="canonical" href="index.html"/>
    

    
    

<meta itemprop="name" content="Rails Webook"/>

  <meta itemprop="image" content="https://blog.st-hatena.com/images/theme/og-image-1500.png"/>


    <meta property="og:title" content="Rails Webook"/>
<meta property="og:type" content="blog"/>
<meta property="og:url" content="http://ruby-rails.hatenadiary.com/"/>

  
  
  
  <meta property="og:image" content="https://blog.st-hatena.com/images/theme/og-image-1500.png"/>

  <meta property="og:description" content="自社のECを開発している会社で働いています。Rails情報やサービスを成長させる方法を書いていきます" />
<meta property="og:site_name" content="http://ruby-rails.hatenadiary.com/"/>

        <meta name="twitter:card"   content="gallery" />
    <meta name="twitter:image0" content="http://f.st-hatena.com/images/fotolife/n/nipe880324/20141015/20141015002041.jpg" />
    <meta name="twitter:image1" content="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141016/20141016010205.png" />
    <meta name="twitter:image2" content="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141015/20141015002041.jpg" />
    <meta name="twitter:image3" content="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141010/20141010000405.jpg" />  <meta name="twitter:title" content="Rails Webook" />  <meta name="twitter:description" content="自社のECを開発している会社で働いています。Rails情報やサービスを成長させる方法を書いていきます" />  <meta name="twitter:app:name:iphone" content="はてなブログアプリ" />
  <meta name="twitter:app:id:iphone" content="583299321" />
  <meta name="twitter:app:url:iphone" content="hatenablog:///open?uri=http%3A%2F%2Fruby-rails.hatenadiary.com%2F%3Fpage%3D1414081224" />  <meta name="twitter:site" content="@nipe032488" />
    
    <meta name="description" content="毎週更新。Railsプログラマがソフトウェア開発を効果的・効率的にするために、分かりやすく・使いやすい形でRailsに関する技術情報を記載。">    <meta name="google-site-verification" content="OyOieuLgSrQckqbACTn_Q3G1dPq6LMlTqBRHa6V1XsA">    <meta name="keywords" content="Rails,Ruby on Rails,gem,Webアプリケーション,開発,構築,運用,インフラ">

    
<script type="text/javascript">
// <!--

if (~navigator.userAgent.indexOf('Mac OS X')) {
  document.write('<style type="text/css">html, body { font-family: \x27Helvetica\x27, \x27Arial\x27, \x27ヒラギノ角ゴ Pro W3\x27, \x27Hiragino Kaku Gothic Pro\x27, sans-serif; } </style>');
} else {
  document.write('<style type="text/css">html, body { font-family: \x27Helvetica\x27, \x27Arial\x27, \x27メイリオ\x27, \x27Meiryo\x27, \x27MS PGothic\x27, sans-serif; } </style>');
}

// -->
</script>

<!--[if lt IE 9]>
<script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->




    <link rel="shortcut icon" href="https://blog.st-hatena.com/images/favicon.ico">
<link rel="icon" sizes="192x192" href="https://blog.st-hatena.com/images/common/meta-icon-global.png">

    
<link rel="alternate" type="application/atom+xml" title="Atom" href="feed"/>
<link rel="alternate" type="application/rss+xml" title="RSS2.0" href="rss.rss"/>


      <link rel="author" href="http://www.hatena.ne.jp/nipe880324/">
    

    <link rel="stylesheet" type="text/css" href="https://blog.st-hatena.com/css/blog.css?version=228df9a6e5a3ae04fdb53d33befa3556"/>

    
  <link rel="stylesheet" type="text/css" href="http://blog.hatena.ne.jp/-/blog_style/12921228815727789780/a052dbbef76fd4380abc811c11814f2d9f990b9a"/>

    <script></script>

    
<style>div#google_afc_user,
  div#google_afc_user_container_0,
  div#google_afc_user_container_1,
  div#google_afc_user_container_2,
  div#google_afc_user_container_3,
  div#google_afc_user_container_4,
  div#google_afc_user_container_5,
  div.google_afc_image,
  div.google_afc_blocklink {
      display: block !important;
  }
</style>


    
  </head>

  <body class="page-index enable-top-editarea enable-bottom-editarea">
    <!-- Google Universal Analytics -->
<script id="google-analytics-script">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-29716941-6', 'auto', {'name': 'HatenaBlogTracker', 'sampleRate': 1});
  ga('HatenaBlogTracker.require', 'displayfeatures');
  ga('HatenaBlogTracker.send', 'pageview');
  ga('create', 'UA-29716941-26', 'auto', {'name': 'HatenaBlogSeparatedTracker', 'sampleRate': 10});
  ga('HatenaBlogSeparatedTracker.require', 'displayfeatures');
  ga('HatenaBlogSeparatedTracker.send', 'pageview');

    
      ga('create', 'UA-45988509-6', 'auto', {'name': 'HatenaBlogUserTracker'});
      ga('HatenaBlogUserTracker.require', 'displayfeatures');
      ga('HatenaBlogUserTracker.send', 'pageview');
    
  
  ga('create', 'UA-7855606-1', 'auto', {'name': 'HatenaGlobalTracker', 'sampleRate': 1});
  ga('HatenaGlobalTracker.require', 'displayfeatures');
  ga('HatenaGlobalTracker.send', 'pageview');
</script>
<!-- End Google Universal Analytics -->

    
    <div id="header-container">
     <div id="sp-suggest" style="display: none;"><a id="sp-suggest-link" href="index-page=1414081224.html#">スマートフォン用の表示で見る</a></div>
    </div>

    

<div class="quote-box">
  <div class="tooltip-quote tooltip-quote-star">
    <i class="blogicon-star" title="引用スターをつける"></i>
  </div>
  <div class="tooltip-quote tooltip-quote-stock">
    <i class="blogicon-quote" title="引用をストック"></i>
  </div>
</div>

<div class="message-box" id="quote-star-message-box" style="display: none; position: absolute;">
  スターをつけました
</div>

<div class="quote-stock-panel" id="quote-stock-message-box" style="position: absolute; z-index: 3000">
  <div class="message-box" id="quote-stock-succeeded-message" style="display: none">
    <p>引用をストックしました</p>
    <button class="btn btn-primary" id="quote-stock-show-editor-button" data-track-name="curation-quote-edit-button">ストック一覧を見る</button>
    <button class="btn quote-stock-close-message-button">閉じる</button>
  </div>

  <div class="message-box" id="quote-login-required-message" style="display: none">
    <p>引用するにはまずログインしてください</p>
    <button class="btn btn-primary" id="quote-login-button">ログイン</button>
    <button class="btn quote-stock-close-message-button">閉じる</button>
  </div>

  <div class="error-box" id="quote-stock-failed-message" style="display: none">
    <p>引用をストックできませんでした。再度お試しください</p>
    <button class="btn quote-stock-close-message-button">閉じる</button>
  </div>

  <div class="error-box" id="unstockable-quote-message-box" style="display: none; position: absolute; z-index: 3000;">
    <p>限定公開記事のため引用できません。</p>
  </div>
</div>

<script type="x-underscore-template" id="js-requote-button-template">
  <div class="requote-button js-requote-button">
    <button class="requote-button-btn tipsy-top" title="引用する"><i class="blogicon-quote"></i></button>
  </div>
</script>


    <div id="globalheader-container" >
  <iframe id="globalheader" height="37" frameborder="0" allowTransparency="true"></iframe>
</div>


    
    <div id="hidden-subscribe-button">
      <div class="hatena-follow-button-box btn-subscribe js-hatena-follow-button-box"
  
  >

  <a href="index-page=1414081224.html#" class="hatena-follow-button js-hatena-follow-button">
    <span class="subscribing">
      <span class="foreground">読者です</span>
      <span class="background">読者をやめる</span>
    </span>
    <span class="unsubscribing" data-track-name="profile-widget-subscribe-button" data-track-once>
      <span class="foreground">読者になる</span>
      <span class="background">読者になる</span>
    </span>
  </a>
  <div class="subscription-count-box js-subscription-count-box">
    <i></i>
    <u></u>
    <span class="subscription-count js-subscription-count">
    </span>
  </div>
</div>

    </div>

    <div id="container">
      <div id="container-inner">
        <header id="blog-title" data-brand="hatenablog">
  <div id="blog-title-inner" >
    <div id="blog-title-content">
      <h1 id="title"><a href="index.html">Rails Webook</a></h1>
      
        <h2 id="blog-description">自社のECを開発している会社で働いています。Rails情報やサービスを成長させる方法を書いていきます</h2>
      
    </div>
  </div>
</header>

        
          <div id="top-editarea">
            <!-- start Mixpanel --><script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
mixpanel.init("16db652100dca0a23c6a55a9205f0824");</script><!-- end Mixpanel -->
<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- rails top bar 728 x 90 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-2736751992834286"
     data-ad-slot="6687328050"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

          </div>
        
        
        



<div id="content" class="hfeed"
  
  >
  <div id="content-inner">
    <div id="wrapper">
      <div id="main">
        <div id="main-inner">
          
            
            <!-- google_ad_section_start -->
            <!-- rakuten_ad_target_begin -->
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-3200 words-200 mode-hatena entry-odd" id="entry-8454420450069740014" data-keyword-campaign="" data-uuid="8454420450069740014">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/10/22.html" rel="nofollow">
          <time pubdate datetime="2014-10-21T16:02:12Z" title="2014-10-21T16:02:12Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">10</span><span class="hyphen">-</span><span class="date-day">22</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141022/1413907332.html" class="entry-title-link bookmark">RailsのCarrierWaveのカスタマイズ - ファイルの配置先、リサイズ、テストなど</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%20gem.html">Rails gem</a>
          
          <a href="archive/category/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89.html">ファイルアップロード</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p>前回は<a href="entry/20141015/1413300088.html" target="_blank">CarrierWaveのインストール方法</a>について説明しました。<br />
今回は、ファイルの配置先、リサイズ、テストなどCarrirWaveをもっと使いこなしていくための方法を説明します。</p>

<div class="section">
    <h3>目次</h3>
    
<ul>
<li><a href="index-page=1414081224.html#carrirwave-customize-filepath">ファイルの配置先</a></li>
<li><a href="index-page=1414081224.html#carrirwave-customize-resize">画像サイズの変更（リサイズ）</a></li>
<li><a href="index-page=1414081224.html#carrirwave-customize-extension">アップロードファイルの拡張子</a></li>
<li><a href="index-page=1414081224.html#carrirwave-customize-filename">アップロードされたファイルのファイル名</a></li>
<li><a href="index-page=1414081224.html#carrirwave-customize-i18n">i18n</a></li>
</ul><p></p><p><h3 id="carrirwave-customize-filepath">ファイルの配置先</h3></p><p>まず、ファイルの配置先としては、大まかには次のどちらにするか選ぶ必要があります。</p>

<ol>
<li>Railsが動いているサーバーに配置</li>
<li>Amazon S3, Rackspace Cloud Files, Google Strage for Developersなどのクラウド上のストレージに配置</li>
</ol><p>上記の1について説明します。<br />
2については、公式ページを参照してください。</p>

<ul>
<li><a href="https://github.com/carrierwaveuploader/carrierwave#using-amazon-s3" target="_blank">Amazon S3を使う</a></li>
<li><a href="https://github.com/carrierwaveuploader/carrierwave#using-rackspace-cloud-files" target="_blank">Rackspace Cloud Filesを使う</a></li>
<li><a href="https://github.com/carrierwaveuploader/carrierwave#using-google-storage-for-developers" target="_blank">Google Strage for Developersを使う</a></li>
</ul><p>アップロードしたファイルの配置場所を変更するために、<code>store_dir</code>メソッドをオーバーライドしてください。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/uploaders/image_uploader.rb</span>
<span class="synPreProc">class</span> <span class="synType">ImageUploader</span> &lt; <span class="synType">CarrierWave</span>::<span class="synType">Uploader</span>::<span class="synType">Base</span>
  ...

  <span class="synPreProc">def</span> <span class="synIdentifier">store_dir</span>
    <span class="synComment"># デフォルト値</span>
    <span class="synComment"># &quot;uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}&quot;</span>

    <span class="synComment"># Rails.root/public/mypath/ 配下にファイルが配置される</span>
    <span class="synSpecial">&quot;</span><span class="synConstant">mypath</span><span class="synSpecial">&quot;</span>
  <span class="synPreProc">end</span>

  ...
<span class="synPreProc">end</span>
</pre><p></p><p><h3 id="carrirwave-customize-resize">画像サイズの変更（リサイズ）</h3></p><p>サムネイル画像など同じファイルの異なったサイズのファイルを表示したい場合があると思います。<br />
画像をリサイズするために<code>Imagemagick</code>と<code>MiniMagick</code>のインストールが必要です。</p><p><code>MiniMagick</code>の代わりに<code>RMagick</code>を紹介しているサイトもありますが、<code>MiniMagick</code>は公式に推奨されています。</p><p>OSXの場合、BrewコマンドでImageMagickを追加します。</p>
<pre class="code" data-lang="" data-unlink>brew install imagemagick</pre><p>次に、GemfileにMiniMagickを追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Gemfile</span>
gem <span class="synSpecial">&quot;</span><span class="synConstant">mini_magick</span><span class="synSpecial">&quot;</span>
</pre><p>Bundlerでインストールします。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p>次にMiniMagickをincludeし、また、アップローダーにサイズを変換する指定をいれます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/uploaders/image_uploader.rb</span>
<span class="synPreProc">class</span> <span class="synType">ImageUploader</span> &lt; <span class="synType">CarrierWave</span>::<span class="synType">Uploader</span>::<span class="synType">Base</span>
  <span class="synPreProc">include</span> <span class="synType">CarrierWave</span>::<span class="synType">MiniMagick</span>
  ...

  <span class="synComment"># resize_to_fitはファイルのサイズを変更します</span>
  <span class="synComment"># アップロードされたファイルを200〜200以下に変換する</span>
  process <span class="synConstant">:resize_to_fit</span> =&gt; [<span class="synConstant">200</span>, <span class="synConstant">200</span>]

  <span class="synComment"># 別のスケールを設定</span>
  version <span class="synConstant">:thumb</span> <span class="synStatement">do</span>
    process <span class="synConstant">:resize_to_fit</span> =&gt; [<span class="synConstant">50</span>, <span class="synConstant">50</span>]
  <span class="synStatement">end</span>

  ...
<span class="synPreProc">end</span>
</pre><p>では、ファイルをアップロードし直してみましょう。<br />
分かりづらいですが、ファイルサイズがリサイズされてサーバーに配置されています。<br />
そのため、画面上で画像のサイズが少し小さくなっています。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141022/20141022005200.png" alt="f:id:nipe880324:20141022005200p:plain:w480" title="f:id:nipe880324:20141022005200p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<br />
<p><h3 id="carrirwave-customize-extension">アップロードファイルの拡張子</h3></p><p>PHPやスクリプトファイルなどをサーバー上にアップロードされると危険な場合があります。<br />
そのために、CarrirWaveでは拡張子のホワイトリストを指定し、アップロード可能な拡張子を記載したリストを作成できます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/uploaders/image_uploader.rb</span>
<span class="synPreProc">class</span> <span class="synType">ImageUploader</span> &lt; <span class="synType">CarrierWave</span>::<span class="synType">Uploader</span>::<span class="synType">Base</span>
  ...

  <span class="synComment"># jpg, jpeg, gif, png のみ許可する</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">extension_white_list</span>
    <span class="synSpecial">%w(</span><span class="synConstant">jpg jpeg gif png</span><span class="synSpecial">)</span>
  <span class="synPreProc">end</span>

  ...
<span class="synPreProc">end</span>
</pre><p><br />
もし、Modelでアップローダーをマウントしている場合（<code>mount_uploader :image, ImageUploader</code>）、誤った拡張子がアップロードされた場合には、Validationエラーになります。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/product.rb</span>
<span class="synPreProc">class</span> <span class="synType">Product</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  mount_uploader <span class="synConstant">:image</span>, <span class="synType">ImageUploader</span>
<span class="synPreProc">end</span>
</pre><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141022/20141022005304.png" alt="f:id:nipe880324:20141022005304p:plain:w480" title="f:id:nipe880324:20141022005304p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<br />
<p><h3 id="carrirwave-customize-filename">アップロードファイルのファイル名</h3></p><p>デフォルトでは、CarrierWaveは、アップロードされたファイル名にアルファベット、数字などの簡易な文字しか許可していません。<br />
もし、日本語などをサポートしたい場合は、<code>sanitize_regexp</code>メソッドをオーハーライドし、全ての許可されていない文字列にマッチする正規表現を返す必要があります。</p><p>Ruby 2.0以上の場合、<a href="https://github.com/k-takata/Onigmo" target="_blank">Onigumo</a>を使って簡単に記載できます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">CarrierWave</span>::<span class="synType">SanitizedFile</span>.sanitize_regexp = <span class="synSpecial">/[^</span><span class="synConstant">[:word:</span><span class="synSpecial">]\.</span><span class="synConstant">\-</span><span class="synSpecial">\+</span><span class="synConstant">]</span><span class="synSpecial">/</span>
</pre><p>Ruby 1.8の場合、手動で特定の文字列にマッチする正規表現を記載する必要があります。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">CarrierWave</span>::<span class="synType">SanitizedFile</span>.sanitize_regexp = <span class="synSpecial">/[^</span><span class="synConstant">a-zA-Zа-яА-ЯёЁ0-9</span><span class="synSpecial">\.</span><span class="synConstant">\-</span><span class="synSpecial">\+</span><span class="synConstant">_</span><span class="synSpecial">]/</span>
</pre><p></p><p><h3 id="carrirwave-customize-i18n">i18n</h3></p><p>CarrierWAveのi18nファイルを作成しましょう。</p>
<pre class="code" data-lang="" data-unlink># carrierwave.ja.yml
errors:
  messages:
    carrierwave_processing_error: &#34;Cannot resize image.&#34;
    carrierwave_integrity_error: &#34;Not an image.&#34;
    carrierwave_download_error: &#34;Couldn&#39;t download image.&#34;
    extension_white_list_error: &#34;You are not allowed to upload %{extension} files, allowed types: %{allowed_types}&#34;
    extension_black_list_error: &#34;You are not allowed to upload %{extension} files, prohibited types: %{prohibited_types}&#34;</pre><p>日本語のファイルは次の箇所にあります。<br />
<a href="https://github.com/carrierwaveuploader/carrierwave/blob/master/lib/carrierwave/locale/ja.yml" target="_blank">GitHub - carrierwave/locale/ja.yml</a></p><p></p>

</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li><a href="https://github.com/carrierwaveuploader/carrierwave">https://github.com/carrierwaveuploader/carrierwave</a></li>
</ul><p>以上です。<br />
よく分からない箇所がある場合はコメントください。</p>

</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141022/1413907332.html"><time data-relative datetime="2014-10-21T16:02:12Z" title="2014-10-21T16:02:12Z" pubdate class="updated">2014-10-22 01:02</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141022/1413907332" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141022%2F1413907332" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141022/1413907332" data-count="vertical" data-text="RailsのCarrierWaveのカスタマイズ - ファイルの配置先、リサイズ、テストなど - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141022/1413907332" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_0', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_0" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-5600 words-600 mode-hatena entry-even" id="entry-8454420450069240623" data-keyword-campaign="" data-uuid="8454420450069240623">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/10/21.html" rel="nofollow">
          <time pubdate datetime="2014-10-20T15:43:03Z" title="2014-10-20T15:43:03Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">10</span><span class="hyphen">-</span><span class="date-day">21</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141021/1413819783.html" class="entry-title-link bookmark">Railsの開発効率を上げる - guard-rspec 自動でテスト(RSpec)を実行させる</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/%E9%96%8B%E7%99%BA%E3%82%92%E5%8A%B9%E7%8E%87%E5%8C%96%E3%81%99%E3%82%8B.html">開発を効率化する</a>
          
          <a href="archive/category/Rails%20gem.html">Rails gem</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141016/20141016010205.png" alt="f:id:nipe880324:20141016010205p:plain:w320" title="f:id:nipe880324:20141016010205p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span><br />
</p>

<div class="section">
    <h3>Guardとは</h3>
    <p>Guardとはファイルの変更を検知して、自動的にさまざまな処理を実行してくれる<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のGemです。<br />
これ単体で使うよりも、他の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C4%A1%BC%A5%EB">ツール</a>と連携し、自動的に処理を行うことにより開発効率を上げることができます。</p><p>メジャーどころとしては、次の３つだと思います。</p>

<ul>
<li><a href="entry/20141016/1413389293.html">guard-livereload - Viewファイルの変更したときに自動的にブラウザをリロードする</a></li>
<li>guard-<a class="keyword" href="http://d.hatena.ne.jp/keyword/rspec">rspec</a> - specファイルを変更したときに自動的に<code>RSpec</code>を実行する</li>
<li><a href="entry/20141019/1413698128.html">guard-rubocop - ファイルを修正したときに<code>RuboCop</code>を実行する</a></li>
</ul><p>本記事では、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>へ<code>guard-rspec</code>の導入方法を記載します。<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/RSpec">RSpec</a>を自動的に実行することで、ソースがいつ壊れたか簡単に検知できるようにします。<br />
<br />
</p>

</div>
<div class="section">
    <h3>対象読者</h3>
    
<ul>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>の開発効率を上げたい方</li>
</ul>
</div>
<div class="section">
    <h3>確認バージョン</h3>
    
<ul>
<li>Mac OSX 10.9</li>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>  2.0</li>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a> 4.1</li>
<li>guard 2.6.1</li>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/rspec">rspec</a>-<a class="keyword" href="http://d.hatena.ne.jp/keyword/rails">rails</a> 3.0.2</li>
<li>guard-<a class="keyword" href="http://d.hatena.ne.jp/keyword/rspec">rspec</a> 4.2.10</li>
<li>terminal-notifier-guard 1.5.3</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1414081224.html#guard-rspec-create-rails">Railsプロジェクトの作成 + RSpec</a></li>
<li><a href="index-page=1414081224.html#guard-rspec-getting-started">guard-rspecの導入</a></li>
<li><a href="index-page=1414081224.html#guard-rspec-options">guard-rspecのオプション</a></li>
</ol><p><br />
<h3 id="guard-rspec-create-rails">1. <a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>プロジェクトの作成 + <a class="keyword" href="http://d.hatena.ne.jp/keyword/RSpec">RSpec</a></h3></p><p>まず、Guardを実行させるベースとなる<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>のプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new guard_test
cd guard_test</pre><p>次に、<a class="keyword" href="http://d.hatena.ne.jp/keyword/RSpec">RSpec</a>を<code>Gemfile</code>に追加します。</p>
<pre class="code" data-lang="" data-unlink># Gemfile

group :development, :test do
  gem &#39;rspec-rails&#39;
end</pre><p>Bundlerで<a class="keyword" href="http://d.hatena.ne.jp/keyword/rspec">rspec</a>-<a class="keyword" href="http://d.hatena.ne.jp/keyword/rails">rails</a>を入れます。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p>そして、<a class="keyword" href="http://d.hatena.ne.jp/keyword/RSpec">RSpec</a>の設定ファイルを追加します。</p>
<pre class="code" data-lang="" data-unlink>rails g rspec:install
      create  .rspec
      create  spec
      create  spec/spec_helper.rb
      create  spec/rails_helper.rb</pre><p>Warningがたくさん表示されてしまうので、<a class="keyword" href="http://d.hatena.ne.jp/keyword/rspec">rspec</a>コマンドのオプションを記載するファイルの<code>.rspec</code>を次のように修正します。</p>
<pre class="code" data-lang="" data-unlink># .rspec

--color
--require spec_helper</pre><p><br />
次に、簡単なProductのScaffoldを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails g scaffold Product name:string price:integer discontinued:boolean</pre><p>マイグレートします。</p>
<pre class="code" data-lang="" data-unlink>rake db:migrate</pre><p>では<a class="keyword" href="http://d.hatena.ne.jp/keyword/RSpec">RSpec</a>を実行してみましょう。</p>
<pre class="code" data-lang="" data-unlink>rspec

...
Finished in 0.27292 seconds (files took 2.15 seconds to load)
30 examples, 0 failures, 17 pending</pre><p>30件のテストの内、失敗は0件、17件は<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DA%A5%F3%A5%C7%A5%A3%A5%F3%A5%B0">ペンディング</a>。つまり、13件が成功しました。</p><br />
<p><h3 id="guard-rspec-getting-started">2. guard-<a class="keyword" href="http://d.hatena.ne.jp/keyword/rspec">rspec</a>の導入</h3></p><p>では、準備が整い舞いましたので、<code>guard-rspec</code>を<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>プロジェクトに導入していきます。</p><p>まずは、<code>Gemfile</code>に<code>guard-rspec</code>と<code>terminal-notifier-guard</code>を追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Gemfile</span>

group <span class="synConstant">:development</span> <span class="synStatement">do</span>
  gem <span class="synSpecial">'</span><span class="synConstant">guard-rspec</span><span class="synSpecial">'</span>, <span class="synPreProc">require</span>: <span class="synConstant">false</span> <span class="synComment"># guardでrspecを動かす</span>
  gem <span class="synSpecial">'</span><span class="synConstant">terminal-notifier</span><span class="synSpecial">'</span>
  gem <span class="synSpecial">'</span><span class="synConstant">terminal-notifier-guard</span><span class="synSpecial">'</span>  <span class="synComment"># デスクトップ通知を行う</span>
<span class="synStatement">end</span>
</pre><p>Bundlerを実行して、インストールします。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p><code>Guardfile</code>（Guardの設定を記載するファイル）に「<a class="keyword" href="http://d.hatena.ne.jp/keyword/RSpec">RSpec</a>用の設定」を追加します。</p>
<pre class="code" data-lang="" data-unlink>guard init rspec</pre><p><br />
作成された<code>Guardfile</code>の中身を確認してみます。<br />
<code>guard :rspec</code>のブロック内に監視対象と実行するSpecファイルが記載されています。<br />
具体的には、<code>watch</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>で「監視するファイル」を<a class="keyword" href="http://d.hatena.ne.jp/keyword/%C0%B5%B5%AC%C9%BD%B8%BD">正規表現</a>で記載し、ブロック内で監視するファイルが変更されたときに「実行するファイル」を指定します。</p><p>以下の設定で、適切な単位でのテスト実行がされ、失敗時にはデスクトップに通知されるため修正はしません。<br />
<code>guard-rspec</code>のオプションについては、「<a href="index-page=1414081224.html#guard-rspec-options">guard-rspecのオプション</a>」を参照して下さい。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Guardfile</span>

guard <span class="synConstant">:rspec</span> <span class="synStatement">do</span>
  watch(<span class="synSpecial">%r{^</span><span class="synConstant">spec/</span><span class="synSpecial">.+</span><span class="synConstant">_spec</span><span class="synSpecial">\.</span><span class="synConstant">rb</span><span class="synSpecial">$}</span>)
  watch(<span class="synSpecial">%r{^</span><span class="synConstant">lib/</span><span class="synSpecial">(.+)\.</span><span class="synConstant">rb</span><span class="synSpecial">$}</span>)     { |<span class="synIdentifier">m</span>| <span class="synSpecial">&quot;</span><span class="synConstant">spec/lib/</span><span class="synSpecial">#{</span>m[<span class="synConstant">1</span>]<span class="synSpecial">}</span><span class="synConstant">_spec.rb</span><span class="synSpecial">&quot;</span> }
  watch(<span class="synSpecial">'</span><span class="synConstant">spec/spec_helper.rb</span><span class="synSpecial">'</span>)  { <span class="synSpecial">&quot;</span><span class="synConstant">spec</span><span class="synSpecial">&quot;</span> }

  <span class="synComment"># Rails example</span>
  watch(<span class="synSpecial">%r{^</span><span class="synConstant">app/</span><span class="synSpecial">(.+)\.</span><span class="synConstant">rb</span><span class="synSpecial">$}</span>)                           { |<span class="synIdentifier">m</span>| <span class="synSpecial">&quot;</span><span class="synConstant">spec/</span><span class="synSpecial">#{</span>m[<span class="synConstant">1</span>]<span class="synSpecial">}</span><span class="synConstant">_spec.rb</span><span class="synSpecial">&quot;</span> }
  watch(<span class="synSpecial">%r{^</span><span class="synConstant">app/</span><span class="synSpecial">(.*)(\.</span><span class="synConstant">erb</span><span class="synSpecial">|\.</span><span class="synConstant">haml</span><span class="synSpecial">|\.</span><span class="synConstant">slim</span><span class="synSpecial">)$}</span>)          { |<span class="synIdentifier">m</span>| <span class="synSpecial">&quot;</span><span class="synConstant">spec/</span><span class="synSpecial">#{</span>m[<span class="synConstant">1</span>]<span class="synSpecial">}#{</span>m[<span class="synConstant">2</span>]<span class="synSpecial">}</span><span class="synConstant">_spec.rb</span><span class="synSpecial">&quot;</span> }
  watch(<span class="synSpecial">%r{^</span><span class="synConstant">app/controllers/</span><span class="synSpecial">(.+)</span><span class="synConstant">_</span><span class="synSpecial">(</span><span class="synConstant">controller</span><span class="synSpecial">)\.</span><span class="synConstant">rb</span><span class="synSpecial">$}</span>)  { |<span class="synIdentifier">m</span>| [<span class="synSpecial">&quot;</span><span class="synConstant">spec/routing/</span><span class="synSpecial">#{</span>m[<span class="synConstant">1</span>]<span class="synSpecial">}</span><span class="synConstant">_routing_spec.rb</span><span class="synSpecial">&quot;</span>, <span class="synSpecial">&quot;</span><span class="synConstant">spec/</span><span class="synSpecial">#{</span>m[<span class="synConstant">2</span>]<span class="synSpecial">}</span><span class="synConstant">s/</span><span class="synSpecial">#{</span>m[<span class="synConstant">1</span>]<span class="synSpecial">}</span><span class="synConstant">_</span><span class="synSpecial">#{</span>m[<span class="synConstant">2</span>]<span class="synSpecial">}</span><span class="synConstant">_spec.rb</span><span class="synSpecial">&quot;</span>, <span class="synSpecial">&quot;</span><span class="synConstant">spec/acceptance/</span><span class="synSpecial">#{</span>m[<span class="synConstant">1</span>]<span class="synSpecial">}</span><span class="synConstant">_spec.rb</span><span class="synSpecial">&quot;</span>] }
  watch(<span class="synSpecial">%r{^</span><span class="synConstant">spec/support/</span><span class="synSpecial">(.+)\.</span><span class="synConstant">rb</span><span class="synSpecial">$}</span>)                  { <span class="synSpecial">&quot;</span><span class="synConstant">spec</span><span class="synSpecial">&quot;</span> }
  watch(<span class="synSpecial">'</span><span class="synConstant">config/routes.rb</span><span class="synSpecial">'</span>)                           { <span class="synSpecial">&quot;</span><span class="synConstant">spec/routing</span><span class="synSpecial">&quot;</span> }
  watch(<span class="synSpecial">'</span><span class="synConstant">app/controllers/application_controller.rb</span><span class="synSpecial">'</span>)  { <span class="synSpecial">&quot;</span><span class="synConstant">spec/controllers</span><span class="synSpecial">&quot;</span> }

  <span class="synComment"># Capybara features specs</span>
  watch(<span class="synSpecial">%r{^</span><span class="synConstant">app/views/</span><span class="synSpecial">(.+)</span><span class="synConstant">/</span><span class="synSpecial">.*\.(</span><span class="synConstant">erb</span><span class="synSpecial">|</span><span class="synConstant">haml</span><span class="synSpecial">|</span><span class="synConstant">slim</span><span class="synSpecial">)$}</span>)     { |<span class="synIdentifier">m</span>| <span class="synSpecial">&quot;</span><span class="synConstant">spec/features/</span><span class="synSpecial">#{</span>m[<span class="synConstant">1</span>]<span class="synSpecial">}</span><span class="synConstant">_spec.rb</span><span class="synSpecial">&quot;</span> }

  <span class="synComment"># Turnip features and steps</span>
  watch(<span class="synSpecial">%r{^</span><span class="synConstant">spec/acceptance/</span><span class="synSpecial">(.+)\.</span><span class="synConstant">feature</span><span class="synSpecial">$}</span>)
  watch(<span class="synSpecial">%r{^</span><span class="synConstant">spec/acceptance/steps/</span><span class="synSpecial">(.+)</span><span class="synConstant">_steps</span><span class="synSpecial">\.</span><span class="synConstant">rb</span><span class="synSpecial">$}</span>)   { |<span class="synIdentifier">m</span>| <span class="synType">Dir</span>[<span class="synType">File</span>.join(<span class="synSpecial">&quot;</span><span class="synConstant">**/</span><span class="synSpecial">#{</span>m[<span class="synConstant">1</span>]<span class="synSpecial">}</span><span class="synConstant">.feature</span><span class="synSpecial">&quot;</span>)][<span class="synConstant">0</span>] || <span class="synSpecial">'</span><span class="synConstant">spec/acceptance</span><span class="synSpecial">'</span> }
<span class="synStatement">end</span>||&lt;


では、&lt;code&gt;<span class="synType">Guard</span>&lt;/code&gt;を実行します。
&gt;||
bundle exec guard
</pre><p><i>※<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>プロジェクトの配置パスに日本語が入っていると、「<b>E, [2014-10-16T00:43:38.055423 #28197] <a class="keyword" href="http://d.hatena.ne.jp/keyword/ERROR">ERROR</a> -- : run() in thread failed: inspected result must be ASCII only or use the same encoding with default external:/Users/nipe0324/.rbenv/versions/2.0.0-p247/lib/<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>/gems/2.0.0/gems/listen-2.7.9/lib/listen/listener.rb:329:in `inspect'</b>」のようなエラーが発生するのでご注意ください。</i></p><br />
<p>Pendingである<code>product_spec.rb</code>にテストを追加してみましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">require</span> <span class="synSpecial">'</span><span class="synConstant">rails_helper</span><span class="synSpecial">'</span>

<span class="synType">RSpec</span>.describe <span class="synType">Product</span>, <span class="synConstant">:type</span> =&gt; <span class="synConstant">:model</span> <span class="synStatement">do</span>
  describe <span class="synSpecial">&quot;</span><span class="synConstant">#name</span><span class="synSpecial">&quot;</span> <span class="synStatement">do</span>
    it <span class="synSpecial">&quot;</span><span class="synConstant">空文字を許容しないこと</span><span class="synSpecial">&quot;</span> <span class="synStatement">do</span>
      product = <span class="synType">Product</span>.new(<span class="synConstant">name</span>: <span class="synSpecial">&quot;&quot;</span>, <span class="synConstant">price</span>: <span class="synConstant">100</span>, <span class="synConstant">discontinued</span>: <span class="synConstant">false</span>)
      expect(product).to be_invalid
    <span class="synStatement">end</span>
  <span class="synStatement">end</span>
<span class="synStatement">end</span>
</pre><p>spceファイルを保存すると、guardが変更を検知し、特定のspecファイルを自動的に実行します。</p>
<pre class="code" data-lang="" data-unlink>15:50:03 - INFO - Running: ./spec/models/product_spec.rb:5
Run options: include {:locations=&gt;{&#34;./spec/models/product_spec.rb&#34;=&gt;[5]}}
F

Failures:

  1) Product#name 空文字を許容しないこと
     Failure/Error: expect(product).to be_invalid
       expected `#&lt;Product id: nil, name: &#34;&#34;, price: 100, discontinued: false, created_at: nil, updated_at: nil&gt;.invalid?` to return true, got false
     # ./spec/models/product_spec.rb:7:in `block (3 levels) in &lt;top (required)&gt;&#39;

Finished in 0.00922 seconds (files took 2.5 seconds to load)
1 example, 1 failure

Failed examples:

rspec ./spec/models/product_spec.rb:5 # Product#name 空文字を許容しないこと</pre><p>さらに、テストが失敗するので、右上にデスクトップ通知が表示されます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141019/20141019155242.png" alt="f:id:nipe880324:20141019155242p:plain:w320" title="f:id:nipe880324:20141019155242p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><p>では、Productモデルを実装しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/product.rb</span>

<span class="synPreProc">class</span> <span class="synType">Product</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  validates <span class="synConstant">:name</span>, <span class="synConstant">presence</span>: <span class="synConstant">true</span>
<span class="synPreProc">end</span>
</pre><p>保存するとまた特定のspecファイルのみ実行され、実行結果がデスクトップに表示されます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141019/20141019155503.png" alt="f:id:nipe880324:20141019155503p:plain:w320" title="f:id:nipe880324:20141019155503p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<p>これで、自動的に<a class="keyword" href="http://d.hatena.ne.jp/keyword/RSpec">RSpec</a>を実行する環境を構築できました。<br />
また、guardを実行しているコンソール上で<code>Enter</code>を押すと、全てのSpecファイルを実行することが可能です。</p><br />
<p><h3 id="guard-rspec-options">3. guard-<a class="keyword" href="http://d.hatena.ne.jp/keyword/rspec">rspec</a>のオプション</h3></p><p>次のように<code>guard-rspec</code>にオプションを指定することが可能です。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Guardfile</span>

<span class="synComment"># bundle execをつけて、rspecコマンドを実行する</span>
guard <span class="synConstant">:rspec</span>, <span class="synConstant">cmd</span>: <span class="synSpecial">'</span><span class="synConstant">bundle exec rspec</span><span class="synSpecial">'</span> <span class="synStatement">do</span>
  <span class="synComment"># ...</span>
<span class="synStatement">end</span>
</pre><p>指定できるオプションは次のようになっています。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synConstant">cmd</span>: <span class="synSpecial">'</span><span class="synConstant">zeus rspec</span><span class="synSpecial">'</span>      <span class="synComment"># rspecコマンドの前に特定のコマンドをつけてrspecを実行できる（デフォルト値：'rspec'）</span>
<span class="synConstant">cmd_additional_args</span>: <span class="synSpecial">'</span><span class="synConstant">-f progress</span><span class="synSpecial">'</span> <span class="synComment"># rspecのオプションを指定できる</span>
<span class="synConstant">spec_paths</span>: [<span class="synSpecial">'</span><span class="synConstant">spec</span><span class="synSpecial">'</span>]   <span class="synComment"># specファイルのカスタム配列を指定できる</span>
<span class="synConstant">failed_mode</span>: <span class="synConstant">:focus</span>    <span class="synComment"># specが失敗した時の挙動</span>
                       <span class="synComment"># 使用可能な値:</span>
                       <span class="synComment">#  :focus - focus on the first 10 failed specs, rerun till they pass</span>
                       <span class="synComment">#  :keep - keep failed specs until they pass (add them to new ones)</span>
                       <span class="synComment">#  :none (default) - just report</span>
<span class="synConstant">all_after_pass</span>: <span class="synConstant">true</span>   <span class="synComment"># specファイルが変更されたら全てのspecを実行する（デフォルト値：false）</span>
<span class="synConstant">all_on_start</span>: <span class="synConstant">true</span>     <span class="synComment"># guard起動時に全てのspecを実行する（デフォルト値：false）</span>
<span class="synConstant">launchy</span>: <span class="synConstant">nil</span>           <span class="synComment"># rspecの結果ファイルの出力パスを指定する。 例： ./tmp/spec_results.html（デフォルト値：nil）</span>
<span class="synConstant">notification</span>: <span class="synConstant">false</span>    <span class="synComment"># specが実行されたあとに通知を表示するか指定する（デフォルト値： true）</span>
<span class="synConstant">run_all</span>: { <span class="synConstant">cmd</span>: <span class="synSpecial">'</span><span class="synConstant">custom rspec command</span><span class="synSpecial">'</span>, <span class="synConstant">message</span>: <span class="synSpecial">'</span><span class="synConstant">custom message</span><span class="synSpecial">'</span> } <span class="synComment"># Custom options to use when running all specs</span>
<span class="synConstant">title</span>: <span class="synSpecial">'</span><span class="synConstant">My project</span><span class="synSpecial">'</span>    <span class="synComment"># 通知のタイトルを指定できる（デフォルト値：'RSpec results'）</span>
</pre>
</div>
<div class="section">
    <h3>参考文献</h3>
    <p><a href="https://github.com/guard/guard-rspec">guard/guard-rspec &middot; GitHub</a></p><br />
<p>以上です。分からない箇所や間違いなどありましたらコメントください。</p>

</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141021/1413819783.html"><time data-relative datetime="2014-10-20T15:43:03Z" title="2014-10-20T15:43:03Z" pubdate class="updated">2014-10-21 00:43</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141021/1413819783" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141021%2F1413819783" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141021/1413819783" data-count="vertical" data-text="Railsの開発効率を上げる - guard-rspec 自動でテスト(RSpec)を実行させる - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141021/1413819783" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
          <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4438296558807254"
     data-ad-slot="4370884664"
     data-ad-format="horizontal"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-3200 words-400 mode-hatena entry-odd" id="entry-8454420450069002348" data-keyword-campaign="" data-uuid="8454420450069002348">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/10/19.html" rel="nofollow">
          <time pubdate datetime="2014-10-19T05:55:28Z" title="2014-10-19T05:55:28Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">10</span><span class="hyphen">-</span><span class="date-day">19</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141019/1413698128.html" class="entry-title-link bookmark">Railsの開発効率を上げる - guard-rubocopを使ってRailsで自動で静的コード解析ツール(RuboCop)を実行させる</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/%E9%96%8B%E7%99%BA%E3%82%92%E5%8A%B9%E7%8E%87%E5%8C%96%E3%81%99%E3%82%8B.html">開発を効率化する</a>
          
          <a href="archive/category/Rails%20gem.html">Rails gem</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141016/20141016010205.png" alt="f:id:nipe880324:20141016010205p:plain:w320" title="f:id:nipe880324:20141016010205p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span><br />
</p>

<div class="section">
    <h3>Guardとは</h3>
    <p>Guardとはファイルの変更を検知して、自動的にさまざまな処理を実行してくれるRubyのGemです。<br />
これ単体で使うよりも、他のツールと連携し、自動的に処理を行い開発効率を上げるために使います。<br />
メジャーどころとしては、次の３つだと思います。</p>

<ul>
<li><a href="entry/20141016/1413389293.html">guard-livereload - Viewファイルの変更したときに自動的にブラウザをリロードする</a></li>
<li><a href="entry/20141021/1413819783.html">guard-rspec - specファイルを変更したときに自動的に<code>RSpec</code>を実行する</a></li>
<li>guard-rubocop - ファイルを修正したときに<code>RuboCop</code>を実行する</li>
</ul><p><br />
本記事では、Railsへ<code>guard-rubocop</code>の導入方法を記載します。<br />
また、<code>rubocop</code>は自動で動くので、失敗したときに、Mac OS X の通知センターの機能を使って通知するようにします。</p><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141019/20141019145153.png" alt="f:id:nipe880324:20141019145153p:plain:w320" title="f:id:nipe880324:20141019145153p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><p></p>

</div>
<div class="section">
    <h3>対象読者</h3>
    
<ul>
<li>Railsの開発効率を上げたい方</li>
</ul>
</div>
<div class="section">
    <h3>確認バージョン</h3>
    
<ul>
<li>Mac OSX 10.9</li>
<li>Ruby  2.0</li>
<li>Rails 4.1</li>
<li>guard 2.6.1</li>
<li>rubocop 0.26.1</li>
<li>guard-rubocop 1.1.0</li>
<li>terminal-notifier-guard 1.5.3</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1414081224.html#guard-rubocop-create-rails">Railsプロジェクトの作成</a></li>
<li><a href="index-page=1414081224.html#guard-rubocop-getting-started">guard-rubocopの導入</a></li>
<li><a href="index-page=1414081224.html#guard-rubocop-options">guard-rubocopのオプション</a></li>
<li><a href="index-page=1414081224.html#guard-rubocop-rspec">guard-rubocopとguard-rspecの混合</a></li>
</ol><p><h3 id="guard-rubocop-create-rails">1. Railsプロジェクトの作成</h3></p><p>まず、Guardを実行させるベースとなるRailsのプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new guard_test</pre><p>次に、簡単なProductのScaffoldを作成します。</p>
<pre class="code" data-lang="" data-unlink>cd guard_test
rails g scaffold Product name:string price:integer discontinued:boolean</pre><p>マイグレートします。</p>
<pre class="code" data-lang="" data-unlink>rake db:migrate</pre><p></p><p><h3 id="guard-rubocop-getting-started">2. guard-rubocopの導入</h3></p><p><code>Gemfile</code>の<code>developemnt</code>グループ内に必要なgemを追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Gemfile</span>
group <span class="synConstant">:development</span> <span class="synStatement">do</span>
  gem <span class="synSpecial">'</span><span class="synConstant">rubocop</span><span class="synSpecial">'</span>
  gem <span class="synSpecial">'</span><span class="synConstant">guard-rubocop</span><span class="synSpecial">'</span>
  gem <span class="synSpecial">'</span><span class="synConstant">terminal-notifier-guard</span><span class="synSpecial">'</span>
<span class="synStatement">end</span>
</pre><p>Bundlerを実行して、インストールします。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p>Guard定義が記載された<code>Guardfile</code>(Guardの設定ファイル)を作成します。</p>
<pre class="code" data-lang="" data-unlink>guard init rubocop</pre><p>コマンドが上手くいかない場合は、下記を実行して下さい。</p>
<pre class="code" data-lang="" data-unlink>gem install rubocop
gem install guard-rubocop
gem install terminal-notifier-guard</pre><p><br />
作成された<code>Guardfile</code>の中身を確認してみます。<br />
<code>rubocop</code>のブロック内に監視対象が記載されています。<br />
<code>watch</code>メソッドで監視するファイルを正規表現で記載します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Guardfile</span>

guard <span class="synConstant">:rubocop</span> <span class="synStatement">do</span>
  watch(<span class="synSpecial">%r{.+\.</span><span class="synConstant">rb</span><span class="synSpecial">$}</span>)
  watch(<span class="synSpecial">%r{(?:.+</span><span class="synConstant">/</span><span class="synSpecial">)?\.</span><span class="synConstant">rubocop</span><span class="synSpecial">\.</span><span class="synConstant">yml</span><span class="synSpecial">$}</span>) { |<span class="synIdentifier">m</span>| <span class="synType">File</span>.dirname(m[<span class="synConstant">0</span>]) }
<span class="synStatement">end</span>
</pre><p>次のように修正します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Guardfile</span>

<span class="synComment"># guard :rubocop do</span>
guard <span class="synConstant">:rubocop</span>, <span class="synConstant">all_on_start</span>: <span class="synConstant">false</span>, <span class="synConstant">cli</span>: [<span class="synSpecial">'</span><span class="synConstant">--format</span><span class="synSpecial">'</span>, <span class="synSpecial">'</span><span class="synConstant">clang</span><span class="synSpecial">'</span>, <span class="synSpecial">'</span><span class="synConstant">--rails</span><span class="synSpecial">'</span>] <span class="synStatement">do</span>
  watch(<span class="synSpecial">%r{.+\.</span><span class="synConstant">rb</span><span class="synSpecial">$}</span>)
  watch(<span class="synSpecial">%r{.+\.</span><span class="synConstant">rake</span><span class="synSpecial">$}</span>) <span class="synComment"># .rakeファイルも監視対象にする</span>
  watch(<span class="synSpecial">%r{(?:.+</span><span class="synConstant">/</span><span class="synSpecial">)?\.</span><span class="synConstant">rubocop</span><span class="synSpecial">\.</span><span class="synConstant">yml</span><span class="synSpecial">$}</span>) { |<span class="synIdentifier">m</span>| <span class="synType">File</span>.dirname(m[<span class="synConstant">0</span>]) }
<span class="synStatement">end</span>
</pre><p>上記の設定でguard起動時にrubocopを実行させず、失敗時に通知センターに通知がされます。<br />
rubocopの詳細なオプションについては、本記事下記の「<a href="index-page=1414081224.html#guard-rubocop-options">guard-rubocopのオプション</a>」を参照して下さい。</p><br />
<p>では、<code>Guard</code>を実行します。</p>
<pre class="code" data-lang="" data-unlink>bundle exec guard</pre><p><i>※Railsプロジェクトの配置パスに日本語が入っていると、「<b>E, [2014-10-16T00:43:38.055423 #28197] ERROR -- : run() in thread failed: inspected result must be ASCII only or use the same encoding with default external:/Users/nipe0324/.rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/listen-2.7.9/lib/listen/listener.rb:329:in `inspect'</b>」のようなエラーが発生するのでご注意ください。</i></p><p><code>.rb</code>のファイルを編集することで、自動でrubocopが動き、（デフォルトのrubocopの規約が厳しすぎて）失敗するので、右上で通知がされます。</p><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141019/20141019145153.png" alt="f:id:nipe880324:20141019145153p:plain:w320" title="f:id:nipe880324:20141019145153p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><p>これで、自動でrubocopを起動する環境を構築することができました。<br />
rubocopの設定については、<a href="https://github.com/bbatsov/rubocop">bbatsov/rubocop &middot; GitHub</a> を参照して下さい。</p><br />
<p><h3 id="guard-rubocop-options">3. guard-rubocopのオプション</h3></p><p>次のように<code>guard-rubocop</code>にオプションを指定することが可能です。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Guardfile</span>

guard <span class="synConstant">:rubocop</span>, <span class="synConstant">all_on_start</span>: <span class="synConstant">false</span>, <span class="synConstant">cli</span>: [<span class="synSpecial">'</span><span class="synConstant">--format</span><span class="synSpecial">'</span>, <span class="synSpecial">'</span><span class="synConstant">clang</span><span class="synSpecial">'</span>, <span class="synSpecial">'</span><span class="synConstant">--rails</span><span class="synSpecial">'</span>] <span class="synStatement">do</span>
  watch(<span class="synSpecial">%r{.+\.</span><span class="synConstant">rb</span><span class="synSpecial">$}</span>)
  watch(<span class="synSpecial">%r{(?:.+</span><span class="synConstant">/</span><span class="synSpecial">)?\.</span><span class="synConstant">rubocop</span><span class="synSpecial">\.</span><span class="synConstant">yml</span><span class="synSpecial">$}</span>) { |<span class="synIdentifier">m</span>| <span class="synType">File</span>.dirname(m[<span class="synConstant">0</span>]) }
<span class="synStatement">end</span>
</pre><p>指定できるオプションは次のようになっています。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synConstant">all_on_start</span>: <span class="synConstant">true</span>     <span class="synComment"># Guard起動時にすべてのファイルをチェックする（デフォルト値：true）</span>
<span class="synConstant">cli</span>: <span class="synSpecial">'</span><span class="synConstant">--rails</span><span class="synSpecial">'</span>         <span class="synComment"># RuboCopへのオプションをを文字列か配列で指定する（デフォルト値：nil）</span>
<span class="synConstant">keep_failed</span>: <span class="synConstant">true</span>      <span class="synComment"># Keep failed files until they pass. (default: true)</span>
<span class="synConstant">notification</span>: <span class="synConstant">:failed</span>  <span class="synComment"># 実行後に通知センターに通知をする（デフォルト値：failed - 失敗時）</span>
                       <span class="synComment">#   true    - 毎回通知する</span>
                       <span class="synComment">#   false   - 通知をしない</span>
                       <span class="synComment">#   :failed - 失敗時のみ通知する</span>
</pre><p></p><p><h3 id="guard-rubocop-rspec">guard-rubocopとguard-rspecの混合</h3></p><p>TDDで実装しているときに、RedとGreenの段階では、「RSpecが失敗したら、RuboCopの実行をしない」ように制御したい場合があるかもしれません。<br />
そのようなときに、次のように<code>Guardfile</code>を修正するとよいです。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Guardfile</span>

<span class="synComment"># RSpecが失敗したら、RuboCopをスキップする</span>
group <span class="synConstant">:red_green_refactor</span>, <span class="synConstant">halt_on_fail</span>: <span class="synConstant">true</span> <span class="synStatement">do</span>

  guard <span class="synConstant">:rspec</span> <span class="synStatement">do</span>
    ...
  <span class="synStatement">end</span>

  guard <span class="synConstant">:rubocop</span> <span class="synStatement">do</span>
    ...
  <span class="synStatement">end</span>

<span class="synStatement">end</span>


* 参考文献
- [https<span class="synConstant">:/</span>/github.com/guard/guard<span class="synConstant">:title</span>]

</pre>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141019/1413698128.html"><time data-relative datetime="2014-10-19T05:55:28Z" title="2014-10-19T05:55:28Z" pubdate class="updated">2014-10-19 14:55</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141019/1413698128" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141019%2F1413698128" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141019/1413698128" data-count="vertical" data-text="Railsの開発効率を上げる - guard-rubocopを使ってRailsで自動で静的コード解析ツール(RuboCop)を実行させる - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141019/1413698128" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user_2nd', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_1', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_1" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-3200 words-400 mode-hatena entry-even" id="entry-8454420450068828864" data-keyword-campaign="" data-uuid="8454420450068828864">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/10/16.html" rel="nofollow">
          <time pubdate datetime="2014-10-15T16:08:13Z" title="2014-10-15T16:08:13Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">10</span><span class="hyphen">-</span><span class="date-day">16</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141016/1413389293.html" class="entry-title-link bookmark">Railsの開発効率を上げる - guard-livereloadを使ってRailsでブラウザのオートリロードをさせる</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%20gem.html">Rails gem</a>
          
          <a href="archive/category/%E9%96%8B%E7%99%BA%E3%82%92%E5%8A%B9%E7%8E%87%E5%8C%96%E3%81%99%E3%82%8B.html">開発を効率化する</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141016/20141016010205.png" alt="f:id:nipe880324:20141016010205p:plain:w320" title="f:id:nipe880324:20141016010205p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span><br />
</p>

<div class="section">
    <h3>Guardとは</h3>
    <p>Guardとはファイルの変更を検知して、自動的にさまざまな処理を実行してくれるRubyのGemです。<br />
これ単体で使うよりも、他のツールと連携し、自動的に処理を行い開発効率を上げるために使います。<br />
メジャーどころとしては、次の３つだと思います。</p>

<ul>
<li>guard-livereload - Viewファイルの変更したときに自動的にブラウザをリロードする</li>
<li><a href="entry/20141021/1413819783.html">guard-rspec - specファイルを変更したときに自動的に<code>RSpec</code>を実行する</a></li>
<li><a href="entry/20141019/1413698128.html">guard-rubocop - ファイルを修正したときに<code>RuboCop</code>を実行する</a></li>
</ul><p>本記事では、Railsへ<code>guard-livereload</code>の導入方法を記載します。<br />
<br />
<br />
<br />
</p>

</div>
<div class="section">
    <h3>動作確認</h3>
    
<ul>
<li>Mac OSX 10.9</li>
<li>Ruby  2.0</li>
<li>Rails 4.1</li>
<li>guard 2.6.1</li>
<li>guard-livereload 2.3.0</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1414081224.html#guard-create-rails">Railsプロジェクトの作成</a></li>
<li><a href="index-page=1414081224.html#guard-livereload-getting-started">guard-livereloadの導入</a></li>
</ol><p><br />
<h3 id="guard-create-rails">1. Railsプロジェクトの作成</h3></p><p>まず、Guardを実行させるベースとなるRailsのプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new guard_test</pre><p>次に、簡単なProductのScaffoldを作成します。</p>
<pre class="code" data-lang="" data-unlink>cd guard_test
rails g scaffold Product name:string price:integer discontinued:boolean</pre><p>マイグレートします。</p>
<pre class="code" data-lang="" data-unlink>rake db:migrate</pre><p></p><p><h3 id="guard-livereload-getting-started">2. guard-livereloadの導入</h3></p><p><code>Gemfile</code>の<code>developemnt group</code>内に<code>guard-livereload</code>を追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Gemfile</span>
group <span class="synConstant">:development</span> <span class="synStatement">do</span>
  gem <span class="synSpecial">'</span><span class="synConstant">guard-livereload</span><span class="synSpecial">'</span>, <span class="synPreProc">require</span>: <span class="synConstant">false</span>
<span class="synStatement">end</span>
</pre><p>Bundlerを実行して、インストールします。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p>Guard定義が記載された<code>Guardfile</code>(Guardの設定ファイル)を作成します。</p>
<pre class="code" data-lang="" data-unlink>bundle exec guard init livereload</pre><p>作成された<code>Guardfile</code>の中身を確認してみます。</p><p>これは、<code>guard</code>で監視するファイルが変更された場合に実行するプラグイン(livereload, rspec, rubocopなど)を記載します。<br />
そして、<code>guard</code>ブロック内に<code>watch</code>を記載し、監視するファイルを記載します。</p><p>基本的に<code>bundle exec guard init [Guardのプラグイン名</code>を実行することにより、基本的な設定を自動で<code>Guardfile</code>に追加してくれます。</p><p>既にViewやHelperなどの変更に対する監視が記載されているので、今回は特に編集しません。<br />
監視対象を増やしたい、減らしたい場合は必要に応じて追加してください。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># A sample Guardfile</span>
<span class="synComment"># More info at https://github.com/guard/guard#readme</span>

guard <span class="synSpecial">'</span><span class="synConstant">livereload</span><span class="synSpecial">'</span> <span class="synStatement">do</span>
  watch(<span class="synSpecial">%r{</span><span class="synConstant">app/views/</span><span class="synSpecial">.+\.(</span><span class="synConstant">erb</span><span class="synSpecial">|</span><span class="synConstant">haml</span><span class="synSpecial">|</span><span class="synConstant">slim</span><span class="synSpecial">)$}</span>)
  watch(<span class="synSpecial">%r{</span><span class="synConstant">app/helpers/</span><span class="synSpecial">.+\.</span><span class="synConstant">rb</span><span class="synSpecial">}</span>)
  watch(<span class="synSpecial">%r{</span><span class="synConstant">public/</span><span class="synSpecial">.+\.(</span><span class="synConstant">css</span><span class="synSpecial">|</span><span class="synConstant">js</span><span class="synSpecial">|</span><span class="synConstant">html</span><span class="synSpecial">)}</span>)
  watch(<span class="synSpecial">%r{</span><span class="synConstant">config/locales/</span><span class="synSpecial">.+\.</span><span class="synConstant">yml</span><span class="synSpecial">}</span>)
  <span class="synComment"># Rails Assets Pipeline</span>
  watch(<span class="synSpecial">%r{(</span><span class="synConstant">app</span><span class="synSpecial">|</span><span class="synConstant">vendor</span><span class="synSpecial">)(</span><span class="synConstant">/assets/</span><span class="synSpecial">\w+</span><span class="synConstant">/</span><span class="synSpecial">(.+\.(</span><span class="synConstant">css</span><span class="synSpecial">|</span><span class="synConstant">js</span><span class="synSpecial">|</span><span class="synConstant">html</span><span class="synSpecial">|</span><span class="synConstant">png</span><span class="synSpecial">|</span><span class="synConstant">jpg</span><span class="synSpecial">))).*}</span>) { |<span class="synIdentifier">m</span>| <span class="synSpecial">&quot;</span><span class="synConstant">/assets/</span><span class="synSpecial">#{</span>m[<span class="synConstant">3</span>]<span class="synSpecial">}&quot;</span> }
<span class="synStatement">end</span>
</pre><p>次にブラウザに<code>LiveReload</code>のエクステンションを追加します。<br />
次のサイトにSafari, Chrome, FireFoxのエクステンションへのリンクがあります。<br />
<a href="http://feedback.livereload.com/knowledgebase/articles/86242-how-do-i-install-and-use-the-browser-extensions-">http://feedback.livereload.com/knowledgebase/articles/86242-how-do-i-install-and-use-the-browser-extensions-</a></p><p>エクステンションを入れたら、<code>Guard</code>を実行します。</p>
<pre class="code" data-lang="" data-unlink>bundle exec guard
00:52:35 - INFO - Guard is using TerminalTitle to send notifications.
00:52:36 - INFO - LiveReload is waiting for a browser to connect.
00:52:36 - INFO - Guard is now watching at &#39;/Users/nipe0324/guard_test&#39;</pre><p><i>※Railsプロジェクトの配置パスに日本語が入っていると、「<b>E, [2014-10-16T00:43:38.055423 #28197] ERROR -- : run() in thread failed: inspected result must be ASCII only or use the same encoding with default external:/Users/nipe0324/.rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/listen-2.7.9/lib/listen/listener.rb:329:in `inspect'</b>」のようなエラーが発生するのでご注意ください。</i></p><p>そして、別コンソールでサーバーを起動します。</p>
<pre class="code" data-lang="" data-unlink>rails s</pre><p><code>http://localhost:3000/products</code>にアクセスし、ブラウザの<code>LiveRelad</code>を有効にしてください。<br />
Guardのコンソールに次のように「<b>Browser connected.</b>」と表示されたら、ブラウザとGuardが接続された証拠です。</p>
<pre class="code" data-lang="" data-unlink>[1] guard(main)&gt; 00:52:42 - INFO - Browser connected.</pre><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141016/20141016010240.png" alt="f:id:nipe880324:20141016010240p:plain:w480" title="f:id:nipe880324:20141016010240p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>この状態で、<code>index.html</code>を更新し、保存します。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>Listing products<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>

<span class="synComment">&lt;!-- 追加箇所 開始 --&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier"> </span><span class="synType">style</span><span class="synIdentifier">=</span><span class="synConstant">&quot;color:red;&quot;</span><span class="synIdentifier">&gt;</span>Guardで自動的に追加される文字列<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
<span class="synComment">&lt;!-- 追加箇所 終了 --&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Name<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Price<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Discontinued<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier"> </span><span class="synType">colspan</span><span class="synIdentifier">=</span><span class="synConstant">&quot;3&quot;</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>
  ...
</pre><p>保存をすると、GuardがViewファイルの変更を検知し、ブラウザを自動的にリロードしてくれます。</p><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141016/20141016010257.png" alt="f:id:nipe880324:20141016010257p:plain:w480" title="f:id:nipe880324:20141016010257p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>これで、毎回ファイルを更新してブラウザをロードするということがなくなりとっても便利です。</p><br />
<p>もし、VagrantなどでMacなどに仮想マシンを起動させている場合は、そのための設定方法が記載されています。<br />
<iframe src="http://togattti.hateblo.jp/embed/2014/09/09/233049" title="Vagrant環境にLive Reloadを設定する - 麹町で働くWebエンジニアのメモ帳" class="embed-card embed-blogcard" scrolling="no" frameborder="0" style="width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;"><a href="http://togattti.hateblo.jp/entry/2014/09/09/233049">Vagrant環境にLive Reloadを設定する - 麹町で働くWebエンジニアのメモ帳</a></iframe><br />
<a href="http://togattti.hateblo.jp/entry/2014/09/09/233049">Vagrant&#x74B0;&#x5883;&#x306B;Live Reload&#x3092;&#x8A2D;&#x5B9A;&#x3059;&#x308B; - &#x9EB9;&#x753A;&#x3067;&#x50CD;&#x304F;Web&#x30A8;&#x30F3;&#x30B8;&#x30CB;&#x30A2;&#x306E;&#x30E1;&#x30E2;&#x5E33;</a></p><p></p>

</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li><a href="https://github.com/guard/guard">guard/guard &middot; GitHub</a></li>
</ul><p><br />
以上です。分からない箇所や間違いなどありましたらコメントください。</p>

</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141016/1413389293.html"><time data-relative datetime="2014-10-15T16:08:13Z" title="2014-10-15T16:08:13Z" pubdate class="updated">2014-10-16 01:08</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141016/1413389293" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141016%2F1413389293" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141016/1413389293" data-count="vertical" data-text="Railsの開発効率を上げる - guard-livereloadを使ってRailsでブラウザのオートリロードをさせる - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141016/1413389293" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
          <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4438296558807254"
     data-ad-slot="4370884664"
     data-ad-format="horizontal"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-4400 words-400 mode-hatena entry-odd" id="entry-8454420450068615327" data-keyword-campaign="" data-uuid="8454420450068615327">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/10/15.html" rel="nofollow">
          <time pubdate datetime="2014-10-14T15:21:28Z" title="2014-10-14T15:21:28Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">10</span><span class="hyphen">-</span><span class="date-day">15</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141015/1413300088.html" class="entry-title-link bookmark">RailsのファイルをアップロードするgemのCarrierWaveのインストール方法</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%20gem.html">Rails gem</a>
          
          <a href="archive/category/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89.html">ファイルアップロード</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        
<div class="section">
    <h3>CarrierWaveとは</h3>
    <p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141015/20141015002041.jpg" alt="f:id:nipe880324:20141015002041j:plain:w240" title="f:id:nipe880324:20141015002041j:plain:w240" class="hatena-fotolife" style="width:240px" itemprop="image"></span></p><p>CarrierWaveとは有名なファイルアップロード用のgemです。他にはPaperclipというものもあります。<br />
この２つがRuby/Railsでのファイルアップロードgemとしてトップ２を争っています。</p><p>これらの違いは、</p>

<ul>
<li>Paperclipは機能がシンプルで使いやすい</li>
<li>CarrierWaveは機能がいろいろあり、応用が聞きやすい</li>
</ul><p>です。<br />
<br />
</p>

</div>
<div class="section">
    <h3>完成イメージ</h3>
    <p>新規/編集画面で画像をアップロードをし、次のように詳細画面で表示することができます。<br />
また、チェックボックスをつけて、削除することも可能です。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141015/20141015000556.png" alt="f:id:nipe880324:20141015000556p:plain:w320" title="f:id:nipe880324:20141015000556p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<p></p>

</div>
<div class="section">
    <h3>実施環境</h3>
    
<ul>
<li>Mac OS X 10.9</li>
<li>Ruby  2.0</li>
<li>Rails 4.1</li>
<li>CarrierWave 0.10.0</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1414081224.html#carrierwave-create-rails">Railsプロジェクトの作成</a></li>
<li><a href="index-page=1414081224.html#carrierwave-getting-started">CarrierWaveのインストールと導入</a></li>
<li><a href="index-page=1414081224.html#carrierwave-usefull-method">CarrierWaveの良く使うメソッド</a></li>
</ol><p><br />
<h3 id="carrierwave-create-rails">Railsプロジェクトの作成</h3></p><p>まず Railsプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new carrierwave_test</pre><p>そして Scaffoldで簡単なProductクラスを作ります。</p>
<pre class="code" data-lang="" data-unlink>cd carrierwave_test
rails g scaffold Product name:string price:integer</pre><p>では DBマイグレートをして、ローカル環境で動かしてみましょう。</p>
<pre class="code" data-lang="" data-unlink>rake db:migrate
rails s</pre><p>以下のような画面ができるはずです。</p><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141015/20141015000549.png" alt="f:id:nipe880324:20141015000549p:plain:w480" title="f:id:nipe880324:20141015000549p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<br />
<p><h3 id="carrierwave-getting-started">CarrierWaveのインストールと導入</h3></p>

<div class="section">
    <h4>Gemのインストール</h4>
    <p>では、CarrierWaveのインストールをプロジェクトに導入します。</p>
<pre class="code" data-lang="" data-unlink># Gemfile
...
gem &#34;carrierwave&#34;</pre><p>gemをインストールします。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre>
</div>
<div class="section">
    <h4>アップローダーの生成</h4>
    <p>CarrierWaveのジェネレーターでアップローダーを作成します</p>
<pre class="code" data-lang="" data-unlink>rails g uploader Image
      create  app/uploaders/image_uploader.rb</pre><p>作成されたファイルの<code>image_uploader.rb</code>の中をのぞいてみると、ファイルの保存方法（デフォルトはファイル）、保存パス、ファイルのサイズ、拡張子やファイル名の変換などが変更できることがわかると思います。</p><p>CarrierWaveはActiveRecordやMongoId、DataMapperなどのORMと連携することができます。<br />
今回は、RailsのデフォルトでもあるActiveRecordを使って、アップロードしたファイルの情報を保存します。</p>

</div>
<div class="section">
    <h4>Modelに画像情報保持用のカラムの追加</h4>
    <p>まずは、Stringカラムをモデルに追加するために、Productモデルにマイグレーションファイルを作成し、マイグレートをします。</p>
<pre class="code" data-lang="" data-unlink>rails g migration add_image_to_product image:string
rake db:migrate</pre><p>その後、モデルファイルを開き、アップローダーへのマウントする記述を追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/product.rb</span>
<span class="synPreProc">class</span> <span class="synType">Product</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  mount_uploader <span class="synConstant">:image</span>, <span class="synType">ImageUploader</span>
<span class="synPreProc">end</span>
</pre>
</div>
<div class="section">
    <h4>画像の追加/編集/表示/削除処理の追加</h4>
    <p>商品の新規/編集フォームに画像アップロードの入力フィールドを追加します。<br />
hidden属性で<code>image_cache</code>を指定しましたが、これは、画像を指定したけれども、バリデーションエラーなどにより保存が失敗した場合の画面再表示時などに、画像情報をキャッシュしておくための領域です。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/products/_form.html.erb

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> form_for(@product)</span><span class="synIdentifier"> do |f| %&gt;</span>
  <span class="synIdentifier">&lt;% if @product.errors.any? %&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;error_explanation&quot;</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> pluralize(@product.errors.count,</span><span class="synIdentifier"> </span><span class="synConstant">&quot;error&quot;</span><span class="synIdentifier">) %&gt;</span> prohibited this product from being saved:<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>

      <span class="synIdentifier">&lt;</span><span class="synStatement">ul</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;% @product.errors.full_messages.each do |message| %&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> message</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;% end %&gt;</span>
      <span class="synIdentifier">&lt;/</span><span class="synStatement">ul</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;% end %&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;field&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :</span><span class="synType">name</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_field</span><span class="synIdentifier"> :</span><span class="synType">name</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;field&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :price %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.number_field</span><span class="synIdentifier"> :price %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
  <span class="synComment">&lt;!-- 追加箇所 開始 --&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;field&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;% if @product.image? %&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;thumbnail&quot;</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;%=</span><span class="synConstant"> image_tag</span><span class="synIdentifier"> @product.image.</span><span class="synType">url</span><span class="synIdentifier"> %&gt;</span>
      <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;% end %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :image %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.file_field</span><span class="synIdentifier"> :image %&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.hidden_field</span><span class="synIdentifier"> :image_cache %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;field&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synComment">&lt;!-- 既存レコード(DBに保存されている)かつ、画像が存在する場合 --&gt;</span>
    <span class="synIdentifier">&lt;% if @product.persisted? &amp;&amp; @product.image? %&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">label</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.check_box</span><span class="synIdentifier"> :remove_image %&gt;</span>
        画像を削除
      <span class="synIdentifier">&lt;/</span><span class="synStatement">label</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;% end %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
  <span class="synComment">&lt;!-- 追加箇所 終了 --&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;actions&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.submit</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;% end %&gt;</span>
</pre><p><br />
コントローラーにファイルの属性を更新できるようにするために、StrongParametersの箇所を修正します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/controllers/products_controller.rb</span>

...
    <span class="synComment"># Never trust parameters from the scary internet, only allow the white list through.</span>
    <span class="synPreProc">def</span> <span class="synIdentifier">product_params</span>
      params.require(<span class="synConstant">:product</span>).permit(<span class="synConstant">:name</span>, <span class="synConstant">:price</span>, <span class="synConstant">:image</span>, <span class="synConstant">:image_cache</span>, <span class="synConstant">:remove_image</span>)
    <span class="synPreProc">end</span>

end
</pre><p>そして、画像がアップロードされたら、詳細画面で表示するようにします。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/products/show.html.erb

<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;notice&quot;</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> notice</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>Name:<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @product.name</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>Price:<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @product.price</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

<span class="synComment">&lt;!-- 追加箇所 開始 --&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>Image:<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;% if @product.image? %&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;thumbnail&quot;</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;%=</span><span class="synConstant"> image_tag</span><span class="synIdentifier"> @product.image.</span><span class="synType">url</span><span class="synIdentifier"> %&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;% end %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
<span class="synComment">&lt;!-- 追加箇所 終了 --&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Edit'</span><span class="synIdentifier">, edit_product_path(@product) %&gt;</span> |
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Back'</span><span class="synIdentifier">, products_path %&gt;</span>
</pre><p><br />
では、サーバーを起動して画像を登録してみましょう。<br />
新規画面から画像を選択し、登録を押すと次のように画像が表示されます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141015/20141015000556.png" alt="f:id:nipe880324:20141015000556p:plain:w320" title="f:id:nipe880324:20141015000556p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><p>また、このアップロードされたファイルはpublic/uploads/products配下に保存されています。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141015/20141015000604.png" alt="f:id:nipe880324:20141015000604p:plain:w230" title="f:id:nipe880324:20141015000604p:plain:w230" class="hatena-fotolife" style="width:230px" itemprop="image"></span></p><br />
<p><h3 id="carrierwave-usefull-method">CarrierWaveの良く使うメソッド</h3>アップローダーをincludeしたモデル次のようなメソッドを使えます</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># モデルの作成</span>
product       = <span class="synType">Product</span>.new

<span class="synComment"># 画像ファイルの設定</span>
product.image = params[<span class="synConstant">:image</span>]         <span class="synComment"># paramsから設定</span>
product.image = <span class="synType">File</span>.open(<span class="synSpecial">'</span><span class="synConstant">somewhere</span><span class="synSpecial">'</span>) <span class="synComment"># Fileオブジェクトを設定</span>

<span class="synComment"># 保存</span>
product.save!

<span class="synComment"># アップローダーの対するメソッド</span>
product.image.url          <span class="synComment"># =&gt; '/url/to/file.png'</span>
product.image.current_path <span class="synComment"># =&gt; 'path/to/file.png'</span>
prodcut.image.identifier   <span class="synComment"># =&gt; 'file.png'</span>
product.image?   <span class="synComment"># =&gt; imageがあるかを true or false で返す</span>
</pre><p></p><p>今回はCarrierWaveの基礎的な内容を記載しましたが、比較的簡単に画像のCRUDをActiveRecordのモデルに追加することができました。<br />
次は、より深くCarrierWaveを使うためのカスタマイズ方法を説明します。</p><p>間違っている箇所のご指摘、良く分からないといった質問などありましたら、お気軽に以下のコメント欄に記載ください。直に返します。</p>

</div>
</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li><a href="https://github.com/carrierwaveuploader/carrierwave" target="_blank">GitHub公式ページ</a></li>
<li><a href="https://github.com/carrierwaveuploader/carrierwave/wiki" target="_blank">Howto集</a></li>
<li><a href="http://rubydoc.info/gems/carrierwave/frames" target="_blank">Howot集2</a></li>
</ul>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141015/1413300088.html"><time data-relative datetime="2014-10-14T15:21:28Z" title="2014-10-14T15:21:28Z" pubdate class="updated">2014-10-15 00:21</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141015/1413300088" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141015%2F1413300088" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141015/1413300088" data-count="vertical" data-text="RailsのファイルをアップロードするgemのCarrierWaveのインストール方法 - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141015/1413300088" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user_2nd', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_2', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_2" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-2000 words-100 mode-hatena entry-even" id="entry-8454420450068121552" data-keyword-campaign="" data-uuid="8454420450068121552">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/10/10.html" rel="nofollow">
          <time pubdate datetime="2014-10-09T15:10:52Z" title="2014-10-09T15:10:52Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">10</span><span class="hyphen">-</span><span class="date-day">10</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141010/1412867452.html" class="entry-title-link bookmark">チームでカイゼンしていく指向フレームワークKPTとは</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/%E3%83%81%E3%83%BC%E3%83%A0.html">チーム</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141010/20141010000405.jpg" alt="f:id:nipe880324:20141010000405j:plain:w480" title="f:id:nipe880324:20141010000405j:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>KPTのやりかたについて説明します。<br />
KPTをやることでチーム開発のプロセス自体をフィードバックを行うことができ、より効果的・生産的にチーム開発を行っていけます。<br />
<br />
</p>

<div class="section">
    <h3>対象読者</h3>
    
<ul>
<li>チームメンバーがバラバラでチームの空気が重いと思っている方</li>
<li>チーム内での情報の共有が上手くできていないと考えている方</li>
<li>問題を洗い出しても、具体的な行動につながらないと考えている方</li>
</ul>
</div>
<div class="section">
    <h3>KPTとは</h3>
    
<ul>
<li>「Keep（よかったこと、今後も続けること）」</li>
<li>「Problem（困ったこと、問題点）」</li>
<li>「Try（今後の活動で試したいこと）」</li>
</ul><p>の略で、この視点でチームで振り返りをする思考フレームワークです。</p><p>これを毎週や数週間毎に定期的に行うことにより、チームとしての生産性を上げることができます。</p><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141010/20141010000451.jpg" alt="f:id:nipe880324:20141010000451j:plain:w480" title="f:id:nipe880324:20141010000451j:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p></p>

<div class="section">
    <h4>KPTの流れ</h4>
    
<div class="section">
    <h5>Problem -> Try -> Keep パターン</h5>
    <p>問題があったのでProblemに記載。<br />
改善策を考えTryに移動し実行する。<br />
そして、効果があると思われたので今後も続けるためにKeepに移動する。</p>

</div>
<div class="section">
    <h5>Keep -> Try -> Keep</h5>
    <p>よかったことを、もっとよくしていこうというもの。<br />
Keepにあるものを、こうしたらより良くなるとTryに移動し、</p>

</div>
<div class="section">
    <h5>Try -> Keep</h5>
    <p>KeepやProblem無関係にTryを実施して、次も続けるならばKeepとして扱う。<br />
問題から発端としてないので、なかなかKeepになりづらい。</p><p>これらを定期的に繰り返すことにより、Keepが増えていき、問題が解消されてよりよいチームになります。<br />
そうなったときには、「<b>チームとしての成功体験が見える形でたくさんあり、連帯感も増えて、よいチームになっている</b>」ことでしょう。</p>

</div>
</div>
</div>
<div class="section">
    <h3>KPTの手順</h3>
    <p>※ 初回は 1, 2 は省略する</p>

<ol>
<li>チームとしてのどうなっていきたいかを決める（これに向かっていくための振り返りやカイゼンであるためこれがないと効果が上がりづらい）例えば、「残業が定常化しているなら残業時間を減らすために生産的に働く」「楽しく働く」などざっくりしたものでよいです。大切なことは、チームとしてどのなっていきたいという方向性をみんなで同意することです。</li>
<li>前回のTryの中で、次も続けた方がいいものはKeepに移動する。Prolemとして扱う必要がなくなったものは取り外す。</li>
<li>Keepを各々が付箋紙に書いて、メンバーが書き終わったらチーム全員に共有する。こうすることで各々の意見がでて、いろいろな意見がでる。</li>
<li>Problemを付箋紙に書いて、メンバーが書き終わったらチーム全員に共有する。</li>
<li>KeepやProblemに対しての改善策をメンバーで考え、Tryを付箋紙に書いて共有する。</li>
<li>次の期間内で実行するTryを選択し、アクションに落とし込んで合意し、Todoとしてメンバーに割り当てる。</li>
</ol>
</div>
<div class="section">
    <h3>意見が出ない場合...</h3>
    
<div class="section">
    <h5>人数が多く、周りの人に遠慮してしまい意見が出にくくなっているかもしれない。そういうときは、グループに分けることが効果的。</h5>
    
</div>
<div class="section">
    <h5>KPTのテーマが不明確。問題はゴールと現状のギャップなので、テーマ(=ゴール)が不明確なので問題を認識できてない場合があるかもしれない。</h5>
    <p><b>「業務をよりシンプルに、より素早く行うには」というような、継続性があり、簡単にはゴールに到達できないテーマを設定すると良い。</b><br />
</p>

</div>
<div class="section">
    <h5>問題の設定を促すために、意見を引き出す質問をするといいかもしれない。</h5>
    <p>[Keep]</p>

<ul>
<li>今後も続けたいことは何ですか？</li>
<li>どんなよかったことがありましたか？</li>
<li>なぜ、上手くいった/よかったのですか？</li>
<li>他の人にちょっと自慢したいことや、褒めてもらいたいことはありますか？</li>
<li>他の人の「ここがよかった」というところはどこですか？</li>
<li>前と変えてみたところはありましたか？</li>
</ul><p>[Problem]</p>

<ul>
<li>気になることや、困ったことはありましたか？</li>
<li>何かガマンしていることはありますか？</li>
<li>「もっとできた」と思っていることは、どんなことですか？</li>
<li>チームで決めたルールで、守れなかったことはありましたか？</li>
<li>目標の達成をさまたげることは、どんなことですか？</li>
<li>ムダと感じることは、どんなことですか？</li>
<li>理想と感じることは、どんなことですか？</li>
</ul><p>[Try]</p>

<ul>
<li>そのProblemを少しでも改善するには、何をすればよいですか？</li>
<li>そのProblemをすべて取り払うには、何をすればよいですか？</li>
<li>そのProblemがなくせないとしたら、何をすればよいですか？</li>
<li>そのKeepの本質は何ですか？</li>
<li>そのKeepをよりうまく行うには、何をすればよいですか？</li>
<li>目標に近づくためには、何をすればよいですか？</li>
</ul>
</div>
</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li>これだけ!KPT あらゆるプロセスを成果につなげる 最強のカイゼンフレームワーク</li>
</ul>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141010/1412867452.html"><time data-relative datetime="2014-10-09T15:10:52Z" title="2014-10-09T15:10:52Z" pubdate class="updated">2014-10-10 00:10</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141010/1412867452" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141010%2F1412867452" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141010/1412867452" data-count="vertical" data-text="チームでカイゼンしていく指向フレームワークKPTとは - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141010/1412867452" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
          <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4438296558807254"
     data-ad-slot="4370884664"
     data-ad-format="horizontal"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-5600 words-600 mode-hatena entry-odd" id="entry-8454420450068003305" data-keyword-campaign="" data-uuid="8454420450068003305">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/10/08.html" rel="nofollow">
          <time pubdate datetime="2014-10-08T13:20:36Z" title="2014-10-08T13:20:36Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">10</span><span class="hyphen">-</span><span class="date-day">08</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141008/1412774436.html" class="entry-title-link bookmark">Railsでransackを使って検索機能を作成する</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%20gem.html">Rails gem</a>
          
          <a href="archive/category/%E6%A4%9C%E7%B4%A2.html">検索</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        
<div class="section">
    <h3>ransackとは</h3>
    <p><a href="https://github.com/activerecord-hackery/ransack" target="_blank">ransack</a>はモデルの検索インターフェースを簡単に作れるgemです。それにより検索機能を簡単に実装できます。</p><p>商品の検索機能をステップステップで作成することにより、ransackの使い方を説明していきます。<br />
次のように検索フォームを作成し、検索をすることができます。</p><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141008/20141008215332.png" alt="f:id:nipe880324:20141008215332p:plain:w480" title="f:id:nipe880324:20141008215332p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p></p>

</div>
<div class="section">
    <h3>動作確認</h3>
    
<ul>
<li>Mac OSX 10.9</li>
<li>Rails 4.1</li>
<li>Ransack 1.4.1</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1414081224.html#ransack-create-project">Railsプロジェクトの作成</a></li>
<li><a href="index-page=1414081224.html#ransack-install">Ransackのインストール</a></li>
<li><a href="index-page=1414081224.html#ransack-search-function">Ransackで検索機能と検索フォームを作成</a></li>
<li><a href="index-page=1414081224.html#ransack-sort-on-table">Ransackでテーブルのソートリンク</a></li>
<li><a href="index-page=1414081224.html#ransack-restrict">Ransackで検索条件を絞る</a></li>
</ol><p><br />
<h3 id="ransack-create-project">1. Railsプロジェクトの作成</h3>まずは、Railsプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new ransack_test
cd ransack_test</pre><p>Scaffoldで商品を作成します。</p>
<pre class="code" data-lang="" data-unlink>rails g scaffold Product name:string description:string price:integer discontinued:boolean carrier_id:integer</pre><p>商品の取り扱い会社を保持するCarrierモデルを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails g model Carrier name:string</pre><p>モデル間の関連を追加します。<br />
まずは、Carrierモデルです。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/carrier.rb</span>

<span class="synPreProc">class</span> <span class="synType">Carrier</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  has_many <span class="synConstant">:products</span>
<span class="synPreProc">end</span>
</pre><p>次は、Productモデルです。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/carrier.rb</span>

<span class="synPreProc">class</span> <span class="synType">Product</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  belongs_to <span class="synConstant">:carrier</span>
<span class="synPreProc">end</span>
</pre><p>マイグレートを実行します。</p>
<pre class="code" data-lang="" data-unlink>rake db:migrate</pre><p>初期データを作成します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># db/seeds.rb</span>

<span class="synComment"># This file should contain all the record creation needed to seed the database with its default values.</span>
<span class="synComment"># The data can then be loaded with the rake db:seed (or created alongside the db with db:setup).</span>
<span class="synComment">#</span>
<span class="synComment"># Examples:</span>
<span class="synComment">#</span>
<span class="synComment">#   cities = City.create([{ name: 'Chicago' }, { name: 'Copenhagen' }])</span>
<span class="synComment">#   Mayor.create(name: 'Emanuel', city: cities.first)</span>

carrier1 = <span class="synType">Carrier</span>.create!(<span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">Mocodo</span><span class="synSpecial">&quot;</span>)
carrier2 = <span class="synType">Carrier</span>.create!(<span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">BankSoft</span><span class="synSpecial">&quot;</span>)

carrier1.products..create!(
  <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">iPhone 6</span><span class="synSpecial">&quot;</span>,
  <span class="synConstant">description</span>: <span class="synSpecial">&quot;</span><span class="synConstant">今回のモデルチェンジではいくつか見どころがあるが、その中でも特に大きなポイントとなるのが画面サイズのアップだ。「iPhone 6」は4.7インチ、「iPhone 6 Plus」は5.5インチの「Retina HDディスプレイ」を採用している。従来モデル「iPhone 5s」の4インチと比べて、「iPhone 6」はひと回り、「iPhone 6 Plus」ではそれ以上に大きなディスプレイとなっている。</span><span class="synSpecial">&quot;</span>,
  <span class="synConstant">price</span>: <span class="synConstant">96480</span>,
  <span class="synConstant">discontinued</span>: <span class="synConstant">false</span>)

carrier1.products.create!(
  <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">iPhone 3G</span><span class="synSpecial">&quot;</span>,
  <span class="synConstant">description</span>: <span class="synSpecial">&quot;</span><span class="synConstant">iPhone 3Gとはアップル インコーポレイテッドが設計・販売しているスマートフォンである。iPhoneの第2世代機で、2008年6月9日にサンフランシスコのモスコーニ・センター（英語版）で開催されたWWDC 2008で発表された。</span><span class="synSpecial">&quot;</span>,
  <span class="synConstant">price</span>: <span class="synConstant">12800</span>,
  <span class="synConstant">discontinued</span>: <span class="synConstant">true</span>)

carrier2.products..create!(
  <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">AQUOS CRYSTAL SoftBank</span><span class="synSpecial">&quot;</span>,
  <span class="synConstant">description</span>: <span class="synSpecial">&quot;</span><span class="synConstant">画面のフレームを極限までなくした「フレームレス構造」によって、画面だけを持っているような感覚を実現したスマートフォン。ディスプレイは大画面の5.0型「S-CG Silicon」（1280×720ドット）液晶を搭載しながら、女性でも片手で操作できるコンパクトなサイズに仕上げている。</span><span class="synSpecial">&quot;</span>,
  <span class="synConstant">price</span>: <span class="synConstant">8800</span>,
  <span class="synConstant">discontinued</span>: <span class="synConstant">false</span>)
</pre><p>データを投入します。</p>
<pre class="code" data-lang="" data-unlink>rake db:seed</pre><p>そして、Carrierを表示するようにします。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/products/index.html.erb

<span class="synIdentifier">&lt;%# 変更前 %&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.carrier_id</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;%# 変更後 %&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.carriers.name</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
</pre><p>では、<code>rails s</code>で画面を表示してみましょう。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141008/20141008215539.png" alt="f:id:nipe880324:20141008215539p:plain:w480" title="f:id:nipe880324:20141008215539p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<p><h3 id="ransack-install">2. Ransackのインストール</h3>では、準備ができたので<code>Ransack</code>をインストールしていきましょう。</p><p>まずは、<code>Gemfile</code>に<code>ransack</code>を追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Gemfile</span>
...
gem <span class="synSpecial">&quot;</span><span class="synConstant">ransack</span><span class="synSpecial">&quot;</span>
</pre><p><code>ransack</code>をインストールします。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p><br />
<h3 id="ransack-search-function">3. Ransackで検索機能と検索フォームを作成</h3>Ransackで検索機能と検索フォームを追加します。</p><p>まず、コントローラーに検索をするコードを追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>  ...
  <span class="synComment"># GET /products</span>
  <span class="synComment"># GET /products.json</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">index</span>
    <span class="synComment">#@products = Product.all</span>
    <span class="synIdentifier">@q</span>        = <span class="synType">Product</span>.search(params[<span class="synConstant">:q</span>])
    <span class="synIdentifier">@products</span> = <span class="synIdentifier">@q</span>.result(<span class="synConstant">distinct</span>: <span class="synConstant">true</span>)
  <span class="synPreProc">end</span>
  ...
</pre><p>次に、商品一覧のビューに検索フォームを追加します。<br />
コメントで記載していますが、<br />
Ransackでは、</p>

<ul>
<li><code>search_form_for</code>を使う</li>
<li><code>カラム名_start</code>、<code>カラム名_cont</code>などで検索条件を指定する</li>
</ul><p>ことにより、検索フォームを作成します。<br />
以下に上げているもので検索パターンをほぼ網羅しています。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>Listing products<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;%# form_for の代わりに search_form_for を使うことで検索フォームを作成 %&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> search_form_for</span><span class="synIdentifier"> @q do |f| %&gt;</span>

  <span class="synIdentifier">&lt;%# </span><span class="synType">start</span><span class="synIdentifier"> 特定の文字列で始まる商品名で検索 %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :name_start, </span><span class="synConstant">&quot;商品名&quot;</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.search_field</span><span class="synIdentifier"> :name_start %&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>

  <span class="synIdentifier">&lt;%# cont 文字列が含まれる商品説明で検索（not_cont で含まれない商品説明） %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :description_cont, </span><span class="synConstant">&quot;商品説明&quot;</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.search_field</span><span class="synIdentifier"> :description_cont %&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>

  <span class="synIdentifier">&lt;%# 関連の名前で検索 Product.carrier.</span><span class="synType">name</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :carrier_name_cont, </span><span class="synConstant">&quot;キャリア&quot;</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.search_field</span><span class="synIdentifier"> :carrier_name_cont %&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>

  <span class="synIdentifier">&lt;%# lt で特定の数値より下で検索（gt はより上、eq は同じ、gteqやlteqなどもできる） %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :price_lt, </span><span class="synConstant">&quot;値段(以下)&quot;</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.search_field</span><span class="synIdentifier"> :price_lt %&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>

  <span class="synIdentifier">&lt;%# or で複数の値をorで検索（and 複数の値をand条件で検索） %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :name_or_description_cont, </span><span class="synConstant">&quot;名前 or 説明&quot;</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.search_field</span><span class="synIdentifier"> :name_or_description_cont %&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>

  <span class="synIdentifier">&lt;%# 検索ボタン %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.submit</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;% end %&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">hr</span><span class="synIdentifier"> /&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
  ...
</pre><p>では、<code>rails s</code>でサーバーを起動し検索してみましょう。<br />
まず、「商品名」を "iPhone" で検索します。<br />
デフォルトでは大文字小文字を区別しません。「商品名」が "iPhone" で始まる文字列で検索されます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141008/20141008220206.png" alt="f:id:nipe880324:20141008220206p:plain:w480" title="f:id:nipe880324:20141008220206p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>次に、「商品説明」に "ディスプレイ" を入力し、検索します。<br />
すると、複合条件で検索された結果が表示されます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141008/20141008220222.png" alt="f:id:nipe880324:20141008220222p:plain:w480" title="f:id:nipe880324:20141008220222p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<p><h3 id="ransack-sort-on-table">4. Ransackでテーブルのソートリンク</h3>Ransackが提供している<code>sort_link</code>ヘルパーをテーブルのヘッダーに設定することによりテーブルの列をソートすることができるようになります。<br />
<code>default_order</code>オプションにより、初期のソート順を指定できます。</p><p>では、テーブルのヘッダーにテーブルのソートリンクを追加しましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/products/index.html.erb
  ...
  <span class="synIdentifier">&lt;</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
	  <span class="synIdentifier">&lt;</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>
	    <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
	      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> sort_link(@q,</span><span class="synIdentifier"> :</span><span class="synType">name</span><span class="synIdentifier">) %&gt;&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
	      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Description<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
	      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> sort_link(@q,</span><span class="synIdentifier"> :price, default_order: :desc) %&gt;&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
	      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Discontinued<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
	      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>Carrier<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
	      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier"> </span><span class="synType">colspan</span><span class="synIdentifier">=</span><span class="synConstant">&quot;3&quot;</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
	    <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
	  <span class="synIdentifier">&lt;/</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>

	  <span class="synIdentifier">&lt;</span><span class="synStatement">tbody</span><span class="synIdentifier">&gt;</span>
	    <span class="synIdentifier">&lt;% @products.each do |product| %&gt;</span>
	      <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
	        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.name</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
	        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.description</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
	        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.price</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
	        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.discontinued</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
	        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.carrier.name</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
	        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Show'</span><span class="synIdentifier">, product %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
	        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Edit'</span><span class="synIdentifier">, edit_product_path(product) %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
	        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'Destroy'</span><span class="synIdentifier">, product, </span><span class="synType">method</span><span class="synIdentifier">: :delete, </span><span class="synType">data</span><span class="synIdentifier">: { confirm: </span><span class="synConstant">'Are you sure?'</span><span class="synIdentifier"> } %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
	      <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
	    <span class="synIdentifier">&lt;% end %&gt;</span>
	  <span class="synIdentifier">&lt;/</span><span class="synStatement">tbody</span><span class="synIdentifier">&gt;</span>
	<span class="synIdentifier">&lt;/</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
  ...
</pre><p> 画面を更新しましょう。「Name」や「Price」がクリック可能になり、昇順や降順ができるようになりました。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141008/20141008220408.png" alt="f:id:nipe880324:20141008220408p:plain:w480" title="f:id:nipe880324:20141008220408p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<p><h3 id="ransack-restrict">5. Ransackで検索条件を絞る</h3>ユーザーが独自に検索パラメーターを指定した場合には、その他の項目で検索ができてしまいます。<br />
そのため、セキュリティを意識する必要がある場合は、<br />
「Name」、「Description」、「Carrier.Name」、「Price」以外<br />
の検索条件を利用できないようにします。</p>

<ul>
<li>カラム名を制限するには、<code>ransackable_attributes</code>をオーバーライドし、許可するカラム名を配列で指定します。</li>
<li>関連を制限するには、<code>ransackable_associations</code>をオーバーライドし、許可する関連名を配列で指定します。</li>
</ul><pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">Product</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  belongs_to <span class="synConstant">:carrier</span>

  <span class="synComment"># デフォルトでは全てのカラム名を返す</span>
  <span class="synComment"># 許可するカラムの名前をオーバーライドする</span>
  <span class="synPreProc">def</span> <span class="synConstant">self</span>.<span class="synIdentifier">ransackable_attributes</span> auth_object = <span class="synConstant">nil</span>
    <span class="synSpecial">%w(</span><span class="synConstant">name description price</span><span class="synSpecial">)</span>
  <span class="synPreProc">end</span>

  <span class="synComment"># デフォルトは全てのアソシエーション名を返す</span>
  <span class="synComment"># 許可する関連の配列をオーバーライドする</span>
  <span class="synPreProc">def</span> <span class="synConstant">self</span>.<span class="synIdentifier">ransackable_associations</span> auth_object = <span class="synConstant">nil</span>
    <span class="synSpecial">%w(</span><span class="synConstant">carrier</span><span class="synSpecial">)</span>
  <span class="synPreProc">end</span>
<span class="synPreProc">end</span>
</pre>
</div>
<div class="section">
    <h3>参考文献</h3>
    <p><a href="http://qiita.com/nysalor/items/9a95d91f2b97a08b96b0">http://qiita.com/nysalor/items/9a95d91f2b97a08b96b0</a></p>

</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141008/1412774436.html"><time data-relative datetime="2014-10-08T13:20:36Z" title="2014-10-08T13:20:36Z" pubdate class="updated">2014-10-08 22:20</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141008/1412774436" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141008%2F1412774436" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141008/1412774436" data-count="vertical" data-text="Railsでransackを使って検索機能を作成する - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141008/1412774436" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user_2nd', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_3', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_3" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
            <!-- rakuten_ad_target_end -->
            <!-- google_ad_section_end -->

            
              <div class="pager autopagerize_insert_before">
                <span class="pager-next">
                  <a href="index-page=1412774436.html" rel="next">次のページ</a>
                </span>
              </div>
            
          
        </div>
      </div>

      
      <aside id="box1">
        <div id="box1-inner">
        </div>
      </aside>

    </div><!-- #wrapper -->

    <aside id="box2">
  
  <div id="box2-inner">
    
      
<div class="hatena-module hatena-module-html">
  <div class="hatena-module-body">
    <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-2736751992834286"
     data-ad-slot="8116686456"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>
</div>

      
      
    
      

<div class="hatena-module hatena-module-profile">
  <div class="hatena-module-title">
    プロフィール
  </div>
  <div class="hatena-module-body">
    
    <a href="about.html" class="profile-icon-link">
      <img src="http://cdn1.www.st-hatena.com/users/ni/nipe880324/profile.gif?1406435422"
      alt="id:nipe880324" class="profile-icon" />
    </a>
    

    
    <span class="id">
      <a href="about.html" class="hatena-id-link"><span data-load-nickname="1" data-user-name="nipe880324">id:nipe880324</span></a>
      
  
    
    
  


    </span>
    

    

    
      <div class="hatena-follow-button-box btn-subscribe js-hatena-follow-button-box"
  
  >

  <a href="index-page=1414081224.html#" class="hatena-follow-button js-hatena-follow-button">
    <span class="subscribing">
      <span class="foreground">読者です</span>
      <span class="background">読者をやめる</span>
    </span>
    <span class="unsubscribing" data-track-name="profile-widget-subscribe-button" data-track-once>
      <span class="foreground">読者になる</span>
      <span class="background">読者になる</span>
    </span>
  </a>
  <div class="subscription-count-box js-subscription-count-box">
    <i></i>
    <u></u>
    <span class="subscription-count js-subscription-count">
    </span>
  </div>
</div>

    

    

    

    
  </div>
</div>

      
      
    
      
<div class="hatena-module hatena-module-entries-access-ranking"
     data-count="4"
     data-display_entry_category="1"
     data-display_entry_image="0"
     data-display_entry_image_size_width="100"
     data-display_entry_image_size_height="100"
     data-display_entry_body_length="0"
     data-display_entry_date="1"
     data-display_bookmark_count="0"
     data-source="access"
>
  <div class="hatena-module-title">
    
      最近のアクセス
    
  </div>
  <div class="hatena-module-body">
    
  </div>
</div>

      
      
    
      
<div class="hatena-module hatena-module-html">
    <div class="hatena-module-title">    </div>
  <div class="hatena-module-body">
    <nav>
  <div class="side-category">
    <span class="side-category-title">Rails 入門</span>
    <ul class="side-category-list">
      <li><a href="entry/20140713/1405251091.html">RailsのためのRuby基礎</a></li>
      <li><a href="entry/20140813/1407915718.html">Rails入門者向け ブログ開発</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Railsコマンド</span>
    <ul class="side-category-list">
      <li><a href="entry/20140713/1405251709.html">rails new / server / console</a></li>
      <li><a href="entry/20150204/1423055537.html">rails new時の有用な6つの設定</a></li>
      <li><a href="entry/20150208/1423391199.html">rails new時のテンプレート</a></li>
      <li><a href="entry/20140802/1406948695.html">rails generate</a></li>
      <li><a href="entry/20141116/1416115266.html">rakeコマンド一覧</a></li>
      <li><a href="entry/20141117/1416225563.html">自前rakeコマンド</a></li>
      <li><a href="entry/20141110/1415623670.html">productionモードで起動</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Route / Controller</span>
    <ul class="side-category-list">
      <li><a href="entry/20140716/1405451238.html">Routing</a></li>
      <li><a href="entry/20140810/1407603600.html">レイアウトファイルを指定</a></li>
      <li><a href="entry/20141125/1416918957.html">ビューを返す(render)</a></li>
      <li><a href="entry/20140808/1407427457.html">リダイレクトする(redirect_to)</a></li>
      <li><a href="entry/20141126/1417012848.html">Strong Parameters</a></li>
      <li><a href="entry/20141129/1417223453.html">フィルタ(before_action, after_action)</a></li>
      <li><a href="entry/20141127/1417086075.html">簡易なメッセージ表示(Flash)</a></li>
      <li><a href="entry/20141130/1417334030.html">セッション(session)</a></li>
      <li><a href="entry/20141201/1417432408.html">リクエストヘッダ、レスポンスヘッダ(request, response)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Model, Migration</span>
    <ul class="side-category-list">
      <li><a href="entry/20140724/1406142120.html">CRUD</a></li>
      <li><a href="entry/20141203/1417601540.html">1対多関連</a></li>
      <li><a href="entry/20141204/1417688260.html">多対多関連</a></li>
      <li><a href="entry/20141205/1417779929.html">1対1関連</a></li>
      <li><a href="entry/20141206/1417839458.html">STI(単一継承テーブル)</a></li>
      <li><a href="entry/20141207/1417926599.html">ポリモフィック関連</a></li>
      <li><a href="entry/20141208/1418018874.html">複数の子レコードを作成/更新</a></li>
      <li><a href="entry/20140724/1406145303.html">バリデーション(validation)</a></li>
      <li><a href="entry/20140810/1407623400.html">バリデーションエラー(validation errors)</a></li>
      <li><a href="entry/20140814/1407994568.html">スコープ(scope)</a></li>
      <li><a href="entry/20141211/1418301640.html">コールバック(callback)</a></li>
      <li><a href="entry/20150428/1430154446.html">複雑なSELECT文のまとめ</a></li>
      <li><a href="entry/20150710/1436461745.html">enum (Rails 4.1以上)</a></li>
      <li><a href="entry/20141209/1418123425.html">楽観的ロック</a></li>
      <li><a href="entry/20141210/1418207618.html">悲観的ロック</a></li>
      <li><a href="entry/20140810/1407634200.html">Migration(マイグレーション)</a></li>
      <li><a href="entry/20150607/1433606267.html">Postgresとマイグレーション</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">API</span>
    <ul class="side-category-list">
      <li><a href="entry/20150708/1436284476.html">Roar</a></li>
      <li>ActiveSerializer</li>
      <li>Versioning</li>
      <li>CORS</li>
    </ul>
  </div>

  <div class="side-category">
    <span class="side-category-title">View, Helper, Presenter</span>
    <ul class="side-category-list">
      <li><a href="entry/20140810/1407603600.html">レイアウトファイルを指定</a></li>
      <li><a href="entry/20140807/1407419013.html">部分テンプレート</a></li>
      <li><a href="entry/20140727/1406448610.html">フォーム周りのMVC連携フロー</a></li>
      <li><a href="entry/20150113/1421149061.html">ビューヘルパーまとめ(View Helper)</a></li>
      <li><a href="entry/20140802/1406969793.html">フォーマットヘルパー</a></li>
      <li><a href="entry/20140803/1407049200.html">独自ヘルパー作成</a></li>
      <li><a href="entry/20141208/1418018874.html">複数の子レコード(has_many)を作成/更新するフォーム</a></li>
      <li><a href="entry/20141225/1419515057.html">1フォームに複数のSubmitボタンを配置</a></li>
      <li><a href="entry/20140730/1406700205.html">simple_form</a></li>
      <li><a href="entry/20150415/1429031791.html">Draper</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">テンプレートエンジン</span>
    <ul class="side-category-list">
      <li><a href="entry/20140929/1411997071.html">HTMLテンプレートエンジンまとめ</a></li>
      <li><a href="entry/20140929/1411997071.html">Slim</a></li>
      <li><a href="entry/20141001/1412097051.html">Haml</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ActionSupport / ActionMailer / ActiveJob / i18n</span>
    <ul class="side-category-list">
      <li><a href="entry/20141217/1418817120.html">タイムゾーン、時刻処理</a></li>
      <li><a href="entry/20141218/1418901424.html">Timecop 時刻処理のテスト</a></li>
      <li><a href="entry/20141216/1418729961.html">クラス名,DB名,ファイル名の変換</a></li>
      <li><a href="entry/20141230/1419936984.html">JSON, XML, YAMLの読み書き</a></li>
      <li><a href="entry/20141030/1414599853.html">文字コード/エンコード</a></li>
      <li><a href="entry/20140828/1409236436.html">メール送信</a></li>
      <li><a href="entry/20150304/1425396671.html">DelayedJob バックグラウンド処理</a></li>
      <li><a href="entry/20150110/1420863998.html">ログ・ログレベル・ログフォーマット(log, logger)</a></li>
      <li><a href="entry/20150226/1424937175.html">i18nまとめ</a></li>
      <li><a href="entry/20141111/1415707101.html">エラーハンドリング</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">テスト</span>
    <ul class="side-category-list">
      <li><a href="entry/20150101/1420093487.html">RSpec/Capybaraの導入方法</a></li>
      <li><a href="entry/20150103/1420280252.html">RSpec/Capybaraのレシピ集</a></li>
      <li><a href="entry/20150101/1420093487.html">FactoryGirlのレシピ集</a></li>
      <li><a href="entry/20150105/1420465062.html">Jasmine(Javascriptの単体テスト)</a></li>
      <li><a href="entry/20150108/1420675366.html">APIの作成とテスト</a></li>
      <li><a href="entry/20150106/1420545920.html">RSpecテストを速くする</a></li>
      <li><a href="entry/20150108/1420721205.html">デバッグ(debug)</a></li>
      <li><a href="entry/20150420/1429462755.html">Seleniumでスタンドアローンなテスト</a></li>
      <li><a href="entry/20140719/1405708234.html">Cucumber+RSpec+Capybara インストール</a></li>
      <li><a href="entry/20140719/1405777918.html">Cucumber+RSpec+Capybara BDD/TDD開発例</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Security</span>
    <ul class="side-category-list">
      <li><a href="entry/20141215/1418641291.html">ログ上での秘密情報のフィルタリング</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">パフォーマンス</span>
    <ul class="side-category-list">
      <li><a href="entry/20141109/1415522242.html">Bullet</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">設定</span>
    <ul class="side-category-list">
      <li><a href="entry/20141224/1419414316.html">新しいEnvironmentを追加</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">UI/UX</span>
    <ul class="side-category-list">
      <li><a href="entry/20140801/1406818800.html">Twitter Bootstrap 3</a></li>
      <li><a href="entry/20141112/1415804076.html">select2</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Gemの基礎</span>
    <ul class="side-category-list">
      <li><a href="entry/20140715/1405361727.html">RubyGemsの選び方</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ログイン/認証機能</span>
    <ul class="side-category-list">
      <li><a href="entry/20140801/1406907000.html">devise1 インストール</a></li>
      <li><a href="entry/20140804/1407168000.html">devise2 カスタマイズ</a></li>
      <li><a href="entry/20140805/1407200400.html">devise3 Twitterでログイン(OAuth連携)</a></li>
      <li><a href="entry/20141212/1418380288.html">devise4 ゲストユーザー(Guest)作成</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ファイルアップロード機能</span>
    <ul class="side-category-list">
      <li><a href="entry/20140716/1405443484.html">PaperClip</a></li>
      <li><a href="entry/20141015/1413300088.html">CarrierWave1 インストール</a></li>
      <li><a href="entry/20141022/1413907332.html">CarrierWave2 カスタマイズ</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">検索機能・Elasticsearch</span>
    <ul class="side-category-list">
      <li><a href="entry/20141008/1412774436.html">Ransack 検索機能</a></li>
      <li><a href="entry/20150224/1424776132.html">Sunspot 全文検索</a></li>
      <li><a href="entry/20151018/1445142266.html">Elasticsearch 1: 全文検索・フィルタ</a></li>
      <li><a href="entry/20151019/1445265581.html">Elasticsearch 2: ページネーション</a></li>
      <li><a href="entry/20151021/1445353566.html">Elasticsearch 3: ソート</a></li>
      <li><a href="entry/20151022/1445439798.html">Elasticsearch 4: アグリゲーション（ファセット）・post_filter</a></li>
      <li><a href="20151025/1445703231.html">Elasticsearch 5: ハイライト</a></li>
      <li><a href="entry/20151027/1445957667.html">Elasticsearch 6: サジェスト</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ページネーション</span>
    <ul class="side-category-list">
      <li><a href="entry/20141118/1416314608.html">ページネーションまとめ</a></li>
      <li><a href="entry/20141113/1415874683.html">kaminari</a></li>
      <li><a href="entry/20141114/1415967206.html">will_paginate</a></li>
      <li><a href="entry/20141115/1416021886.html">動的ページロード</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">CSV</span>
    <ul class="side-category-list">
      <li><a href="entry/20141119/1416398472.html">CSVダウンロード</a></li>
      <li><a href="entry/20141120/1416483136.html">CSVアップロード</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">PDFファイル作成機能</span>
    <ul class="side-category-list">
      <li><a href="entry/20140906/1409995011.html">PDF作成Gem まとめ</a></li>
      <li><a href="entry/20140907/1410078997.html">コードのみでPDF作成 Prawn</a></li>
      <li><a href="entry/20140908/1410176894.html">HTMLを変換してPDF作成 PDFKit + wkhtmltopdf</a></li>
      <li><a href="entry/20140909/1410241835.html">GUIツールでPDF作成 ThinReports</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">開発効率をあげる</span>
    <ul class="side-category-list">
      <li><a href="entry/20141026/1414289421.html">Spring</a></li>
      <li><a href="entry/20141016/1413389293.html">Guard-LiveReload</a></li>
      <li><a href="entry/20141021/1413819783.html">Guard-RSpec</a></li>
      <li><a href="entry/20141019/1413698128.html">Guard-RuboCop</a></li>
      <li><a href="entry/20141024/1414081224.html">Pry-Rails / Pry-BuyBug</a></li>
      <li><a href="entry/20141024/1414160189.html">Hirb</a></li>
      <li><a href="entry/20141028/1414505988.html">Awesome Print</a></li>
      <li><a href="entry/20141029/1414584929.html">Quiet Assets</a></li>
      <li><a href="entry/20141025/1414225490.html">Better_Errors</a></li>
      <li><a href="entry/20141027/1414409495.html">Rails-ERD</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">その他Gem</span>
    <ul class="side-category-list">
      <li><a href="entry/20150225/1424858414.html">acts-as-taggable-on タグ管理</a></li>
      <li><a href="entry/20141016/1413389293.html">wenerber Cron設定</a></li>
      <li><a href="entry/20150221/1424489524.html">friendly_id URLスラッグ</a></li>
      <li><a href="entry/20150216/1424092796.html">awesome_nested_set ツリー構造</a></li>
      <li><a href="entry/20150217/1424179269.html">awesome_nested_set にjsTreeを追加</a></li>
      <li><a href="entry/20150214/1423923524.html">PaperTrail 取り消し機能</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Tips</span>
    <ul class="side-category-list">
      <li><a href="entry/20141229/1419856433.html">Virtual Attributes(仮想属性)</a></li>
      <li><a href="entry/20141226/1419600679.html">日付/時刻のフォーマット</a></li>
      <li><a href="entry/20141225/1419515057.html">1フォームに複数のSubmitボタンを配置</a></li>
      <li><a href="entry/20141223/1419334845.html">URLのパーマリンクをID以外に変更</a></li>
      <li><a href="entry/20141220/1419058040.html">CSSスタイリングのコントローラー単位で分割</a></li>
      <li><a href="entry/20141219/1418990626.html">ページタイトルの変更</a></li>
      <li><a href="entry/20150101/1420049679.html">Ruby/Railsの便利なメソッド(useful methods)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Rubyテクニック</span>
    <ul class="side-category-list">
      <li><a href="entry/20150921/1442839934.html">キーワード引数</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">良い設計/リファクタリング</span>
    <ul class="side-category-list">
      <li><a href="entry/20150922/1442923521.html">デメテルの法則(Law of Demeter)</a></li>
      <li><a href="entry/20150312/1426141352.html">HTML/CSS/JSを疎結合にする方法</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">JavaScript</span>
    <ul class="side-category-list">
      <li><a href="entry/20150311/1426062668.html">オブジェクト指向</a></li>
      <li><a href="entry/20150313/1426238835.html">thisの参照先</a></li>
      <li><a href="entry/20150317/1426599220.html">設定データを分離</a></li>
      <li><a href="entry/20150607/1433652441.html">ページを離れる時にアラートを出す</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">jQuery</span>
    <ul class="side-category-list">
      <li><a href="entry/20150325/1427291741.html">Ajax</a></li>
      <li><a href="entry/20150326/1427379215.html">イベント処理(Event)</a></li>
      <li><a href="entry/20150331/1427809820.html">DOM操作</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">React.js</span>
    <ul class="side-category-list">
      <li><a href="entry/20151122/1448118932.html">React.jsチュートリアル: メッセージボックス</a></li>
      <li><a href="entry/20151124/1448300267.html">サーバーレンダリング</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">AngularJS</span>
    <ul class="side-category-list">
      <li><a href="entry/20150114/1421235346.html">AngularJSのインストール</a></li>
      <li><a href="entry/20150115/1421316461.html">UI Bootstrapのインストール</a></li>
      <li><a href="entry/20150116/1421407124.html">AngularJS Controller</a>
      <li><a href="entry/20150119/1421666497.html">ngResource + RailsでAPI作成</a></li>
      <li><a href="entry/20150120/1421761471.html">ngRoute</a></li>
      <li><a href="entry/20150126/1422276839.html">編集可能(Editable)</a></li>
      <li><a href="entry/20150127/1422357163.html">ソート可能(Sortable)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">開発手法</span>
    <ul class="side-category-list">
      <li><a href="entry/20140917/1410963376.html">スクラム開発</a></li>
      <li><a href="entry/20141010/1412867452.html">カイゼンフレームワークKPT</a>
      <li><a href="entry/20140816/1408126999.html">GitHubを使ったチーム開発フロー</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">開発ツール</span>
    <ul class="side-category-list">
      <li><a href="entry/20141103/1414940400.html">git - 初期設定と便利なエイリアス</a></li>
      <li><a href="entry/20140713/1405248403.html">git - よく使うコマンド</a></li>
      <li><a href="entry/20140724/1406137504.html">SublimeText3 - 便利コマンドとプラグイン</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">DB</span>
    <ul class="side-category-list">
      <li><a href="entry/20140726/1406331785.html">MongoDBの基礎入門 CRUD操作</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">インフラ</span>
    <ul class="side-category-list">
      <li><a href="entry/20150719/1437249020.html">Vagrant</a></li>
      <li><a href="entry/20150721/1437404524.html">Chef(Rails環境構築)</a></li>
      <li><a href="entry/20150314/1426332751.html">Herokuの準備とデプロイ</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">リファレンス</span>
    <ul class="side-category-list">
      <li><a href="https://github.com/" target="_blank">GitHub</a></li>
      <li><a href="http://guides.rubyonrails.org/index.html" target="_blank">RailsGuides</a></li>
      <li><a href="http://railscasts.com/" target="_blank">RailsCast</a></li>
      <li><a href="https://rubygems.org/" target="_blank">RubyGems</a></li>
      <li><a href="https://www.ruby-toolbox.com/" target="_blank">RubyToolbox</a></li>
      <li><a href="http://rubular.com/" target="_blank">正規表現 Rubular</a></li>
      <li><a href="http://ruby-doc.org/core-2.1/" target="_blank">Ruby API (2.1)</a></li>
      <li><a href="http://api.rubyonrails.org/" target="_blank">Ruby on Rails API (4.1)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Phoenix</span>
    <ul class="side-category-list">
      <li><a href="entry/20151011/1444560106.html">Phoenix環境設定(Phoenix入門1)</a></li>
      <li><a href="entry/20151013/1444662887.html">基本的な認証機能(Phoenix入門2)</a></li>
      <li><a href="entry/20151016/1444930756.html">基本的なチャット機能(Phoenix入門3)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">その他</span>
    <ul class="side-category-list">
      <li><a href="entry/20150401/1427898898.html">広告収入向上</a></li>
      <li><a href="entry/20140830/1409361710.html">著者が読んだ本</a></li>
    </ul>
  </div>
</nav>

  </div>
</div>

      
      
    
      

<div class="hatena-module hatena-module-archive" data-archive-type="default" data-archive-url="http://ruby-rails.hatenadiary.com/archive">
  <div class="hatena-module-title">
    <a href="archive.html">月別アーカイブ</a>
  </div>
  <div class="hatena-module-body">
  </div>
</div>

      
      
    
    
  </div>
</aside>

  </div>
</div>




        
        
          <script type="text/javascript" src="http://b.hatena.ne.jp/js/hatena_dfp2.js"></script>
        
        
          <div id="bottom-editarea">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
$('.unsubscribing').on('click', function() {
    ga('send', 'event', 'button', 'click', 'hatenaReader');  
});
</script>
          </div>
        
      </div>
    </div>

    
      <footer id="footer" data-brand="hatenablog">
  <div id="footer-inner">
    <address>
      
      <a href="about.html"><img src="http://cdn1.www.st-hatena.com/users/ni/nipe880324/profile.gif" width="16" height="16" alt=""/>
        <span data-load-nickname="1" data-user-name="nipe880324">nipe880324</span>
      </a>
    </address>
    <p class="services">Powered by <a href="http://hatenablog.com/">Hatena Blog</a></p>
  </div>
</footer>

    

    
  <script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>


    

    <script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js">
  {"parsetags": "explicit"}
</script>
<script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>



  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-with-addons.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.min.js"></script>


<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery/jquery-ui.1.10.0.custom.min.js"></script>
<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery/jquery.flot.0.8.3.js"></script>
<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery/jquery.flot.time.0.8.3.js"></script>



<script id="hatenablog-js" data-env="production"
  type="text/javascript" src="https://blog.st-hatena.com/js/hatenablog.js?version=228df9a6e5a3ae04fdb53d33befa3556" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://blog.st-hatena.com/js/texts-ja.js?version=228df9a6e5a3ae04fdb53d33befa3556"></script>


  <script type="text/javascript">Hatena.Diary.GlobalHeader.init()</script>


<script src="https://www.google.com/recaptcha/api.js" async defer></script>




    


    
       

  <script id="hatena-counter-script" type="text/javascript"><!--
      hatena_counter_name = "nipe880324";
      hatena_counter_id = "102";
      hatena_counter_ref = document.referrer+"";
      hatena_counter_screen = screen.width + "x" + screen.height+","+screen.colorDepth;
  //--></script>
  <script type="text/javascript" src="http://counter.hatena.ne.jp/js/counter.js"></script>
  <noscript><img src="http://counter.hatena.ne.jp/nipe880324/102" border="0" alt="counter"></noscript>


    

  </body>
</html>

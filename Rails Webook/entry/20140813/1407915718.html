<!DOCTYPE html>
<html
  lang="ja"
data-avail-langs="ja en"

data-page="entry"
data-static-domain="https://blog.st-hatena.com"
data-blog="ruby-rails.hatenadiary.com"
data-blog-name="Rails Webook"
data-blogs-uri-base="http://ruby-rails.hatenadiary.com"
data-globalheader-color="b"
data-author="nipe880324"
data-version="228df9a6e5a3ae04fdb53d33befa3556"
data-blog-comments-top-is-new=""
data-plus-available=""



data-admin-domain="http://blog.hatena.ne.jp"

data-brand="hatenablog"

data-has-touch-view="1"


itemscope
itemtype="http://schema.org/Article"


  data-device="pc"
  data-globalheader-type="pc"
  >
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
    
    
    

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=7; IE=9; IE=10; IE=11" />
    <title>Railsを始めたばかりの人向け！Railsの仕組みを一から理解しながらブログを作成する - Rails Webook</title>

    

    
      <link rel="canonical" href="1407915718.html"/>
    

    
    

<meta itemprop="name" content="Railsを始めたばかりの人向け！Railsの仕組みを一から理解しながらブログを作成する - Rails Webook"/>

  <meta itemprop="image" content="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813160348.png"/>


    <meta property="og:title" content="Railsを始めたばかりの人向け！Railsの仕組みを一から理解しながらブログを作成する - Rails Webook"/>
<meta property="og:type" content="article"/>
<meta property="og:url" content="http://ruby-rails.hatenadiary.com/entry/20140813/1407915718"/>

  <meta property="og:image" content="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813160348.png"/>

    <meta property="og:description" content="Rails初心者がRailsの一通りの仕組みを理解できることをために、Railsの仕組みを一つ一つ理解しながらブログを作成していきます。 Railsでのルーティング、コントローラー、モデル、ビューの規約や使い方、ScssでのスタイリングやCoffeeScriptでのJavascriptの記述なども説明します。" />
<meta property="og:site_name" content="http://ruby-rails.hatenadiary.com/"/>

  <meta property="article:published_time" content="1407915718" />

    <meta property="article:tag" content="Rails初級" />
    <meta property="article:tag" content="作ってみよう" />
        <meta name="twitter:card"  content="summary_large_image" />
    <meta name="twitter:image" content="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813160348.png" />
  <meta name="twitter:title" content="Railsを始めたばかりの人向け！Railsの仕組みを一から理解しながらブログを作成する - Rails Webook" />    <meta name="twitter:description" content="Rails初心者がRailsの一通りの仕組みを理解できることをために、Railsの仕組みを一つ一つ理解しながらブログを作成していきます。 Railsでのルーティング、コントローラー、モデル、ビューの規約や使い方、ScssでのスタイリングやCoffeeScriptでのJavascriptの記述なども説明します。" />  <meta name="twitter:app:name:iphone" content="はてなブログアプリ" />
  <meta name="twitter:app:id:iphone" content="583299321" />
  <meta name="twitter:app:url:iphone" content="hatenablog:///open?uri=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20140813%2F1407915718" />  <meta name="twitter:site" content="@nipe032488" />
    
    <meta name="google-site-verification" content="OyOieuLgSrQckqbACTn_Q3G1dPq6LMlTqBRHa6V1XsA">    <meta name="keywords" content="Rails,Ruby on Rails,gem,Webアプリケーション,開発,構築,運用,インフラ">    <meta name="description" content="Rails初心者がRailsの一通りの仕組みを理解できることをために、Railsの仕組みを一つ一つ理解しながらブログを作成していきます。 Railsでのルーティング、コントローラー、モデル、ビューの規約や使い方、ScssでのスタイリングやCoffeeScriptでのJavascriptの記述なども説明します。" />

    
<script type="text/javascript">
// <!--

if (~navigator.userAgent.indexOf('Mac OS X')) {
  document.write('<style type="text/css">html, body { font-family: \x27Helvetica\x27, \x27Arial\x27, \x27ヒラギノ角ゴ Pro W3\x27, \x27Hiragino Kaku Gothic Pro\x27, sans-serif; } </style>');
} else {
  document.write('<style type="text/css">html, body { font-family: \x27Helvetica\x27, \x27Arial\x27, \x27メイリオ\x27, \x27Meiryo\x27, \x27MS PGothic\x27, sans-serif; } </style>');
}

// -->
</script>

<!--[if lt IE 9]>
<script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->




    <link rel="shortcut icon" href="https://blog.st-hatena.com/images/favicon.ico">
<link rel="icon" sizes="192x192" href="https://blog.st-hatena.com/images/common/meta-icon-global.png">

    
<link rel="alternate" type="application/atom+xml" title="Atom" href="../../feed"/>
<link rel="alternate" type="application/rss+xml" title="RSS2.0" href="../../rss.rss"/>
<link rel="alternate" type="application/json+oembed" href="http://hatenablog.com/oembed?url=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20140813%2F1407915718&amp;format=json" title="oEmbed Profile of Railsを始めたばかりの人向け！Railsの仕組みを一から理解しながらブログを作成する"/>
<link rel="alternate" type="text/xml+oembed" href="http://hatenablog.com/oembed?url=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20140813%2F1407915718&amp;format=xml" title="oEmbed Profile of Railsを始めたばかりの人向け！Railsの仕組みを一から理解しながらブログを作成する"/>

      <link rel="author" href="http://www.hatena.ne.jp/nipe880324/">

    <link rel="stylesheet" type="text/css" href="https://blog.st-hatena.com/css/blog.css?version=228df9a6e5a3ae04fdb53d33befa3556"/>

    
  <link rel="stylesheet" type="text/css" href="http://blog.hatena.ne.jp/-/blog_style/12921228815727789780/a052dbbef76fd4380abc811c11814f2d9f990b9a"/>

    <script></script>

    
<style>div#google_afc_user,
  div#google_afc_user_container_0,
  div#google_afc_user_container_1,
  div#google_afc_user_container_2,
  div#google_afc_user_container_3,
  div#google_afc_user_container_4,
  div#google_afc_user_container_5,
  div.google_afc_image,
  div.google_afc_blocklink {
      display: block !important;
  }
</style>


    
  </head>

  <body class="page-entry enable-top-editarea enable-bottom-editarea category-Rails初級 category-作ってみよう">
    <!-- Google Universal Analytics -->
<script id="google-analytics-script">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-29716941-6', 'auto', {'name': 'HatenaBlogTracker', 'sampleRate': 1});
  ga('HatenaBlogTracker.require', 'displayfeatures');
  ga('HatenaBlogTracker.send', 'pageview');
  ga('create', 'UA-29716941-26', 'auto', {'name': 'HatenaBlogSeparatedTracker', 'sampleRate': 10});
  ga('HatenaBlogSeparatedTracker.require', 'displayfeatures');
  ga('HatenaBlogSeparatedTracker.send', 'pageview');

    
      ga('create', 'UA-45988509-6', 'auto', {'name': 'HatenaBlogUserTracker'});
      ga('HatenaBlogUserTracker.require', 'displayfeatures');
      ga('HatenaBlogUserTracker.send', 'pageview');
    
  
  ga('create', 'UA-7855606-1', 'auto', {'name': 'HatenaGlobalTracker', 'sampleRate': 1});
  ga('HatenaGlobalTracker.require', 'displayfeatures');
  ga('HatenaGlobalTracker.send', 'pageview');
</script>
<!-- End Google Universal Analytics -->

    
    <div id="header-container">
     <div id="sp-suggest" style="display: none;"><a id="sp-suggest-link" href="1407915718.html#">スマートフォン用の表示で見る</a></div>
    </div>

    

<div class="quote-box">
  <div class="tooltip-quote tooltip-quote-star">
    <i class="blogicon-star" title="引用スターをつける"></i>
  </div>
  <div class="tooltip-quote tooltip-quote-stock">
    <i class="blogicon-quote" title="引用をストック"></i>
  </div>
</div>

<div class="message-box" id="quote-star-message-box" style="display: none; position: absolute;">
  スターをつけました
</div>

<div class="quote-stock-panel" id="quote-stock-message-box" style="position: absolute; z-index: 3000">
  <div class="message-box" id="quote-stock-succeeded-message" style="display: none">
    <p>引用をストックしました</p>
    <button class="btn btn-primary" id="quote-stock-show-editor-button" data-track-name="curation-quote-edit-button">ストック一覧を見る</button>
    <button class="btn quote-stock-close-message-button">閉じる</button>
  </div>

  <div class="message-box" id="quote-login-required-message" style="display: none">
    <p>引用するにはまずログインしてください</p>
    <button class="btn btn-primary" id="quote-login-button">ログイン</button>
    <button class="btn quote-stock-close-message-button">閉じる</button>
  </div>

  <div class="error-box" id="quote-stock-failed-message" style="display: none">
    <p>引用をストックできませんでした。再度お試しください</p>
    <button class="btn quote-stock-close-message-button">閉じる</button>
  </div>

  <div class="error-box" id="unstockable-quote-message-box" style="display: none; position: absolute; z-index: 3000;">
    <p>限定公開記事のため引用できません。</p>
  </div>
</div>

<script type="x-underscore-template" id="js-requote-button-template">
  <div class="requote-button js-requote-button">
    <button class="requote-button-btn tipsy-top" title="引用する"><i class="blogicon-quote"></i></button>
  </div>
</script>


    <div id="globalheader-container" >
  <iframe id="globalheader" height="37" frameborder="0" allowTransparency="true"></iframe>
</div>


    
    <div id="hidden-subscribe-button">
      <div class="hatena-follow-button-box btn-subscribe js-hatena-follow-button-box"
  
  >

  <a href="1407915718.html#" class="hatena-follow-button js-hatena-follow-button">
    <span class="subscribing">
      <span class="foreground">読者です</span>
      <span class="background">読者をやめる</span>
    </span>
    <span class="unsubscribing" data-track-name="profile-widget-subscribe-button" data-track-once>
      <span class="foreground">読者になる</span>
      <span class="background">読者になる</span>
    </span>
  </a>
  <div class="subscription-count-box js-subscription-count-box">
    <i></i>
    <u></u>
    <span class="subscription-count js-subscription-count">
    </span>
  </div>
</div>

    </div>

    <div id="container">
      <div id="container-inner">
        <header id="blog-title" data-brand="hatenablog">
  <div id="blog-title-inner" >
    <div id="blog-title-content">
      <h1 id="title"><a href="../../index.html">Rails Webook</a></h1>
      
        <h2 id="blog-description">自社のECを開発している会社で働いています。Rails情報やサービスを成長させる方法を書いていきます</h2>
      
    </div>
  </div>
</header>

        
          <div id="top-editarea">
            <!-- start Mixpanel --><script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
mixpanel.init("16db652100dca0a23c6a55a9205f0824");</script><!-- end Mixpanel -->
<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- rails top bar 728 x 90 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-2736751992834286"
     data-ad-slot="6687328050"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

          </div>
        
        
        



<div id="content" class="hfeed"
  
  >
  <div id="content-inner">
    <div id="wrapper">
      <div id="main">
        <div id="main-inner">
          
            
            <!-- google_ad_section_start -->
            <!-- rakuten_ad_target_begin -->
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-20000 words-2600 mode-hatena entry-odd" id="entry-12921228815729996513" data-keyword-campaign="" data-uuid="12921228815729996513">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="../../entries/2014/08/13.html" rel="nofollow">
          <time pubdate datetime="2014-08-13T07:41:58Z" title="2014-08-13T07:41:58Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">08</span><span class="hyphen">-</span><span class="date-day">13</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="1407915718.html" class="entry-title-link bookmark">Railsを始めたばかりの人向け！Railsの仕組みを一から理解しながらブログを作成する</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="../../archive/category/Rails%E5%88%9D%E7%B4%9A.html">Rails初級</a>
          
          <a href="../../archive/category/%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86.html">作ってみよう</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>初心者が<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>の一通りの仕組みを理解できることをために、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>の仕組みを一つ一つ理解しながらブログを作成していきます。<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>でのルーティング、コントローラー、モデル、ビューの規約や使い方、Scssでのスタイリングや<a class="keyword" href="http://d.hatena.ne.jp/keyword/CoffeeScript">CoffeeScript</a>での<a class="keyword" href="http://d.hatena.ne.jp/keyword/Javascript">Javascript</a>の記述なども説明します。</p><p><i><a href="http://guides.rubyonrails.org/v4.0.6/getting_started.html" target="_blank">Rails Guide - Getting Started with Rails</a>をベースにしました。</i></p><p>まずは、完成させるブログアプリケーションの画面です。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813160348.png" alt="f:id:nipe880324:20140813160348p:plain:w320" title="f:id:nipe880324:20140813160348p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<p></p>

<div class="section">
    <h3>動作確認</h3>
    
<ul>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a> 2.0</li>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a> 4.1</li>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/Mac%20OS%20X">Mac OS X</a> 10.9 </li>
</ul>
</div>
<div class="section">
    <h3>前提条件</h3>
    
<ul>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a> がインストール済み</li>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a> 4 がインストール済み</li>
<li>SQLite3データベースがインストール済み</li>
</ul><p><i>※もしインストールされていない場合は、「Rails4 インストール」などで<a class="keyword" href="http://d.hatena.ne.jp/keyword/Google">Google</a>検索してインストールしてください</i></p><p></p>

</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="1407915718.html#what-is-rails">Railsとは</a></li>
<li><a href="1407915718.html#create-new-rails-project">新しいRailsプロジェクトを作成する</a></li>
<li><a href="1407915718.html#hello-rails">Hello, Rails! を表示する</a></li>
<li><a href="1407915718.html#getting-up-and-running">投稿機能を作成する</a></li>
<li><a href="1407915718.html#adding-a-second-model">コメントを追加する</a></li>
<li><a href="1407915718.html#refactoring">リファクタリング</a></li>
<li><a href="1407915718.html#deleting-comments">コメントを削除する</a></li>
<li><a href="1407915718.html#security">HTTP認証を追加する</a></li>
<li><a href="1407915718.html#styling">画面のスタイリングをする</a></li>
<li><a href="1407915718.html#coffee-script">CoffeeScriptでJavaScriptを使う</a></li>
<li><a href="1407915718.html#what-is-next">次は？</a></li>
</ol><p><br />
<h3 id="what-is-rails">1. <a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>とは</h3><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>は、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D7%A5%ED%A5%B0%A5%E9%A5%DF%A5%F3%A5%B0%B8%C0%B8%EC">プログラミング言語</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>で書かれたWebアプリケーション開発<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D5%A5%EC%A1%BC%A5%E0%A5%EF%A1%BC%A5%AF">フレームワーク</a>です。<br />
「設定よりも規約」とい考えで、いろいろとルールを決めることでWebアプリケーションを簡易に開発できようにするという設計思想のもとに作られています。このため、この規約を守ることで、他の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D7%A5%ED%A5%B0%A5%E9%A5%DF%A5%F3%A5%B0%B8%C0%B8%EC">プログラミング言語</a>や<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D5%A5%EC%A1%BC%A5%E0%A5%EF%A1%BC%A5%AF">フレームワーク</a>よりも少ない<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>（生産性が高い）でWebアプリケーションを開発できます。<br />
これにより、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>開発者の多くは、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>でのWebアプリケーション開発は楽しいものであると感じています。</p><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>の規約に基づいた開発を学ぶことで、素晴らしい生産性の向上を体感するでしょう。他の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D7%A5%ED%A5%B0%A5%E9%A5%DF%A5%F3%A5%B0%B8%C0%B8%EC">プログラミング言語</a>での古い考え方にいつまでも固執していると、Webアプリケーション開発が楽しくないものになってしまうかもれません。</p><p><b><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>の主要な２つの原則</b></p>

<ul>
<li>DRY（Don't Repeat Yourself）- 同じコードを何度も書くことは良くないという考え</li>
<li>設定より規約（Convention Over Configuration）- 設定ファイルに細かな設定情報を記載するのではなく、ファイル名やクラス名などの規約があらかじめ<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>によって決められている</li>
</ul><p><br />
<h3 id="#create-new-rails-project">2. 新しい<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>プロジェクトを作成する</h3>実際に手を動かしながら以降の説明を実施していくと理解が深まるのでお勧めです。<br />
この記事では、「簡単なブログアプリケーションを作成」していきます。</p>

<div class="section">
    <h4>2.1. ブログアプリケーションの作成</h4>
    <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>には「ジェネレーター」と呼ばれる<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>があり、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>でなにか作業を始めるときの最初のステップとしてよく使う<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>郡ですので覚えておいてください。<br />
新しい<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションを作成するときもこの「ジェネレーター」を使うことができます。</p><p>ターミナルを開いて、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションを作成したいフォルダに移動して、次のコマンドを実行してください。</p>
<pre class="code" data-lang="" data-unlink>$ rails new blog</pre><p>このコマンドは内部的に、<code>blog</code>フォルダを作成し、そのフォルダ内に「Blog」という<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションに必要なファイルを作成しています。その後、<code>bundle install</code>を行い<code>Gemfile</code>内に記載されているgemをインストールしています。</p><p><i>※<code>rails new -h</code>コマンドで全ての<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%DE%A5%F3%A5%C9%A5%E9%A5%A4%A5%F3">コマンドライン</a>オプションを確認できます。</i></p><p>ブログアプリケーションで作業をするために作成したblogフォルダに移動します。</p>
<pre class="code" data-lang="" data-unlink>$ cd blog</pre><p><code>rails new blog</code>コマンドは、自動で<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>のフォルダ構成、ファイルを作成します。この<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C1%A5%E5%A1%BC%A5%C8%A5%EA%A5%A2%A5%EB">チュートリアル</a>では、<code>app/</code>配下のファイルを修正することが多くなりますが、その他のフォルダも重要です。そのため、デフォルトで作成されるフォルダとファイルの基礎をまとめておきました。<br />
<a href="../20140709/1404912093.html" target="_blank">Railsのフォルダ構造の説明</a></p><br />
<p><h3 id="hello-rails">3. Hello, <a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>! を表示する</h3>まずは、画面にテキストを表示させてみましょう。</p>

</div>
<div class="section">
    <h4>3.1. Webサーバーを起動する</h4>
    <p>実は今の段階で既に<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>アプリケーションは機能します。開発マシン上でWebサーバーを起動させましょう。</p>
<pre class="code" data-lang="" data-unlink>$ rails server</pre><p><i>※<a class="keyword" href="http://d.hatena.ne.jp/keyword/CoffeeScript">CoffeeScript</a>を<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>に<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>するために「<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>ランタイム」が必要です。もし、「<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>ランタイム」が存在しない場合、<code>execjs error</code>が発生します。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Mac%20OS%20X">Mac OS X</a>や<a class="keyword" href="http://d.hatena.ne.jp/keyword/Windows">Windows</a>では「<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>ランタイム」は通常はインストールされているので問題ありません。</i></p><p>コマンドを実行すると、Webサーバーの<code>WeBrick</code>が起動します。動作を確認するために、ブラウザを開き、<code>http://localhost:3000</code>にアクセスしてください。デフォルトのインフォページが表示されます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812025948.png" alt="f:id:nipe880324:20140812025948p:plain:w480" title="f:id:nipe880324:20140812025948p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p><i>※Webサーバーを止めるには、ターミナル内で<code>Ctrl+C</code>を押して下さい。<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>を変更したときにサーバーが自動的に読み込むを行うのでサーバーの再起動は必要ありません。ルーティングなどの設定ファイルを変更した場合はサーバーの再起動が必要です。変更したのに画面上で変化がないときはサーバーの再起動をするようにしてみてください。</i></p><p>画面にインフォページが表示されるということは、画面を表示するために十分な設定が正しく行われているという証拠です。また、この画面上部にある"About your application’s environment"リンクをクリックすることでアプリケーション環境を確認することができます。</p>

</div>
<div class="section">
    <h4>3.2. "Hello, <a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>"を画面表示</h4>
    <p>"Hello, <a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>"を画面表示するためには、少なくともコントローラーとビューを作成する必要があります。</p><p>コントローラーの目的は、アプリケーションへのリクエストを処理することです。ルーティングは、どのコントローラーがどのリクエストを処理するかを決めます。つまり、リクエストされたURLとコントローラーの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%C3%A5%D4%A5%F3%A5%B0">マッピング</a>を行っています。たいていは、コントローラーは<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CA%A3%BF%F4">複数</a>のルートを処理できるので、それぞれのルートはコントローラー内のそれぞれのアクション（コントローラーの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>のことをアクションと呼ぶ）に<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%C3%A5%D4%A5%F3%A5%B0">マッピング</a>されます。アクション内では、情報を集め、それをビューに渡しています。</p><p>ビューの目的は、人間が読める形式で情報を表示することです。重要なことは、表示する情報を集めるのはコントローラーであり、ビューではないということです。ビューはコントローラーが集めた情報を表示することに専念すべきです。デフォルトでは、ビューテンプレートはERB(組み込み<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>)という言語で書かれています。</p><p>コントローラーを作成するために、「ジェネレーター」に<code>controller</code>を指定し、<code>welcome</code>というコントローラ名、そして、<code>index</code>というアクションを指定します。</p>
<pre class="code" data-lang="" data-unlink>$ rails generate controller welcome index</pre><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>はいくつかのファイルと１つのルートを追加します。</p>
<pre class="code" data-lang="" data-unlink>    create  app/controllers/welcome_controller.rb
     route  get &#39;welcome/index&#39;
    invoke  erb
    create    app/views/welcome
    create    app/views/welcome/index.html.erb
    invoke  test_unit
    create    test/controllers/welcome_controller_test.rb
    invoke  helper
    create    app/helpers/welcome_helper.rb
    invoke    test_unit
    create      test/helpers/welcome_helper_test.rb
    invoke  assets
    invoke    coffee
    create      app/assets/javascripts/welcome.js.coffee
    invoke    scss
    create      app/assets/stylesheets/welcome.css.scss</pre><p>これらのファイルのなかで一番重要なのは、<br />
「コントローラー(<code>app/controllers/welcome_controller.rb</code>)」と<br />
「ビュー(<code>app/views/welcome/index.html.erb</code>)」です。</p><p><code>app/views/welcome/index.html.erb</code>を<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C6%A5%AD%A5%B9%A5%C8%A5%A8%A5%C7%A5%A3%A5%BF">テキストエディタ</a>で開きましょう。<br />
全てのコードを削除し、次のコードを記載して保存してください。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>Hello, Rails!<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>
</pre>
</div>
<div class="section">
    <h4>3.3. アプリケーションのルート画面を設定</h4>
    <p>さて、私たちは今コントローラーとビューを作成しました。ルートURL(<code>http://localhost:3000</code>)にアクセスしたときに、"Hello, <a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>!"を画面に表示させたいです。しかし、今は"Welcome Aboard"のインフォページが表示されてしまいます。</p><p>これを解消するために、ルートを指定する必要があります。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># config/routes.rb</span>
<span class="synType">Rails</span>.application.routes.draw <span class="synStatement">do</span>
  get <span class="synSpecial">'</span><span class="synConstant">welcome/index</span><span class="synSpecial">'</span>

  <span class="synComment"># The priority is based upon order of creation: first created -&gt; highest priority.</span>
  <span class="synComment"># See how all your routes lay out with &quot;rake routes&quot;.</span>

  <span class="synComment"># You can have the root of your site routed with &quot;root&quot;</span>
  <span class="synComment"># root 'welcome#index'</span>
  ...
</pre><p>これはアプリケーションのルーティングファイルです。特殊な<a class="keyword" href="http://d.hatena.ne.jp/keyword/DSL">DSL</a>(Domain-Specific-Language)で書かれており、アプリケーションへのリクエストをコントローラーとアクションに<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%C3%A5%D4%A5%F3%A5%B0">マッピング</a>しています。このファイル内には既にいくつかのサンプルが<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%E1%A5%F3%A5%C8%A5%A2%A5%A6%A5%C8">コメントアウト</a>されて記載されています。その中の一つに、ルートURLをコントローラーとアクションに結びつけている記載があります。<code>root</code>から始まる<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%E1%A5%F3%A5%C8%A5%A2%A5%A6%A5%C8">コメントアウト</a>されている行を探して、コメントを外して下さい。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># config/routes.rb</span>
  root <span class="synSpecial">'</span><span class="synConstant">welcome#index</span><span class="synSpecial">'</span>
</pre><p><code>root 'welcome#index'</code>はルートへのリクエストを<code>Welcome</code>コントローラーの<code>index</code>アクションに<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%C3%A5%D4%A5%F3%A5%B0">マッピング</a>させることを意味しています。<br />
また、<code>get 'welcome/index'</code>は<code>http://localhost:3000/welcome/index</code>へのリクエストを<code>Welcome</code>コントローラーの<code>index</code>アクションに<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%C3%A5%D4%A5%F3%A5%B0">マッピング</a>させることを意味しています。これは、<code>rails generate controller welcome index</code>コマンドを実行したときに作られたルートです。</p><p>ブラウザで<code>http://localhost:3000</code>にアクセスしましょう。<br />
すると、<code>app/views/welcome/index.html.erb</code>に記載された"Hello, <a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>!"メッセージが表示されるます。<br />
これは、<code>config/routes.rb</code>内に追加したルートが<code>Welcome</code>コントローラーの<code>index</code>アクションに<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%C3%A5%D4%A5%F3%A5%B0">マッピング</a>され、<code>index</code>アクションが<code>app/views/welcome/index.html.erb</code>を<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%C0%A5%EA%A5%F3%A5%B0">レンダリング</a>したからです。</p><p><i>※<code>index</code>アクションを確認すると、アクション内に<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>が記載されていません。しかし、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>はビューを<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%C0%A5%EA%A5%F3%A5%B0">レンダリング</a>する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>の<code>render</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>が呼ばれていないときは、暗黙でコントローラー名とアクション名から<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%C0%A5%EA%A5%F3%A5%B0">レンダリング</a>するビューファイルを推測します。今回の場合、コントローラ名が<code>Welcome</code>でアクション名が<code>index</code>なので、<code>app/views/welcome/index.html.erb</code>が<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%C0%A5%EA%A5%F3%A5%B0">レンダリング</a>されます。</i></p><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812031054.png" alt="f:id:nipe880324:20140812031054p:plain:w480" title="f:id:nipe880324:20140812031054p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<p><h3 id="getting-up-and-running">4. 投稿機能を作成する</h3>さて、あなたはもうすでに「コントローラー、アクション、ビューの作成方法」を知ることができました。<br />
それでは、ブログの投稿機能を作っていきましょう。</p><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>では、標準的なRESTリソースを宣言するために使われる<code>resources</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>が定義されています。>|<a class="keyword" href="http://d.hatena.ne.jp/keyword/ruby">ruby</a>|<br />
# config/routes.rb<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>.application.routes.draw do</p><p>  resources :posts</p><p>  root 'welcome#index'<br />
end<br />
|</p>

</div><p>ターミナルで<code>rake routes</code>を実行すると、標準のRESTfulアクションのルートを確認することができます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>$ rake routes
   <span class="synType">Prefix</span> <span class="synType">Verb</span>   <span class="synType">URI</span> <span class="synType">Pattern</span>               <span class="synType">Controller</span><span class="synComment">#Action</span>
    posts <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">(.</span><span class="synConstant">:format</span><span class="synSpecial">)</span><span class="synConstant">          posts#index</span>
<span class="synConstant">          POST   </span><span class="synSpecial">/</span>posts(.<span class="synConstant">:format</span>)          posts<span class="synComment">#create</span>
 new_post <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/ne</span>w(.<span class="synConstant">:format</span>)      posts<span class="synComment">#new</span>
edit_post <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:id</span>/edit(.<span class="synConstant">:format</span>) posts<span class="synComment">#edit</span>
     post <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)      posts<span class="synComment">#show</span>
          <span class="synType">PATCH</span>  <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)      posts<span class="synComment">#update</span>
          <span class="synType">PUT</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)      posts<span class="synComment">#update</span>
          <span class="synType">DELETE</span> <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)      posts<span class="synComment">#destroy</span>
     root <span class="synType">GET</span>    /                         welcome<span class="synComment">#index</span>
</pre><p>それでは、新しい投稿(<code>Post</code>)を作成する機能とフォームを追加します。<br />
これは、<a class="keyword" href="http://d.hatena.ne.jp/keyword/CRUD">CRUD</a>操作の<code>作成(Create)</code>と<code>検索(Read)</code>に当てはまります。これから作成するフォームは次のようになります。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812034136.png" alt="f:id:nipe880324:20140812034136p:plain:w480" title="f:id:nipe880324:20140812034136p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>今のところ見た目がもっさいですが、まあいいでしょう。最後の方の９番目の大項目でスタイリングを改善していきます。</p>

<div class="section">
    <h4>4.1. 前準備の実施</h4>
    <p>アプリケーションに新しい投稿を作成する最初のステップは、「ルーティング」です。<br />
<code>/posts/new</code>のURLにアクセスすることで投稿を作成します。しかし、<code>resouces</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>により既にそのルートは定義されています。</p><p>画面から<code>http://localhost:3000/posts/new</code>にアクセスしてください。ルーティングエラーが発生するでしょう。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812032446.png" alt="f:id:nipe880324:20140812032446p:plain:w480" title="f:id:nipe880324:20140812032446p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>このエラーの原因は、「リクエストを処理するためのコントローラーを必要としているが、そのコントローラーが存在していなかった」ためです。<br />
そのため<code>PostsController</code>を作成すれば解決します。次のコマンドでコントローラーを作成しましょう。</p>
<pre class="code" data-lang="" data-unlink>$ rails generate controller posts</pre><p>空のコントローラーが表示されます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/controllers/posts_controller.rb</span>
<span class="synPreProc">class</span> <span class="synType">PostsController</span> &lt; <span class="synType">ApplicationController</span>
<span class="synPreProc">end</span>
</pre><p>コントローラーは<code>ApplicationController</code>を継承したクラスです。コントローラークラス内に<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を定義することで、それがコントローラーのアクションとなります。通常そのアクションはPostに対する<a class="keyword" href="http://d.hatena.ne.jp/keyword/CRUD">CRUD</a>操作を行います。</p><p><i>※<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>にはpublic, private, protected<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>があります。public<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>だけがコントローラーのアクションとなります。privateやprotected<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>はアクションにはならないことに注意して下さい。</i></p><p><code>http://localhost:3000/posts/new</code>にアクセスし直すと、新しいエラーが表示されます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812032733.png" alt="f:id:nipe880324:20140812032733p:plain:w480" title="f:id:nipe880324:20140812032733p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>このエラーは、「<code>PostsController</code>内に<code>new</code>アクションを見つからなかった」ということを表しています。</p><p><code>app/controllers/posts_controller.rb</code>をエディタで開き、<code>PostsController</code>クラス内に<code>new</code>アクションを定義しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">PostsController</span> &lt; <span class="synType">ApplicationController</span>
  <span class="synComment"># GET /posts/new</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">new</span> 
  <span class="synPreProc">end</span>
<span class="synPreProc">end</span>
</pre><p><code>new</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を定義したので、<code>http://localhost:3000/posts/new</code>にアクセスし直しましょう。また新しいエラーが発生します。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812032951.png" alt="f:id:nipe880324:20140812032951p:plain:w480" title="f:id:nipe880324:20140812032951p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>「アクションを処理した後にビュー（テンプレート）を表示しようとしたが、それが存在しなかった」ためエラーが発生しています。</p><p>上記の画像のエラー文を細かく見てみましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">Missing</span> template posts/new, application/new
with {<span class="synConstant">locale</span>:[<span class="synConstant">:en</span>], <span class="synConstant">formats</span>:[<span class="synConstant">:html</span>], <span class="synConstant">handlers</span>:[<span class="synConstant">:erb</span>, <span class="synConstant">:builder</span>, <span class="synConstant">:coffee</span>]}.
<span class="synType">Searched</span> <span class="synStatement">in</span>: * <span class="synSpecial">&quot;</span><span class="synConstant">/path/to/blog/app/views</span><span class="synSpecial">&quot;</span>
</pre><p>それぞれの部分が何を意味しているかささっと確認しましょう。</p><p>最初の部分は、何のテンプレートが存在しなかったかを示しています。今回の場合、<code>posts/new</code>テンプレートです。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>は最初にこのテンプレートを探します。そしてもし見つけれなかった場合、今度は<code>application/new</code>テンプレートを表示しようと試みます。これは、<code>PostsControler</code>が<code>ApplicationController</code>を継承しているためです。</p><p>次の部分は、ハッシュです。<code>locale</code>キーはテンプレートがどの言語を使うべきかを示しいます。デフォルトは「<code>英語(:en)</code>」です。<br />
次の<code>formats</code>キーはテンプレートの形式を表しています。デフォルトは「<code>HTML(html)</code>」のため、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>はHTMLテンプレートを探します。<br />
最後の<code>handlers</code>キーはテンプレートを<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%C0%A5%EA%A5%F3%A5%B0">レンダリング</a>するためにどのテンプレートハンドラーを使えるか表しています。今回の場合で言うと、<code>erb</code>はHTMLテンプレート用、<code>builder</code>は<a class="keyword" href="http://d.hatena.ne.jp/keyword/XML">XML</a>テンプレート用に使われ、<code>coffee</code>は<a class="keyword" href="http://d.hatena.ne.jp/keyword/CoffeeScript">CoffeeScript</a>を<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>テンプレートに変換するために使われます。</p><p>最後の部分は、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>がテンプレートファイルを探すパスを表しています。</p><p>今回のエラーを解消するための一番簡単なテンプレートは、<code>app/views/posts/new.html.erb</code>ファイルを作成することです。１つ目の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B3%C8%C4%A5%BB%D2">拡張子</a>(html)がテンプレートのフォーマットであり、２つ目の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B3%C8%C4%A5%BB%D2">拡張子</a>(erb)がテンプレートのハンドラーを表します。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>は<code>app/views/</code>配下から<code>posts/new</code>テンプレートを探します。<br />
今私たちはHTMLフォームを作りたいので、フォーマットは<code>html</code>、そして、ハンドラーは<code>erb</code>としました。そのため、ファイルは<code>app/views/posts/new.html.erb</code>にするべきです。</p><p>エラーを解消するために、<code>app/views/posts/new.html.erb</code>を新たに作成し、次の内容を記載してください。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>新しい投稿<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>
</pre><p><code>http://localhost:3000/posts/new</code>にアクセスすると画面が表示されるはずです。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812033848.png" alt="f:id:nipe880324:20140812033848p:plain:w480" title="f:id:nipe880324:20140812033848p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>ルート、コントローラー、アクションそしてビューが連動して上手く動いています。</p>

</div>
<div class="section">
    <h4>4.2. 最初のフォーム</h4>
    <p>さて、「投稿を作成するフォーム」を作っていきましょう。<br />
テンプレートでフォームを作るためには、<code>form_for</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>と呼ばれるヘルパー<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を使います。<code>app/views/posts/new.html.erb</code>を次のように修正しましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>新しい投稿<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> form_for</span><span class="synIdentifier"> :post, </span><span class="synType">url</span><span class="synIdentifier">: posts_path do |f| %&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :title, </span><span class="synConstant">&quot;タイトル&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_field</span><span class="synIdentifier"> :title %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :</span><span class="synType">text</span><span class="synIdentifier">, </span><span class="synConstant">&quot;内容&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_area</span><span class="synIdentifier"> :</span><span class="synType">text</span><span class="synIdentifier">, </span><span class="synType">cols</span><span class="synIdentifier">: 60, </span><span class="synType">rows</span><span class="synIdentifier">: 8 %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.submit</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;% end %&gt;</span>
</pre><p>画面を更新すると、この章の始めにお見せした画面とまったく同じ画面が表示されるでしょう。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>でフォームを作ることは本当に簡単ですね。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812034136.png" alt="f:id:nipe880324:20140812034136p:plain:w480" title="f:id:nipe880324:20140812034136p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p><code>form_for</code>では、どのオブジェクトを作成するためのフォームを作成するかを明示するために引数にオブジェクトを渡す必要があります。今回の場合<code>:post</code>を渡すことで、<code>Post</code>オブジェクトを作成するためのフォームを作るように指定しています。<br />
<code>form_for</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>のブロック内では、<code>FormBuilder</code>オブジェクト(<code>f</code>で表されている)は、投稿の「タイトル(title)」と「内容(text)」のためにラベルとテキストフィールド、テキストエリアを作成しています。そして、最後に<code>submit</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>により、登録ボタンを作成しています。</p><p>しかし、このフォームには１つ問題があります。フォームのHTMLソースを確認すれば分かると思いますが、フォーム要素のaction属性の値が<code>/posts/new</code>になっています。このURLは、<code>resouces</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>で自動的に作成されるルートではないため、フォームの登録ボタンを押したときにルーティングエラーになってしまいます。</p><p>そのため、<code>form_for</code>の行を次のように修正してください。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>&lt;%= form_for <span class="synConstant">:post</span>, <span class="synConstant">url</span>: posts_path <span class="synStatement">do</span> |<span class="synIdentifier">f</span>| %&gt;
</pre><p>今回は、<code>url</code>オプションに<code>posts_path</code>ヘルパーを追加しました。<br />
こうすることにより<code>PostsController</code>の<code>create</code>アクションが呼び出されます。ちなみに、Webの世界では一般的にフォームでサーバーにデータを送信するときにはHTTPの<code>GET</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>ではなく<code>POST</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>が使われます。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>でも自動的に<code>POST</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>が使われます。</p><p><i>※<code>xxx_path</code>や<code>xxx_url</code>は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>が自動的に生成するヘルパー<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>です。中身はURLであり、<code>xxx_path</code>はルートのURLからの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%C1%EA%C2%D0%A5%D1%A5%B9">相対パス</a>、<code>xxx_url</code>は<a class="keyword" href="http://d.hatena.ne.jp/keyword/%C0%E4%C2%D0%A5%D1%A5%B9">絶対パス</a>です。<br />
例えば、<code>posts_path</code>の場合、<code>/posts</code>に変換されます。<br />
どのヘルパーが使えるかどうかは、<code>rake routes</code>コマンドの結果の一番左側の<code>prefix</code>の列を見て、それに<code>_path</code>もしくは<code>_url</code>を足したヘルパー<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>が使用可能です。</i></p><p>では、新しい投稿を作成するために、画面を更新してから、フォームに値を入力し、サブミットボタンを押して下さい。すると、次のようなエラーが発生します。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812035717.png" alt="f:id:nipe880324:20140812035717p:plain:w480" title="f:id:nipe880324:20140812035717p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>これは、「<code>PostsController</code>に<code>create</code>アクションがない」ため発生しています。</p>

</div>
<div class="section">
    <h4>4.3. 投稿の作成</h4>
    <p><code>Unknown action</code>エラーが発生したので、<code>app/controllers/posts_controller.rb</code>の<code>PostsController</code>に<code>create</code>アクションを定義します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">PostsController</span> &lt; <span class="synType">ApplicationController</span>
  <span class="synComment"># GET /posts/new</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">new</span>
  <span class="synPreProc">end</span>

  <span class="synComment"># POST /posts</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">create</span>
  <span class="synPreProc">end</span>
<span class="synPreProc">end</span>
</pre><p>再び、画面を更新して、サブミットボタンを押すとテンプレートファイルがないというエラーが発生します。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812040412.png" alt="f:id:nipe880324:20140812040412p:plain:w480" title="f:id:nipe880324:20140812040412p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>しかし、心配しないで下さい。今のところこのエラーを無視しましょう。<code>create</code>アクションに「新しい投稿をデータベースに登録する処理」を追加しましょう。</p><p>登録ボタンを押してフォームのフィールドデータを送信すると、そのデータはパラメーターとして<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>に送られます。このパラメーターはコントローラーのアクション内で参照可能です。では、これらのパラメーターに含まれる値を確認するために、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>を少し修正しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>  <span class="synComment"># POST /posts</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">create</span>
    render <span class="synConstant">text</span>: params[<span class="synConstant">:post</span>].inspect
  <span class="synPreProc">end</span>
</pre><p>ここでは、<code>render</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>の<code>text:</code>キーに<code>params[:post].inspect</code>を渡しています。<br />
<code>params</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>はフォームから送られてきたパラメーター（もしくは、フィールド）の値を保持しているオブジェクトです。<code>params</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>は、文字列かシンボルをキーとしてハッシュのようにアクセスできる<code>ActiveSupport::HashWithIndifferentAccess</code>オブジェクトを返します。今回は、フォームで入力されたパラメーターのみ保持しています。</p><p>再びフォームに値を入力し、登録ボタンを押すと、<code>Template is missing</code>エラーが発生する代わりに、画面に次のような出力がされます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>{<span class="synSpecial">&quot;</span><span class="synConstant">title</span><span class="synSpecial">&quot;</span>=&gt;<span class="synSpecial">&quot;</span><span class="synConstant">最初の投稿</span><span class="synSpecial">&quot;</span>, <span class="synSpecial">&quot;</span><span class="synConstant">text</span><span class="synSpecial">&quot;</span>=&gt;<span class="synSpecial">&quot;</span><span class="synConstant">これは最初の投稿です。</span><span class="synSpecial">&quot;</span>}
</pre><p>今この<code>create</code>アクションはフォームから送られてきたパラメータを表示しています。しかし、パラメーターを確認できますが、実際にどこかにこのデータを保存しているわけではありません。</p>

</div>
<div class="section">
    <h4>4.4. Postモデルの作成</h4>
    <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>のモデル名は「単数系」、テーブル名はその<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CA%A3%BF%F4">複数</a>形で定義する必要があります。今回の場合で言うと、モデル名は<code>Post</code>、テーブル名は<code>posts</code>になります。<br />
多くの<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>開発者がモデルを作成するときに必ずといっていいほど使うモデルを生成ジェネレーターがあります。次のコマンドを実行し、新しいモデルを作成しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>$ rails generate model <span class="synType">Post</span> title<span class="synConstant">:string</span> text<span class="synConstant">:text</span>
</pre><p>このコマンドは、String型の<code>title</code>属性、Text型の<code>text</code>属性を持った<code>Post</code>モデルを作成しています。</p><p><i>※Active Recordは「テーブルの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A5%E9%A5%E0%CC%BE">カラム名</a>」から「モデルの属性」を自動的に作成してくれます。これは、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>のモデル内に属性を宣言する必要がなく、Active Recordが自動的にそれを行ってくれることを意味しています。</i></p><p></p>

</div>
<div class="section">
    <h4>4.5. <a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>の実行</h4>
    <p><code>rails generate model</code>コマンドにより<code>db/migrate</code>ディレクトリ内にデータベースの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>ファイルが作成されました。<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>はテーブル作成やテーブル変更などのデータベース操作を行うための<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a>のクラスです。<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>開発者は<code>rake</code>コマンドを使ってその<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>ファイルを実施します。データベースに<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>を適用した後にその変更を<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%ED%A1%BC%A5%EB%A5%D0%A5%C3%A5%AF">ロールバック</a>をすることも可能です。<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>ファイルのファイル名は、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>ファイルが作成された順番で処理をさせるためにタイムスタンプを含んでいます。</p><p>作成された<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>ファイルの<code>db/migrate/20140811045600_create_posts.rb</code>を確認しましょう。（タイムスタンプが含まれているのでファイル名は少し違うことに注意して下さい）</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">CreatePosts</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Migration</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">change</span>
    create_table <span class="synConstant">:posts</span> <span class="synStatement">do</span> |<span class="synIdentifier">t</span>|
      t.string <span class="synConstant">:title</span>
      t.text <span class="synConstant">:text</span>

      t.timestamps
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>
<span class="synPreProc">end</span>
</pre><p><code>change</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>は<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>が実行されるときに呼ばれます。この<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>内で定義されたコードは「逆実行が可能」です。つまり、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>は<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>による変更を逆実行（戻すこと）が可能ということです。<br />
この<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>ファイルを実行すると、String型とText型のカラムをもった<code>posts</code>テーブルが作成されます。また、postレコードの作成時間(<code>created_at</code>)と更新時間(<code>updated_at</code>)を保持する２つのタイムスタンプも作成されます。</p><p><i>※<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>についてより詳細を知りたい場合は、<a href="../20140810/1407634200.html" target="_blank">マイグレーションファイルの作り方</a>や<a href="http://guides.rubyonrails.org/migrations.html" target="_blank">Rails Guides - Rails Database Migrations</a>を参照して下さい。</i></p><p>では、<code>rake</code>コマンドで<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>をしましょう。</p>
<pre class="code" data-lang="" data-unlink>$ rake db:migrate</pre><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>が成功した場合、次のように<code>posts</code>テーブルが作成された旨の表示がされるでしょう。</p>
<pre class="code" data-lang="" data-unlink>== 20140811045600 CreatePosts: migrating ======================================
-- create_table(:posts)
   -&gt; 0.0013s
== 20140811045600 CreatePosts: migrated (0.0014s) =============================</pre><p><i>基本的には<code>development</code>環境で作業をしています。そのため、このコマンド結果は、<code>config/database.yml</code>ファイルの<code>development</code>セクションで定義されているデータベースに適用されます。他の環境に<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>を適用させたいときは、コマンド実行時に環境名を指定して下さい。<br />
例：<code>rake db:migrate RAILS_ENV=production</code></i><br />
</p>

</div>
<div class="section">
    <h4>4.6. コントローラー内でデータを保存する</h4>
    <p><code>PostsController</code>に戻り、データベース内にデータを保存するために<code>create</code>アクション内で<code>Post</code>モデルを使うように変更しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>  <span class="synComment"># POST /posts</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">create</span>
    <span class="synIdentifier">@post</span> = <span class="synType">Post</span>.new(params[<span class="synConstant">:post</span>])
    <span class="synIdentifier">@post</span>.save
    redirect_to <span class="synIdentifier">@post</span>
  <span class="synPreProc">end</span>
</pre><p>全ての<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>のモデルは属性で初期化することができます。<br />
最初の行では、<code>params[:post]</code>はフォームからの属性を保持しているので、モデルの<code>new</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>にそのまま渡して、モデルを作成しています。<br />
それから、<code>@post.save</code>は、データベースにモデルを保存しています。後から確認しますが、<code>@post.save</code>はモデルが保存できたか、できなかったというboolean値を返します。<br />
最後に、後ほど実装予定の<code>show</code>アクションにリダイレクトするようにしています。</p><p><i>※<code>render、redirect_to</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>などでモデルクラスのオブジェクト(<code>@post</code>など)を引数に渡すと、自動的に<code>/posts/1</code>のようなURLに変換され、<code>show</code>アクションが呼ばれます。</i></p><p>さあ<code>http://localhost:3000/posts/new</code>にアクセスし、新しい投稿をしてみてください。次のエラーが発生するでしょう。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812042243.png" alt="f:id:nipe880324:20140812042243p:plain:w480" title="f:id:nipe880324:20140812042243p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>ではセキュアなアプリケーションの開発を促すためにいくつかのセキュリティ機構が存在します。そして、今そのセキュリティ機構によりエラーが発生しました。この機構は、<code>Strong Parameters</code>と呼ばれ、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>は、私たちに「パラメーターのどの値を取得したいか」をコントローラー内に明示することを要求しています。今回の場合で言うと、パラメーター内の<code>title</code>と<code>text</code>の値を取得したいので、次のように変更して下さい。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>  <span class="synComment"># POST /posts</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">create</span>
    <span class="synIdentifier">@post</span> = <span class="synType">Post</span>.new(post_params)
    <span class="synIdentifier">@post</span>.save
    redirect_to <span class="synIdentifier">@post</span>
  <span class="synPreProc">end</span>

  <span class="synStatement">private</span>
    <span class="synPreProc">def</span> <span class="synIdentifier">post_params</span>
      params.require(<span class="synConstant">:post</span>).permit(<span class="synConstant">:title</span>, <span class="synConstant">:text</span>)
    <span class="synPreProc">end</span>
</pre><p><code>permit</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>は、私たちがアクション内で<code>title</code>と<code>text</code>を取得できるように<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>に明示しています。</p><p><i>※<code>def post_params</code>がプライベート<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>であることに注意して下さい。<code>Strong Parameters</code>は、攻撃者がパラメーターの値を操作し、モデル内の属性を開発者側の意図しない値に設定することを防ぐRails4から導入されたセキュリティ機構です。より詳細については、<a href="http://weblog.rubyonrails.org/2012/3/21/strong-parameters/" target="_blank">this blog post about Strong Parameters</a>を参照ください。</i><br />
</p>

</div>
<div class="section">
    <h4>4.7. 投稿を確認する</h4>
    <p>画面でフォームの登録ボタンを押すと、<code>show</code>アクションが見つからないといったエラーが発生するでしょう。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812042621.png" alt="f:id:nipe880324:20140812042621p:plain:w480" title="f:id:nipe880324:20140812042621p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>コントローラーに<code>show</code>アクションを追加する前に、まずはルートを確認しましょう。<br />
<code>rake routes</code>コマンドの結果を見てみると、<code>show</code>アクションのためのルートがあります。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">Prefix</span> <span class="synType">Verb</span>   <span class="synType">URI</span> <span class="synType">Pattern</span>               <span class="synType">Controller</span><span class="synComment">#Action</span>
  post <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)      posts<span class="synComment">#show</span>
</pre><p>この特殊な<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B7%A5%F3%A5%BF%A5%C3%A5%AF%A5%B9">シンタックス</a>の<code>:id</code>は、このルートでは<code>id</code>という名のパラメーターを使うことを意味しています。今回の場合は、<code>post</code>クラスの<code>id</code>を示しています。</p><p><i>※全てのActive Recordを継承したクラスには<code>id</code>という名の属性があります。これは、主キーであり、一意にレコードを特定することができます。</i></p><p><code>app/controllers/posts_controller.rb</code>に<code>show</code>アクションを追加しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>  <span class="synComment"># GET /posts/:id</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">show</span>
    <span class="synIdentifier">@post</span> = <span class="synType">Post</span>.find(params[<span class="synConstant">:id</span>])
  <span class="synPreProc">end</span>
</pre><p><code>Post.find</code>は、データベースから「指定した<code>id</code>のpostレコード」を取得する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>です。そして、その値を<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%B9%A5%BF%A5%F3%A5%B9">インスタンス</a>変数（<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%B9%A5%BF%A5%F3%A5%B9">インスタンス</a>変数は<code>@</code>で始まる）に設定しています。なぜなら、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>は<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%B9%A5%BF%A5%F3%A5%B9">インスタンス</a>変数を使ってコントローラーからビューにデータを渡すからです。</p><p>さて、<code>app/views/posts/show.html.erb</code>を新たに作成しましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>タイトル：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @post.title</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>内容：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @post.text</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
</pre><p>変更を加えたら、<code>http://localhost:3000/posts/new</code>にアクセスし、なにか新しく投稿してみましょう。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812043231.png" alt="f:id:nipe880324:20140812043231p:plain:w480" title="f:id:nipe880324:20140812043231p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span><br />
</p>

</div>
<div class="section">
    <h4>4.8. 投稿の一覧画面を表示する</h4>
    <p>次は、全ての投稿を一覧表示するようにしてみましょう。<code>rake routes</code>コマンドを実行し、一覧表示をするためのルートがあることを確認します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">Prefix</span> <span class="synType">Verb</span>   <span class="synType">URI</span> <span class="synType">Pattern</span>               <span class="synType">Controller</span><span class="synComment">#Action</span>
 posts <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">(.</span><span class="synConstant">:format</span><span class="synSpecial">)</span><span class="synConstant">          posts#index</span>
</pre><p>このルートから、<code>PostsController</code>の<code>index</code>アクションが呼ばれるため、現在は作成されていないので追加しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># GET /posts</span>
<span class="synPreProc">def</span> <span class="synIdentifier">index</span>
  <span class="synIdentifier">@posts</span> = <span class="synType">Post</span>.all
<span class="synPreProc">end</span>
</pre><p><code>Post.all</code>は、postsテーブル内の全てのpostレコードを取得する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>です。</p><p>そして、アクションの結果を表示する<code>app/views/posts/index.html.erb</code>を新規で作成します。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>全ての投稿一覧<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>タイトル<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>内容<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;% @posts.each do |post| %&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> post.title</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> post.text</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;% end %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
</pre><p><code>http://localhost:3000/posts</code>にアクセスすれば、全ての投稿が一覧で表示されます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140812/20140812043711.png" alt="f:id:nipe880324:20140812043711p:plain:w480" title="f:id:nipe880324:20140812043711p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span><br />
</p>

</div>
<div class="section">
    <h4>4.9. リンクを追加する</h4>
    <p>さて、投稿を作成(new, create)、確認(show)、一覧表示(index)ができるようになりました。それらの画面間を遷移できるようにするためにリンクを追加しましょう。</p><p><code>app/views/welcome/index.html.erb</code>を開き、リンクを追加します。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>Hello, Rails!<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">&quot;私のブログ&quot;</span><span class="synIdentifier">, controller: </span><span class="synConstant">&quot;posts&quot;</span><span class="synIdentifier"> %&gt;</span>
</pre><p><code>link_to</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>は、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>に標準で使えるビューのヘルパー<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>です。この<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>は、引数で渡したテキストでHTMLの<code>a要素</code>を作成します。"私のブログ"という文字列の「投稿の一覧画面へ遷移する」aタグリンクが画面に表示されます。</p><p>同様に他の画面にもリンクを追加しましょう。<code>app/views/posts/index.html.erb</code>の<code>tableタグ</code>の下にリンクを追加して下さい。</p>
<pre class="code lang-html" data-lang="html" data-unlink>...
...
<span class="synIdentifier">&lt;/</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'新しい投稿'</span><span class="synIdentifier">, new_post_path %&gt;</span>
</pre><p>このリンクは、"新しい投稿"という文字列で表示され、新しい投稿を作成するフォーム画面（<code>new</code>アクションを呼び出す）に遷移します。</p><p>次は、<code>app/views/posts/new.html.erb</code>の一番したの行に<code>index</code>アクションに戻るためのリンクを追加しましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>新しい投稿<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> form_for</span><span class="synIdentifier"> :post, </span><span class="synType">url</span><span class="synIdentifier">: posts_path do |f| %&gt;</span>
  .....
<span class="synIdentifier">&lt;% end %&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'戻る'</span><span class="synIdentifier">, posts_path %&gt;</span>
</pre><p>最後に、<code>app/views/posts/show.html.erb</code>テンプレートの一番したの行に<code>index</code>アクションに戻るリンクを追加しましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink>.....

<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>内容：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @post.text</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'戻る'</span><span class="synIdentifier">, posts_path %&gt;</span>
</pre><p><i>※同じコントローラー内のアクションにリンクを貼りたい場合は、<code>:controller</code>オプションを指定する必要はありません。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>のデフォルトでは現在のコントローラーに基づいて遷移を行うためです。</i></p><p><i>※<code>development</code>環境（デフォルトの作業環境）では、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>がブラウザのリクエスト毎に自動で<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>をリロードするので、ソースを修正した後にサーバーの再起動は必要ありません。</i><br />
</p>

</div>
<div class="section">
    <h4>4.10. 少し休憩して、Postモデルの説明</h4>
    <p>Postモデルの<code>app/models/post.rb</code>は次のようになっています。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">Post</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
<span class="synPreProc">end</span>
</pre><p>このファイルには特にこれといったコードは記載されていません。しいて言えば、<code>Post</code>クラスでは<code>ActiveRecord::Base</code>クラスを継承しています。しかしこれは非常に重要であり、Active Recordは非常の多くの機能を自分で作成したモデルクラスで使えるようにしてくれます。例えば、基本的なデータベースの<a class="keyword" href="http://d.hatena.ne.jp/keyword/CRUD">CRUD</a>操作（作成 Create、検索 Read、更新 Update、削除 Destroy）、データのバリデーション（検証）、さらには、複雑な検索や他のモデルへのアソシエーション（リレーション）をサポートしています。</p>

</div>
<div class="section">
    <h4>4.11. バリデーションを追加する</h4>
    <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>では、モデルを扱うときにデータのバリデーションを行うことができます。<br />
<code>app/models/post.rb</code>を開いて、バリデーションのための<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を追加してください。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">Post</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  validates <span class="synConstant">:title</span>, <span class="synConstant">presence</span>: <span class="synConstant">true</span>, <span class="synConstant">length</span>: { <span class="synConstant">minimum</span>: <span class="synConstant">5</span> }
<span class="synPreProc">end</span>
</pre><p>これは、全ての投稿が「<code>title</code>の値を持っており、それは、少なくとも5文字以上の長さが必要」と制限をつけています。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>ではモデルのカラムの値の存在有無、一意性、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D5%A5%A9%A1%BC%A5%DE%A5%C3%A5%C8%A5%C1%A5%A7%A5%C3%A5%AF">フォーマットチェック</a>など様々な状況を検証することができます。</p><p><i>バリデーションについてより詳しく知りたい場合は、「<a href="../20140724/1406145303.html" target="_blank">Railsのバリデーションと独自バリデート</a>」や「<a href="http://guides.rubyonrails.org/active_record_validations.html" target="_blank">Rails Guides - Active Record Validations</a>」を参照して下さい。</i></p><p>バリデーションを追加したので、無効なpostオブジェクトを<code>@post.save</code>で保存したとき(今回の場合はタイトルが空か5文字以下の場合)に、バリデーションにより<code>false</code>が返ってきます。<br />
そのため、<code>app/controllers/posts_controller.rb</code>を再び開き、<code>create</code>アクションの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>を見て下さい。現在<code>@post.save</code>の返り値を無視していますが、もし、返り値が<code>false</code>（バリデーションが失敗する）場合は、ユーザーにフォームを再表示させるようにしましょう。<br />
このためには、<code>new</code>と<code>create</code>アクション内を次のように修正します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># GET /posts/new</span>
<span class="synPreProc">def</span> <span class="synIdentifier">new</span>
  <span class="synIdentifier">@post</span> = <span class="synType">Post</span>.new
<span class="synPreProc">end</span>

<span class="synComment"># POST /posts</span>
<span class="synPreProc">def</span> <span class="synIdentifier">create</span>
  <span class="synIdentifier">@post</span> = <span class="synType">Post</span>.new(post_params)

  <span class="synStatement">if</span> <span class="synIdentifier">@post</span>.save
    redirect_to <span class="synIdentifier">@post</span>
  <span class="synStatement">else</span>
    render <span class="synConstant">:new</span>, <span class="synConstant">status</span>: <span class="synConstant">:unprocessable_entity</span>
  <span class="synStatement">end</span>
<span class="synPreProc">end</span>
</pre><p><code>new</code>アクションでは、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%B9%A5%BF%A5%F3%A5%B9">インスタンス</a>変数の<code>@post</code>に空のPostオブジェクトを設定しています。なぜそのようにしているかはすぐに分かるのでこのまま読み進めて下さい。</p><p><code>create</code>アクションでは、<code>save</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>が<code>false</code>を返すときに<code>redirect_to</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>の代わりに<code>render</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を使うように修正しました。<code>render</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>の引数に<code>'new'</code>を渡すことで、<code>new</code>テンプレートを表示するように指定しています。</p><p><code>http://localhost:3000/posts/new</code>をリロードし、タイトルを空のまま登録ボタンを押して下さい。すると、同じ画面（フォームが表示されている画面）が表示されます。<br />
しかし、エラーメッセージなどが表示されないのでユーザーにはなぜ同じ画面が表示されたか分からりません。そのため、<code>app/views/posts/new.html.erb</code>を修正し、エラーメッセージを表示するように修正しましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>新しい投稿<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> form_for</span><span class="synIdentifier"> :post, </span><span class="synType">url</span><span class="synIdentifier">: posts_path do |f| %&gt;</span>
  <span class="synIdentifier">&lt;% if @post.errors.any? %&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;error_explanation&quot;</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> @post.errors.count</span><span class="synIdentifier"> %&gt;</span>件のエラーが発生したため保存ができませんでした。<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">ul</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;% @post.errors.full_messages.each do |msg| %&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> msg</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;% end %&gt;</span>
      <span class="synIdentifier">&lt;/</span><span class="synStatement">ul</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;% end %&gt;</span>
  ...
  ...
</pre><p><code>@post.errors.any?</code>で<code>@post</code＞にバリデーションエラーが発生しているかどうかを確認しています。
そして、エラーが発生している場合は、<code>@post.errors.full_messages</code>で全てのエラーを表示しています。</p><p>さて、なぜコントローラーの<code>new</code>アクションに<code>@post = Post.new</code>を追加したか説明します。<br />
もし、<code>@post = Post.new</code>を追加しないと、<code>new.html.erb</code>が表示されるときに、<code>@post</code>は<code>nil</code>なので、<code>@post.errors.any?</code>を呼んだときに例外が発生してしまうからです。</p><p><i>※<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>はバリデーションエラーが発生したフィールドを自動的に<code>&lt;div class="field_with_errors"&gt;</code>で囲みます。これを使い、エラーが発生したフィールドを目立たせるために<a class="keyword" href="http://d.hatena.ne.jp/keyword/css">css</a>を定義することができます。是非バリデーションエラーが発生したHTMLソースを確認してみて下さい。</code></i></p><p>さて、再度<code>http://localhost:3000/posts/new</code>で、タイトルを空のままサブミットしてください。素敵なエラーメッセージが表示されるでしょう。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813135554.png" alt="f:id:nipe880324:20140813135554p:plain:w480" title="f:id:nipe880324:20140813135554p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p><i>エラーメッセージの日本語化などより詳細に知りたい場合は「<a href="../20140810/1407623400.html" target="_blank">モデルのバリデーションエラーメッセージ errors や エラーメッセージの日本語化</a>」を確認して下さい。</i><br />
</p>

</div>
<div class="section">
    <h4>4.12. 投稿を更新する</h4>
    <p>現在、<a class="keyword" href="http://d.hatena.ne.jp/keyword/CRUD">CRUD</a>の"CR"を実装しました。次は、"U"の部分である「投稿を更新」できるように実装していきましょう。</p><p>最初のステップは、<code>PostsController</code>クラスに<code>edit</code>アクションを追加することです。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># GET /posts/:id/edit</span>
<span class="synPreProc">def</span> <span class="synIdentifier">edit</span>
  <span class="synIdentifier">@post</span> = <span class="synType">Post</span>.find(params[<span class="synConstant">:id</span>])
<span class="synPreProc">end</span>
</pre><p>次のステップは、編集用の画面を作ります。内容は新しい投稿を作成する画面とほとんど同じです。<br />
<code>app/views/posts/edit.html.erb</code>テンプレートを作成し、次の内容を記載して下さい。<br />
（<code>new.html.erb</code>の内容をコピーし、違いを比較しながら編集するとそれぞれの差分がよく分かるのでお勧めです）</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>投稿を更新<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> form_for</span><span class="synIdentifier"> :post, </span><span class="synType">url</span><span class="synIdentifier">: posts_path, </span><span class="synType">method</span><span class="synIdentifier">: :patch do |f| %&gt;</span>
  <span class="synIdentifier">&lt;% if @post.errors.any? %&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;error_explanation&quot;</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> @post.errors.count</span><span class="synIdentifier"> %&gt;</span>件のエラーが発生したため保存ができませんでした。<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">ul</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;% @post.errors.full_messages.each do |msg| %&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> msg</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;% end %&gt;</span>
      <span class="synIdentifier">&lt;/</span><span class="synStatement">ul</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;% end %&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :title, </span><span class="synConstant">&quot;タイトル&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_field</span><span class="synIdentifier"> :title %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :</span><span class="synType">text</span><span class="synIdentifier">, </span><span class="synConstant">&quot;内容&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_area</span><span class="synIdentifier"> :</span><span class="synType">text</span><span class="synIdentifier">, </span><span class="synType">cols</span><span class="synIdentifier">: 60, </span><span class="synType">rows</span><span class="synIdentifier">: 8 %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.submit</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;% end %&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'戻る'</span><span class="synIdentifier">, posts_path %&gt;</span>
</pre><p><code>form_for</code>内の<code>method: :patch</code>は、HTTPの<code>PATCH</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>でフォームの内容をアプリケーションに送信するように指定しています。RESTでは、リソースを更新するために<code>PATCH</code>と<code>PUT</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を使います。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>はどちらも同じように処理できますが、全体として<code>PATCH</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を使おうという流れがあるので、ここではオプションに<code>:patch</code>を指定しています。<br />
<code>form_for</code>ヘルパーで作成されるフォームのデフォルトの<code>method</code>属性は<code>POST</code><br />
のため、ここでは明示的にオプションで指定する必要があったわけです。</p><p>さて、<code>app/controllers/posts_controller.rb</code>に<code>update</code>アクションを作成しましょう。<br />
こちらもほとんど、<code>create</code>アクションと同じになります。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># PATCH /posts/:id</span>
<span class="synComment"># PUT   /posts/:id</span>
<span class="synPreProc">def</span> <span class="synIdentifier">update</span>
  <span class="synIdentifier">@post</span> = <span class="synType">Post</span>.find(params[<span class="synConstant">:id</span>])

  <span class="synStatement">if</span> <span class="synIdentifier">@post</span>.update(post_params)
    redirect_to <span class="synIdentifier">@post</span>
  <span class="synStatement">else</span>
    render <span class="synConstant">:edit</span>, <span class="synConstant">status</span>: : unprocessable_entity
  <span class="synStatement">end</span>
<span class="synPreProc">end</span>
</pre><p>既に存在しているレコードを更新するときに、コントローラー内の<code>edit</code>と<code>update</code>アクションが使われます。<br />
<code>update</code>アクションでは、<code>create</code>アクションと同様に、</p>

<ul>
<li>バリデーションエラーが発生した場合、ユーザーにエラーメッセージと共に編集画面(edit.html.erb)が表示されます。</li>
<li>更新に成功した場合は、詳細画面(show.html.erb)が表示されます。</li>
</ul><p>最後に、投稿の一覧画面(index.html.erb)に<code>edit</code>アクションへのリンクを追加しましょう。<br />
<code>app/views/posts/index.html.erb</code>を開き<code>link_to</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を追加します(<code>link_to "編集" ...</code>)。ついでに、詳細画面(show.html.erb)へのリンク(<code>link_to "詳細" ...</code>)も追加しています。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>全ての投稿一覧<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>タイトル<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>内容<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;% @posts.each do |post| %&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> post.title</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> post.text</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'詳細'</span><span class="synIdentifier">, post %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'編集'</span><span class="synIdentifier">, edit_post_path(post) %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;% end %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'新しい投稿'</span><span class="synIdentifier">, new_post_path %&gt;</span>
</pre><p>そして、<code>app/views/posts/show.html.erb</code>テンプレートにも同様に、編集画面へのリンクを追加しておきましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink>...
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'戻る'</span><span class="synIdentifier">, posts_path %&gt;</span>
| <span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'編集'</span><span class="synIdentifier">, edit_post_path(@post) %&gt;</span>
</pre><p>現在の投稿一覧画面を確認しましょう。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813140345.png" alt="f:id:nipe880324:20140813140345p:plain:w480" title="f:id:nipe880324:20140813140345p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span><br />
</p>

</div>
<div class="section">
    <h4>4.13. 部分テンプレート（パーシャル）を使ってビューの重複箇所を削除する</h4>
    <p>前にも触れたましたが、作成画面(<code>new.html.erb</code>)と編集画面(<code>edit.html.erb</code>)はとても似ています。部分テンプレートを使うことで重複部分を削除しましょう。<br />
部分テンプレートの規約として、「ファイル名はアンダースコア(_)で始める必要」があります。</p><p><i>※部分テンプレートについてより詳しく知りたい場合は、「<a href="../20140807/1407419013.html" target="_blank">Railsのrenderメソッドと部分テンプレート</a>」や「<a href="http://guides.rubyonrails.org/layouts_and_rendering.html" target="_blank">Rails Guides - Layouts and Rendering in Rails</a>」を参照して下さい</i></p><p><code>app/views/posts/_form.html.erb</code>という部分テンプレートを新しく作成して、次の内容を記載して下さい。<br />
（<code>new.html.erb</code> か <code>edit.html.erb</code> のどちらからか<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>をコピーして、それを修正する形で<code>_form.html.erb</code>を作ると理解が深まるのでお勧めです。<br />
ちなみに、コピーした後の修正内容は、フォーム内は<code>form_for</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>の行以外はそのままです。あとは、最上部の<code>h1</code>タグと最下部の<code>link_to</code>を削除するだけです。）</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;%=</span><span class="synConstant"> form_for</span><span class="synIdentifier"> @post do |f| %&gt;</span>
  <span class="synIdentifier">&lt;% if @post.errors.any? %&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;error_explanation&quot;</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> @post.errors.count</span><span class="synIdentifier"> %&gt;</span>件のエラーが発生したため保存ができませんでした。<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">ul</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;% @post.errors.full_messages.each do |msg| %&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">li</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> msg</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">li</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;% end %&gt;</span>
      <span class="synIdentifier">&lt;/</span><span class="synStatement">ul</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;% end %&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :title, </span><span class="synConstant">&quot;タイトル&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_field</span><span class="synIdentifier"> :title %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :</span><span class="synType">text</span><span class="synIdentifier">, </span><span class="synConstant">&quot;内容&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_area</span><span class="synIdentifier"> :</span><span class="synType">text</span><span class="synIdentifier">, </span><span class="synType">cols</span><span class="synIdentifier">: 60, </span><span class="synType">rows</span><span class="synIdentifier">: 8 %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.submit</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;% end %&gt;</span>
</pre><p><code>form_for</code>はどのようにして正しいHTTP<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>とアクションを作成しているのでしょうか。<br />
ということは後に回し、先に作成した部分テンプレートを使うために<code>app/views/posts/new.html.erb</code>ビューを更新しましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>新しい投稿<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> render</span><span class="synIdentifier"> </span><span class="synConstant">'form'</span><span class="synIdentifier"> %&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'戻る'</span><span class="synIdentifier">, posts_path %&gt;</span>
</pre><p>では同じく、<code>app/views/posts/edit.html.erb</code>ビューも更新しましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>投稿を更新<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> render</span><span class="synIdentifier"> </span><span class="synConstant">'form'</span><span class="synIdentifier"> %&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'戻る'</span><span class="synIdentifier">, posts_path %&gt;</span>
</pre><p>画面を確認すると前と同じように動くでしょう。</p>

</div>
<div class="section">
    <h4>4.14. 投稿を削除する</h4>
    <p>次は、"<a class="keyword" href="http://d.hatena.ne.jp/keyword/CRUD">CRUD</a>"の"D"の部分である「投稿を削除する機能」を実装しましょう。<br />
RESTの規約に従うと、リソースを削除するルートは次のようになります。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">Verb</span>   <span class="synType">URI</span> <span class="synType">Pattern</span>               <span class="synType">Controller</span><span class="synComment">#Action</span>
<span class="synType">DELETE</span> <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)      posts<span class="synComment">#destroy</span>
</pre><p>リソースを削除するために<code>destroy</code>アクションを定義します。<br />
<code>app/controllers/posts_controller.rb</code>に<code>destroy</code>アクションを追加しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># DELETE /posts/:id</span>
<span class="synPreProc">def</span> <span class="synIdentifier">destroy</span>
  <span class="synIdentifier">@post</span> = <span class="synType">Post</span>.find(params[<span class="synConstant">:id</span>])
  <span class="synIdentifier">@post</span>.destroy

  redirect_to posts_path
<span class="synPreProc">end</span>
</pre><p>データベースからレコードを削除したいときには、Active Recordの<code>destroy</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を使います。<br />
<code>destory</code>アクションの後に、<code>posts_path</code>にリダイレクトする（<code>index</code>アクションが呼ばれる）のでビューを新たに作る必要はありません。</p><p>最後に、<code>destory</code>アクションを呼び出すリンクを一覧画面に追加します。<code>app/views/posts/index.html.erb</code>を開き、<code>link_to</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を追加してください。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>全ての投稿一覧<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>タイトル<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>内容<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;% @posts.each do |post| %&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> post.title</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> post.text</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'詳細'</span><span class="synIdentifier">, post %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'編集'</span><span class="synIdentifier">, edit_post_path(post) %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'削除'</span><span class="synIdentifier">, post_path(post),</span>
<span class="synIdentifier">                </span><span class="synType">method</span><span class="synIdentifier">: :delete, </span><span class="synType">data</span><span class="synIdentifier">: { confirm: </span><span class="synConstant">'削除しますか？'</span><span class="synIdentifier"> } %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;% end %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'新しい投稿'</span><span class="synIdentifier">, new_post_path %&gt;</span>
</pre><p>削除するために<code>link_to</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を新しい使い方で使っています。<code>method</code>オプションでHTTP<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を指定し、<code>data</code>オプションで確認ダイアログを表示するように指定しています。<br />
ユーザーが「削除」リンクを押すと、確認ダイアログが表示され、そこで「OK」ボタンを押すと、<code>DELTE /posts/:id</code>がサーバー上に送信され、<code>destroy</code>アクションが実行されることによりデータが削除されます。</p><p><i>この削除処理の多くは <a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a> で実現されています。<br />
アプリケーションのレイアウトファイル(<code>app/views/layouts/application.html.erb</code>)の<code>head</code>タグ内で自動的にインクルードされる<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>ファイル(<code>jquery_ujs</code>)によって実現されています。この<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>のファイルがない場合、確認ダイアログは表示されず、<code>DELETE</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>もサーバーに送信されないため、リソースを削除することができません。</i><br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813141050.png" alt="f:id:nipe880324:20140813141050p:plain:w480" title="f:id:nipe880324:20140813141050p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<p>おめでとうございます！<br />
あなたは、投稿を作成、詳細確認、一覧表示、更新、削除ができるようになりました。 :)</p><br />
<br />
<p><h3 href="#adding-a-second-model">5. コメントを追加する</h3>では、アプリケーションに２つ目のモデルを追加するときが来ました。<br />
２つ目のモデルは投稿の「コメント」です。</p>

</div>
<div class="section">
    <h4>5.1. モデルを生成する</h4>
    <p><code>Post</code>モデルを生成するときに使ったときと同じジェネレーターを使い、<code>Comment</code>モデルを作成します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>$ rails generate model <span class="synType">Comment</span> commenter<span class="synConstant">:string</span> body<span class="synConstant">:text</span> post<span class="synConstant">:references</span>
</pre><p>このコマンドで以下の４つのファイルが作成されます。<table class="table striped">
  <tr><th>ファイル</th><th>目的</th></tr>

  <tr><td>db/migrate/20140811090504_create_comments.rb</td><td><code>comments</code>データベースにテーブルを作成する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>ファイル<br />（ファイル名のタイムスタンプは異なります）</td></tr>
  <tr><td>app/models/comment.rb</td><td><code>Comment</code>モデルを記述するファイル</td></tr>
  <tr><td>test/models/comment_test.rb</td><td><code>Comment</code>モデルのテストを記述するファイル</td></tr>
  <tr><td>test/fixtures/comments.yml</td><td>テストで使用するサンプルの<code>Comment</code>オブジェクトを定義するファイル</td></tr>
</table></p><p>最初に、<code>app/models/comment.rb</code>のファイルの中身を確認しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">Comment</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  belongs_to <span class="synConstant">:post</span>
<span class="synPreProc">end</span>
</pre><p>このファイルは、<code>post.rb</code>ととてもよく似ています。主に違う点は、<code>belongs_to :post</code>列です。これは、Active Recordのアソシエーション（関連 or リレーション）を設定するためのものです。</p><p>ジェネレーターにより、モデルに加え、データベースのテーブルを作成する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>ファイルも作成されます。<code>db/migrate/20140811090504_create_comments.rb</code>の中身を確認しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">CreateComments</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Migration</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">change</span>
    create_table <span class="synConstant">:comments</span> <span class="synStatement">do</span> |<span class="synIdentifier">t</span>|
      t.string <span class="synConstant">:commenter</span>
      t.text <span class="synConstant">:body</span>
      t.references <span class="synConstant">:post</span>, <span class="synConstant">index</span>: <span class="synConstant">true</span>

      t.timestamps
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>
<span class="synPreProc">end</span>
</pre><p><code>create_table :comments</code>が<code>comments</code>テーブルを作成ことを意味しており、その内部のブロックで<code>comments</code>テーブルのカラムを作成しています。<br />
<code>t.string :commenter</code>はString型の<code>commenter</code>というカラムを作成するという意味です。<br />
次の行も同じです。<br />
<code>t.references</code>行は「外部キー」定義しています。加えて、<code>index: true</code>オプションによりその外部キーをインデックスにしています。<br />
<code>t.timestamps</code>は、レコードの作成日付(created_at)と更新日付(updated_at)を保持するカラムを作成します（Active Recordにより自動的に値が更新されるので、私たちが直接値を操作する必要はありません。作成順や更新順などにデータを表示したい場合などにソートで使ったりします。）</p><p>では、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>を実施しましょう。</p>
<pre class="code" data-lang="" data-unlink>$ rake db:migrate</pre><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>は既にデータベースに適用済みの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>ファイルは実行しません。（<code>posts</code>テーブルを作成する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>は実行されない）<br />
そのため、次のように<code>comments</code>テーブルを作成する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DE%A5%A4%A5%B0%A5%EC%A1%BC%A5%B7%A5%E7%A5%F3">マイグレーション</a>ファイルのみ実行されたます。</p>
<pre class="code" data-lang="" data-unlink>== 20140811090504 CreateComments: migrating ===================================
-- create_table(:comments)
   -&gt; 0.0054s
== 20140811090504 CreateComments: migrated (0.0055s) ==========================</pre>
</div>
<div class="section">
    <h4>5.2. モデル間に関連づける</h4>
    <p>Active Recordアソシエーションはモデル間の関連を簡単に定義することができます。<br />
今回の<code>Comment</code>モデルと<code>Post</code>モデルの場合、次のようにモデル間の関係を考えることができます。</p>

<ul>
<li>Each comment <b>belongs to</b> one post.（各々の<code>comment</code>は、１つの<code>post</code>に属する）</li>
<li>One post can <b>have many</b> comments.（１つの<code>post</code>は、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CA%A3%BF%F4">複数</a>の<code>comments</code>を持てる）</li>
</ul><p>つまり、PostとCommentは「1対多関係」になっています。</p><p>この英語の書き方は、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>でのアソシエーションの定義の仕方にとても似ています。<br />
<code>Comment</code>モデル(<code>app/models/comment.rb</code>)で先ほど確認したアソシエーションの定義は、「comment belongs to a post」と読めます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">Comment</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  belongs_to <span class="synConstant">:post</span>
<span class="synPreProc">end</span>
</pre><p><code>Post</code>モデル(<code>app/models/post.rb</code>)側にアソシエーションを定義しましょう。<br />
こちらは、「post has many comments」と読めます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">Post</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  has_many <span class="synConstant">:comments</span>

  validates <span class="synConstant">:title</span>, <span class="synConstant">presence</span>: <span class="synConstant">true</span>, <span class="synConstant">length</span>: { <span class="synConstant">minimum</span>: <span class="synConstant">5</span> }
<span class="synPreProc">end</span>
</pre><p>この２つの宣言を追加することで、それぞれのモデルクラスは自動的にモデル間のアソシエーションを認識します。<br />
例えば、<code>@post</code>という<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%B9%A5%BF%A5%F3%A5%B9">インスタンス</a>変数に<code>Post</code>オブジェクトが設定されているとします。そのときに、<code>@post.comments</code>にアクセスすることにより、その<code>Post</code>オブジェクトに関連づく全ての<code>Comment</code>オブジェクトにアクセスできます。</p><p><i>Active Recordのアソシエーションについてより詳しく知りたい場合は、「<a href="../20140810/1407617435.html" target="_blank">Railsのアソシエーションの作成方法</a>」や「<a href="http://guides.rubyonrails.org/association_basics.html" target="_blank">Rails Guides- Active Record Association</a>」を参照して下さい。</i></p><br />
<p></p>

</div>
<div class="section">
    <h4>5.3. Commentモデルにルートを追加する</h4>
    <p>他のコントローラーと同じように、<code>Comment</code>用にもルートを追加する必要があります。<br />
<code>config/routes.rb</code>ファイルを開き、次のように修正して下さい。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>resources <span class="synConstant">:posts</span> <span class="synStatement">do</span>
  resources <span class="synConstant">:comments</span>
<span class="synStatement">end</span>
</pre><p>今回追加した<code>comments</code>は<code>posts</code>にネストされています。これは、「投稿」と「コメント」の間に意味的に存在する階層構造を表しています。「コメント」はコメント単体では存在せず、「投稿」に紐づいて「コメント」が存在するためです。</p><p>これを説明するために、現在のルートを表示してみましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>$ rake routes
           <span class="synType">Prefix</span> <span class="synType">Verb</span>   <span class="synType">URI</span> <span class="synType">Pattern</span>                                 <span class="synType">Controller</span><span class="synComment">#Action</span>
    post_comments <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:post_id</span>/comments(.<span class="synConstant">:format</span>)          comments<span class="synComment">#index</span>
                  <span class="synType">POST</span>   <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:post_id</span>/comments(.<span class="synConstant">:format</span>)          comments<span class="synComment">#create</span>
 new_post_comment <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:post_id</span>/comments/new(.<span class="synConstant">:format</span>)      comments<span class="synComment">#new</span>
edit_post_comment <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:post_id</span>/comments/<span class="synConstant">:id</span>/edit(.<span class="synConstant">:format</span>) comments<span class="synComment">#edit</span>
     post_comment <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:post_id</span>/comments/<span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)      comments<span class="synComment">#show</span>
                  <span class="synType">PATCH</span>  <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:post_id</span>/comments/<span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)      comments<span class="synComment">#update</span>
                  <span class="synType">PUT</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:post_id</span>/comments/<span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)      comments<span class="synComment">#update</span>
                  <span class="synType">DELETE</span> <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:post_id</span>/comments/<span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)      comments<span class="synComment">#destroy</span>
            posts <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">(.</span><span class="synConstant">:format</span><span class="synSpecial">)</span><span class="synConstant">                            posts#index</span>
<span class="synConstant">                  POST   </span><span class="synSpecial">/</span>posts(.<span class="synConstant">:format</span>)                            posts<span class="synComment">#create</span>
         new_post <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/ne</span>w(.<span class="synConstant">:format</span>)                        posts<span class="synComment">#new</span>
        edit_post <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:id</span>/edit(.<span class="synConstant">:format</span>)                   posts<span class="synComment">#edit</span>
             post <span class="synType">GET</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)                        posts<span class="synComment">#show</span>
                  <span class="synType">PATCH</span>  <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)                        posts<span class="synComment">#update</span>
                  <span class="synType">PUT</span>    <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)                        posts<span class="synComment">#update</span>
                  <span class="synType">DELETE</span> <span class="synSpecial">/</span><span class="synConstant">posts</span><span class="synSpecial">/</span><span class="synConstant">:id</span>(.<span class="synConstant">:format</span>)                        posts<span class="synComment">#destroy</span>
             root <span class="synType">GET</span>    /                                           welcome<span class="synComment">#index</span>
</pre><p>上の方のルートは<code>comments</code>と入っているURLがあります。<br />
しかし、<code>posts/:post_id/comments ...</code>となっています。<br />
これは今まさに説明した通り、「コメント」にアクセスするためには「投稿」がないと作成や更新、表示などができないことを表しています。</p><p><i>※「<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>のルーティング」についてより詳細に知りたい場合は、<br />
「<a href="../20140716/1405451238.html" target="_blank">Railsのルーティングメモ</a>」や「<a href="http://guides.rubyonrails.org/routing.html" target="_blank">Rails Guides - Rails Routing</a>」を参照して下さい。</i><br />
</p>

</div>
<div class="section">
    <h4>5.4. コントローラーを生成する</h4>
    <p>モデルを作成したので、次はコントローラーを作成していきましょう。毎度のことですが、コントローラーを生成するときも「ジェネレーター」を使います。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>$ rails generate controller <span class="synType">Comments</span>
</pre><p>このコマンドで、以下の6つのファイルと１つの空ディレクトリが作成されます。<table class="table striped">
  <tr><th>ファイル</th><th>目的</th></tr>

  <tr><td>app/controllers/comments_controller.rb</td><td>CommentsControllerを実装するファイル</td></tr>
  <tr><td>app/views/comments/</td><td>このディレクトリ内にCommentsのビューファイルを配置する</td></tr>
  <tr><td>test/controllers/comments_controller_test.rb</td><td>CommentsConntrolerのテストを記述するファイル</td></tr>
  <tr><td>app/helpers/comments_helper.rb</td><td>Commentsビューのヘルパーファイル</td></tr>
  <tr><td>test/helpers/comments_helper_test.rb</td><td>Commentsビューのヘルパーのテスト用ファイル</td></tr>
  <tr><td>app/assets/javascripts/comments.js.coffee</td><td>Commentsの<a class="keyword" href="http://d.hatena.ne.jp/keyword/CoffeeScript">CoffeeScript</a>を記述する</td></tr>
  <tr><td>app/assets/stylesheets/comments.<a class="keyword" href="http://d.hatena.ne.jp/keyword/css">css</a>.scss</td><td>CommentsのScss(<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%BF%A5%A4%A5%EB%A5%B7%A1%BC%A5%C8">スタイルシート</a>)を記述する</td></tr>
</table></p><p>一般的なブログでは、「投稿記事」を読んだ最後に「コメント」を記載します。そして、一度「コメント」が記載されると、「投稿記事」の詳細画面(<code>show.html.erb</code>)でその「コメント」が一覧表示されます。</p><p>この挙動を実現するために、<code>CommentsController</code>では、コメントを作成する<code>create</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>とスパムコメントを削除する<code>destroy</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を定義します。</p><p>最初に、投稿の詳細画面(<code>app/views/posts/show.html.erb</code>)にコメントを表示するように修正しましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>タイトル：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @post.title</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>内容：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @post.text</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

<span class="synComment">&lt;!-- 追加箇所 開始 --&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>コメントを追加<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> form_for(</span><span class="synIdentifier"> [@post, @post.comments.build] ) do |f| %&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :commenter, </span><span class="synConstant">&quot;コメンター&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_field</span><span class="synIdentifier"> :commenter %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :body, </span><span class="synConstant">&quot;コメント&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_area</span><span class="synIdentifier"> :body, </span><span class="synType">cols</span><span class="synIdentifier">: 60, </span><span class="synType">rows</span><span class="synIdentifier">: 8 %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.submit,</span><span class="synIdentifier"> </span><span class="synConstant">&quot;コメント投稿&quot;</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;% end %&gt;</span>
<span class="synComment">&lt;!-- 追加箇所 終了 --&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'戻る'</span><span class="synIdentifier">, posts_path %&gt;</span>
| <span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'編集'</span><span class="synIdentifier">, edit_post_path(@post) %&gt;</span>
</pre><p>ここでは、コメントを記載できるフォームを追加しました。<br />
ここでの<code>form_for</code>では配列を使っています。これは、ネストされたルートを作成します。例えば、<code>/posts/1/comments</code>のようなルートを作成します。<code>config/routes.rb</code>でURLをネストしたため、<code>form_for</code>でもルートをネストさせる必要があったのです。</p><p><code>app/controllers/comments_controller.rb</code>に<code>create</code>アクションを追加しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">CommentsController</span> &lt; <span class="synType">ApplicationController</span>
  <span class="synComment"># POST /posts/:post_id/comments</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">create</span>
    <span class="synIdentifier">@post</span> = <span class="synType">Post</span>.find(params[<span class="synConstant">:post_id</span>])
    <span class="synIdentifier">@comment</span> = <span class="synIdentifier">@post</span>.comments.create(comment_params)

    redirect_to post_path(<span class="synIdentifier">@post</span>)
  <span class="synPreProc">end</span>

  <span class="synStatement">private</span>
    <span class="synPreProc">def</span> <span class="synIdentifier">comment_params</span>
      params.require(<span class="synConstant">:comment</span>).permit(<span class="synConstant">:commenter</span>, <span class="synConstant">:body</span>)
    <span class="synPreProc">end</span>
<span class="synPreProc">end</span>
</pre><p>今までのコントローラーより少しだけ複雑に見えるかもしれません。私たちが設定したネストの影響です。<br />
「コメント」へのリクエストには、その「コメント」に関連している「投稿」の情報が必要になります。そのため、最初の行で<code>Post.find</code>で「コメント」に関連する「投稿」を取得しています。</p><p>さらに、このコードではアソシエーションを定義したことによって利用可能になった<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を使っています。<br />
<code>@post.comments.create</code>は「コメント」を作成し、データベースに保存しています。これは、自動的に「コメント」と「投稿」の間でアソシエーションを追加（外部キーの設定）してくれます。</p><p>新しい「コメント」を作成すると、ユーザーは<code>post_path(@post)</code>ヘルパーによって投稿の詳細画面にリダイレクトされます。リダイレクトされたパスにより、<code>PostsController</code>の<code>show</code>アクションが呼び出されます。<code>show</code>アクション内では、<code>show.html.erb</code>テンプレートを<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%C0%A5%EA%A5%F3%A5%B0">レンダリング</a>します。</p><p>では、「コメント」の表示を「投稿」の詳細画面(<code>app/views/posts/show.html.erb</code>)に追加しましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>タイトル：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @post.title</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>内容：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> simple_format</span><span class="synIdentifier"> @post.</span><span class="synType">text</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

<span class="synComment">&lt;!-- 追加箇所 開始 --&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>コメント<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;% @post.comments.each do |comment| %&gt;</span>
  
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>コメンター：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> comment.commenter</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
   
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>コメント：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> simple_format</span><span class="synIdentifier"> comment.body %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;% end %&gt;</span>
<span class="synComment">&lt;!-- 追加箇所 終了 --&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>コメントを追加<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> form_for(</span><span class="synIdentifier"> [@post, @post.comments.build] ) do |f| %&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :commenter, </span><span class="synConstant">&quot;コメンター&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_field</span><span class="synIdentifier"> :commenter %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :body, </span><span class="synConstant">&quot;コメント&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_area</span><span class="synIdentifier"> :body, </span><span class="synType">cols</span><span class="synIdentifier">: 60, </span><span class="synType">rows</span><span class="synIdentifier">: 8 %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.submit,</span><span class="synIdentifier"> </span><span class="synConstant">&quot;コメント投稿&quot;</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;% end %&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'戻る'</span><span class="synIdentifier">, posts_path %&gt;</span>
| <span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'編集'</span><span class="synIdentifier">, edit_post_path(@post) %&gt;</span>
</pre><p><code>simple_format</code>ヘルパー<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を使っています。これは、改行などを認識して表示する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>です。</p><p>さて、ブラウザを開いて、投稿にコメントを追加しましょう。次のように表示されるでしょう。<br />
 <span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813144316.png" alt="f:id:nipe880324:20140813144316p:plain:w480" title="f:id:nipe880324:20140813144316p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<p><h3 id="refactoring">6. <a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%D5%A5%A1%A5%AF%A5%BF%A5%EA%A5%F3%A5%B0">リファクタリング</a></h3>さてさて、今のところ私たちは投稿とコメント機能が実装できました。しかし、ちらっと <code>app/views/posts/show.html.erb</code>を見てください。<br />
少し<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>が長く、汚くないでしょうか。綺麗にするために部分テンプレート（パーシャル）を使って<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%D5%A5%A1%A5%AF%A5%BF%A5%EA%A5%F3%A5%B0">リファクタリング</a>しましょう。</p>

</div>
<div class="section">
    <h4>6.1. 部分テンプレートでコレクションを<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%C0%A5%EA%A5%F3%A5%B0">レンダリング</a>する</h4>
    <p>最初に、投稿の全てのコメントを表示するために部分テンプレートを作成します。<code>app/views/comments/_comment.html.erb</code>を新規に作成して、次の記述を追記して下さい。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>コメンター：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> comment.commenter</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>コメント：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> simple_format</span><span class="synIdentifier"> comment.body %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
</pre><p>次は、<code>app/views/posts/show.html.erb </code>を修正して下さい。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>タイトル：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @post.title</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>内容：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @post.text</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>コメント<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
<span class="synComment">&lt;!-- 修正箇所 開始 --&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> render</span><span class="synIdentifier"> @post.comments %&gt;</span>
<span class="synComment">&lt;!-- 修正箇所 終了 --&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>コメントを追加<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> form_for(</span><span class="synIdentifier"> [@post, @post.comments.build] ) do |f| %&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :commenter, </span><span class="synConstant">&quot;コメンター&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_field</span><span class="synIdentifier"> :commenter %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :body, </span><span class="synConstant">&quot;コメント&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_area</span><span class="synIdentifier"> :body, </span><span class="synType">cols</span><span class="synIdentifier">: 60, </span><span class="synType">rows</span><span class="synIdentifier">: 8 %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.submit</span><span class="synIdentifier"> </span><span class="synConstant">&quot;コメント投稿&quot;</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;% end %&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'戻る'</span><span class="synIdentifier">, posts_path %&gt;</span>
| <span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'編集'</span><span class="synIdentifier">, edit_post_path(@post) %&gt;</span>
</pre><p><code>render @post.comments</code>により、<code>@post.comments</code>コレクションのそれぞれのコメントで部分テンプレートの<code>app/views/comments/_comment.html.erb</code>を<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%C0%A5%EA%A5%F3%A5%B0">レンダリング</a>します。<br />
<code>render</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>はコレクションを１つ１つ処理し、そして、それぞれのコメントを「部分テンプレートと同じ名前のローカル変数」に割り当てます。<br />
今回の場合で言うと、部分テンプレート内では、<code>comment</code>という名のローカル変数が使えます。</p>

</div>
<div class="section">
    <h4>7.2. 部分テンプレートでフォームを<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%C0%A5%EA%A5%F3%A5%B0">レンダリング</a>する</h4>
    <p>コメントを追加する箇所の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>を部分テンプレートにしていきましょう。<br />
<code>app/views/comments/_form.html.erb</code>を新規作成します。<br />
（<code>app/views/comments/_comment.html.erb</code>から<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>から部分テンプレートに置き換える箇所をコピーすると簡単です。）</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;%=</span><span class="synConstant"> form_for(</span><span class="synIdentifier"> [@post, @post.comments.build] ) do |f| %&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :commenter, </span><span class="synConstant">&quot;コメンター&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_field</span><span class="synIdentifier"> :commenter %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :body, </span><span class="synConstant">&quot;コメント&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_area</span><span class="synIdentifier"> :body, </span><span class="synType">cols</span><span class="synIdentifier">: 60, </span><span class="synType">rows</span><span class="synIdentifier">: 8 %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.submit</span><span class="synIdentifier"> </span><span class="synConstant">&quot;コメント投稿&quot;</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;% end %&gt;</span>
</pre><p>そして、<code>app/views/posts/show.html.erb</code>を次のように修正します。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>タイトル：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @post.title</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>内容：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @post.text</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>コメント<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> render</span><span class="synIdentifier"> @post.comments %&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>コメントを追加<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
<span class="synComment">&lt;!-- 修正箇所 開始 --&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> render</span><span class="synIdentifier"> </span><span class="synConstant">&quot;comments/form&quot;</span><span class="synIdentifier"> %&gt;</span>
<span class="synComment">&lt;!-- 修正箇所 終了 --&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'戻る'</span><span class="synIdentifier">, posts_path %&gt;</span>
| <span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'編集'</span><span class="synIdentifier">, edit_post_path(@post) %&gt;</span>
</pre><p>二つ目の<code>render</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>では、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%C0%A5%EA%A5%F3%A5%B0">レンダリング</a>したい部分テンプレート<code>comments/form</code>として指定しました。<code>render</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>の引数が文字列で、その中にスラッシュ(/)が存在する場合、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>は<code>app/views/</code>配下からのパスとして部分テンプレートを探します。<br />
そのため、今回の場合は、<code>comments/form</code>を指定することで、<code>app/views/comments/_form.html.erb</code>が<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%C0%A5%EA%A5%F3%A5%B0">レンダリング</a>されました。</p><p><code>@post</code>という<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%B9%A5%BF%A5%F3%A5%B9">インスタンス</a>変数はどの部分テンプレートでも使うことが可能です。なぜならば、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%B9%A5%BF%A5%F3%A5%B9">インスタンス</a>変数として定義されているからです。</p><p>では、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%D5%A5%A1%A5%AF%A5%BF%A5%EA%A5%F3%A5%B0">リファクタリング</a>後の投稿の詳細画面を表示してみましょう。表示は変わってないですね。<br />
（<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%D5%A5%A1%A5%AF%A5%BF%A5%EA%A5%F3%A5%B0">リファクタリング</a>をしただけなので、いいことです :D）<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813144316.png" alt="f:id:nipe880324:20140813144316p:plain:w480" title="f:id:nipe880324:20140813144316p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<br />
<p><h3 id="deleting-comments">7. コメントを削除する</h3>ブログアプリケーションにおいて、スパムコメントを消せることは重要な機能でしょう。<br />
それを実現するために、</p>

<ul>
<li>スパムコメントを削除する<code>CommentsController</code>の<code>destroy</code>アクション</li>
<li>ビュー内にその<code>destroy</code>アクションを呼び出すリンク</li>
</ul><p>を追加していきます。</p>

</div>
<div class="section">
    <h4>7.1. コメント削除リンクとdestroyアクションを追加する</h4>
    <p>まずは、<code>app/views/comments/_comment.html.erb</code>パーシャルに削除リンクを追加しましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>コメンター：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> comment.commenter</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
 
<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>コメント：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> comment.body</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

<span class="synComment">&lt;!-- 追加箇所 開始 --&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'コメント削除'</span><span class="synIdentifier">, [comment.post, comment],</span>
<span class="synIdentifier">              </span><span class="synType">method</span><span class="synIdentifier">: :delete, </span><span class="synType">data</span><span class="synIdentifier">: { confirm: </span><span class="synConstant">'削除しますか？'</span><span class="synIdentifier"> } %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
<span class="synComment">&lt;!-- 追加箇所 終了 --&gt;</span>
</pre><p>このリンクをクリックすると、サーバーに<code>DELETE /posts/:post_id/comments/:id</code>がリクエストされるので、<code>CommentsController</code>の<code>destroy</code>アクションが呼ばれます。</p><p>では、<code>app/controllers/comments_controller.rb</code>に<code>destroy</code>アクションを追加しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># DELETE /posts/:post_id/comments/:id</span>
<span class="synPreProc">def</span> <span class="synIdentifier">destroy</span>
  <span class="synIdentifier">@post</span> = <span class="synType">Post</span>.find(params[<span class="synConstant">:post_id</span>])
  <span class="synIdentifier">@comment</span> = <span class="synIdentifier">@post</span>.comments.find(params[<span class="synConstant">:id</span>])
  <span class="synIdentifier">@comment</span>.destroy

  redirect_to post_path(<span class="synIdentifier">@post</span>)
<span class="synPreProc">end</span>
</pre><p><code>destory</code>アクションは、<code>@post.comments</code>コレクション内の「コメント」を探し出し、データベースから削除しています。そして、「投稿記事」の詳細画面にリダイレクトしています。</p>

</div>
<div class="section">
    <h4>7.2. アソシエーションで関連したオブジェクトを削除する</h4>
    <p>もし「投稿記事(post)」を削除した場合、それに関連づいている「コメント(comment)」も削除されるべきです。そうしなければ、データベースにゴミデータが残ってしまうからです。<br />
<code>dependent</code>オプションを使うことでこれをとっても簡単に実現することができます。<br />
<code>Post</code>モデル(app/models/post.rb)に<code>dependent</code>オプションを追加しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">Post</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  has_many <span class="synConstant">:comments</span>, <span class="synConstant">dependent</span>: <span class="synConstant">:destroy</span>

  validates <span class="synConstant">:title</span>, <span class="synConstant">presence</span>: <span class="synConstant">true</span>, <span class="synConstant">length</span>: { <span class="synConstant">minimum</span>: <span class="synConstant">5</span> }
<span class="synPreProc">end</span>
</pre><p>これで、<code>@post.destory</code>で「投稿」を削除すると、その「投稿」に関連づいた「コメント」も<code>自動的</code>に一緒に削除されます。</p><br />
<br />
<p><h3 id="security">8. HTTP認証を追加する</h3>もしこのブログをオンラインに公開したい場合、他の誰か知らない人が投稿を追加、編集、削除してしまうかもしれません。<br />
このような場合のために、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>はとても簡単なHTTP認証システムを提供しています。</p><p><i>※本格的に認証する場合は<code>devise</code>という認証用のgemを使うことをお勧めします。<code>devise</code>は、ログイン画面やユーザ登録など一般的な認証システムを提供してくれます。<code>devise</code>の導入方法やカスタマイズは、<a href="../20140801/1406907000.html" target="_blank">deviseの導入</a>を参照して下さい。</i></p><p><code>http_basic_authenticate_with</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を使うことで、特定のコントローラーのアクションの実施に認証が必要となります。<br />
PostsController(<code>app/controllers/posts_controller.rb</code>)の上部に<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を追加しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">PostsController</span> &lt; <span class="synType">ApplicationController</span>

  http_basic_authenticate_with <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">user</span><span class="synSpecial">&quot;</span>, <span class="synConstant">password</span>: <span class="synSpecial">&quot;</span><span class="synConstant">secret</span><span class="synSpecial">&quot;</span>, <span class="synConstant">except</span>: [<span class="synConstant">:index</span>, <span class="synConstant">:show</span>]

  ...
  ...
</pre><p>今回の場合は、<code>index</code>と<code>show</code>アクション以外のアクション(new, create, edit, update, destroy)にHTTP認証が必要になります。<br />
認証時のユーザ名とパスワードは、"user" と "password" です。</p><p>また、認証されたユーザーがコメントを削除するようにしたいので、CommentsController(<code>app/controllers/comments_controller.rb</code>)にも同じように追加しましょう。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">class</span> <span class="synType">CommentsController</span> &lt; <span class="synType">ApplicationController</span>

  http_basic_authenticate_with <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">user</span><span class="synSpecial">&quot;</span>, <span class="synConstant">password</span>: <span class="synSpecial">&quot;</span><span class="synConstant">secret</span><span class="synSpecial">&quot;</span>, <span class="synConstant">only</span>: <span class="synConstant">:destroy</span>

  ...
  ...
</pre><p>上記を記載することで、<code>CommentsController</code>の<code>destroy</code>アクションだけ認証が必要になります。</p><p>さて、投稿の一覧画面(<code>http://localhost:3000/posts</code>)で新規の投稿を作成するために「新しい投稿」リンクを押すと、HTTP認証のダイアログが表示されます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813150152.png" alt="f:id:nipe880324:20140813150152p:plain:w480" title="f:id:nipe880324:20140813150152p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p><h3 id="styling">9. 画面のスタイリングをする</h3>ここまでブログの一通りの機能を実装することができました。</p>

<ul>
<li>投稿の一覧表示、作成、更新、詳細表示、削除ができます。</li>
<li>投稿に対してコメントの作成と削除ができます。</li>
<li>さらに、認証に成功したユーザのみ上記の特定の操作ができます。</li>
</ul><p><br /><br />
ここからは、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a> Guidesには乗っていない、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>での画面のスタイリング方法や<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>の使い方を説明していきます。</p><p>まずは、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>でのスタイリングです。<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%BF%A5%A4%A5%EB%A5%B7%A1%BC%A5%C8">スタイルシート</a>は、<code>app/stylesheets/</code>配下に配置します。<br />
デフォルトでは、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B3%C8%C4%A5%BB%D2">拡張子</a>は<code>css.scss</code>となっています。<br />
<code>.scss</code>は<code>Scss</code>という「<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>により<a class="keyword" href="http://d.hatena.ne.jp/keyword/CSS">CSS</a>を出力する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BF%B8%C0%B8%EC">メタ言語</a>」を表しています。</p><p><i> <code>Scss</code>は見た目はほとんど<a class="keyword" href="http://d.hatena.ne.jp/keyword/CSS">CSS</a>と同じです。実際に<a class="keyword" href="http://d.hatena.ne.jp/keyword/CSS">CSS</a>で記載しても動きます。しかし、主な機能としては、「変数が使える」「ネストが使える」「Mixinができる」「<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BB%A5%EC%A5%AF%A5%BF">セレクタ</a>の継承ができる」などあります。そして、それらの機能により<b><a class="keyword" href="http://d.hatena.ne.jp/keyword/CSS">CSS</a>で書くよりもより生産性や保守性が向上する</b>ことが期待できます。</i></p><p>ここでは、<code>Scss</code>の記載内容について細かく説明しません。<br />
どちらかというと、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>ではどうやってスタイリングファイルが指定され、どのような流れで<code>Scss</code>を記載していくかということを説明します。</p>

</div>
<div class="section">
    <h4>9.1. <a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%BF%A5%A4%A5%EB%A5%B7%A1%BC%A5%C8">スタイルシート</a>の読み込み</h4>
    <p><code>app/views/layouts/application.html.erb</code>というファイルを開いてみて下さい。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synComment">&lt;!DOCTYPE html&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">html</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">head</span><span class="synIdentifier">&gt;</span>
<span class="synPreProc">  </span><span class="synIdentifier">&lt;</span><span class="synStatement">title</span><span class="synIdentifier">&gt;</span>Blog<span class="synIdentifier">&lt;/</span><span class="synStatement">title</span><span class="synIdentifier">&gt;</span>
<span class="synPreProc">  </span><span class="synIdentifier">&lt;%=</span><span class="synConstant"> stylesheet_link_tag</span><span class="synIdentifier">    </span><span class="synConstant">'application'</span><span class="synIdentifier">, </span><span class="synType">media</span><span class="synIdentifier">: </span><span class="synConstant">'all'</span><span class="synIdentifier">, </span><span class="synConstant">'data-turbolinks-track'</span><span class="synIdentifier"> =&gt;</span><span class="synPreProc"> true %&gt;</span>
<span class="synPreProc">  </span><span class="synIdentifier">&lt;%=</span><span class="synConstant"> javascript_include_tag</span><span class="synIdentifier"> </span><span class="synConstant">'application'</span><span class="synIdentifier">, </span><span class="synConstant">'data-turbolinks-track'</span><span class="synIdentifier"> =&gt;</span><span class="synPreProc"> true %&gt;</span>
<span class="synPreProc">  </span><span class="synIdentifier">&lt;%=</span><span class="synConstant"> csrf_meta_tags</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">head</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">body</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> yield</span><span class="synIdentifier"> %&gt;</span>

<span class="synIdentifier">&lt;/</span><span class="synStatement">body</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">html</span><span class="synIdentifier">&gt;</span>
</pre><p>HTMLのドキュメント定義や<code>head</code>タグや<code>body</code>タグが記載されていることがわかると思います。<br />
このファイルは、今まで表示してきたテンプレートファイル(new.html.erbなど)の外側の枠組みとなるファイルです。テンプレートファイルの内容は、<code><%= yield %></code>の箇所に表示されます。<br />
そのため、このファイルを修正することにより、2段カラムなどのレイアウトをWebアプリケーション全ての画面に適用することができます。</p><p>さて、<code>head</code>タグ内の<code>stylesheet_link_tag</code>と記載されている行を確認して下さい。<br />
これは、<code>app/assets/stylesheets/application.css</code>をインクルードすることを意味しています。<br />
そして、<code>application.css</code>内では、<code>app/assets/stylesheets/</code>配下の全てのファイルをインクルードするように指定されています。<br />
そのため、この章の最初で述べたように、「<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%BF%A5%A4%A5%EB%A5%B7%A1%BC%A5%C8">スタイルシート</a>は、<code>app/stylesheets/</code>配下に配置」する必要があります。</p>

</div>
<div class="section">
    <h4>9.2. アプリケーション全体のスタイリングをする</h4>
    <p>今回スタイリングした結果のイメージは次のようになります。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813153533.png" alt="f:id:nipe880324:20140813153533p:plain:w480" title="f:id:nipe880324:20140813153533p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><p>まずアプリケーション全体のスタイリング（レイアウト作成）をしていきましょう。<br />
アプリケーション全体なので<code>app/views/layouts/application.html.erb</code>を修正します。<code>header</code>タグで「ヘッダー部分」と<code>&lt;div id="main"&gt;</code>タグで「コンテンツ部分」に分けてみました。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synComment">&lt;!DOCTYPE html&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">html</span><span class="synIdentifier"> ja=</span><span class="synConstant">&quot;ja&quot;</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">head</span><span class="synIdentifier">&gt;</span>
<span class="synPreProc">  </span><span class="synIdentifier">&lt;</span><span class="synStatement">meta</span><span class="synIdentifier"> </span><span class="synType">charset</span><span class="synIdentifier">=</span><span class="synConstant">&quot;utf-8&quot;</span><span class="synIdentifier"> /&gt;</span>
<span class="synPreProc">  </span><span class="synIdentifier">&lt;</span><span class="synStatement">title</span><span class="synIdentifier">&gt;</span>Blog<span class="synIdentifier">&lt;/</span><span class="synStatement">title</span><span class="synIdentifier">&gt;</span>
<span class="synPreProc">  </span><span class="synIdentifier">&lt;%=</span><span class="synConstant"> stylesheet_link_tag</span><span class="synIdentifier">    </span><span class="synConstant">'application'</span><span class="synIdentifier">, </span><span class="synType">media</span><span class="synIdentifier">: </span><span class="synConstant">'all'</span><span class="synIdentifier">, </span><span class="synConstant">'data-turbolinks-track'</span><span class="synIdentifier"> =&gt;</span><span class="synPreProc"> true %&gt;</span>
<span class="synPreProc">  </span><span class="synIdentifier">&lt;%=</span><span class="synConstant"> javascript_include_tag</span><span class="synIdentifier"> </span><span class="synConstant">'application'</span><span class="synIdentifier">, </span><span class="synConstant">'data-turbolinks-track'</span><span class="synIdentifier"> =&gt;</span><span class="synPreProc"> true %&gt;</span>
<span class="synPreProc">  </span><span class="synIdentifier">&lt;%=</span><span class="synConstant"> csrf_meta_tags</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">head</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">body</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">'&lt;%= controller.controller_name %&gt;'</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;wrap&quot;</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span>header<span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;header&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;inner&quot;</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;logo&quot;</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">&quot;Sample My Blog&quot;</span><span class="synIdentifier">, root_path %&gt;&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;catchcopy&quot;</span><span class="synIdentifier">&gt;</span>Description or something ....<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span><span class="synComment">&lt;!-- /.inner --&gt;</span>
  <span class="synIdentifier">&lt;/</span>header<span class="synIdentifier">&gt;</span><span class="synComment">&lt;!-- /#header --&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;main&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> yield</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span><span class="synComment">&lt;!-- /#main --&gt;</span>
  
<span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span><span class="synComment">&lt;!-- /#wrap --&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">body</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">html</span><span class="synIdentifier">&gt;</span>
</pre><p>その後、<code>Scss</code>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/CSS">CSS</a>を記述していきます。<br />
<code>app/assets/stylesheets/</code>配下を見て下さい。<br />
<code>application.css</code>、<code>comments.css.scss</code>、<code>posts.css.scss</code>などのファイルが存在すると思います。<code>application.css</code>については上部で既に説明したのでその他のファイルについて説明します。<br />
お気づきかもしれませんが、<code>posts.css.scss</code>のファイル名の先頭が「ビューのフォルダ名」と同じです。これは、投稿関連のビュー(<code>app/assets/posts/</code>配下のファイル)のスタイリングをする場合は、<code>posts.css.scss</code>を使うと、スタイリングのコードがどこに書かれているか分かりやすいのでよいです。</p><p><i>※上記の項目で説明しましたが、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>では<code>application.css</code>により全ての画面で<code>app/assets/stylesheets/</code>配下の全てのスタイリングシートを読み込むため、それぞれのファイルに分けて<a class="keyword" href="http://d.hatena.ne.jp/keyword/CSS">CSS</a>を書いた方がよいだけであり、一つのファイルに<a class="keyword" href="http://d.hatena.ne.jp/keyword/CSS">CSS</a>を動いても動きます。<br />
また、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>はビュー毎に読み込む<a class="keyword" href="http://d.hatena.ne.jp/keyword/CSS">CSS</a>を変えているわけではないので、<a class="keyword" href="http://d.hatena.ne.jp/keyword/CSS">CSS</a>ファイル間の<code>id</code>や<code>class</code>のスタイリングの競合に注意して下さい。</i></p><p>今回は、基本的な色やレイアウトを指定するファイルの<code>app/assets/stylesheets/common.css.scss</code>を作成し、次の内容を記載して下さい。<br />
（スタイリングの仕方の話になると本が書けてしまうので、コピーで大丈夫です）</p>
<pre class="code lang-css" data-lang="css" data-unlink>// カラー変数
$baseBlack:     #333;
$baseGray:      <span class="synIdentifier">#aaa</span>;
$baseLightGray: <span class="synIdentifier">#eee</span>;
$baseBlue:      #428bca;
$baseLightBlue: #5bc0de;

<span class="synComment">/*-----------------------------</span>

<span class="synComment">　リセットCSS + サイト共通設定</span>

<span class="synComment">------------------------------*/</span>
<span class="synStatement">body</span>,
<span class="synStatement">h1</span>,<span class="synStatement">h2</span>,<span class="synStatement">h3</span>,<span class="synStatement">h4</span>,<span class="synStatement">h5</span>,<span class="synStatement">h6</span>,
<span class="synStatement">p</span>,<span class="synStatement">ul</span>,<span class="synStatement">ol</span>,<span class="synStatement">dl</span>,<span class="synStatement">dt</span>,<span class="synStatement">dd</span>,<span class="synStatement">li</span>,
<span class="synStatement">table</span>,<span class="synStatement">th</span>,<span class="synStatement">td</span>,
<span class="synStatement">form</span>,<span class="synStatement">select</span>,<span class="synStatement">option</span>,<span class="synStatement">input</span>
<span class="synStatement">address</span>,<span class="synStatement">pre</span>,<span class="synStatement">strong</span>,<span class="synStatement">em</span>,<span class="synStatement">iframe</span>,<span class="synStatement">img</span><span class="synIdentifier">{</span>
  <span class="synType">margin</span>:<span class="synConstant">0</span>;
  <span class="synType">padding</span>:<span class="synConstant">0</span>;
  <span class="synType">font-size</span>:<span class="synConstant">100%</span>;
  <span class="synType">border</span>:<span class="synConstant">0</span>;
<span class="synIdentifier">}</span>

<span class="synComment">/* デフォルト文字設定 */</span>
<span class="synStatement">html</span> <span class="synIdentifier">{</span>
  <span class="synType">height</span>: <span class="synConstant">100%</span>;
<span class="synIdentifier">}</span>

<span class="synStatement">body</span> <span class="synIdentifier">{</span>
  <span class="synType">height</span>: <span class="synConstant">100%</span>;

  <span class="synType">color</span>: $baseBlack;
  <span class="synType">font-family</span>: <span class="synConstant">&quot;Gotham Narrow SSm&quot;</span>,Arial,<span class="synConstant">&quot;ヒラギノ角ゴ Pro W3&quot;</span>,<span class="synConstant">&quot;Hiragino Kaku Gothic Pro&quot;</span>,Osaka,<span class="synConstant">&quot;メイリオ&quot;</span>,Meiryo,<span class="synConstant">&quot;ＭＳ Ｐゴシック&quot;</span>,<span class="synConstant">&quot;MS PGothic&quot;</span>,<span class="synType">sans-serif</span>;
  <span class="synType">font-size</span>: <span class="synConstant">14px</span>;
  <span class="synType">line-height</span>: <span class="synConstant">1.4</span>;
<span class="synIdentifier">}</span>


<span class="synComment">/* リストのマーカーを非表示 */</span>
<span class="synStatement">ul</span>, <span class="synStatement">ol</span> <span class="synIdentifier">{</span>
  <span class="synType">list-style-type</span>:<span class="synType">none</span>;
<span class="synIdentifier">}</span>

<span class="synComment">/* デフォルトリンク色の設定 */</span>
<span class="synStatement">a</span>,
<span class="synStatement">a</span>:-webkit-any-<span class="synPreProc">link</span> <span class="synIdentifier">{</span>
  <span class="synType">text-decoration</span>: <span class="synType">none</span>;

  <span class="synType">color</span>: $baseGray;

  &amp;:hover {
    <span class="synType">color</span>: $baseLightBlue;
  <span class="synIdentifier">}</span>
<span class="synError">}</span>


<span class="synComment">/*--------------------------</span>

<span class="synComment">　レイアウト</span>

<span class="synComment">---------------------------*/</span>
<span class="synStatement">body</span> <span class="synIdentifier">{</span>
  <span class="synType">border-top</span>: $baseGray <span class="synConstant">1px</span> <span class="synType">solid</span>;
<span class="synIdentifier">}</span>

<span class="synComment">/* ページ全体のラッパー</span>
<span class="synComment">---------------------------*/</span>
<span class="synIdentifier">#wrap</span> <span class="synIdentifier">{</span>
  <span class="synType">position</span>: <span class="synType">relative</span>;
  <span class="synType">width</span>: <span class="synConstant">100%</span>;
  <span class="synType">height</span>: <span class="synType">auto</span> <span class="synSpecial">!important</span>;
  <span class="synType">height</span>: <span class="synConstant">100%</span>;
  <span class="synType">min-height</span>: <span class="synConstant">100%</span>;

  <span class="synType">background-color</span>: $baseBlue;
<span class="synIdentifier">}</span>

<span class="synComment">/* ヘッダー</span>
<span class="synComment">---------------------------*/</span>
header <span class="synIdentifier">{</span>
  <span class="synType">border-bottom</span>: $baseGray <span class="synConstant">1px</span> <span class="synType">solid</span>;
  <span class="synType">background-color</span>: <span class="synConstant">white</span>;

  .inner {
    <span class="synType">width</span>: <span class="synConstant">800px</span>;
    <span class="synType">height</span>: <span class="synConstant">58px</span>;
    <span class="synType">margin</span>: <span class="synConstant">0</span> <span class="synType">auto</span>;
   
    #logo {
      <span class="synType">font-size</span>: <span class="synConstant">250%</span>;
      <span class="synType">text-decoration</span>: <span class="synType">none</span>;
    <span class="synIdentifier">}</span>

    <span class="synIdentifier">#catchcopy</span> <span class="synIdentifier">{</span>
      <span class="synType">color</span>: $baseGray;
      <span class="synType">font-size</span>: <span class="synConstant">90%</span>;
      <span class="synType">position</span>: <span class="synType">relative</span>;
      <span class="synType">top</span>: <span class="synConstant">-10px</span>;
      <span class="synType">left</span>: <span class="synConstant">5px</span>;
    <span class="synIdentifier">}</span>
  <span class="synError">}</span>
<span class="synError">}</span>


<span class="synComment">/* メインコンテンツ</span>
<span class="synComment">---------------------------*/</span>
<span class="synIdentifier">#main</span> <span class="synIdentifier">{</span>
  <span class="synType">width</span>: <span class="synConstant">800px</span>;
  <span class="synType">height</span>: <span class="synConstant">100%</span>;

  <span class="synType">padding</span>: <span class="synConstant">10px</span>;

  <span class="synType">margin</span>: <span class="synConstant">30px</span> <span class="synType">auto</span>;

  <span class="synType">background-color</span>: <span class="synConstant">white</span>;
  <span class="synType">border</span>-radius: <span class="synConstant">5px</span>;


  h<span class="synConstant">1</span> {
    <span class="synType">font-size</span>: <span class="synConstant">200%</span>;
    <span class="synType">margin-bottom</span>: <span class="synConstant">20px</span>;
    <span class="synType">border-bottom</span>: <span class="synConstant">1px</span> <span class="synType">solid</span> $baseBlue;
  <span class="synIdentifier">}</span>
<span class="synError">}</span>


<span class="synComment">/*-----------------------------</span>

<span class="synComment">　共通コンポーネント</span>

<span class="synComment">------------------------------*/</span>
<span class="synStatement">input</span><span class="synSpecial">[</span>type<span class="synSpecial">=</span><span class="synConstant">&quot;text&quot;</span><span class="synSpecial">]</span>,
<span class="synStatement">textarea</span> <span class="synIdentifier">{</span>
  <span class="synType">border</span>-radius: <span class="synConstant">3px</span>;
  <span class="synType">border</span>: <span class="synConstant">1px</span> <span class="synType">solid</span> $baseGray; 
<span class="synIdentifier">}</span>
</pre><p><br />
では、画面を開き、スタイリングされていることを確認しましょう。<br />
もっさりした感じがなくなりましたね。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813153533.png" alt="f:id:nipe880324:20140813153533p:plain:w480" title="f:id:nipe880324:20140813153533p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span><br />
</p>

</div>
<div class="section">
    <h4>9.2. 投稿詳細画面のスタイリングをする</h4>
    <p>全体のスタイリングをしたので、ほとんど見た目はよくなりました。しかし、各メインコンテンツは各々スタイリングが必要です。<br />
今回は特に最もスタイリングが必要そうな投稿詳細画面(<code>app/views/posts/show.html.erb</code>)をスタイリングしていきます。</p><p>まず、<code>table</code>タグや<code>input</code>要素はアプリケーション全体で使う「共通<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%DD%A1%BC%A5%CD%A5%F3%A5%C8">コンポーネント</a>」のためcommonの一番下に追記します。</p>
<pre class="code lang-css" data-lang="css" data-unlink><span class="synComment">/*-----------------------------</span>

<span class="synComment">　共通コンポーネント</span>

<span class="synComment">------------------------------*/</span>
<span class="synStatement">input</span><span class="synSpecial">[</span>type<span class="synSpecial">=</span><span class="synConstant">&quot;text&quot;</span><span class="synSpecial">]</span>,
<span class="synStatement">textarea</span> <span class="synIdentifier">{</span>
  <span class="synType">border</span>-radius: <span class="synConstant">3px</span>;
  <span class="synType">border</span>: <span class="synConstant">1px</span> <span class="synType">solid</span> $baseGray; 
<span class="synIdentifier">}</span>
</pre><p>次に、個別の画面の微調整はコントローラー毎にあるファイルを修正します。<br />
今回は「投稿(post)」なので、<code>app/assets/stylesheets/posts.css.scss</code>です。<br />
しかし、先ほど言った通り、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>では全ての画面で全ての<code>Scss</code>ファイルを読み込んでしまうので一工夫が必要です。<br />
<code>app/views/layouts/application.html.erb</code>の<code>body</code>タグに<code>class</code>属性を追加し、値は現在ビューを表示している"コントローラー名"にしましょう。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">body</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">'&lt;%= controller.controller_name %&gt;'</span><span class="synIdentifier">&gt;</span>
</pre><p>HTMLソースをみれば分かりますが、これは、次のようにHTMLに変換されます。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synComment">&lt;!--</span>
<span class="synComment">  ルート画面(app/views/welcome/index.html.erb)のような</span>
<span class="synComment">  WelcomeControllerでレンダリングされた画面</span>
<span class="synComment">--&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">body</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">'welcome'</span><span class="synIdentifier">&gt;</span>

<span class="synComment">&lt;!--</span>
<span class="synComment">  投稿一覧画面(app/views/posts/index.html.erb)のような</span>
<span class="synComment">  PostsControllerでレンダリングされた画面</span>
<span class="synComment">--&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">body</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">'posts'</span><span class="synIdentifier">&gt;</span>
</pre><p>投稿詳細画面(<code>app/views/posts/show.html.erb</code>)のスタイリングをするために、少し<code>app/views/posts/show.html.erb</code>のHTML構造を修正します。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;post_info&quot;</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>タイトル：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> @post.title</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
   
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>内容：<span class="synIdentifier">&lt;/</span><span class="synStatement">strong</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> simple_format</span><span class="synIdentifier"> @post.</span><span class="synType">text</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>コメント<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> render</span><span class="synIdentifier"> @post.comments %&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>コメントを追加<span class="synIdentifier">&lt;/</span><span class="synStatement">h2</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> render</span><span class="synIdentifier"> </span><span class="synConstant">&quot;comments/form&quot;</span><span class="synIdentifier"> %&gt;</span>

<span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'戻る'</span><span class="synIdentifier">, posts_path %&gt;</span>
| <span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">'編集'</span><span class="synIdentifier">, edit_post_path(@post) %&gt;</span>
</pre><p><br />
それでは<code>app/assets/stylesheets/posts.css.scss</code>を記載します。</p>
<pre class="code lang-css" data-lang="css" data-unlink><span class="synPreProc">@import &quot;common.css.scss&quot;;</span>

<span class="synIdentifier">.posts</span> <span class="synIdentifier">{</span>
  h<span class="synConstant">2</span> {
    <span class="synType">margin-top</span>: <span class="synConstant">20px</span>;
    <span class="synType">margin-bottom</span>: <span class="synConstant">5px</span>;

    <span class="synType">font-size</span>: <span class="synConstant">110%</span>;
    <span class="synType">border-bottom</span>: <span class="synConstant">1px</span> <span class="synType">dotted</span> $baseLightBlue;
  <span class="synIdentifier">}</span>

  <span class="synIdentifier">.post_info</span> <span class="synIdentifier">{</span>
    <span class="synType">padding</span>: <span class="synConstant">20px</span> <span class="synConstant">5px</span>;
    <span class="synType">margin-bottom</span>: <span class="synConstant">30px</span>;

    <span class="synType">background-color</span>: $baseLightGray;
    <span class="synType">border</span>-radius: <span class="synConstant">5px</span>;

    strong {
      <span class="synType">font-size</span>: <span class="synConstant">110%</span>;
    <span class="synIdentifier">}</span>
  <span class="synError">}</span>
<span class="synError">}</span>
</pre><p>では、投稿の詳細画面(<code>http://localhost:3000/posts/1</code>)を確認しましょう。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813160348.png" alt="f:id:nipe880324:20140813160348p:plain:w480" title="f:id:nipe880324:20140813160348p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span><br />
これで、スタイリングはおしまいです。</p><br />
<p><h3 id="coffee-script"><a class="keyword" href="http://d.hatena.ne.jp/keyword/CoffeeScript">CoffeeScript</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>を使う</h3>今度は、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>の使い方を説明します。<br />
その例として、「コメント入力時に文字数を<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>で表示する」ようにします。<br />
イメージ次のような形です。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813160712.png" alt="f:id:nipe880324:20140813160712p:plain:w320" title="f:id:nipe880324:20140813160712p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<p>スタイリングをするために<code>Scss</code>が採用されているように、<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>では<a class="keyword" href="http://d.hatena.ne.jp/keyword/JavaScript">JavaScript</a>を記載するために<code>CoffeeScript</code>という<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BF%B8%C0%B8%EC">メタ言語</a>が採用されています。<br />
簡易にかけますが、学習が必要なので<a href="http://dotinstall.com/lessons/basic_coffeescript" target="_blank">ドットインストール - CoffeeScript入門</code>などを実施してみて下さい。</p><p>まず、文字数の表示領域を追加するために、<code>app/views/comments/_form.html.erb</code>を修正します。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;%=</span><span class="synConstant"> form_for(</span><span class="synIdentifier"> [@post, @post.comments.build] ) do |f| %&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :commenter, </span><span class="synConstant">&quot;コメンター&quot;</span><span class="synIdentifier"> %&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_field</span><span class="synIdentifier"> :commenter %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.label</span><span class="synIdentifier"> :body, </span><span class="synConstant">&quot;コメント&quot;</span><span class="synIdentifier"> %&gt;</span> <span class="synIdentifier">&lt;</span><span class="synStatement">br</span><span class="synIdentifier"> /&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.text_area</span><span class="synIdentifier"> :body, </span><span class="synType">cols</span><span class="synIdentifier">: 60, </span><span class="synType">rows</span><span class="synIdentifier">: 8 %&gt;</span>
    <span class="synComment">&lt;!-- 追加箇所　開始 --&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;hint&quot;</span><span class="synIdentifier">&gt;</span>入力文字数：<span class="synIdentifier">&lt;</span><span class="synStatement">span</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;char_num&quot;</span><span class="synIdentifier">&gt;</span>0<span class="synIdentifier">&lt;/</span><span class="synStatement">span</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
    <span class="synComment">&lt;!-- 追加箇所　終了 --&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;%=</span><span class="synConstant"> f.submit</span><span class="synIdentifier"> </span><span class="synConstant">&quot;コメント投稿&quot;</span><span class="synIdentifier"> %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
</pre><p><br />
文字数表示をスタイリングしておきます。<br />
<code>app/assets/stylesheets/common.css.scss</code>の一番下に下記を追加して下さい。</p>
<pre class="code lang-css" data-lang="css" data-unlink><span class="synIdentifier">.hint</span> <span class="synIdentifier">{</span>
  <span class="synType">font-size</span>: <span class="synConstant">86%</span>;
  <span class="synType">color</span>: $baseGray;
  <span class="synType">font-style</span>: <span class="synType">italic</span>; 
<span class="synIdentifier">}</span>
</pre><p>では、JavaScriptを記載します。<br />
<code>Scss</code>と同じように、コメントに関するJavaScriptなので<code>comments.js.coffee</code>に下記を記載します。（CoffeeScriptで記載しています）</p>
<pre class="code lang-javascript" data-lang="javascript" data-unlink>$ -&gt;
  $(<span class="synConstant">'#comment_body'</span>).keyup -&gt;
    $(<span class="synConstant">'#char_num'</span>).text($(<span class="synIdentifier">this</span>).val().length)
</pre><p><i>RailsではgemによりjQueryが標準でインクルードされているため使うことが可能です。しかし、jQueryをCoffeeScriptで記載するには少し癖ありますので、<a href="http://www.webopixel.net/javascript/660.html" target="_blank">CoffeeScriptでjQueryを使うときのメモ</a>などを読んでみて下さい。</i></p><p>では、実際にコメントを入力し、動的に入力文字列の値が変わることを確認してみて下さい。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20140813/20140813160712.png" alt="f:id:nipe880324:20140813160712p:plain:w320" title="f:id:nipe880324:20140813160712p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<p><h3 id="what-is-next">次は？</h3>おつかれさまでした。そして、おめでとうございます。</p><p>あなたは、これでRailsの基本的な開発方法を学ぶことができるようになりました。<br />
ルーティング、コントローラー、モデル、ビュー、スタイリング、JavaScriptなど数々のことについて知ることができました。</p><br />
<br />
<p>さて、今後どうしていったらいいかのアドバイスを簡単に説明していきます。</p>

<ul>
<li>このブログに追加の自力で機能を追加する。例えば、ユーザ認証機能、ファイルアップロード機能など。そのときに、このページのトップにある「有用なライブラリ」の<code>devise</code>や<code>paperclip</code>の記事がとても参考になると思います。</li>
</ul>
<ul>
<li>「<a href="http://railstutorial.jp/" target="_blank">Railsチュートリアル</a>」というオンラインブックで「Twitter風アプリをテスト駆動開発かつAgileで開発」する</li>
</ul><p><i>GitやRSpecでテストを書いてからコードを書くなどさまざまなことが知れるのでとてもお勧め。</i><br />
</p>

<ul>
<li>「RailsによるアジャイルWebアプリケーション開発 第4版」という本で「ECサイトをAgileで開発」する。</li>
</ul><p><i> Railsを開発した人が書いてあるのでとても内容が分かりやすくて実用的だた、Rails 3.2で説明しているのでRailsが少し古いことが欠点</i><br />
<div class="hatena-asin-detail"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4274068668/hatena-blog-22/"><img src="http://ecx.images-amazon.com/images/I/51Gibg-iYTL._SL160_.jpg" class="hatena-asin-detail-image" alt="RailsによるアジャイルWebアプリケーション開発 第4版" title="RailsによるアジャイルWebアプリケーション開発 第4版"></a><div class="hatena-asin-detail-info"><p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4274068668/hatena-blog-22/">RailsによるアジャイルWebアプリケーション開発 第4版</a></p><ul><li><span class="hatena-asin-detail-label">作者:</span> Sam Ruby,Dave Thomas,David Heinemeier Hansson,前田修吾</li><li><span class="hatena-asin-detail-label">出版社/メーカー:</span> オーム社</li><li><span class="hatena-asin-detail-label">発売日:</span> 2011/12/01</li><li><span class="hatena-asin-detail-label">メディア:</span> 単行本（ソフトカバー）</li><li><span class="hatena-asin-detail-label">購入</span>: 12人 <span class="hatena-asin-detail-label">クリック</span>: 206回</li><li><a href="http://d.hatena.ne.jp/asin/4274068668/hatena-blog-22" target="_blank">この商品を含むブログ (40件) を見る</a></li></ul></div><div class="hatena-asin-detail-foot"></div></div></p>

<ul>
<li>「<a href="http://guides.rubyonrails.org/index.html" target="_blank">Rails Guides</a>」を読んでより深く詳細にRailsの各機能について学ぶ。</li>
</ul><p><i>英語で読むのに時間がかかるというのが欠点だが、内容の豊富さはダントツでお勧め。</i><br />
</p>

<ul>
<li>「<a href="http://railscasts.com/" target="_blank">RailsCast」というRails専用のスクリーンキャスト(※ドットインストールと同じ動画で説明してくれるサイト)で幅広い情報を学ぶ。</li>
</ul><p><i>Rails界隈ではとても人気な（だった？）スクリーンキャストでRailsGuidsと違った種類の内容の多さはピカイチ。英語で説明しているので分かりづらいことと、2013年1月から更新が止まっていて内容が一部古いこと、一部有料の記事があることが欠点。</i></p><p>「実際に独自で作って、つまりながらも完成させること」と「一部の機能を深く広く学ぶこと」を繰り返していくことにより、どんどんとRailsの知識やスキルが深まっていくのでまずは自分で何か機能を追加してみることをお勧めします。</p><p>では、以上です。<br />
わかりづらい、間違っている箇所などありましたらコメントを下さい。<br />
長くなりましたがここまで読んでいただきありがとうございました。<br />
そして、おつかれさまです。</p>

</div>
</div>
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="1407915718.html"><time data-relative datetime="2014-08-13T07:41:58Z" title="2014-08-13T07:41:58Z" pubdate class="updated">2014-08-13 16:41</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20140813/1407915718" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20140813%2F1407915718" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20140813/1407915718" data-count="vertical" data-text="Railsを始めたばかりの人向け！Railsの仕組みを一から理解しながらブログを作成する - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20140813/1407915718" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_0', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_0" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

          

          

          
        
      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                
                  
                  
                  <div class="permalink pager">
                    
                      
                      <span class="pager-prev">
                        <a href="../20140814/1407994568.html" rel="prev">
                          <span class="pager-arrow">« </span>
                          Rails ModelのScope（スコープ）の使い方…
                        </a>
                      </span>
                    
                    
                      
                      <span class="pager-next">
                        <a href="../20140810/1407634200.html" rel="next">
                          Railsのmigrationの基本とレシピ集
                          <span class="pager-arrow"> »</span>
                        </a>
                      </span>
                    
                  </div>
                

              
            
            <!-- rakuten_ad_target_end -->
            <!-- google_ad_section_end -->

            
          
        </div>
      </div>

      
      <aside id="box1">
        <div id="box1-inner">
        </div>
      </aside>

    </div><!-- #wrapper -->

    <aside id="box2">
  
  <div id="box2-inner">
    
      
<div class="hatena-module hatena-module-html">
  <div class="hatena-module-body">
    <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-2736751992834286"
     data-ad-slot="8116686456"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>
</div>

      
      
    
      

<div class="hatena-module hatena-module-profile">
  <div class="hatena-module-title">
    プロフィール
  </div>
  <div class="hatena-module-body">
    
    <a href="../../about.html" class="profile-icon-link">
      <img src="http://cdn1.www.st-hatena.com/users/ni/nipe880324/profile.gif?1406435422"
      alt="id:nipe880324" class="profile-icon" />
    </a>
    

    
    <span class="id">
      <a href="../../about.html" class="hatena-id-link"><span data-load-nickname="1" data-user-name="nipe880324">id:nipe880324</span></a>
      
  
    
    
  


    </span>
    

    

    
      <div class="hatena-follow-button-box btn-subscribe js-hatena-follow-button-box"
  
  >

  <a href="1407915718.html#" class="hatena-follow-button js-hatena-follow-button">
    <span class="subscribing">
      <span class="foreground">読者です</span>
      <span class="background">読者をやめる</span>
    </span>
    <span class="unsubscribing" data-track-name="profile-widget-subscribe-button" data-track-once>
      <span class="foreground">読者になる</span>
      <span class="background">読者になる</span>
    </span>
  </a>
  <div class="subscription-count-box js-subscription-count-box">
    <i></i>
    <u></u>
    <span class="subscription-count js-subscription-count">
    </span>
  </div>
</div>

    

    

    

    
  </div>
</div>

      
      
    
      
<div class="hatena-module hatena-module-entries-access-ranking"
     data-count="4"
     data-display_entry_category="1"
     data-display_entry_image="0"
     data-display_entry_image_size_width="100"
     data-display_entry_image_size_height="100"
     data-display_entry_body_length="0"
     data-display_entry_date="1"
     data-display_bookmark_count="0"
     data-source="access"
>
  <div class="hatena-module-title">
    
      最近のアクセス
    
  </div>
  <div class="hatena-module-body">
    
  </div>
</div>

      
      
    
      
<div class="hatena-module hatena-module-html">
    <div class="hatena-module-title">    </div>
  <div class="hatena-module-body">
    <nav>
  <div class="side-category">
    <span class="side-category-title">Rails 入門</span>
    <ul class="side-category-list">
      <li><a href="../20140713/1405251091.html">RailsのためのRuby基礎</a></li>
      <li><a href="1407915718.html">Rails入門者向け ブログ開発</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Railsコマンド</span>
    <ul class="side-category-list">
      <li><a href="../20140713/1405251709.html">rails new / server / console</a></li>
      <li><a href="../20150204/1423055537.html">rails new時の有用な6つの設定</a></li>
      <li><a href="../20150208/1423391199.html">rails new時のテンプレート</a></li>
      <li><a href="../20140802/1406948695.html">rails generate</a></li>
      <li><a href="../20141116/1416115266.html">rakeコマンド一覧</a></li>
      <li><a href="../20141117/1416225563.html">自前rakeコマンド</a></li>
      <li><a href="../20141110/1415623670.html">productionモードで起動</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Route / Controller</span>
    <ul class="side-category-list">
      <li><a href="../20140716/1405451238.html">Routing</a></li>
      <li><a href="../20140810/1407603600.html">レイアウトファイルを指定</a></li>
      <li><a href="../20141125/1416918957.html">ビューを返す(render)</a></li>
      <li><a href="../20140808/1407427457.html">リダイレクトする(redirect_to)</a></li>
      <li><a href="../20141126/1417012848.html">Strong Parameters</a></li>
      <li><a href="../20141129/1417223453.html">フィルタ(before_action, after_action)</a></li>
      <li><a href="../20141127/1417086075.html">簡易なメッセージ表示(Flash)</a></li>
      <li><a href="../20141130/1417334030.html">セッション(session)</a></li>
      <li><a href="../20141201/1417432408.html">リクエストヘッダ、レスポンスヘッダ(request, response)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Model, Migration</span>
    <ul class="side-category-list">
      <li><a href="../20140724/1406142120.html">CRUD</a></li>
      <li><a href="../20141203/1417601540.html">1対多関連</a></li>
      <li><a href="../20141204/1417688260.html">多対多関連</a></li>
      <li><a href="../20141205/1417779929.html">1対1関連</a></li>
      <li><a href="../20141206/1417839458.html">STI(単一継承テーブル)</a></li>
      <li><a href="../20141207/1417926599.html">ポリモフィック関連</a></li>
      <li><a href="../20141208/1418018874.html">複数の子レコードを作成/更新</a></li>
      <li><a href="../20140724/1406145303.html">バリデーション(validation)</a></li>
      <li><a href="../20140810/1407623400.html">バリデーションエラー(validation errors)</a></li>
      <li><a href="../20140814/1407994568.html">スコープ(scope)</a></li>
      <li><a href="../20141211/1418301640.html">コールバック(callback)</a></li>
      <li><a href="../20150428/1430154446.html">複雑なSELECT文のまとめ</a></li>
      <li><a href="../20150710/1436461745.html">enum (Rails 4.1以上)</a></li>
      <li><a href="../20141209/1418123425.html">楽観的ロック</a></li>
      <li><a href="../20141210/1418207618.html">悲観的ロック</a></li>
      <li><a href="../20140810/1407634200.html">Migration(マイグレーション)</a></li>
      <li><a href="../20150607/1433606267.html">Postgresとマイグレーション</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">API</span>
    <ul class="side-category-list">
      <li><a href="../20150708/1436284476.html">Roar</a></li>
      <li>ActiveSerializer</li>
      <li>Versioning</li>
      <li>CORS</li>
    </ul>
  </div>

  <div class="side-category">
    <span class="side-category-title">View, Helper, Presenter</span>
    <ul class="side-category-list">
      <li><a href="../20140810/1407603600.html">レイアウトファイルを指定</a></li>
      <li><a href="../20140807/1407419013.html">部分テンプレート</a></li>
      <li><a href="../20140727/1406448610.html">フォーム周りのMVC連携フロー</a></li>
      <li><a href="../20150113/1421149061.html">ビューヘルパーまとめ(View Helper)</a></li>
      <li><a href="../20140802/1406969793.html">フォーマットヘルパー</a></li>
      <li><a href="../20140803/1407049200.html">独自ヘルパー作成</a></li>
      <li><a href="../20141208/1418018874.html">複数の子レコード(has_many)を作成/更新するフォーム</a></li>
      <li><a href="../20141225/1419515057.html">1フォームに複数のSubmitボタンを配置</a></li>
      <li><a href="../20140730/1406700205.html">simple_form</a></li>
      <li><a href="../20150415/1429031791.html">Draper</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">テンプレートエンジン</span>
    <ul class="side-category-list">
      <li><a href="../20140929/1411997071.html">HTMLテンプレートエンジンまとめ</a></li>
      <li><a href="../20140929/1411997071.html">Slim</a></li>
      <li><a href="../20141001/1412097051.html">Haml</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ActionSupport / ActionMailer / ActiveJob / i18n</span>
    <ul class="side-category-list">
      <li><a href="../20141217/1418817120.html">タイムゾーン、時刻処理</a></li>
      <li><a href="../20141218/1418901424.html">Timecop 時刻処理のテスト</a></li>
      <li><a href="../20141216/1418729961.html">クラス名,DB名,ファイル名の変換</a></li>
      <li><a href="../20141230/1419936984.html">JSON, XML, YAMLの読み書き</a></li>
      <li><a href="../20141030/1414599853.html">文字コード/エンコード</a></li>
      <li><a href="../20140828/1409236436.html">メール送信</a></li>
      <li><a href="../20150304/1425396671.html">DelayedJob バックグラウンド処理</a></li>
      <li><a href="../20150110/1420863998.html">ログ・ログレベル・ログフォーマット(log, logger)</a></li>
      <li><a href="../20150226/1424937175.html">i18nまとめ</a></li>
      <li><a href="../20141111/1415707101.html">エラーハンドリング</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">テスト</span>
    <ul class="side-category-list">
      <li><a href="../20150101/1420093487.html">RSpec/Capybaraの導入方法</a></li>
      <li><a href="../20150103/1420280252.html">RSpec/Capybaraのレシピ集</a></li>
      <li><a href="../20150101/1420093487.html">FactoryGirlのレシピ集</a></li>
      <li><a href="../20150105/1420465062.html">Jasmine(Javascriptの単体テスト)</a></li>
      <li><a href="../20150108/1420675366.html">APIの作成とテスト</a></li>
      <li><a href="../20150106/1420545920.html">RSpecテストを速くする</a></li>
      <li><a href="../20150108/1420721205.html">デバッグ(debug)</a></li>
      <li><a href="../20150420/1429462755.html">Seleniumでスタンドアローンなテスト</a></li>
      <li><a href="../20140719/1405708234.html">Cucumber+RSpec+Capybara インストール</a></li>
      <li><a href="../20140719/1405777918.html">Cucumber+RSpec+Capybara BDD/TDD開発例</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Security</span>
    <ul class="side-category-list">
      <li><a href="../20141215/1418641291.html">ログ上での秘密情報のフィルタリング</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">パフォーマンス</span>
    <ul class="side-category-list">
      <li><a href="../20141109/1415522242.html">Bullet</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">設定</span>
    <ul class="side-category-list">
      <li><a href="../20141224/1419414316.html">新しいEnvironmentを追加</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">UI/UX</span>
    <ul class="side-category-list">
      <li><a href="../20140801/1406818800.html">Twitter Bootstrap 3</a></li>
      <li><a href="../20141112/1415804076.html">select2</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Gemの基礎</span>
    <ul class="side-category-list">
      <li><a href="../20140715/1405361727.html">RubyGemsの選び方</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ログイン/認証機能</span>
    <ul class="side-category-list">
      <li><a href="../20140801/1406907000.html">devise1 インストール</a></li>
      <li><a href="../20140804/1407168000.html">devise2 カスタマイズ</a></li>
      <li><a href="../20140805/1407200400.html">devise3 Twitterでログイン(OAuth連携)</a></li>
      <li><a href="../20141212/1418380288.html">devise4 ゲストユーザー(Guest)作成</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ファイルアップロード機能</span>
    <ul class="side-category-list">
      <li><a href="../20140716/1405443484.html">PaperClip</a></li>
      <li><a href="../20141015/1413300088.html">CarrierWave1 インストール</a></li>
      <li><a href="../20141022/1413907332.html">CarrierWave2 カスタマイズ</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">検索機能・Elasticsearch</span>
    <ul class="side-category-list">
      <li><a href="../20141008/1412774436.html">Ransack 検索機能</a></li>
      <li><a href="../20150224/1424776132.html">Sunspot 全文検索</a></li>
      <li><a href="../20151018/1445142266.html">Elasticsearch 1: 全文検索・フィルタ</a></li>
      <li><a href="../20151019/1445265581.html">Elasticsearch 2: ページネーション</a></li>
      <li><a href="../20151021/1445353566.html">Elasticsearch 3: ソート</a></li>
      <li><a href="../20151022/1445439798.html">Elasticsearch 4: アグリゲーション（ファセット）・post_filter</a></li>
      <li><a href="../../20151025/1445703231.html">Elasticsearch 5: ハイライト</a></li>
      <li><a href="../20151027/1445957667.html">Elasticsearch 6: サジェスト</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ページネーション</span>
    <ul class="side-category-list">
      <li><a href="../20141118/1416314608.html">ページネーションまとめ</a></li>
      <li><a href="../20141113/1415874683.html">kaminari</a></li>
      <li><a href="../20141114/1415967206.html">will_paginate</a></li>
      <li><a href="../20141115/1416021886.html">動的ページロード</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">CSV</span>
    <ul class="side-category-list">
      <li><a href="../20141119/1416398472.html">CSVダウンロード</a></li>
      <li><a href="../20141120/1416483136.html">CSVアップロード</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">PDFファイル作成機能</span>
    <ul class="side-category-list">
      <li><a href="../20140906/1409995011.html">PDF作成Gem まとめ</a></li>
      <li><a href="../20140907/1410078997.html">コードのみでPDF作成 Prawn</a></li>
      <li><a href="../20140908/1410176894.html">HTMLを変換してPDF作成 PDFKit + wkhtmltopdf</a></li>
      <li><a href="../20140909/1410241835.html">GUIツールでPDF作成 ThinReports</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">開発効率をあげる</span>
    <ul class="side-category-list">
      <li><a href="../20141026/1414289421.html">Spring</a></li>
      <li><a href="../20141016/1413389293.html">Guard-LiveReload</a></li>
      <li><a href="../20141021/1413819783.html">Guard-RSpec</a></li>
      <li><a href="../20141019/1413698128.html">Guard-RuboCop</a></li>
      <li><a href="../20141024/1414081224.html">Pry-Rails / Pry-BuyBug</a></li>
      <li><a href="../20141024/1414160189.html">Hirb</a></li>
      <li><a href="../20141028/1414505988.html">Awesome Print</a></li>
      <li><a href="../20141029/1414584929.html">Quiet Assets</a></li>
      <li><a href="../20141025/1414225490.html">Better_Errors</a></li>
      <li><a href="../20141027/1414409495.html">Rails-ERD</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">その他Gem</span>
    <ul class="side-category-list">
      <li><a href="../20150225/1424858414.html">acts-as-taggable-on タグ管理</a></li>
      <li><a href="../20141016/1413389293.html">wenerber Cron設定</a></li>
      <li><a href="../20150221/1424489524.html">friendly_id URLスラッグ</a></li>
      <li><a href="../20150216/1424092796.html">awesome_nested_set ツリー構造</a></li>
      <li><a href="../20150217/1424179269.html">awesome_nested_set にjsTreeを追加</a></li>
      <li><a href="../20150214/1423923524.html">PaperTrail 取り消し機能</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Tips</span>
    <ul class="side-category-list">
      <li><a href="../20141229/1419856433.html">Virtual Attributes(仮想属性)</a></li>
      <li><a href="../20141226/1419600679.html">日付/時刻のフォーマット</a></li>
      <li><a href="../20141225/1419515057.html">1フォームに複数のSubmitボタンを配置</a></li>
      <li><a href="../20141223/1419334845.html">URLのパーマリンクをID以外に変更</a></li>
      <li><a href="../20141220/1419058040.html">CSSスタイリングのコントローラー単位で分割</a></li>
      <li><a href="../20141219/1418990626.html">ページタイトルの変更</a></li>
      <li><a href="../20150101/1420049679.html">Ruby/Railsの便利なメソッド(useful methods)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Rubyテクニック</span>
    <ul class="side-category-list">
      <li><a href="../20150921/1442839934.html">キーワード引数</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">良い設計/リファクタリング</span>
    <ul class="side-category-list">
      <li><a href="../20150922/1442923521.html">デメテルの法則(Law of Demeter)</a></li>
      <li><a href="../20150312/1426141352.html">HTML/CSS/JSを疎結合にする方法</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">JavaScript</span>
    <ul class="side-category-list">
      <li><a href="../20150311/1426062668.html">オブジェクト指向</a></li>
      <li><a href="../20150313/1426238835.html">thisの参照先</a></li>
      <li><a href="../20150317/1426599220.html">設定データを分離</a></li>
      <li><a href="../20150607/1433652441.html">ページを離れる時にアラートを出す</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">jQuery</span>
    <ul class="side-category-list">
      <li><a href="../20150325/1427291741.html">Ajax</a></li>
      <li><a href="../20150326/1427379215.html">イベント処理(Event)</a></li>
      <li><a href="../20150331/1427809820.html">DOM操作</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">React.js</span>
    <ul class="side-category-list">
      <li><a href="../20151122/1448118932.html">React.jsチュートリアル: メッセージボックス</a></li>
      <li><a href="../20151124/1448300267.html">サーバーレンダリング</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">AngularJS</span>
    <ul class="side-category-list">
      <li><a href="../20150114/1421235346.html">AngularJSのインストール</a></li>
      <li><a href="../20150115/1421316461.html">UI Bootstrapのインストール</a></li>
      <li><a href="../20150116/1421407124.html">AngularJS Controller</a>
      <li><a href="../20150119/1421666497.html">ngResource + RailsでAPI作成</a></li>
      <li><a href="../20150120/1421761471.html">ngRoute</a></li>
      <li><a href="../20150126/1422276839.html">編集可能(Editable)</a></li>
      <li><a href="../20150127/1422357163.html">ソート可能(Sortable)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">開発手法</span>
    <ul class="side-category-list">
      <li><a href="../20140917/1410963376.html">スクラム開発</a></li>
      <li><a href="../20141010/1412867452.html">カイゼンフレームワークKPT</a>
      <li><a href="../20140816/1408126999.html">GitHubを使ったチーム開発フロー</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">開発ツール</span>
    <ul class="side-category-list">
      <li><a href="../20141103/1414940400.html">git - 初期設定と便利なエイリアス</a></li>
      <li><a href="../20140713/1405248403.html">git - よく使うコマンド</a></li>
      <li><a href="../20140724/1406137504.html">SublimeText3 - 便利コマンドとプラグイン</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">DB</span>
    <ul class="side-category-list">
      <li><a href="../20140726/1406331785.html">MongoDBの基礎入門 CRUD操作</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">インフラ</span>
    <ul class="side-category-list">
      <li><a href="../20150719/1437249020.html">Vagrant</a></li>
      <li><a href="../20150721/1437404524.html">Chef(Rails環境構築)</a></li>
      <li><a href="../20150314/1426332751.html">Herokuの準備とデプロイ</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">リファレンス</span>
    <ul class="side-category-list">
      <li><a href="https://github.com/" target="_blank">GitHub</a></li>
      <li><a href="http://guides.rubyonrails.org/index.html" target="_blank">RailsGuides</a></li>
      <li><a href="http://railscasts.com/" target="_blank">RailsCast</a></li>
      <li><a href="https://rubygems.org/" target="_blank">RubyGems</a></li>
      <li><a href="https://www.ruby-toolbox.com/" target="_blank">RubyToolbox</a></li>
      <li><a href="http://rubular.com/" target="_blank">正規表現 Rubular</a></li>
      <li><a href="http://ruby-doc.org/core-2.1/" target="_blank">Ruby API (2.1)</a></li>
      <li><a href="http://api.rubyonrails.org/" target="_blank">Ruby on Rails API (4.1)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Phoenix</span>
    <ul class="side-category-list">
      <li><a href="../20151011/1444560106.html">Phoenix環境設定(Phoenix入門1)</a></li>
      <li><a href="../20151013/1444662887.html">基本的な認証機能(Phoenix入門2)</a></li>
      <li><a href="../20151016/1444930756.html">基本的なチャット機能(Phoenix入門3)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">その他</span>
    <ul class="side-category-list">
      <li><a href="../20150401/1427898898.html">広告収入向上</a></li>
      <li><a href="../20140830/1409361710.html">著者が読んだ本</a></li>
    </ul>
  </div>
</nav>

  </div>
</div>

      
      
    
      

<div class="hatena-module hatena-module-archive" data-archive-type="default" data-archive-url="../../archive.html">
  <div class="hatena-module-title">
    <a href="../../archive.html">月別アーカイブ</a>
  </div>
  <div class="hatena-module-body">
  </div>
</div>

      
      
    
    
  </div>
</aside>

  </div>
</div>




        
        
          <script type="text/javascript" src="http://b.hatena.ne.jp/js/hatena_dfp2.js"></script>
        
        
          <div id="bottom-editarea">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
$('.unsubscribing').on('click', function() {
    ga('send', 'event', 'button', 'click', 'hatenaReader');  
});
</script>
          </div>
        
      </div>
    </div>

    
      <footer id="footer" data-brand="hatenablog">
  <div id="footer-inner">
    <address>
      
      <a href="../../about.html"><img src="http://cdn1.www.st-hatena.com/users/ni/nipe880324/profile.gif" width="16" height="16" alt=""/>
        <span data-load-nickname="1" data-user-name="nipe880324">nipe880324</span>
      </a>
    </address>
    <p class="services">Powered by <a href="http://hatenablog.com/">Hatena Blog</a></p>
  </div>
</footer>

    

    
  <script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>


    

    <script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js">
  {"parsetags": "explicit"}
</script>
<script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>



  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-with-addons.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.min.js"></script>


<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery/jquery-ui.1.10.0.custom.min.js"></script>
<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery/jquery.flot.0.8.3.js"></script>
<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery/jquery.flot.time.0.8.3.js"></script>



<script id="hatenablog-js" data-env="production"
  type="text/javascript" src="https://blog.st-hatena.com/js/hatenablog.js?version=228df9a6e5a3ae04fdb53d33befa3556" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://blog.st-hatena.com/js/texts-ja.js?version=228df9a6e5a3ae04fdb53d33befa3556"></script>


  <script type="text/javascript">Hatena.Diary.GlobalHeader.init()</script>


<script src="https://www.google.com/recaptcha/api.js" async defer></script>




    


    
       

  <script id="hatena-counter-script" type="text/javascript"><!--
      hatena_counter_name = "nipe880324";
      hatena_counter_id = "102";
      hatena_counter_ref = document.referrer+"";
      hatena_counter_screen = screen.width + "x" + screen.height+","+screen.colorDepth;
  //--></script>
  <script type="text/javascript" src="http://counter.hatena.ne.jp/js/counter.js"></script>
  <noscript><img src="http://counter.hatena.ne.jp/nipe880324/102" border="0" alt="counter"></noscript>


    

  </body>
</html>


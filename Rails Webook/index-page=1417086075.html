<!DOCTYPE html>
<html
  lang="ja"
data-avail-langs="ja en"

data-page="index"
data-static-domain="https://blog.st-hatena.com"
data-blog="ruby-rails.hatenadiary.com"
data-blog-name="Rails Webook"
data-blogs-uri-base="http://ruby-rails.hatenadiary.com"
data-globalheader-color="b"
data-author="nipe880324"
data-version="228df9a6e5a3ae04fdb53d33befa3556"
data-blog-comments-top-is-new=""
data-plus-available=""



data-admin-domain="http://blog.hatena.ne.jp"

data-brand="hatenablog"

data-has-touch-view="1"


itemscope
itemtype="http://schema.org/Blog"


  data-device="pc"
  data-globalheader-type="pc"
  >
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
    
    
    

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=7; IE=9; IE=10; IE=11" />
    <title>Rails Webook</title>

    

    
      <link rel="canonical" href="index.html"/>
    

    
    

<meta itemprop="name" content="Rails Webook"/>

  <meta itemprop="image" content="https://blog.st-hatena.com/images/theme/og-image-1500.png"/>


    <meta property="og:title" content="Rails Webook"/>
<meta property="og:type" content="blog"/>
<meta property="og:url" content="http://ruby-rails.hatenadiary.com/"/>

  
  
  
  <meta property="og:image" content="https://blog.st-hatena.com/images/theme/og-image-1500.png"/>

  <meta property="og:description" content="自社のECを開発している会社で働いています。Rails情報やサービスを成長させる方法を書いていきます" />
<meta property="og:site_name" content="http://ruby-rails.hatenadiary.com/"/>

        <meta name="twitter:card"  content="summary_large_image" />
    <meta name="twitter:image" content="http://f.st-hatena.com/images/fotolife/n/nipe880324/20140802/20140802105152.png" />
  <meta name="twitter:title" content="Rails Webook" />  <meta name="twitter:description" content="自社のECを開発している会社で働いています。Rails情報やサービスを成長させる方法を書いていきます" />  <meta name="twitter:app:name:iphone" content="はてなブログアプリ" />
  <meta name="twitter:app:id:iphone" content="583299321" />
  <meta name="twitter:app:url:iphone" content="hatenablog:///open?uri=http%3A%2F%2Fruby-rails.hatenadiary.com%2F%3Fpage%3D1417086075" />  <meta name="twitter:site" content="@nipe032488" />
    
    <meta name="description" content="毎週更新。Railsプログラマがソフトウェア開発を効果的・効率的にするために、分かりやすく・使いやすい形でRailsに関する技術情報を記載。">    <meta name="google-site-verification" content="OyOieuLgSrQckqbACTn_Q3G1dPq6LMlTqBRHa6V1XsA">    <meta name="keywords" content="Rails,Ruby on Rails,gem,Webアプリケーション,開発,構築,運用,インフラ">

    
<script type="text/javascript">
// <!--

if (~navigator.userAgent.indexOf('Mac OS X')) {
  document.write('<style type="text/css">html, body { font-family: \x27Helvetica\x27, \x27Arial\x27, \x27ヒラギノ角ゴ Pro W3\x27, \x27Hiragino Kaku Gothic Pro\x27, sans-serif; } </style>');
} else {
  document.write('<style type="text/css">html, body { font-family: \x27Helvetica\x27, \x27Arial\x27, \x27メイリオ\x27, \x27Meiryo\x27, \x27MS PGothic\x27, sans-serif; } </style>');
}

// -->
</script>

<!--[if lt IE 9]>
<script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->




    <link rel="shortcut icon" href="https://blog.st-hatena.com/images/favicon.ico">
<link rel="icon" sizes="192x192" href="https://blog.st-hatena.com/images/common/meta-icon-global.png">

    
<link rel="alternate" type="application/atom+xml" title="Atom" href="feed"/>
<link rel="alternate" type="application/rss+xml" title="RSS2.0" href="rss.rss"/>


      <link rel="author" href="http://www.hatena.ne.jp/nipe880324/">
    

    <link rel="stylesheet" type="text/css" href="https://blog.st-hatena.com/css/blog.css?version=228df9a6e5a3ae04fdb53d33befa3556"/>

    
  <link rel="stylesheet" type="text/css" href="http://blog.hatena.ne.jp/-/blog_style/12921228815727789780/a052dbbef76fd4380abc811c11814f2d9f990b9a"/>

    <script></script>

    
<style>div#google_afc_user,
  div#google_afc_user_container_0,
  div#google_afc_user_container_1,
  div#google_afc_user_container_2,
  div#google_afc_user_container_3,
  div#google_afc_user_container_4,
  div#google_afc_user_container_5,
  div.google_afc_image,
  div.google_afc_blocklink {
      display: block !important;
  }
</style>


    
  </head>

  <body class="page-index enable-top-editarea enable-bottom-editarea">
    <!-- Google Universal Analytics -->
<script id="google-analytics-script">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-29716941-6', 'auto', {'name': 'HatenaBlogTracker', 'sampleRate': 1});
  ga('HatenaBlogTracker.require', 'displayfeatures');
  ga('HatenaBlogTracker.send', 'pageview');
  ga('create', 'UA-29716941-26', 'auto', {'name': 'HatenaBlogSeparatedTracker', 'sampleRate': 10});
  ga('HatenaBlogSeparatedTracker.require', 'displayfeatures');
  ga('HatenaBlogSeparatedTracker.send', 'pageview');

    
      ga('create', 'UA-45988509-6', 'auto', {'name': 'HatenaBlogUserTracker'});
      ga('HatenaBlogUserTracker.require', 'displayfeatures');
      ga('HatenaBlogUserTracker.send', 'pageview');
    
  
  ga('create', 'UA-7855606-1', 'auto', {'name': 'HatenaGlobalTracker', 'sampleRate': 1});
  ga('HatenaGlobalTracker.require', 'displayfeatures');
  ga('HatenaGlobalTracker.send', 'pageview');
</script>
<!-- End Google Universal Analytics -->

    
    <div id="header-container">
     <div id="sp-suggest" style="display: none;"><a id="sp-suggest-link" href="index-page=1417086075.html#">スマートフォン用の表示で見る</a></div>
    </div>

    

<div class="quote-box">
  <div class="tooltip-quote tooltip-quote-star">
    <i class="blogicon-star" title="引用スターをつける"></i>
  </div>
  <div class="tooltip-quote tooltip-quote-stock">
    <i class="blogicon-quote" title="引用をストック"></i>
  </div>
</div>

<div class="message-box" id="quote-star-message-box" style="display: none; position: absolute;">
  スターをつけました
</div>

<div class="quote-stock-panel" id="quote-stock-message-box" style="position: absolute; z-index: 3000">
  <div class="message-box" id="quote-stock-succeeded-message" style="display: none">
    <p>引用をストックしました</p>
    <button class="btn btn-primary" id="quote-stock-show-editor-button" data-track-name="curation-quote-edit-button">ストック一覧を見る</button>
    <button class="btn quote-stock-close-message-button">閉じる</button>
  </div>

  <div class="message-box" id="quote-login-required-message" style="display: none">
    <p>引用するにはまずログインしてください</p>
    <button class="btn btn-primary" id="quote-login-button">ログイン</button>
    <button class="btn quote-stock-close-message-button">閉じる</button>
  </div>

  <div class="error-box" id="quote-stock-failed-message" style="display: none">
    <p>引用をストックできませんでした。再度お試しください</p>
    <button class="btn quote-stock-close-message-button">閉じる</button>
  </div>

  <div class="error-box" id="unstockable-quote-message-box" style="display: none; position: absolute; z-index: 3000;">
    <p>限定公開記事のため引用できません。</p>
  </div>
</div>

<script type="x-underscore-template" id="js-requote-button-template">
  <div class="requote-button js-requote-button">
    <button class="requote-button-btn tipsy-top" title="引用する"><i class="blogicon-quote"></i></button>
  </div>
</script>


    <div id="globalheader-container" >
  <iframe id="globalheader" height="37" frameborder="0" allowTransparency="true"></iframe>
</div>


    
    <div id="hidden-subscribe-button">
      <div class="hatena-follow-button-box btn-subscribe js-hatena-follow-button-box"
  
  >

  <a href="index-page=1417086075.html#" class="hatena-follow-button js-hatena-follow-button">
    <span class="subscribing">
      <span class="foreground">読者です</span>
      <span class="background">読者をやめる</span>
    </span>
    <span class="unsubscribing" data-track-name="profile-widget-subscribe-button" data-track-once>
      <span class="foreground">読者になる</span>
      <span class="background">読者になる</span>
    </span>
  </a>
  <div class="subscription-count-box js-subscription-count-box">
    <i></i>
    <u></u>
    <span class="subscription-count js-subscription-count">
    </span>
  </div>
</div>

    </div>

    <div id="container">
      <div id="container-inner">
        <header id="blog-title" data-brand="hatenablog">
  <div id="blog-title-inner" >
    <div id="blog-title-content">
      <h1 id="title"><a href="index.html">Rails Webook</a></h1>
      
        <h2 id="blog-description">自社のECを開発している会社で働いています。Rails情報やサービスを成長させる方法を書いていきます</h2>
      
    </div>
  </div>
</header>

        
          <div id="top-editarea">
            <!-- start Mixpanel --><script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
mixpanel.init("16db652100dca0a23c6a55a9205f0824");</script><!-- end Mixpanel -->
<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- rails top bar 728 x 90 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-2736751992834286"
     data-ad-slot="6687328050"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

          </div>
        
        
        



<div id="content" class="hfeed"
  
  >
  <div id="content-inner">
    <div id="wrapper">
      <div id="main">
        <div id="main-inner">
          
            
            <!-- google_ad_section_start -->
            <!-- rakuten_ad_target_begin -->
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-3600 words-400 mode-hatena entry-odd" id="entry-8454420450074927760" data-keyword-campaign="" data-uuid="8454420450074927760">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/26.html" rel="nofollow">
          <time pubdate datetime="2014-11-26T14:40:48Z" title="2014-11-26T14:40:48Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">26</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141126/1417012848.html" class="entry-title-link bookmark">Rails4でフォームに入力された値を取得するStrongParameters機能</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%E5%88%9D%E7%B4%9A.html">Rails初級</a>
          
          <a href="archive/category/Rails%20Controller.html">Rails Controller</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p>Rails4以降で導入されたフォームで入力された値のマスアサイメントを防ぐためのStrongParametersという機能について説明します。<br />
<br />
</p>

<div class="section">
    <h3>動作確認</h3>
    
<ul>
<li>Rails 4.1</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1417086075.html#ctrl-form-params">Railsのparamsメソッド</a></li>
<li><a href="index-page=1417086075.html#ctrl-form-strong-parameter">StrongParameterのメソッド</a></li>
</ol><p></p><br />
<p><h3 id="ctrl-form-params">1. Railsのparamsメソッド</h3>Railsではname属性には次のような規約があるため、コントローラー内の<code>params</code>メソッドで値をネストされたハッシュとして取得できます。</p>

<ul>
<li><code>product[name]</code>のように、name属性に<code>[名前]</code>をつけると、ネストしたハッシュとして受け取れる</li>
<li><code>product[category_ids][]</code>のように、name属性に<code>複数空の[]</code>をつけると、配列として値を受け取れる。</li>
</ul><p>例えば、次のような商品情報を登録するフォームから入力を受け付けたとします。</p>
<pre class="code lang-html" data-lang="html" data-unlink><span class="synIdentifier">&lt;</span><span class="synStatement">form</span><span class="synIdentifier"> </span><span class="synType">action</span><span class="synIdentifier">=</span><span class="synConstant">&quot;/products&quot;</span><span class="synIdentifier"> </span><span class="synType">method</span><span class="synIdentifier">=</span><span class="synConstant">&quot;post&quot;</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">style</span><span class="synIdentifier">=</span><span class="synConstant">&quot;display:none&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">input</span><span class="synIdentifier"> </span><span class="synType">name</span><span class="synIdentifier">=</span><span class="synConstant">&quot;utf8&quot;</span><span class="synIdentifier"> </span><span class="synType">type</span><span class="synIdentifier">=</span><span class="synConstant">&quot;hidden&quot;</span><span class="synIdentifier"> </span><span class="synType">value</span><span class="synIdentifier">=</span><span class="synConstant">&quot;✓&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">input</span><span class="synIdentifier"> </span><span class="synType">name</span><span class="synIdentifier">=</span><span class="synConstant">&quot;authenticity_token&quot;</span><span class="synIdentifier"> </span><span class="synType">type</span><span class="synIdentifier">=</span><span class="synConstant">&quot;hidden&quot;</span><span class="synIdentifier"> </span><span class="synType">value</span><span class="synIdentifier">=</span><span class="synConstant">&quot;gpATAhefgIhzK7cuGsWVuKGZCE4gJeEbrMv+a/wOJ+I=&quot;</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;field&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">label</span><span class="synIdentifier"> </span><span class="synType">for</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product_name&quot;</span><span class="synIdentifier">&gt;</span>Name<span class="synIdentifier">&lt;/</span><span class="synStatement">label</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">input</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product_name&quot;</span><span class="synIdentifier"> </span><span class="synType">name</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product[name]&quot;</span><span class="synIdentifier"> </span><span class="synType">type</span><span class="synIdentifier">=</span><span class="synConstant">&quot;text&quot;</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;field&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">label</span><span class="synIdentifier"> </span><span class="synType">for</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product_description&quot;</span><span class="synIdentifier">&gt;</span>Description<span class="synIdentifier">&lt;/</span><span class="synStatement">label</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">textarea</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product_description&quot;</span><span class="synIdentifier"> </span><span class="synType">name</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product[description]&quot;</span><span class="synIdentifier">&gt;&lt;/</span><span class="synStatement">textarea</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;field&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">label</span><span class="synIdentifier"> </span><span class="synType">for</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product_price&quot;</span><span class="synIdentifier">&gt;</span>Price<span class="synIdentifier">&lt;/</span><span class="synStatement">label</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">input</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product_price&quot;</span><span class="synIdentifier"> </span><span class="synType">name</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product[price]&quot;</span><span class="synIdentifier"> </span><span class="synType">type</span><span class="synIdentifier">=</span><span class="synConstant">&quot;number&quot;</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;field&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">label</span><span class="synIdentifier"> </span><span class="synType">for</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product_category&quot;</span><span class="synIdentifier">&gt;</span>Category<span class="synIdentifier">&lt;/</span><span class="synStatement">label</span><span class="synIdentifier">&gt;&lt;</span><span class="synStatement">br</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">input</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product_category_idx_1&quot;</span><span class="synIdentifier"> </span><span class="synType">name</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product[cateogory_ids][]&quot;</span><span class="synIdentifier"> </span><span class="synType">type</span><span class="synIdentifier">=</span><span class="synConstant">&quot;checkbox&quot;</span><span class="synIdentifier"> </span><span class="synType">value</span><span class="synIdentifier">=</span><span class="synConstant">&quot;1&quot;</span><span class="synIdentifier">&gt;</span> カテゴリ1
    <span class="synIdentifier">&lt;</span><span class="synStatement">input</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product_category_idx_2&quot;</span><span class="synIdentifier"> </span><span class="synType">name</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product[cateogory_ids][]&quot;</span><span class="synIdentifier"> </span><span class="synType">type</span><span class="synIdentifier">=</span><span class="synConstant">&quot;checkbox&quot;</span><span class="synIdentifier"> </span><span class="synType">value</span><span class="synIdentifier">=</span><span class="synConstant">&quot;2&quot;</span><span class="synIdentifier">&gt;</span> カテゴリ2
    <span class="synIdentifier">&lt;</span><span class="synStatement">input</span><span class="synIdentifier"> </span><span class="synType">id</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product_category_idx_3&quot;</span><span class="synIdentifier"> </span><span class="synType">name</span><span class="synIdentifier">=</span><span class="synConstant">&quot;product[cateogory_ids][]&quot;</span><span class="synIdentifier"> </span><span class="synType">type</span><span class="synIdentifier">=</span><span class="synConstant">&quot;checkbox&quot;</span><span class="synIdentifier"> </span><span class="synType">value</span><span class="synIdentifier">=</span><span class="synConstant">&quot;3&quot;</span><span class="synIdentifier">&gt;</span> カテゴリ3
  <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">div</span><span class="synIdentifier"> </span><span class="synType">class</span><span class="synIdentifier">=</span><span class="synConstant">&quot;actions&quot;</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">input</span><span class="synIdentifier"> </span><span class="synType">name</span><span class="synIdentifier">=</span><span class="synConstant">&quot;commit&quot;</span><span class="synIdentifier"> </span><span class="synType">type</span><span class="synIdentifier">=</span><span class="synConstant">&quot;submit&quot;</span><span class="synIdentifier"> </span><span class="synType">value</span><span class="synIdentifier">=</span><span class="synConstant">&quot;Create Product&quot;</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">div</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">form</span><span class="synIdentifier">&gt;</span>
</pre><p>このとき、<code>params</code>は次のような値を返します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>params
<span class="synComment">#=&gt; {</span>
<span class="synComment">#     &quot;utf8&quot;=&gt;&quot;✓&quot;,</span>
<span class="synComment">#     &quot;authenticity_token&quot;=&gt;&quot;gpATAhefgIhzK7cuGsWVuKGZCE4gJeEbrMv+a/wOJ+I=&quot;,</span>
<span class="synComment">#     &quot;product&quot; =&gt; {</span>
<span class="synComment">#         &quot;name&quot;=&gt;&quot;オレンジジュース&quot;,</span>
<span class="synComment">#         &quot;description&quot;=&gt;&quot;おいしーいオレンジジュース&quot;,</span>
<span class="synComment">#         &quot;price&quot;=&gt;&quot;100&quot;</span>
<span class="synComment">#         &quot;cateogory_ids&quot; =&gt; [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;]</span>
<span class="synComment">#     },</span>
<span class="synComment">#     &quot;commit&quot;=&gt;&quot;Create Product&quot;,</span>
<span class="synComment">#     &quot;action&quot;=&gt;&quot;create&quot;,</span>
<span class="synComment">#     &quot;controller&quot;=&gt;&quot;products&quot;</span>
<span class="synComment">#   }</span>
</pre><p></p><br />
<p><h3 id="ctrl-form-strong-parameter">2. StrongParameterのメソッド</h3>ハッシュで入力パラメーターを受け取れると、モデルの<code>new</code>、<code>update</code>などのメソッドにそのまま受け渡すことが可能です。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>params <span class="synComment"># =&gt; { &quot;name&quot; =&gt; &quot;田中太郎&quot;, &quot;email&quot; =&gt; &quot;taro@test.com&quot;, password&quot; =&gt; &quot;password&quot; }</span>
<span class="synType">User</span>.create(params) <span class="synComment"># =&gt; 新しいユーザーが作成される</span>
</pre><p>しかし、セキュリティの問題として、悪意あるユーザーが次のように入力パラメーターを付加して送ってきた場合、予期しないデータまで更新されてしまいます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>params <span class="synComment"># =&gt; { &quot;name&quot; =&gt; &quot;田中太郎&quot;, &quot;email&quot; =&gt; &quot;taro@test.com&quot;, password&quot; =&gt; &quot;password&quot;, &quot;admin&quot; =&gt; &quot;true&quot; }</span>
<span class="synType">User</span>.create(params) <span class="synComment"># =&gt; 新しいユーザーが管理者権限でで作成されてしまう</span>
</pre><p>このため、Rails3では、モデル内で次のように<code>attr_accessible</code>を使って明示的に記載することで、<b>更新できる値を制限</b>していました。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Rails3</span>
<span class="synPreProc">class</span> <span class="synType">Product</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  attr_accessible <span class="synConstant">:name</span>, <span class="synConstant">:email</span>, <span class="synConstant">:password</span>
<span class="synPreProc">end</span>
</pre><p>しかし、書かないと制限できないという性質上、制限し忘れということが有名なサイトなどでも発見されて、デフォルトで許可というのは良くないということになりました。<br />
そのため、Rails4からはデフォルトで拒否し、更新したい値を許可するという形になりました。<br />
それが、StrongParameterという機構であり、paramsの受け取る値（更新を許可する値）をコントローラー側で明示的に記載するようなりました。</p><p>paramsメソッドに<code>require</code>と<code>permit</code>を使うことで値を許可することができます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>  <span class="synPreProc">def</span> <span class="synIdentifier">create</span>
    <span class="synIdentifier">@product</span> = <span class="synType">Product</span>.new(product_params)

    <span class="synStatement">if</span> <span class="synIdentifier">@product</span>.save
      redirect_to <span class="synIdentifier">@product</span>, <span class="synConstant">notice</span>: <span class="synSpecial">'</span><span class="synConstant">Product was successfully created.</span><span class="synSpecial">'</span>
    <span class="synStatement">else</span>
      render <span class="synConstant">:new</span>
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>


  <span class="synStatement">private</span>
    <span class="synComment"># StrongParameter</span>
    <span class="synComment"># productのname, description, priceのみ返される(許可する)</span>
    <span class="synComment">#</span>
    <span class="synComment"># paramsの内容</span>
    <span class="synComment"># =&gt; {</span>
    <span class="synComment">#      &quot;utf8&quot;=&gt;&quot;✓&quot;,</span>
    <span class="synComment">#      &quot;authenticity_token&quot; =&gt; &quot;gpATAhefgIhzK7cuGsWVuKGZCE4gJeEbrMv+a/wOJ+I=&quot;,</span>
    <span class="synComment">#      &quot;product&quot;=&gt;</span>
    <span class="synComment">#         { &quot;name&quot;=&gt;&quot;111&quot;,</span>
    <span class="synComment">#           &quot;description&quot;=&gt;&quot;22&quot;,</span>
    <span class="synComment">#           &quot;price&quot;=&gt;&quot;100&quot;,</span>
    <span class="synComment">#           &quot;cateogory_ids&quot;=&gt;[&quot;1&quot;, &quot;2&quot;]</span>
    <span class="synComment">#         },</span>
    <span class="synComment">#      &quot;commit&quot;=&gt;&quot;Create Product&quot;,</span>
    <span class="synComment">#      &quot;action&quot;=&gt;&quot;create&quot;,</span>
    <span class="synComment">#      &quot;controller&quot;=&gt;&quot;products&quot;</span>
    <span class="synComment">#     }</span>
    <span class="synComment">#</span>
    <span class="synComment"># 返り値</span>
    <span class="synComment"># =&gt; {&quot;name&quot;=&gt;&quot;商品名&quot;, &quot;description&quot;=&gt;&quot;商品の説明&quot;, &quot;price&quot;=&gt;&quot;100&quot;}</span>
    <span class="synPreProc">def</span> <span class="synIdentifier">product_params</span>
      params.require(<span class="synConstant">:product</span>).permit(<span class="synConstant">:name</span>, <span class="synConstant">:description</span>, <span class="synConstant">:price</span>)

      <span class="synComment"># 配列も取得したい場合は、次のように記載します。</span>
      <span class="synComment"># params.require(:product)</span>
      <span class="synComment">#       .permit(:name, :description, :price, :cateogory_ids =&gt; [])</span>
    <span class="synPreProc">end</span>
</pre><p><br />
以上です。</p>

</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li>Rails3 レシピブック 190の技</li>
<li><a href="https://github.com/rails/strong_parameters">rails/strong_parameters &middot; GitHub</a></li>
</ul>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141126/1417012848.html"><time data-relative datetime="2014-11-26T14:40:48Z" title="2014-11-26T14:40:48Z" pubdate class="updated">2014-11-26 23:40</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141126/1417012848" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141126%2F1417012848" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141126/1417012848" data-count="vertical" data-text="Rails4でフォームに入力された値を取得するStrongParameters機能 - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141126/1417012848" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_0', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_0" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-5200 words-400 mode-hatena entry-even" id="entry-8454420450074922359" data-keyword-campaign="" data-uuid="8454420450074922359">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/25.html" rel="nofollow">
          <time pubdate datetime="2014-11-25T12:35:57Z" title="2014-11-25T12:35:57Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">25</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141125/1416918957.html" class="entry-title-link bookmark">よく忘れるRailsのコントローラーでのrenderメソッドのレシピ集</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%E5%88%9D%E7%B4%9A.html">Rails初級</a>
          
          <a href="archive/category/Rails%20Controller.html">Rails Controller</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>のコントローラーでの<code>render</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>の使い方について説明します。<br />
<code>render</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>は、「コントローラー(Controller)」と「ビュー(View)」のそれぞれにあります。<br />
ここではコントローラーのrender<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>の使い方を示します。<br />
ビューでのrender<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>の使い方は <a href="entry/20140807/1407419013.html" target="_blank">こちら</a>を参照してください。<br />
<br />
</p>

<div class="section">
    <h3>動作確認</h3>
    
<ul>
<li><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a> 4.1</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ul>
<li><a href="index-page=1417086075.html#render-ctrl-render-desc">1. ビューを表示する</a>
<ul>
<li><a href="index-page=1417086075.html#render-ctrl-render">1.1. 暗黙的なビューの表示する</a></li>
<li><a href="index-page=1417086075.html#render-ctrl-render-action">1.2. 他のアクションのビューを表示する(actionオプション)</a></li>
<li><a href="index-page=1417086075.html#render-ctrl-render-temp">1.3. 他のコントローラーのビューを表示する(templateオプション)</a></li>
</ul></li>
<li><a href="index-page=1417086075.html#render-ctrl-json-desc">2. JSONを返す</a>
<ul>
<li><a href="index-page=1417086075.html#render-ctrl-json-render">2.1. renderメソッド</a></li>
<li><a href="index-page=1417086075.html#render-ctrl-json-jbuilder">2.2. jbuilder</a></li>
<li><a href="index-page=1417086075.html#render-ctrl-json-serializer">2.3. ActiveModelSerializer</a></li>
</ul></li>
<li><a href="index-page=1417086075.html#render-ctrl-not-view">3. ビュー以外を表示する</a>
<ul>
<li><a href="index-page=1417086075.html#render-ctrl-render-text">3.1. 文字列を表示する(textオプション)</a></li>
<li><a href="index-page=1417086075.html#render-ctrl-render-xml">3.2. XMLを返す(xmlオプション)</a></li>
</ul></li>
<li><a href="index-page=1417086075.html#render-ctrl-only-status-code">4. ステータスコードのみを返す</a></li>
<li><a href="index-page=1417086075.html#render-ctrl-respond-to">5. リクエストの種類に応じて、レスポンスのフォーマットを変更する</a></li>
<li><a href="index-page=1417086075.html#render-ctrl-render-to-string">6. テンプレートを文字列として取得する(デバッグなどで使える)</a></li>
<li><a href="index-page=1417086075.html#render-ctrl-status-code">7. よく使うステータスコード</a></li>
</ul><p></p><br />
<p><h3 id="render-ctrl-render-desc">1. ビューを表示する</h4><h4 id="render-ctrl-render">1.1. 暗黙的なビューの表示する</h4><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>はコントローラ名と<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>名からrender<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を記載しなくても自動的に<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EC%A5%F3%A5%C0%A5%EA%A5%F3%A5%B0">レンダリング</a>するビューを特定します。<br />
<b>ルールは「app/views/コントローラ名/<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>名.html.erb」を呼び出します。</b></p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/controllers/products_controller.rb</span>

<span class="synComment"># GET /products</span>
<span class="synComment"># 暗黙的に「app/views/products/index.html.erb」を呼び出す</span>
<span class="synPreProc">def</span> <span class="synIdentifier">index</span>  <span class="synComment"># indexはアクション名</span>
  <span class="synIdentifier">@products</span> = <span class="synType">Product</span>.all
<span class="synPreProc">end</span>
</pre><p><br />
<h4 id="render-ctrl-render-action">1.2. 他のアクションのビューを表示する(actionオプション)</h4>actionオプションを指定することにより、 <b>同じコントローラー内</b>のビューファイルを明示的に指定することができます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/controllers/products_controller.rb</span>

<span class="synComment"># GET /products</span>
<span class="synComment"># renderメソッドは、「app/views/products/new.html.erb」を呼び出す</span>
<span class="synPreProc">def</span> <span class="synIdentifier">index</span>
  <span class="synIdentifier">@products</span> = <span class="synType">Product</span>.all
  render <span class="synConstant">action</span>: <span class="synConstant">:new</span>  <span class="synComment"># 引数は :new のようなシンボルでも、'new' のような文字列でも良い</span>
<span class="synPreProc">end</span>
</pre><p>layoutオプションを指定することで、レイアウトファイルを指定することができます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># special_layoutというレイアウトを使用して、new.html.erbテンプレートを表示する</span>
render <span class="synConstant">action</span>: <span class="synConstant">:new</span>, <span class="synConstant">layout</span>: <span class="synConstant">:special_layout</span>

<span class="synComment"># レイアウトを表示しないで、new.html.erbテンプレートのみを表示する</span>
render <span class="synConstant">action</span>: <span class="synConstant">:new</span>, <span class="synConstant">layout</span>: <span class="synConstant">false</span>

<span class="synComment"># レイアウトを指定しない場合は、コントローラーのデフォルトのレイアウトが使われて、</span>
<span class="synComment"># new.html.erbテンプレートを表示する</span>
render <span class="synConstant">action</span>: <span class="synConstant">:new</span>
</pre><p><br />
<h4 id="render-ctrl-render-temp">1.3. 他のコントローラーのビューを表示する(templateオプション)</h4><b>他のコントローラー</b>のビューファイルを呼び出すためには、<code>template</code>オプションを利用します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/views/welcome/index.html.erb を表示する</span>
render <span class="synConstant">template</span>: <span class="synSpecial">&quot;</span><span class="synConstant">welcome/index</span><span class="synSpecial">&quot;</span>
</pre><p></p><p><h3 id="render-ctrl-json-desc">2. <a class="keyword" href="http://d.hatena.ne.jp/keyword/JSON">JSON</a>を返す</h4><h4 id="render-ctrl-json-render">2.1. render<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a></h4>render<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>に<code>json</code>オプションを追加すると<a class="keyword" href="http://d.hatena.ne.jp/keyword/JSON">JSON</a>としてレスポンスを返します。<br />
指定したオブジェクトに<code>to_json</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>があれば、自動的に<a class="keyword" href="http://d.hatena.ne.jp/keyword/JSON">JSON</a>形式に変換して返します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">def</span> <span class="synIdentifier">index</span>
  <span class="synIdentifier">@products</span> = <span class="synType">Product</span>.all
  render <span class="synConstant">json</span>: <span class="synIdentifier">@products</span>
<span class="synPreProc">end</span>
</pre><p><a class="keyword" href="http://d.hatena.ne.jp/keyword/JSON">JSON</a>形式として次のように返されます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>[
  {<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>:<span class="synConstant">1</span>,<span class="synSpecial">&quot;</span><span class="synConstant">name</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">ジュース</span><span class="synSpecial">&quot;</span>,<span class="synSpecial">&quot;</span><span class="synConstant">description</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">おいしいジュース</span><span class="synSpecial">&quot;</span>,<span class="synSpecial">&quot;</span><span class="synConstant">price</span><span class="synSpecial">&quot;</span>:<span class="synConstant">100</span>,<span class="synSpecial">&quot;</span><span class="synConstant">created_at</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">2014-11-23T07:12:19.942Z</span><span class="synSpecial">&quot;</span>,<span class="synSpecial">&quot;</span><span class="synConstant">updated_at</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">2014-11-23T07:12:19.942Z</span><span class="synSpecial">&quot;</span>},
  {<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>:<span class="synConstant">2</span>,<span class="synSpecial">&quot;</span><span class="synConstant">name</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">ハンバーガー</span><span class="synSpecial">&quot;</span>,<span class="synSpecial">&quot;</span><span class="synConstant">description</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">普通のハンバーガー</span><span class="synSpecial">&quot;</span>,<span class="synSpecial">&quot;</span><span class="synConstant">price</span><span class="synSpecial">&quot;</span>:<span class="synConstant">120</span>,<span class="synSpecial">&quot;</span><span class="synConstant">created_at</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">2014-11-23T07:12:31.892Z</span><span class="synSpecial">&quot;</span>,<span class="synSpecial">&quot;</span><span class="synConstant">updated_at</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">2014-11-23T07:12:31.892Z</span><span class="synSpecial">&quot;</span>}
]
</pre><p><br />
<h4 id="render-ctrl-json-jbuilder">2.2. <a class="keyword" href="http://d.hatena.ne.jp/keyword/jbuilder">jbuilder</a></h4>また、Rails4.1には<code>jbuilder</code>というgemがデフォルトで入っており、テンプレートファイルで<a class="keyword" href="http://d.hatena.ne.jp/keyword/JSON">JSON</a>を生成することができます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/views/products/index.json.jbuilder</span>

json.array!(<span class="synIdentifier">@products</span>) <span class="synStatement">do</span> |<span class="synIdentifier">product</span>|
  json.extract! product, <span class="synConstant">:id</span>, <span class="synConstant">:name</span>, <span class="synConstant">:description</span>, <span class="synConstant">:price</span>
  json.url product_url(product, <span class="synConstant">format</span>: <span class="synConstant">:json</span>)
<span class="synStatement">end</span>
</pre><p><code>localhost:3000/products.json</code>にアクセすると次のように結果が表示されます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>[
  {<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>:<span class="synConstant">1</span>,<span class="synSpecial">&quot;</span><span class="synConstant">name</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">ジュース</span><span class="synSpecial">&quot;</span>,<span class="synSpecial">&quot;</span><span class="synConstant">description</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">おいしいジュース</span><span class="synSpecial">&quot;</span>,<span class="synSpecial">&quot;</span><span class="synConstant">price</span><span class="synSpecial">&quot;</span>:<span class="synConstant">100</span>,<span class="synSpecial">&quot;</span><span class="synConstant">url</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">http://localhost:3000/products/1.json</span><span class="synSpecial">&quot;</span>},
  {<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>:<span class="synConstant">2</span>,<span class="synSpecial">&quot;</span><span class="synConstant">name</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">ハンバーガー</span><span class="synSpecial">&quot;</span>,<span class="synSpecial">&quot;</span><span class="synConstant">description</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">普通のハンバーガー</span><span class="synSpecial">&quot;</span>,<span class="synSpecial">&quot;</span><span class="synConstant">price</span><span class="synSpecial">&quot;</span>:<span class="synConstant">120</span>,<span class="synSpecial">&quot;</span><span class="synConstant">url</span><span class="synSpecial">&quot;</span>:<span class="synSpecial">&quot;</span><span class="synConstant">http://localhost:3000/products/2.json</span><span class="synSpecial">&quot;</span>}
]
</pre><p><h4 id="render-ctrl-json-serializer">2.3. ActiveModelSerializer</h4><a href="https://github.com/rails-api/active_model_serializers">active_model_serializer</a>というgemによりモデルのように定義することで<a class="keyword" href="http://d.hatena.ne.jp/keyword/JSON">JSON</a>を返すこともできます。</p><br />
<br />
<p><h3 id="render-ctrl-not-view">3. ビュー以外を表示する</h4><h4 id="render-ctrl-render-text">3.1. 文字列を表示する(textオプション)</h4>render<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>に<code>text</code>オプションを指定することで、テンプレートではなく、文字列を直接表示することが可能です。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>render <span class="synConstant">text</span>: <span class="synSpecial">&quot;</span><span class="synConstant">Hello, world!</span><span class="synSpecial">&quot;</span>
</pre><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141123/20141123165933.png" alt="f:id:nipe880324:20141123165933p:plain:w240" title="f:id:nipe880324:20141123165933p:plain:w240" class="hatena-fotolife" style="width:240px" itemprop="image"></span></p><br />
<p>デフォルトではレイアウトは適用されていません。レイアウトを適用するには、<code>layout: true</code>を指定します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>render <span class="synConstant">text</span>: <span class="synSpecial">&quot;</span><span class="synConstant">Hello, world!</span><span class="synSpecial">&quot;</span>, <span class="synConstant">layout</span>: <span class="synConstant">true</span>
</pre><p><br />
<h4 id="render-ctrl-render-xml">3.2. <a class="keyword" href="http://d.hatena.ne.jp/keyword/XML">XML</a>を返す(<a class="keyword" href="http://d.hatena.ne.jp/keyword/xml">xml</a>オプション)</h4>render<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>に<code>xml</code>オプションを指定することで、テンプレートではなく、<a class="keyword" href="http://d.hatena.ne.jp/keyword/XML">XML</a>を返すことが可能です。<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/XML">XML</a>の表示には、<code>to_xml</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>が用いられます。また、Content-Typeは<b>application/<a class="keyword" href="http://d.hatena.ne.jp/keyword/xml">xml</a>; charset=<a class="keyword" href="http://d.hatena.ne.jp/keyword/utf-8">utf-8</a></b>です。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synPreProc">def</span> <span class="synIdentifier">index</span>
  <span class="synIdentifier">@products</span> = <span class="synType">Product</span>.all
  render <span class="synConstant">xml</span>: <span class="synIdentifier">@products</span>  <span class="synComment"># @products.to_xml の結果が返される</span>
<span class="synPreProc">end</span>
</pre><p>次にように<a class="keyword" href="http://d.hatena.ne.jp/keyword/XML">XML</a>が返されます。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141123/20141123165935.png" alt="f:id:nipe880324:20141123165935p:plain:w480" title="f:id:nipe880324:20141123165935p:plain:w480" class="hatena-fotolife" style="width:480px" itemprop="image"></span></p><br />
<br />
<br />
<p><h3 id="render-ctrl-only-status-code">4. <a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%C6%A1%BC%A5%BF%A5%B9%A5%B3%A1%BC%A5%C9">ステータスコード</a>のみを返す</h4><a class="keyword" href="http://d.hatena.ne.jp/keyword/API">API</a>として動作するアクションなどでは、レスポンスの本文は省略し、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%C6%A1%BC%A5%BF%A5%B9%A5%B3%A1%BC%A5%C9">ステータスコード</a>のみで成功/失敗を伝えれば良い時があります。<br />
そういう場合は、<code>head</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を使います。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink>head <span class="synConstant">200</span>   <span class="synComment"># 200を返す</span>
head <span class="synConstant">:ok</span>   <span class="synComment"># 200を返す</span>
</pre><p>第2引数にパラメーターを指定すると、HTTPヘッダの内容を指定できます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># createdは201コード。locationヘッダも指定しリソースが作られたことを伝えるために使われる</span>
head <span class="synConstant">:created</span>, <span class="synConstant">location</span>: product_path(<span class="synIdentifier">@person</span>)
</pre><p>例外を除去するために、次のようにすることも可能です。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synStatement">return</span> head(<span class="synConstant">:method_not_allowed</span>) <span class="synStatement">unless</span> request.post?
<span class="synStatement">return</span> head(<span class="synConstant">:bad_request</span>) <span class="synStatement">unless</span> valid_request?
render
</pre><p><i><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%C6%A1%BC%A5%BF%A5%B9%A5%B3%A1%BC%A5%C9">ステータスコード</a>については、「<a href="index-page=1417086075.html#">良く使うステータスコード一覧</a>」を参照してください。</i></p><br />
<br />
<br />
<p><h3 id="render-ctrl-respond-to">5. リクエストの種類に応じて、レスポンスのフォーマットを変更する</h4><code>resopnd_to</code>を使うことで、<a class="keyword" href="http://d.hatena.ne.jp/keyword/JSON">JSON</a>形式や<a class="keyword" href="http://d.hatena.ne.jp/keyword/XML">XML</a>などの形式でデータを返すことができます。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/controllers/products_controller.rb</span>

<span class="synComment"># 下記のリクエストに応じて、それぞれの形式でレスポンスを返す</span>
<span class="synComment"># GET /products/1</span>
<span class="synComment"># GET /products/1.json</span>
<span class="synComment"># GET /products/1.xml</span>
<span class="synComment"># GET /products/1.yaml</span>
<span class="synPreProc">def</span> <span class="synIdentifier">show</span>
  <span class="synIdentifier">@product</span> = <span class="synType">Product</span>.find(params[<span class="synConstant">:id</span>)

  respond_to <span class="synStatement">do</span> |<span class="synIdentifier">format</span>|
    format.html <span class="synComment"># show.html.erb</span>
    format.json { render <span class="synConstant">json</span>: <span class="synIdentifier">@product</span> } <span class="synComment"># JSON形式</span>
    format.xml  { render <span class="synConstant">xml</span>:  <span class="synIdentifier">@product</span> } <span class="synComment"># XML形式</span>
    format.yaml { render <span class="synConstant">text</span>: <span class="synIdentifier">@product</span>.to_yaml } <span class="synComment"># YAML形式</span>
  <span class="synStatement">end</span>
<span class="synPreProc">end</span>
</pre><p></p><br />
<p><h3 id="render-ctrl-render-to-string">6. テンプレートを文字列として取得する(<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%D0%A5%C3%A5%B0">デバッグ</a>などで使える)</h4>テンプレートの処理結果を画面に表示せず、文字列として取得したい場合は、<code>render_to_string</code><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>を使います。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># index.html</span>
html_str = render_to_string <span class="synConstant">action</span>: <span class="synConstant">:index</span>
p html_str
<span class="synComment"># =&gt; &quot;&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  ...</span>
</pre><p></p><br />
<p><h3 id="render-ctrl-status-code">7. よく使う<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%C6%A1%BC%A5%BF%A5%B9%A5%B3%A1%BC%A5%C9">ステータスコード</a></h4><table>
<thead>
  <tr>
    <th>Code</th><th>シンボル</th><th>説明</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>200</td><td>:ok</td><td>レスポンスが正常に終了した</td>
  </tr>
  <tr>
    <td>201</td><td>:created</td><td>createなどのアクションの結果などでリソースが正常に作成された。作成されたリソースに対するlocationヘッダも指定する</td>
  </tr>
  <tr>
    <td>302</td><td>:found</td><td>他のURLへのリダイレクトを示す。redirect_to<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BD%A5%C3%A5%C9">メソッド</a>が内部的に使っていて明示的に使うことは少ない</td>
  </tr>
  <tr>
    <td>400</td><td>:bad_request</td><td>リクエストチェックをした結果、不正だった</td>
  </tr>
  <tr>
    <td>401</td><td>:unauthorized</td><td>認証に失敗した</td>
  </tr>
  <tr>
    <td>403</td><td>:forbidden</td><td>アクセスが禁止されている</td>
  </tr>
  <tr>
    <td>404</td><td>:not_found</td><td>対象のURLやリソースが存在しない</td>
  </tr>
  <tr>
    <td>406</td><td>:not_acceptable</td><td>指定されたフォーマットでレスポンスを返せない。respond_toの指定ミスなどで起こる</td>
  </tr>
  <tr>
    <td>422</td><td>:unprocessable_entity</td><td>バリデーションエラーなど</td>
  </tr>
  <tr>
    <td>500</td><td>:internal_server_<a class="keyword" href="http://d.hatena.ne.jp/keyword/error">error</a></td><td>サーバー側が現認のシステムエラーが発生した</td>
  </tr>
  <tr>
    <td>503</td><td>:service_unavailable</td><td>メンテナンスや高負荷など</td>
  </tr>
</tbody>
</table></p><br />
<p>以上です。<br />
なにかありましたら、コメントいただけると嬉しいです。</p>

</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li>Rails3 レシピブック 190の技</li>
</ul>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141125/1416918957.html"><time data-relative datetime="2014-11-25T12:35:57Z" title="2014-11-25T12:35:57Z" pubdate class="updated">2014-11-25 21:35</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141125/1416918957" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141125%2F1416918957" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141125/1416918957" data-count="vertical" data-text="よく忘れるRailsのコントローラーでのrenderメソッドのレシピ集 - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141125/1416918957" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
          <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4438296558807254"
     data-ad-slot="4370884664"
     data-ad-format="horizontal"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-4000 words-400 mode-hatena entry-odd" id="entry-8454420450073924608" data-keyword-campaign="" data-uuid="8454420450073924608">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/20.html" rel="nofollow">
          <time pubdate datetime="2014-11-20T11:32:16Z" title="2014-11-20T11:32:16Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">20</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141120/1416483136.html" class="entry-title-link bookmark">RailsでCSV/Excel/OpenOfficeのアップロード機能の実装方法</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/CSV%7CExcel.html">CSV/Excel</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p>RailsでCSV/Excel/OpenOfficeのアップロード機能の実装方法について説明します。</p>

<div class="section">
    <h3>動作確認</h3>
    
<ul>
<li>Ruby 2.1</li>
<li>Rails 4.1</li>
<li>Roo 1.13.2</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1417086075.html#csv_import_create_project">Railsプロジェクトの作成</h3></li>
<li><a href="index-page=1417086075.html#csv_import_import_csv">CSVのインポート機能の実装</a></li>
<li><a href="index-page=1417086075.html#csv_import_import_excel">Excelのインポート機能の実装</a></li>
</ol><p></p><p><h3 id="csv_import_create_project">1. Railsプロジェクトの作成</h3>まず、Raislのプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new csv_import_test
cd csv_import_test</pre><p>そして、必要なコントローラー、ビュー、モデルを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails g controller Products index
rails g model Product name:string price:integer released_on:date
rake db:migrate</pre><p><br />
CSV出力するためのデータを作成します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># db/seeds.rb</span>

names = <span class="synSpecial">%w(</span><span class="synConstant">レコーダー イヤホン マイク Webカメラ 洗濯機 冷蔵庫 エアコン ノートPC 40型TV デジタルカメラ</span><span class="synSpecial">)</span>

names.each <span class="synStatement">do</span> |<span class="synIdentifier">name</span>|
  random = [*<span class="synConstant">1</span>..<span class="synConstant">10</span>].sample  <span class="synComment"># 1から10のランダム値を取得</span>
  <span class="synType">Product</span>.create! <span class="synConstant">name</span>: name, <span class="synConstant">price</span>: random * <span class="synConstant">1000</span>, <span class="synConstant">released_on</span>: random.day.ago
<span class="synStatement">end</span>
</pre><p>DBにデータを投入します。</p>
<pre class="code" data-lang="" data-unlink>rake db:seed</pre><p>そして、コントローラーのindexアクションを実装します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/contollers/products_contoller.rb</span>
<span class="synPreProc">class</span> <span class="synType">ProductsController</span> &lt; <span class="synType">ApplicationController</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">index</span>
    <span class="synIdentifier">@products</span> = <span class="synType">Product</span>.all
  <span class="synPreProc">end</span>
<span class="synPreProc">end</span>
</pre><p><br />
そして、ビューを作成します。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/products/index.html.erb
<span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>商品一覧<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>ID<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>名前<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>値段<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>発売日<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">tbody</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;% @products.each do |product| %&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.id</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.name</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.price</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.released_on</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;% end %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">tbody</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
</pre><p>そして、最後にルートを追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">Rails</span>.application.routes.draw <span class="synStatement">do</span>
  root <span class="synSpecial">'</span><span class="synConstant">products#index</span><span class="synSpecial">'</span>
  resources <span class="synSpecial">'</span><span class="synConstant">products</span><span class="synSpecial">'</span>, <span class="synConstant">only</span>: <span class="synConstant">:index</span>
<span class="synStatement">end</span>
</pre><p><code>rails s</code>でサーバーを起動して画面を確認しましょう。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141115/20141115151914.png" alt="f:id:nipe880324:20141115151914p:plain:w380" title="f:id:nipe880324:20141115151914p:plain:w380" class="hatena-fotolife" style="width:380px" itemprop="image"></span></p><br />
<br />
<br />
<p><h3 id="csv_import_import_csv">2. CSVのアップロード機能の実装/</h3>では、アップロード機能を実装します。</p><p>CSVを処理できるようにするために、Ruby標準ライブラリの<code>csv</code>を追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># config/application.rb</span>
<span class="synPreProc">require</span> <span class="synType">File</span>.expand_path(<span class="synSpecial">'</span><span class="synConstant">../boot</span><span class="synSpecial">'</span>, <span class="synConstant">__FILE__</span>)

<span class="synPreProc">require</span> <span class="synSpecial">'</span><span class="synConstant">rails/all</span><span class="synSpecial">'</span>
<span class="synPreProc">require</span> <span class="synSpecial">'</span><span class="synConstant">csv</span><span class="synSpecial">'</span>
</pre><p>ビューにファイルをアップロードする入力フィールドを追加します。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/products/index.html.erb

<span class="synComment">&lt;!-- ページの一番下に追加 --&gt;</span>
<span class="synIdentifier">&lt;%=</span><span class="synConstant"> form_tag</span><span class="synIdentifier"> import_products_path, multipart: true do %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> file_field_tag</span><span class="synIdentifier"> :file %&gt;</span>
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> submit_tag</span><span class="synIdentifier"> </span><span class="synConstant">&quot;インポート&quot;</span><span class="synIdentifier"> %&gt;</span>
<span class="synIdentifier">&lt;% end %&gt;</span>
</pre><p>ルートを追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># config/routes.rb</span>

resources <span class="synSpecial">'</span><span class="synConstant">products</span><span class="synSpecial">'</span>, <span class="synConstant">only</span>: <span class="synConstant">:index</span> <span class="synStatement">do</span>
  collection { post <span class="synConstant">:import</span> }
<span class="synStatement">end</span>
</pre><p>コントローラーでファイルを受け取り、リダイレクトします。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/controllers/products_controller.rb</span>

<span class="synPreProc">def</span> <span class="synIdentifier">import</span>
  <span class="synComment"># fileはtmpに自動で一時保存される</span>
  <span class="synType">Product</span>.import(params[<span class="synConstant">:file</span>])
  redirect_to root_url, <span class="synConstant">notice</span>: <span class="synSpecial">&quot;</span><span class="synConstant">商品を追加しました。</span><span class="synSpecial">&quot;</span>
<span class="synPreProc">end</span>
</pre><p>CSVを読み込んで、DBに登録するインポート処理を実装します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/product.rb</span>

<span class="synPreProc">class</span> <span class="synType">Product</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>

  <span class="synPreProc">def</span> <span class="synConstant">self</span>.<span class="synIdentifier">import</span>(file)
    <span class="synType">CSV</span>.foreach(file.path, <span class="synConstant">headers</span>: <span class="synConstant">true</span>) <span class="synStatement">do</span> |<span class="synIdentifier">row</span>|
      <span class="synComment"># IDが見つかれば、レコードを呼び出し、見つかれなければ、新しく作成</span>
      product = find_by(<span class="synConstant">id</span>: row[<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>]) || new
      <span class="synComment"># CSVからデータを取得し、設定する</span>
      product.attributes = row.to_hash.slice(*updatable_attributes)
      <span class="synComment"># 保存する</span>
      product.save!
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>

  <span class="synComment"># 更新を許可するカラムを定義</span>
  <span class="synPreProc">def</span> <span class="synConstant">self</span>.<span class="synIdentifier">updatable_attributes</span>
    [<span class="synSpecial">&quot;</span><span class="synConstant">name</span><span class="synSpecial">&quot;</span>, <span class="synSpecial">&quot;</span><span class="synConstant">price</span><span class="synSpecial">&quot;</span>, <span class="synSpecial">&quot;</span><span class="synConstant">released_on</span><span class="synSpecial">&quot;</span>]
  <span class="synPreProc">end</span>
<span class="synPreProc">end</span>
</pre><p>サーバーを再起動して、ファイルをアップロードします。</p><p>アップロードするファイルの内容は次の通りです。</p>
<pre class="code" data-lang="" data-unlink>id,name,price,released_on
10,一眼デジタルカメラ,300,2014-11-13
11,Bar,100,2014-12-01</pre><p>では、アップロードしてみます。<br />
アップロードすると、ID10の商品が更新され、ID11の商品が追加されています。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141115/20141115152012.png" alt="f:id:nipe880324:20141115152012p:plain:w380" title="f:id:nipe880324:20141115152012p:plain:w380" class="hatena-fotolife" style="width:380px" itemprop="image"></span></p><br />
<br />
<br />
<p><h3 id="csv_import_import_excel">3. Excelのインポート機能の実装/</h3>次は、Excelのインポート機能の実装です。</p><p><a hfre="https://github.com/Empact/roo" target="_blank">roo</a>というExcel, CSV, OpenOffice, GoogleSpreadSheetを開くことができるGemを利用します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># Gemfile</span>
gem <span class="synSpecial">'</span><span class="synConstant">roo</span><span class="synSpecial">'</span>
</pre><p>バンドルインストールします。</p>
<pre class="code" data-lang="" data-unlink>bundle install</pre><p>ファイル読み込みの箇所を拡張子に合わせて、Rooを使って読み込むようにします。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/product.rb</span>

<span class="synPreProc">class</span> <span class="synType">Product</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>

  <span class="synPreProc">def</span> <span class="synConstant">self</span>.<span class="synIdentifier">import</span>(file)
    spreadsheet = open_spreadsheet(file)
    header = spreadsheet.row(<span class="synConstant">1</span>)

    (<span class="synConstant">2</span>..spreadsheet.last_row).each <span class="synStatement">do</span> |<span class="synIdentifier">i</span>|
      <span class="synComment"># {カラム名 =&gt; 値, ...} のハッシュを作成する</span>
      row = <span class="synType">Hash</span>[[header, spreadsheet.row(i)].transpose]

      <span class="synComment"># IDが見つかれば、レコードを呼び出し、見つかれなければ、新しく作成</span>
      product = find_by(<span class="synConstant">id</span>: row[<span class="synSpecial">&quot;</span><span class="synConstant">id</span><span class="synSpecial">&quot;</span>]) || new
      <span class="synComment"># CSVからデータを取得し、設定する</span>
      product.attributes = row.to_hash.slice(*updatable_attributes)
      <span class="synComment"># 保存する</span>
      product.save!
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>

  <span class="synPreProc">def</span> <span class="synConstant">self</span>.<span class="synIdentifier">open_spreadsheet</span>(file)
    <span class="synStatement">case</span> <span class="synType">File</span>.extname(file.original_filename)
    <span class="synStatement">when</span> <span class="synSpecial">'</span><span class="synConstant">.csv</span><span class="synSpecial">'</span>  <span class="synStatement">then</span> <span class="synType">Roo</span>::<span class="synType">Csv</span>.new(file.path,    <span class="synConstant">nil</span>, <span class="synConstant">:ignore</span>)
    <span class="synStatement">when</span> <span class="synSpecial">'</span><span class="synConstant">.xls</span><span class="synSpecial">'</span>  <span class="synStatement">then</span> <span class="synType">Roo</span>::<span class="synType">Excel</span>.new(file.path,  <span class="synConstant">nil</span>, <span class="synConstant">:ignore</span>)
    <span class="synStatement">when</span> <span class="synSpecial">'</span><span class="synConstant">.xlsx</span><span class="synSpecial">'</span> <span class="synStatement">then</span> <span class="synType">Roo</span>::<span class="synType">Excelx</span>.new(file.path, <span class="synConstant">nil</span>, <span class="synConstant">:ignore</span>)
    <span class="synStatement">when</span> <span class="synSpecial">'</span><span class="synConstant">.ods</span><span class="synSpecial">'</span>  <span class="synStatement">then</span> <span class="synType">Roo</span>::<span class="synType">OpenOffice</span>.new(file.path, <span class="synConstant">nil</span>, <span class="synConstant">:ignore</span>)
    <span class="synStatement">else</span> <span class="synStatement">raise</span> <span class="synSpecial">&quot;</span><span class="synConstant">Unknown file type: </span><span class="synSpecial">#{</span>file.original_filename<span class="synSpecial">}&quot;</span>
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>

  ...
<span class="synPreProc">end</span>
</pre><p>では、サーバーを再起動して、ファイルをアップロードしましょう。<br />
今回は、OpenOfficeで次のようなファイルを作成しました。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141115/20141115152141.png" alt="f:id:nipe880324:20141115152141p:plain:w320" title="f:id:nipe880324:20141115152141p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><p>アップロードすると、ID11の商品が更新され、ID12の商品が追加されていることがわかります。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141115/20141115152225.png" alt="f:id:nipe880324:20141115152225p:plain:w380" title="f:id:nipe880324:20141115152225p:plain:w380" class="hatena-fotolife" style="width:380px" itemprop="image"></span></p><br />
<p>以上です。</p>

</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li><a href="http://railscasts.com/episodes/396-importing-csv-and-excel:tilte">http://railscasts.com/episodes/396-importing-csv-and-excel:tilte</a></li>
</ul>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141120/1416483136.html"><time data-relative datetime="2014-11-20T11:32:16Z" title="2014-11-20T11:32:16Z" pubdate class="updated">2014-11-20 20:32</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141120/1416483136" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141120%2F1416483136" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141120/1416483136" data-count="vertical" data-text="RailsでCSV/Excel/OpenOfficeのアップロード機能の実装方法 - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141120/1416483136" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user_2nd', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_1', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_1" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-4800 words-600 mode-hatena entry-even" id="entry-8454420450073903806" data-keyword-campaign="" data-uuid="8454420450073903806">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/19.html" rel="nofollow">
          <time pubdate datetime="2014-11-19T12:01:12Z" title="2014-11-19T12:01:12Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">19</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141119/1416398472.html" class="entry-title-link bookmark">RailsでCSV/Excelのダウンロード機能の実装方法</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/CSV%7CExcel.html">CSV/Excel</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p>RailsでCSVやExcelをダウンロード（エクスポート）する方法を説明します。<br />
<a href="entry/20141008/1412774436.html" target="_blank">Ransack</a>などで検索機能をつければ、検索結果に応じたCSV/Excel出力も可能です。</p>

<div class="section">
    <h3>動作確認</h3>
    
<ul>
<li>Ruby 2.1</li>
<li>Rails 4.1</li>
</ul>
</div>
<div class="section">
    <h3>目次</h3>
    
<ol>
<li><a href="index-page=1417086075.html#csv_export_create_project">Railsプロジェクトの作成</a></li>
<li><a href="index-page=1417086075.html#csv_export_download_csv">CSVのダウンロード機能の実装</a></li>
<li><a href="index-page=1417086075.html#csv_export_download_excel">Excelのダウンロード機能の実装</a></li>
</ol><p><br />
<h3 id="csv_export_create_project">Railsプロジェクトの作成</h3></p><p>まず、Raislのプロジェクトを作成します。</p>
<pre class="code" data-lang="" data-unlink>rails new csv_export_test
cd csv_export_test</pre><p>そして、必要なコントローラー、ビュー、モデルを作成します。<br />
製造者(Manufacture)と製品(Product)が1対Nの関係にします。</p>
<pre class="code" data-lang="" data-unlink>rails g controller Products index
rails g model Manufacture name:string
rails g model Product name:string price:integer released_on:date manufacture:references
rake db:migrate</pre><p>モデルにAssociationを追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/manufacture.rb</span>

<span class="synPreProc">class</span> <span class="synType">Manufacture</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  has_many <span class="synConstant">:products</span>
<span class="synPreProc">end</span>
</pre><p><br />
CSV出力するためのデータを作成します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># db/seeds.rb</span>

a = <span class="synType">Manufacture</span>.create! <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">Aエレクトリック</span><span class="synSpecial">&quot;</span>
<span class="synSpecial">%w(</span><span class="synConstant">レコーダー イヤホン マイク Webカメラ</span><span class="synSpecial">)</span>.each <span class="synStatement">do</span> |<span class="synIdentifier">name</span>|
  random = [*<span class="synConstant">1</span>..<span class="synConstant">5</span>].sample  <span class="synComment"># 1-5からランダム値を取得</span>
  a.products.create! <span class="synConstant">name</span>: name, <span class="synConstant">price</span>: random * <span class="synConstant">1000</span>, <span class="synConstant">released_on</span>: random.day.ago
<span class="synStatement">end</span>

b = <span class="synType">Manufacture</span>.create! <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">B工業</span><span class="synSpecial">&quot;</span>
<span class="synSpecial">%w(</span><span class="synConstant">洗濯機 冷蔵庫 エアコン</span><span class="synSpecial">)</span>.each <span class="synStatement">do</span> |<span class="synIdentifier">name</span>|
  random = [*<span class="synConstant">1</span>..<span class="synConstant">5</span>].sample  <span class="synComment"># 1-5からランダム値を取得</span>
  b.products.create! <span class="synConstant">name</span>: name, <span class="synConstant">price</span>: random * <span class="synConstant">10000</span>, <span class="synConstant">released_on</span>: random.day.ago
<span class="synStatement">end</span>

c = <span class="synType">Manufacture</span>.create! <span class="synConstant">name</span>: <span class="synSpecial">&quot;</span><span class="synConstant">C電器</span><span class="synSpecial">&quot;</span>
<span class="synSpecial">%w(</span><span class="synConstant">ノートPC 40型TV デジタルカメラ</span><span class="synSpecial">)</span>.each <span class="synStatement">do</span> |<span class="synIdentifier">name</span>|
  random = [*<span class="synConstant">1</span>..<span class="synConstant">5</span>].sample  <span class="synComment"># 1-5からランダム値を取得</span>
  c.products.create! <span class="synConstant">name</span>: name, <span class="synConstant">price</span>: random * <span class="synConstant">10000</span>, <span class="synConstant">released_on</span>: random.day.ago
<span class="synStatement">end</span>
</pre><p>DBにデータを投入します。</p>
<pre class="code" data-lang="" data-unlink>rake db:seed</pre><p>そして、コントローラーのindexアクションを実装します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/contollers/products_contoller.rb</span>
<span class="synPreProc">class</span> <span class="synType">ProductsController</span> &lt; <span class="synType">ApplicationController</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">index</span>
    <span class="synComment"># N+1問題のため、allではなくincludes</span>
    <span class="synIdentifier">@products</span> = <span class="synType">Product</span>.includes(<span class="synConstant">:manufacture</span>)
  <span class="synPreProc">end</span>
<span class="synPreProc">end</span>
</pre><p><br />
そして、ビューを作成します。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/products/index.html.erb
<span class="synIdentifier">&lt;</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>商品一覧<span class="synIdentifier">&lt;/</span><span class="synStatement">h1</span><span class="synIdentifier">&gt;</span>

<span class="synIdentifier">&lt;</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>ID<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>名前<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>値段<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>発売日<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>製造元<span class="synIdentifier">&lt;/</span><span class="synStatement">th</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">thead</span><span class="synIdentifier">&gt;</span>

  <span class="synIdentifier">&lt;</span><span class="synStatement">tbody</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;% @products.each do |product| %&gt;</span>
      <span class="synIdentifier">&lt;</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.id</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.name</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.price</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.released_on</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
        <span class="synIdentifier">&lt;</span><span class="synStatement">td</span><span class="synIdentifier">&gt;&lt;%=</span><span class="synConstant"> product.manufacture.name</span><span class="synIdentifier"> %&gt;&lt;/</span><span class="synStatement">td</span><span class="synIdentifier">&gt;</span>
      <span class="synIdentifier">&lt;/</span><span class="synStatement">tr</span><span class="synIdentifier">&gt;</span>
    <span class="synIdentifier">&lt;% end %&gt;</span>
  <span class="synIdentifier">&lt;/</span><span class="synStatement">tbody</span><span class="synIdentifier">&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">table</span><span class="synIdentifier">&gt;</span>
</pre><p>そして、最後にルートを追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synType">Rails</span>.application.routes.draw <span class="synStatement">do</span>
  root <span class="synSpecial">'</span><span class="synConstant">products#index</span><span class="synSpecial">'</span>
  resources <span class="synSpecial">'</span><span class="synConstant">products</span><span class="synSpecial">'</span>, <span class="synConstant">only</span>: <span class="synConstant">:index</span>
<span class="synStatement">end</span>
</pre><p><code>rails s</code>でサーバーを起動して画面を確認しましょう。</p><p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141115/20141115134717.png" alt="f:id:nipe880324:20141115134717p:plain:w380" title="f:id:nipe880324:20141115134717p:plain:w380" class="hatena-fotolife" style="width:380px" itemprop="image"></span></p><br />
<br />
<br />
<p><h3 id="csv_export_download_csv">CSVのダウンロード機能の実装</h3>では、この画面に表示している内容をCSVで出力するようにしてみましょう。</p><p>まず、Ruby標準付属のCSVクラスをRailsで使えるように <code>require</code>を追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># config/application.rb</span>
<span class="synPreProc">require</span> <span class="synType">File</span>.expand_path(<span class="synSpecial">'</span><span class="synConstant">../boot</span><span class="synSpecial">'</span>, <span class="synConstant">__FILE__</span>)

<span class="synPreProc">require</span> <span class="synSpecial">'</span><span class="synConstant">rails/all</span><span class="synSpecial">'</span>
<span class="synPreProc">require</span> <span class="synSpecial">'</span><span class="synConstant">csv</span><span class="synSpecial">'</span>
...
</pre><p>次にCSVのダウンロードボタンを追加します。<br />
<code>format: "csv"</code>をパスの引数に指定することで、<br />
「"/products"」が「"/products.csv"」というURLになります。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/products/index.html.erb

<span class="synComment">&lt;!-- 一番下に追加 --&gt;</span>
<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  Download:
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">&quot;CSV&quot;</span><span class="synIdentifier">, products_path(format: </span><span class="synConstant">&quot;csv&quot;</span><span class="synIdentifier">) %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
</pre><p>そして、コントローラーに<code>respond_to</code>を追加し、<br />
<code>.csv</code>でアクセスされた場合の処理を追記します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/contollers/products_contoller.rb</span>
<span class="synPreProc">class</span> <span class="synType">ProductsController</span> &lt; <span class="synType">ApplicationController</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">index</span>
    <span class="synIdentifier">@products</span> = <span class="synType">Product</span>.includes(<span class="synConstant">:manufacture</span>)

    respond_to <span class="synStatement">do</span> |<span class="synIdentifier">format</span>|
      format.html
      format.csv { send_data <span class="synIdentifier">@products</span>.to_csv }
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>
<span class="synPreProc">end</span>
</pre><p><br />
そして、<code>to_csv</code>メソッドでCSVを作成する処理を実装します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/product.rb</span>

<span class="synPreProc">class</span> <span class="synType">Product</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  belongs_to <span class="synConstant">:manufacture</span>

  <span class="synPreProc">def</span> <span class="synConstant">self</span>.<span class="synIdentifier">to_csv</span>
    <span class="synType">CSV</span>.generate <span class="synStatement">do</span> |<span class="synIdentifier">csv</span>|
      <span class="synComment"># column_namesはカラム名を配列で返す</span>
      <span class="synComment"># 例: [&quot;id&quot;, &quot;name&quot;, &quot;price&quot;, &quot;released_on&quot;, ...]</span>
      csv &lt;&lt; column_names
      all.each <span class="synStatement">do</span> |<span class="synIdentifier">product</span>|
        <span class="synComment"># attributes はカラム名と値のハッシュを返す</span>
        <span class="synComment"># 例: {&quot;id&quot;=&gt;1, &quot;name&quot;=&gt;&quot;レコーダー&quot;, &quot;price&quot;=&gt;3000, ... }</span>
        <span class="synComment"># valudes_at はハッシュから引数で指定したキーに対応する値を取り出し、配列にして返す</span>
        <span class="synComment"># 下の行は最終的に column_namesで指定したvalue値の配列を返す</span>
        csv &lt;&lt; product.attributes.values_at(*column_names)
      <span class="synStatement">end</span>
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>
</pre><p>では、サーバーを再起動し、「CSV」ボタンを押して、CSVファイルをダウンロードしましょう。</p><p>中身は次のようになっています。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141115/20141115134746.png" alt="f:id:nipe880324:20141115134746p:plain:w320" title="f:id:nipe880324:20141115134746p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<p><code>to_csv</code>メソッドで<code>column_names</code>を指定しているため、画面と同じ内容ではありません。<br />
画面と同じになるように少し微調整をします。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/product.rb</span>

<span class="synPreProc">class</span> <span class="synType">Product</span> &lt; <span class="synType">ActiveRecord</span>::<span class="synType">Base</span>
  belongs_to <span class="synConstant">:manufacture</span>

  <span class="synPreProc">def</span> <span class="synConstant">self</span>.<span class="synIdentifier">to_csv</span>
    <span class="synType">CSV</span>.generate <span class="synStatement">do</span> |<span class="synIdentifier">csv</span>|
      csv &lt;&lt; csv_column_names
      all.each <span class="synStatement">do</span> |<span class="synIdentifier">product</span>|
        csv &lt;&lt; product.csv_column_values
      <span class="synStatement">end</span>
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>

  <span class="synPreProc">def</span> <span class="synConstant">self</span>.<span class="synIdentifier">csv_column_names</span>
    [<span class="synSpecial">&quot;</span><span class="synConstant">ID</span><span class="synSpecial">&quot;</span>, <span class="synSpecial">&quot;</span><span class="synConstant">商品名</span><span class="synSpecial">&quot;</span>, <span class="synSpecial">&quot;</span><span class="synConstant">値段</span><span class="synSpecial">&quot;</span>, <span class="synSpecial">&quot;</span><span class="synConstant">発売日</span><span class="synSpecial">&quot;</span>, <span class="synSpecial">&quot;</span><span class="synConstant">製造元</span><span class="synSpecial">&quot;</span>]
  <span class="synPreProc">end</span>

  <span class="synPreProc">def</span> <span class="synIdentifier">csv_column_values</span>
    [id, name, price, released_on, manufacture.name]
  <span class="synPreProc">end</span>
<span class="synPreProc">end</span>
</pre><p>では、ダウンロードファイルを見てみましょう。画面と同じになりました。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141115/20141115134802.png" alt="f:id:nipe880324:20141115134802p:plain:w320" title="f:id:nipe880324:20141115134802p:plain:w320" class="hatena-fotolife" style="width:320px" itemprop="image"></span></p><br />
<br />
<br />
<p><h3 id="csv_export_download_excel">Excelのダウンロード機能の実装</h3>では、次は、Excelで出力するようにしてみます。<br />
こちらもCSVとほぼ同じです。</p><p>Excelのダウンロードボタンを追加します。</p>
<pre class="code lang-html" data-lang="html" data-unlink># app/views/products/index.html.erb

<span class="synIdentifier">&lt;</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
  Download:
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">&quot;CSV&quot;</span><span class="synIdentifier">, products_path(format: </span><span class="synConstant">&quot;csv&quot;</span><span class="synIdentifier">) %&gt;</span>
  |
  <span class="synIdentifier">&lt;%=</span><span class="synConstant"> link_to</span><span class="synIdentifier"> </span><span class="synConstant">&quot;Excel&quot;</span><span class="synIdentifier">, products_path(format: </span><span class="synConstant">&quot;xls&quot;</span><span class="synIdentifier">) %&gt;</span>
<span class="synIdentifier">&lt;/</span><span class="synStatement">p</span><span class="synIdentifier">&gt;</span>
</pre><p>そして、コントローラーに<code>xls</code>を追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/contollers/products_contoller.rb</span>

<span class="synPreProc">class</span> <span class="synType">ProductsController</span> &lt; <span class="synType">ApplicationController</span>
  <span class="synPreProc">def</span> <span class="synIdentifier">index</span>
    <span class="synIdentifier">@products</span> = <span class="synType">Product</span>.includes(<span class="synConstant">:manufacture</span>)

    respond_to <span class="synStatement">do</span> |<span class="synIdentifier">format</span>|
      format.html
      format.csv { send_data <span class="synIdentifier">@products</span>.to_csv }
      format.xls { send_data <span class="synIdentifier">@products</span>.to_csv(<span class="synConstant">col_sep</span>: <span class="synSpecial">&quot;\t&quot;</span>) }
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>
<span class="synPreProc">end</span>
</pre><p>そして、CSV.generateにオプションを指定するようにします。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># app/models/product.rb</span>

  <span class="synPreProc">def</span> <span class="synConstant">self</span>.<span class="synIdentifier">to_csv</span>(options = {})
    <span class="synType">CSV</span>.generate(options) <span class="synStatement">do</span> |<span class="synIdentifier">csv</span>|
      csv &lt;&lt; csv_column_names
      all.each <span class="synStatement">do</span> |<span class="synIdentifier">product</span>|
        csv &lt;&lt; product.csv_column_values
      <span class="synStatement">end</span>
    <span class="synStatement">end</span>
  <span class="synPreProc">end</span>
</pre><p>そして、RailsからExcelを返せるようにするためにMIME TYPEを追加します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># config/initializers/mime_types.rb</span>

<span class="synType">Mime</span>::<span class="synType">Type</span>.register <span class="synSpecial">&quot;</span><span class="synConstant">application/xls</span><span class="synSpecial">&quot;</span>, <span class="synConstant">:xls</span>
</pre><p>では、サーバーを再起動して、Excelファイルがダウンロードできることを確認しましょう。<br />
<span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/n/nipe880324/20141115/20141115134824.png" alt="f:id:nipe880324:20141115134824p:plain:w380" title="f:id:nipe880324:20141115134824p:plain:w380" class="hatena-fotolife" style="width:380px" itemprop="image"></span></p><br />
<p></p>

</div>
<div class="section">
    <h3>参考文献</h3>
    <p>  - <a href="http://railscasts.com/episodes/362-exporting-csv-and-excel">RailsCast #362 - Exporting CSV and Excel </a></p>

</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141119/1416398472.html"><time data-relative datetime="2014-11-19T12:01:12Z" title="2014-11-19T12:01:12Z" pubdate class="updated">2014-11-19 21:01</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141119/1416398472" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141119%2F1416398472" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141119/1416398472" data-count="vertical" data-text="RailsでCSV/Excelのダウンロード機能の実装方法 - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141119/1416398472" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
          <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4438296558807254"
     data-ad-slot="4370884664"
     data-ad-format="horizontal"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-800 words-100 mode-hatena entry-odd" id="entry-8454420450072957192" data-keyword-campaign="" data-uuid="8454420450072957192">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/18.html" rel="nofollow">
          <time pubdate datetime="2014-11-18T12:43:28Z" title="2014-11-18T12:43:28Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">18</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141118/1416314608.html" class="entry-title-link bookmark">Railsでページネーションを実装するGemのまとめ</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/%E3%81%BE%E3%81%A8%E3%82%81.html">まとめ</a>
          
          <a href="archive/category/UI%7CUX.html">UI/UX</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p>Railsでページネーションを実装するGemとして<a href="https://www.ruby-toolbox.com/categories/pagination" target="blank">The Ruby Toolbox - Pagination</a>で確認すると、有名どころとしては、</p>

<ul>
<li>Kaminari</li>
<li>Will Paginate</li>
</ul><p>です。</p>

<div class="section">
    <h3>比較</h3>
    <p>それぞれRails上で使ってみて、比較してみました。<br />
個人的には、<code>Kaminari</code>をお勧めします。<br />
理由としては次の比較表をみれば、一目瞭然ですが、ドキュメントやカスタマイズ性が高いところがあげられます。</p><p><table class="table table-striped">
  <tr>
    <th style="width:80px;"></th><th>kaminari</th><th>will_pagineta</th><th>所感</th>
  </tr>
  <tr>
    <td>機能面</td>
    <td>◎</td>
    <td>◎</td>
    <td>どちらのGemも「ページのサマリー」、「ページネーションのリンク」をヘルパーで１行で追加できるので、機能的にはほぼ同じです。</td>
  </tr>
  <tr>
    <td>国際化対応</td>
    <td>◯</td>
    <td>◯</td>
    <td>i18nはどちらも可能</td>
  </tr>
  <tr>
    <td>ドキュメント</td>
    <td>◯</td>
    <td>△</td>
    <td>GitHubのトップページをみれば一目瞭然！kaminariの方が圧倒的に充実している。<a href="https://github.com/amatsuda/kaminari" target="_blank">kaminri</a> / <a href="https://github.com/mislav/will_paginate">will_pagination</a></td>
  </tr>
  <tr>
    <td>カスタマイズ性</td>
    <td>◎</td>
    <td>△</td>
    <td>Bootstrapなどのテーマを適用できること、Viewファイルやページネーションの設定などのカスタマイズ性もあるのはKaminariです。will_paginateはページ辺りの表示件数を変えれるぐらい？</td>
  </tr>
</table></p><br />
<p></p>

</div>
<div class="section">
    <h3>ページネーションの使い方</h3>
    <p>ページネーションの実装方法を下記に記載しましたので、興味ある方は一読ください。</p>

<ul>
<li><a href="entry/20141113/1415874683.html" target="_blank">kaminariでページネーションを行う</a></li>
<li><a href="entry/20141114/1415967206.html" target="_blank">will_paginateでページネーションを行う</a></li>
<li><a href="entry/20141115/1416021886.html" target="_blank">kaminariとinfinite scrollを使って動的ページロードを行う</a></li>
</ul><p><br />
以上です。</p>

</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141118/1416314608.html"><time data-relative datetime="2014-11-18T12:43:28Z" title="2014-11-18T12:43:28Z" pubdate class="updated">2014-11-18 21:43</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141118/1416314608" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141118%2F1416314608" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141118/1416314608" data-count="vertical" data-text="Railsでページネーションを実装するGemのまとめ - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141118/1416314608" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user_2nd', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_2', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_2" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-1600 words-200 mode-hatena entry-even" id="entry-8454420450073934357" data-keyword-campaign="" data-uuid="8454420450073934357">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/17.html" rel="nofollow">
          <time pubdate datetime="2014-11-17T11:59:23Z" title="2014-11-17T11:59:23Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">17</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141117/1416225563.html" class="entry-title-link bookmark">RailsでRakeタスクの作成</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%E5%85%A5%E9%96%80.html">Rails入門</a>
          
          <a href="archive/category/Rails%E5%88%9D%E7%B4%9A.html">Rails初級</a>
          
          <a href="archive/category/%E9%96%8B%E7%99%BA%E3%82%92%E5%8A%B9%E7%8E%87%E5%8C%96%E3%81%99%E3%82%8B.html">開発を効率化する</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>でRakeタスクを作成する手順を説明します。<br />
開発中に何度も実行するコマンドや操作をRakeタスクにしておくことで開発をスムーズに進められるようになります。</p><p><i><a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>には、既に有用なRakeタスクがデフォルトで定義されていますので、<a href="entry/20141116/1416115266.html" target="_blank">Rakeコマンド一覧</a>を参照して、既に存在していないか、一部として使えそうなタスクはないかと見ることも大切です。</i></p><br />
<br />
<p>今回は、次のユーザーモデルのテストデータを作成するタスクを作成します。</p>
<pre class="code" data-lang="" data-unlink>User nickname email password</pre>
<div class="section">
    <h3>1. Rakeタスクをファイルを作成</h3>
    <p><code>rails g task [タスク名]</code>でRakeタスクのファイルを作成します。<br />
Rakeタスクは<a class="keyword" href="http://d.hatena.ne.jp/keyword/%B3%C8%C4%A5%BB%D2">拡張子</a>が<code>.rake</code>である必要があります。</p>
<pre class="code" data-lang="" data-unlink>rails g task sample
      create  lib/tasks/sample.rake</pre>
</div>
<div class="section">
    <h3>2. Rakeタスクの実装</h3>
    <p><code>lib/tasks</code>配下にファイルが作成されるので、タスクで実行したい処理を実装します。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># lib/tasks/sample.rake</span>

namespace <span class="synConstant">:sample</span> <span class="synStatement">do</span>           <span class="synComment"># ネームスペースを定義 &quot;rake sample: ...&quot;となる</span>
  desc <span class="synSpecial">&quot;</span><span class="synConstant">サンプルデータを作成する</span><span class="synSpecial">&quot;</span>    <span class="synComment"># rake -T のタスク一覧の結果で表示されるタスクの説明文</span>
  task <span class="synConstant">populate</span>: <span class="synConstant">:environment</span> <span class="synStatement">do</span> <span class="synComment"># タスク名を定義 &quot;rake db:populate&quot;で呼べる</span>
    <span class="synComment"># 100ユーザ作成する</span>
    <span class="synConstant">100</span>.times <span class="synStatement">do</span> |<span class="synIdentifier">n</span>|
      nickname = <span class="synSpecial">&quot;</span><span class="synConstant">nickname</span><span class="synSpecial">#{</span>n<span class="synSpecial">}&quot;</span>
      email    = <span class="synSpecial">&quot;</span><span class="synConstant">user</span><span class="synSpecial">#{</span>n<span class="synSpecial">}</span><span class="synConstant">@example.co.jp</span><span class="synSpecial">&quot;</span>
      password = <span class="synSpecial">&quot;</span><span class="synConstant">password</span><span class="synSpecial">&quot;</span>
      <span class="synType">User</span>.create!(<span class="synConstant">nickname</span>: nickname, <span class="synConstant">email</span>: email, <span class="synConstant">password</span>: password)
    <span class="synStatement">end</span>
  <span class="synStatement">end</span>
<span class="synStatement">end</span>
</pre><p>では、Rakeタスクを実行します。(migrationが実行済みであること)</p>
<pre class="code" data-lang="" data-unlink>rake sample:populate</pre>
</div>
<div class="section">
    <h3>3. Rakeタスクに引数を渡す</h3>
    <p>次のように環境引数で渡すのが一般的です。</p>
<pre class="code" data-lang="" data-unlink>rake sample:populate LIMIT=10</pre><p>ここでは、<code>LIMIT</code>を指定することで作成するUser数を設定できるようにします。</p>
<pre class="code lang-ruby" data-lang="ruby" data-unlink><span class="synComment"># lib/tasks/sample.rake</span>

namespace <span class="synConstant">:sample</span> <span class="synStatement">do</span>
  desc <span class="synSpecial">&quot;</span><span class="synConstant">サンプルデータを作成する</span><span class="synSpecial">&quot;</span> 
  task <span class="synConstant">populate</span>: <span class="synConstant">:environment</span> <span class="synStatement">do</span>
    <span class="synComment"># 環境変数の値を取得。指定がないときはデフォルト値100で設定</span>
    limit = <span class="synIdentifier">ENV</span>[<span class="synSpecial">'</span><span class="synConstant">LIMIT</span><span class="synSpecial">'</span>] || <span class="synConstant">100</span>

    <span class="synComment"># limitの数だけUserを作成する</span>
    limit.times <span class="synStatement">do</span> |<span class="synIdentifier">n</span>|
      nickname = <span class="synSpecial">&quot;</span><span class="synConstant">nickname</span><span class="synSpecial">#{</span>n<span class="synSpecial">}&quot;</span>
      email    = <span class="synSpecial">&quot;</span><span class="synConstant">user</span><span class="synSpecial">#{</span>n<span class="synSpecial">}</span><span class="synConstant">@example.co.jp</span><span class="synSpecial">&quot;</span>
      password = <span class="synSpecial">&quot;</span><span class="synConstant">password</span><span class="synSpecial">&quot;</span>
      <span class="synType">User</span>.create!(<span class="synConstant">nickname</span>: nickname, <span class="synConstant">email</span>: email, <span class="synConstant">password</span>: password)
    <span class="synStatement">end</span>
  <span class="synStatement">end</span>え<span class="synStatement">end</span>
</pre><p><br />
以上です。<br />
<br />
</p>

</div>
<div class="section">
    <h3>参考文献</h3>
    
<ul>
<li><a href="http://guides.rubyonrails.org/command_line.html#custom-rake-tasks">The Rails Command Line &mdash; Ruby on Rails Guides</a></li>
<li><a href="http://www.ownway.info/Ruby/rake/arguments">rake &#x3067;&#x306E;&#x30B3;&#x30DE;&#x30F3;&#x30C9;&#x30E9;&#x30A4;&#x30F3;&#x5F15;&#x6570;&#x306E;&#x6271;&#x3044; - &#x541B;&#x306E;&#x77B3;&#x306F;&#x307E;&#x308B;&#x3067;&#x30EB;&#x30D3;&#x30FC; - Ruby &#x95A2;&#x9023;&#x307E;&#x3068;&#x3081;&#x30B5;&#x30A4;&#x30C8;</a></li>
</ul>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141117/1416225563.html"><time data-relative datetime="2014-11-17T11:59:23Z" title="2014-11-17T11:59:23Z" pubdate class="updated">2014-11-17 20:59</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141117/1416225563" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141117%2F1416225563" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141117/1416225563" data-count="vertical" data-text="RailsでRakeタスクの作成 - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141117/1416225563" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
          <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4438296558807254"
     data-ad-slot="4370884664"
     data-ad-format="horizontal"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
              
                <article class="entry hentry js-entry-article date-first autopagerize_page_element chars-2800 words-400 mode-hatena entry-odd" id="entry-8454420450073930565" data-keyword-campaign="" data-uuid="8454420450073930565">
  <div class="entry-inner">
    <header class="entry-header">
      <div class="entry-date date first">
        <a href="entries/2014/11/16.html" rel="nofollow">
          <time pubdate datetime="2014-11-16T05:21:06Z" title="2014-11-16T05:21:06Z">
            <span class="date-year">2014</span><span class="hyphen">-</span><span class="date-month">11</span><span class="hyphen">-</span><span class="date-day">16</span>
          </time>
        </a>
      </div>
      <h1 class="entry-title">
        <a href="entry/20141116/1416115266.html" class="entry-title-link bookmark">Rake コマンド一覧</a>
      </h1>
      
      
        <div class="entry-categories categories">
          
          <a href="archive/category/Rails%E5%88%9D%E7%B4%9A.html">Rails初級</a>
          
          <a href="archive/category/%E9%96%8B%E7%99%BA%E3%82%92%E5%8A%B9%E7%8E%87%E5%8C%96%E3%81%99%E3%82%8B.html">開発を効率化する</a>
          
        </div>
      
      

      
    </header>
        
    <div class="entry-content">

      
        <p>rakeコマンドをまとめました。</p>

<div class="section">
    <h3>動作確認</h3>
    
<ul>
<li>Rails 4.1</li>
</ul>
</div>
<div class="section">
    <h3>すべてのRakeコマンドを表示する(※1)</h3>
    <pre class="code" data-lang="" data-unlink>rake -T</pre><p><i>※1 Rakeタスクの定義で、<code>description</code>を書いていないため、厳密には表示されないものもある</i><br />
</p>

</div>
<div class="section">
    <h3>すべてのRakeコマンド一覧(※1)</h3>
    <pre class="code" data-lang="" data-unlink>rake about                              # Railsフレームワークのバージョンを表示する
rake assets:clean[keep]                 # 古いコンパイルされたアセットを削除する
rake assets:clobber                     # コンパイルされたアセットを削除する
rake assets:environment                 # Load asset compile environment
rake assets:precompile                  # config.assets.prefompile内のすべてのアセットをコンパイルする
rake cache_digests:dependencies         # Lookup first-level dependencies for TEMPLATE (like messages/show or comments/_comment.html)
rake cache_digests:nested_dependencies  # Lookup nested dependencies for TEMPLATE (like messages/show or comments/_comment.html)
rake db:create                          # DATABASE_URL か config/database.yml に基づいてRAILS_ENV 用の DBを作成する
rake db:drop                            # DATABASE_URL か config/database.yml に基づいてRAILS_ENV 用の DBを削除する
rake db:fixtures:load                   # 現在の環境のDBに fixtures をロードする
rake db:migrate                         # マイグレートする(オプション: VERSION=x, VERBOSE=false, SCOPE=blog)
rake db:migrate:status                  # マイグレーションの適用状況を確認する
rake db:migrate:reset                   # db:drop, db:create, db:migrate を実行する
rake db:rollback                        # マイグレートをロールバックする(オプション: STEP=n)
rake db:schema:cache:clear              # db/schema_cache.dump をクリアする
rake db:schema:cache:dump               # db/schema_cache.dump を作成する
rake db:schema:dump                     # db/schema.rb を作成する
rake db:schema:load                     # db/schema.rb の内容をDBにロードする
rake db:seed                            # db/seeds.rb からseedデータをロードする
rake db:setup                           # DBを作成、スキーマをロード、seedデータをロードする
rake db:structure:dump                  # db/structure.sql にDB構造をdumpする
rake db:version                         # 現在のスキーマバージョン番号を取得する
rake doc:app                            # doc/app配下にアプリのドキュメントを生成する
rake doc:rails                          # doc/api配下にRailsのドキュメントを生成する
rake doc:guides                         # doc/guids配下にRailsGuidsのドキュメントを生成する
rake log:clear                          # すべての log/配下の *.log をクリアする (LOGS=test,development でログを指定できる)
rake middleware                         # Rack Middlewareのスタックを表示する
rake notes                              # すべてのアノテーション(コード上のOPTIMIZE, FIXME, TODO)を列挙する (notes:optimize, :fixme, :todo で指定可能)
rake notes:custom                       # カスタムアノテーションを列挙する (ANNOTATION=CUSTOM で指定可能)
rake rails:template                     # Applies the template supplied by LOCATION=(/path/to/template) or URL
rake rails:update                       # Update configs and some other initially generated files (or use just update:configs or update:bin)
rake routes                             # すべての定義されたルートを表示する
rake secret                             # セキュアなシークレットキーを生成する (一般的にクッキーセッションのためのシークレットに使われる)
rake stats                              # コードの静的情報(KLOCなど)を報告する
rake test                               # test:units, test:functionals, test:generators, test:integration を実行する
rake test:all                           # Run tests quickly by merging all types and not resetting db
rake test:all:db                        # Run tests quickly, but also reset db
rake time:zones:all                     # すべてのタイムゾーンを表示する(time:zones:us, time:zones:local も指定可能)
rake tmp:clear                          # tmp/配管のsession, cache, socket ファイルをクリアする(tmp:sessions:clear, tmp:cache:clear, tmp:sockets:clear　でクリア範囲を狭められる)
rake tmp:create                         # sessions, cache, sockets, pidsのために、tmpディレクトリを作成する</pre>
</div>
        
      
    </div>
    <footer class="entry-footer">
      <p class="entry-footer-section">
        <span class="author vcard"><span class="fn" data-load-nickname="1" data-user-name="nipe880324">nipe880324</span></span>
        <span class="entry-footer-time"><a href="entry/20141116/1416115266.html"><time data-relative datetime="2014-11-16T05:21:06Z" title="2014-11-16T05:21:06Z" pubdate class="updated">2014-11-16 14:21</time></a></span>
      </p>

      

      
<div class="social-buttons">
  
  
    <div class="social-button-item">
      <a href="http://b.hatena.ne.jp/entry/http://ruby-rails.hatenadiary.com/entry/20141116/1416115266" class="hatena-bookmark-button" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="この記事をはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only.gif" alt="この記事をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
    </div>
  
  
  
    <div class="social-button-item">
      <a href="https://twitter.com/search?q=http%3A%2F%2Fruby-rails.hatenadiary.com%2Fentry%2F20141116%2F1416115266" class="social-button-twitter-balloon" target="_blank">
        <span class="social-button-twitter-balloon-list">list</span>
        <i class="social-button-twitter-balloon-arrow-border"></i>
        <u class="social-button-twitter-balloon-arrow"></u>
      </a>
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruby-rails.hatenadiary.com/entry/20141116/1416115266" data-count="vertical" data-text="Rake コマンド一覧 - Rails Webook" data-lang="ja">Tweet</a>
    </div>
  
  
  
  
  
    <div class="social-button-item">
      <a data-pocket-label="pocket" data-save-url="http://ruby-rails.hatenadiary.com/entry/20141116/1416115266" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
    </div>
  
</div>


      
        
          
            
            <div class="google-afc-image test-google-rectangle-ads ">
              
              
                <script>
  var hatenadfp = hatenadfp || {};
  hatenadfp.adUnits = hatenadfp.adUnits || [];
  hatenadfp.adUnits.push(
    
      { unitName: 'blog_user_2nd', size: [[300, 250], [336, 280]], divId: 'google_afc_user_container_3', allowContentMatch: true }
    
  );
  hatenadfp.isNGContent = false;
  
</script>

                <div id="google_afc_user_container_3" class="google_afc_blocklink2_5 google_afc_boder"></div>
                
                  <a href="http://blog.hatena.ne.jp/guide/pro" class="open-pro-modal" data-guide-pro-modal-ad-url="http://hatenablog.com/guide/pro/modal/ad">広告を非表示にする</a>
                
                
              
            </div>
          
        
      

      <div class="customized-footer">

        

      </div>

      <div class="comment-box">
        
        <ul class="comment">
          
             <li class="read-more-comments" style="display: none;"><a>もっと読む (0)</a></li>
          
        </ul>
        
          <a class="leave-comment-title">コメントを書く</a>
        
      </div>
      <!-- enjapan ad -->
      
    </footer>
  </div>
</article>

                

                

              
            
            <!-- rakuten_ad_target_end -->
            <!-- google_ad_section_end -->

            
              <div class="pager autopagerize_insert_before">
                <span class="pager-next">
                  <a href="index-page=1416115266.html" rel="next">次のページ</a>
                </span>
              </div>
            
          
        </div>
      </div>

      
      <aside id="box1">
        <div id="box1-inner">
        </div>
      </aside>

    </div><!-- #wrapper -->

    <aside id="box2">
  
  <div id="box2-inner">
    
      
<div class="hatena-module hatena-module-html">
  <div class="hatena-module-body">
    <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- -->
<ins class="adsbygoogle"
     style="display:inline-block;width:160px;height:600px"
     data-ad-client="ca-pub-2736751992834286"
     data-ad-slot="8116686456"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>
</div>

      
      
    
      

<div class="hatena-module hatena-module-profile">
  <div class="hatena-module-title">
    プロフィール
  </div>
  <div class="hatena-module-body">
    
    <a href="about.html" class="profile-icon-link">
      <img src="http://cdn1.www.st-hatena.com/users/ni/nipe880324/profile.gif?1406435422"
      alt="id:nipe880324" class="profile-icon" />
    </a>
    

    
    <span class="id">
      <a href="about.html" class="hatena-id-link"><span data-load-nickname="1" data-user-name="nipe880324">id:nipe880324</span></a>
      
  
    
    
  


    </span>
    

    

    
      <div class="hatena-follow-button-box btn-subscribe js-hatena-follow-button-box"
  
  >

  <a href="index-page=1417086075.html#" class="hatena-follow-button js-hatena-follow-button">
    <span class="subscribing">
      <span class="foreground">読者です</span>
      <span class="background">読者をやめる</span>
    </span>
    <span class="unsubscribing" data-track-name="profile-widget-subscribe-button" data-track-once>
      <span class="foreground">読者になる</span>
      <span class="background">読者になる</span>
    </span>
  </a>
  <div class="subscription-count-box js-subscription-count-box">
    <i></i>
    <u></u>
    <span class="subscription-count js-subscription-count">
    </span>
  </div>
</div>

    

    

    

    
  </div>
</div>

      
      
    
      
<div class="hatena-module hatena-module-entries-access-ranking"
     data-count="4"
     data-display_entry_category="1"
     data-display_entry_image="0"
     data-display_entry_image_size_width="100"
     data-display_entry_image_size_height="100"
     data-display_entry_body_length="0"
     data-display_entry_date="1"
     data-display_bookmark_count="0"
     data-source="access"
>
  <div class="hatena-module-title">
    
      最近のアクセス
    
  </div>
  <div class="hatena-module-body">
    
  </div>
</div>

      
      
    
      
<div class="hatena-module hatena-module-html">
    <div class="hatena-module-title">    </div>
  <div class="hatena-module-body">
    <nav>
  <div class="side-category">
    <span class="side-category-title">Rails 入門</span>
    <ul class="side-category-list">
      <li><a href="entry/20140713/1405251091.html">RailsのためのRuby基礎</a></li>
      <li><a href="entry/20140813/1407915718.html">Rails入門者向け ブログ開発</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Railsコマンド</span>
    <ul class="side-category-list">
      <li><a href="entry/20140713/1405251709.html">rails new / server / console</a></li>
      <li><a href="entry/20150204/1423055537.html">rails new時の有用な6つの設定</a></li>
      <li><a href="entry/20150208/1423391199.html">rails new時のテンプレート</a></li>
      <li><a href="entry/20140802/1406948695.html">rails generate</a></li>
      <li><a href="entry/20141116/1416115266.html">rakeコマンド一覧</a></li>
      <li><a href="entry/20141117/1416225563.html">自前rakeコマンド</a></li>
      <li><a href="entry/20141110/1415623670.html">productionモードで起動</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Route / Controller</span>
    <ul class="side-category-list">
      <li><a href="entry/20140716/1405451238.html">Routing</a></li>
      <li><a href="entry/20140810/1407603600.html">レイアウトファイルを指定</a></li>
      <li><a href="entry/20141125/1416918957.html">ビューを返す(render)</a></li>
      <li><a href="entry/20140808/1407427457.html">リダイレクトする(redirect_to)</a></li>
      <li><a href="entry/20141126/1417012848.html">Strong Parameters</a></li>
      <li><a href="entry/20141129/1417223453.html">フィルタ(before_action, after_action)</a></li>
      <li><a href="entry/20141127/1417086075.html">簡易なメッセージ表示(Flash)</a></li>
      <li><a href="entry/20141130/1417334030.html">セッション(session)</a></li>
      <li><a href="entry/20141201/1417432408.html">リクエストヘッダ、レスポンスヘッダ(request, response)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Model, Migration</span>
    <ul class="side-category-list">
      <li><a href="entry/20140724/1406142120.html">CRUD</a></li>
      <li><a href="entry/20141203/1417601540.html">1対多関連</a></li>
      <li><a href="entry/20141204/1417688260.html">多対多関連</a></li>
      <li><a href="entry/20141205/1417779929.html">1対1関連</a></li>
      <li><a href="entry/20141206/1417839458.html">STI(単一継承テーブル)</a></li>
      <li><a href="entry/20141207/1417926599.html">ポリモフィック関連</a></li>
      <li><a href="entry/20141208/1418018874.html">複数の子レコードを作成/更新</a></li>
      <li><a href="entry/20140724/1406145303.html">バリデーション(validation)</a></li>
      <li><a href="entry/20140810/1407623400.html">バリデーションエラー(validation errors)</a></li>
      <li><a href="entry/20140814/1407994568.html">スコープ(scope)</a></li>
      <li><a href="entry/20141211/1418301640.html">コールバック(callback)</a></li>
      <li><a href="entry/20150428/1430154446.html">複雑なSELECT文のまとめ</a></li>
      <li><a href="entry/20150710/1436461745.html">enum (Rails 4.1以上)</a></li>
      <li><a href="entry/20141209/1418123425.html">楽観的ロック</a></li>
      <li><a href="entry/20141210/1418207618.html">悲観的ロック</a></li>
      <li><a href="entry/20140810/1407634200.html">Migration(マイグレーション)</a></li>
      <li><a href="entry/20150607/1433606267.html">Postgresとマイグレーション</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">API</span>
    <ul class="side-category-list">
      <li><a href="entry/20150708/1436284476.html">Roar</a></li>
      <li>ActiveSerializer</li>
      <li>Versioning</li>
      <li>CORS</li>
    </ul>
  </div>

  <div class="side-category">
    <span class="side-category-title">View, Helper, Presenter</span>
    <ul class="side-category-list">
      <li><a href="entry/20140810/1407603600.html">レイアウトファイルを指定</a></li>
      <li><a href="entry/20140807/1407419013.html">部分テンプレート</a></li>
      <li><a href="entry/20140727/1406448610.html">フォーム周りのMVC連携フロー</a></li>
      <li><a href="entry/20150113/1421149061.html">ビューヘルパーまとめ(View Helper)</a></li>
      <li><a href="entry/20140802/1406969793.html">フォーマットヘルパー</a></li>
      <li><a href="entry/20140803/1407049200.html">独自ヘルパー作成</a></li>
      <li><a href="entry/20141208/1418018874.html">複数の子レコード(has_many)を作成/更新するフォーム</a></li>
      <li><a href="entry/20141225/1419515057.html">1フォームに複数のSubmitボタンを配置</a></li>
      <li><a href="entry/20140730/1406700205.html">simple_form</a></li>
      <li><a href="entry/20150415/1429031791.html">Draper</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">テンプレートエンジン</span>
    <ul class="side-category-list">
      <li><a href="entry/20140929/1411997071.html">HTMLテンプレートエンジンまとめ</a></li>
      <li><a href="entry/20140929/1411997071.html">Slim</a></li>
      <li><a href="entry/20141001/1412097051.html">Haml</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ActionSupport / ActionMailer / ActiveJob / i18n</span>
    <ul class="side-category-list">
      <li><a href="entry/20141217/1418817120.html">タイムゾーン、時刻処理</a></li>
      <li><a href="entry/20141218/1418901424.html">Timecop 時刻処理のテスト</a></li>
      <li><a href="entry/20141216/1418729961.html">クラス名,DB名,ファイル名の変換</a></li>
      <li><a href="entry/20141230/1419936984.html">JSON, XML, YAMLの読み書き</a></li>
      <li><a href="entry/20141030/1414599853.html">文字コード/エンコード</a></li>
      <li><a href="entry/20140828/1409236436.html">メール送信</a></li>
      <li><a href="entry/20150304/1425396671.html">DelayedJob バックグラウンド処理</a></li>
      <li><a href="entry/20150110/1420863998.html">ログ・ログレベル・ログフォーマット(log, logger)</a></li>
      <li><a href="entry/20150226/1424937175.html">i18nまとめ</a></li>
      <li><a href="entry/20141111/1415707101.html">エラーハンドリング</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">テスト</span>
    <ul class="side-category-list">
      <li><a href="entry/20150101/1420093487.html">RSpec/Capybaraの導入方法</a></li>
      <li><a href="entry/20150103/1420280252.html">RSpec/Capybaraのレシピ集</a></li>
      <li><a href="entry/20150101/1420093487.html">FactoryGirlのレシピ集</a></li>
      <li><a href="entry/20150105/1420465062.html">Jasmine(Javascriptの単体テスト)</a></li>
      <li><a href="entry/20150108/1420675366.html">APIの作成とテスト</a></li>
      <li><a href="entry/20150106/1420545920.html">RSpecテストを速くする</a></li>
      <li><a href="entry/20150108/1420721205.html">デバッグ(debug)</a></li>
      <li><a href="entry/20150420/1429462755.html">Seleniumでスタンドアローンなテスト</a></li>
      <li><a href="entry/20140719/1405708234.html">Cucumber+RSpec+Capybara インストール</a></li>
      <li><a href="entry/20140719/1405777918.html">Cucumber+RSpec+Capybara BDD/TDD開発例</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Security</span>
    <ul class="side-category-list">
      <li><a href="entry/20141215/1418641291.html">ログ上での秘密情報のフィルタリング</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">パフォーマンス</span>
    <ul class="side-category-list">
      <li><a href="entry/20141109/1415522242.html">Bullet</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">設定</span>
    <ul class="side-category-list">
      <li><a href="entry/20141224/1419414316.html">新しいEnvironmentを追加</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">UI/UX</span>
    <ul class="side-category-list">
      <li><a href="entry/20140801/1406818800.html">Twitter Bootstrap 3</a></li>
      <li><a href="entry/20141112/1415804076.html">select2</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Gemの基礎</span>
    <ul class="side-category-list">
      <li><a href="entry/20140715/1405361727.html">RubyGemsの選び方</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ログイン/認証機能</span>
    <ul class="side-category-list">
      <li><a href="entry/20140801/1406907000.html">devise1 インストール</a></li>
      <li><a href="entry/20140804/1407168000.html">devise2 カスタマイズ</a></li>
      <li><a href="entry/20140805/1407200400.html">devise3 Twitterでログイン(OAuth連携)</a></li>
      <li><a href="entry/20141212/1418380288.html">devise4 ゲストユーザー(Guest)作成</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ファイルアップロード機能</span>
    <ul class="side-category-list">
      <li><a href="entry/20140716/1405443484.html">PaperClip</a></li>
      <li><a href="entry/20141015/1413300088.html">CarrierWave1 インストール</a></li>
      <li><a href="entry/20141022/1413907332.html">CarrierWave2 カスタマイズ</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">検索機能・Elasticsearch</span>
    <ul class="side-category-list">
      <li><a href="entry/20141008/1412774436.html">Ransack 検索機能</a></li>
      <li><a href="entry/20150224/1424776132.html">Sunspot 全文検索</a></li>
      <li><a href="entry/20151018/1445142266.html">Elasticsearch 1: 全文検索・フィルタ</a></li>
      <li><a href="entry/20151019/1445265581.html">Elasticsearch 2: ページネーション</a></li>
      <li><a href="entry/20151021/1445353566.html">Elasticsearch 3: ソート</a></li>
      <li><a href="entry/20151022/1445439798.html">Elasticsearch 4: アグリゲーション（ファセット）・post_filter</a></li>
      <li><a href="20151025/1445703231.html">Elasticsearch 5: ハイライト</a></li>
      <li><a href="entry/20151027/1445957667.html">Elasticsearch 6: サジェスト</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">ページネーション</span>
    <ul class="side-category-list">
      <li><a href="entry/20141118/1416314608.html">ページネーションまとめ</a></li>
      <li><a href="entry/20141113/1415874683.html">kaminari</a></li>
      <li><a href="entry/20141114/1415967206.html">will_paginate</a></li>
      <li><a href="entry/20141115/1416021886.html">動的ページロード</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">CSV</span>
    <ul class="side-category-list">
      <li><a href="entry/20141119/1416398472.html">CSVダウンロード</a></li>
      <li><a href="entry/20141120/1416483136.html">CSVアップロード</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">PDFファイル作成機能</span>
    <ul class="side-category-list">
      <li><a href="entry/20140906/1409995011.html">PDF作成Gem まとめ</a></li>
      <li><a href="entry/20140907/1410078997.html">コードのみでPDF作成 Prawn</a></li>
      <li><a href="entry/20140908/1410176894.html">HTMLを変換してPDF作成 PDFKit + wkhtmltopdf</a></li>
      <li><a href="entry/20140909/1410241835.html">GUIツールでPDF作成 ThinReports</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">開発効率をあげる</span>
    <ul class="side-category-list">
      <li><a href="entry/20141026/1414289421.html">Spring</a></li>
      <li><a href="entry/20141016/1413389293.html">Guard-LiveReload</a></li>
      <li><a href="entry/20141021/1413819783.html">Guard-RSpec</a></li>
      <li><a href="entry/20141019/1413698128.html">Guard-RuboCop</a></li>
      <li><a href="entry/20141024/1414081224.html">Pry-Rails / Pry-BuyBug</a></li>
      <li><a href="entry/20141024/1414160189.html">Hirb</a></li>
      <li><a href="entry/20141028/1414505988.html">Awesome Print</a></li>
      <li><a href="entry/20141029/1414584929.html">Quiet Assets</a></li>
      <li><a href="entry/20141025/1414225490.html">Better_Errors</a></li>
      <li><a href="entry/20141027/1414409495.html">Rails-ERD</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">その他Gem</span>
    <ul class="side-category-list">
      <li><a href="entry/20150225/1424858414.html">acts-as-taggable-on タグ管理</a></li>
      <li><a href="entry/20141016/1413389293.html">wenerber Cron設定</a></li>
      <li><a href="entry/20150221/1424489524.html">friendly_id URLスラッグ</a></li>
      <li><a href="entry/20150216/1424092796.html">awesome_nested_set ツリー構造</a></li>
      <li><a href="entry/20150217/1424179269.html">awesome_nested_set にjsTreeを追加</a></li>
      <li><a href="entry/20150214/1423923524.html">PaperTrail 取り消し機能</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Tips</span>
    <ul class="side-category-list">
      <li><a href="entry/20141229/1419856433.html">Virtual Attributes(仮想属性)</a></li>
      <li><a href="entry/20141226/1419600679.html">日付/時刻のフォーマット</a></li>
      <li><a href="entry/20141225/1419515057.html">1フォームに複数のSubmitボタンを配置</a></li>
      <li><a href="entry/20141223/1419334845.html">URLのパーマリンクをID以外に変更</a></li>
      <li><a href="entry/20141220/1419058040.html">CSSスタイリングのコントローラー単位で分割</a></li>
      <li><a href="entry/20141219/1418990626.html">ページタイトルの変更</a></li>
      <li><a href="entry/20150101/1420049679.html">Ruby/Railsの便利なメソッド(useful methods)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Rubyテクニック</span>
    <ul class="side-category-list">
      <li><a href="entry/20150921/1442839934.html">キーワード引数</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">良い設計/リファクタリング</span>
    <ul class="side-category-list">
      <li><a href="entry/20150922/1442923521.html">デメテルの法則(Law of Demeter)</a></li>
      <li><a href="entry/20150312/1426141352.html">HTML/CSS/JSを疎結合にする方法</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">JavaScript</span>
    <ul class="side-category-list">
      <li><a href="entry/20150311/1426062668.html">オブジェクト指向</a></li>
      <li><a href="entry/20150313/1426238835.html">thisの参照先</a></li>
      <li><a href="entry/20150317/1426599220.html">設定データを分離</a></li>
      <li><a href="entry/20150607/1433652441.html">ページを離れる時にアラートを出す</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">jQuery</span>
    <ul class="side-category-list">
      <li><a href="entry/20150325/1427291741.html">Ajax</a></li>
      <li><a href="entry/20150326/1427379215.html">イベント処理(Event)</a></li>
      <li><a href="entry/20150331/1427809820.html">DOM操作</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">React.js</span>
    <ul class="side-category-list">
      <li><a href="entry/20151122/1448118932.html">React.jsチュートリアル: メッセージボックス</a></li>
      <li><a href="entry/20151124/1448300267.html">サーバーレンダリング</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">AngularJS</span>
    <ul class="side-category-list">
      <li><a href="entry/20150114/1421235346.html">AngularJSのインストール</a></li>
      <li><a href="entry/20150115/1421316461.html">UI Bootstrapのインストール</a></li>
      <li><a href="entry/20150116/1421407124.html">AngularJS Controller</a>
      <li><a href="entry/20150119/1421666497.html">ngResource + RailsでAPI作成</a></li>
      <li><a href="entry/20150120/1421761471.html">ngRoute</a></li>
      <li><a href="entry/20150126/1422276839.html">編集可能(Editable)</a></li>
      <li><a href="entry/20150127/1422357163.html">ソート可能(Sortable)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">開発手法</span>
    <ul class="side-category-list">
      <li><a href="entry/20140917/1410963376.html">スクラム開発</a></li>
      <li><a href="entry/20141010/1412867452.html">カイゼンフレームワークKPT</a>
      <li><a href="entry/20140816/1408126999.html">GitHubを使ったチーム開発フロー</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">開発ツール</span>
    <ul class="side-category-list">
      <li><a href="entry/20141103/1414940400.html">git - 初期設定と便利なエイリアス</a></li>
      <li><a href="entry/20140713/1405248403.html">git - よく使うコマンド</a></li>
      <li><a href="entry/20140724/1406137504.html">SublimeText3 - 便利コマンドとプラグイン</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">DB</span>
    <ul class="side-category-list">
      <li><a href="entry/20140726/1406331785.html">MongoDBの基礎入門 CRUD操作</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">インフラ</span>
    <ul class="side-category-list">
      <li><a href="entry/20150719/1437249020.html">Vagrant</a></li>
      <li><a href="entry/20150721/1437404524.html">Chef(Rails環境構築)</a></li>
      <li><a href="entry/20150314/1426332751.html">Herokuの準備とデプロイ</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">リファレンス</span>
    <ul class="side-category-list">
      <li><a href="https://github.com/" target="_blank">GitHub</a></li>
      <li><a href="http://guides.rubyonrails.org/index.html" target="_blank">RailsGuides</a></li>
      <li><a href="http://railscasts.com/" target="_blank">RailsCast</a></li>
      <li><a href="https://rubygems.org/" target="_blank">RubyGems</a></li>
      <li><a href="https://www.ruby-toolbox.com/" target="_blank">RubyToolbox</a></li>
      <li><a href="http://rubular.com/" target="_blank">正規表現 Rubular</a></li>
      <li><a href="http://ruby-doc.org/core-2.1/" target="_blank">Ruby API (2.1)</a></li>
      <li><a href="http://api.rubyonrails.org/" target="_blank">Ruby on Rails API (4.1)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">Phoenix</span>
    <ul class="side-category-list">
      <li><a href="entry/20151011/1444560106.html">Phoenix環境設定(Phoenix入門1)</a></li>
      <li><a href="entry/20151013/1444662887.html">基本的な認証機能(Phoenix入門2)</a></li>
      <li><a href="entry/20151016/1444930756.html">基本的なチャット機能(Phoenix入門3)</a></li>
    </ul>
  </div>
  <div class="side-category">
    <span class="side-category-title">その他</span>
    <ul class="side-category-list">
      <li><a href="entry/20150401/1427898898.html">広告収入向上</a></li>
      <li><a href="entry/20140830/1409361710.html">著者が読んだ本</a></li>
    </ul>
  </div>
</nav>

  </div>
</div>

      
      
    
      

<div class="hatena-module hatena-module-archive" data-archive-type="default" data-archive-url="http://ruby-rails.hatenadiary.com/archive">
  <div class="hatena-module-title">
    <a href="archive.html">月別アーカイブ</a>
  </div>
  <div class="hatena-module-body">
  </div>
</div>

      
      
    
    
  </div>
</aside>

  </div>
</div>




        
        
          <script type="text/javascript" src="http://b.hatena.ne.jp/js/hatena_dfp2.js"></script>
        
        
          <div id="bottom-editarea">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
$('.unsubscribing').on('click', function() {
    ga('send', 'event', 'button', 'click', 'hatenaReader');  
});
</script>
          </div>
        
      </div>
    </div>

    
      <footer id="footer" data-brand="hatenablog">
  <div id="footer-inner">
    <address>
      
      <a href="about.html"><img src="http://cdn1.www.st-hatena.com/users/ni/nipe880324/profile.gif" width="16" height="16" alt=""/>
        <span data-load-nickname="1" data-user-name="nipe880324">nipe880324</span>
      </a>
    </address>
    <p class="services">Powered by <a href="http://hatenablog.com/">Hatena Blog</a></p>
  </div>
</footer>

    

    
  <script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>


    

    <script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js">
  {"parsetags": "explicit"}
</script>
<script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>



  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-with-addons.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.min.js"></script>


<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery/jquery-ui.1.10.0.custom.min.js"></script>
<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery/jquery.flot.0.8.3.js"></script>
<script type="text/javascript" src="http://cdn7.www.st-hatena.com/js/jquery/jquery.flot.time.0.8.3.js"></script>



<script id="hatenablog-js" data-env="production"
  type="text/javascript" src="https://blog.st-hatena.com/js/hatenablog.js?version=228df9a6e5a3ae04fdb53d33befa3556" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://blog.st-hatena.com/js/texts-ja.js?version=228df9a6e5a3ae04fdb53d33befa3556"></script>


  <script type="text/javascript">Hatena.Diary.GlobalHeader.init()</script>


<script src="https://www.google.com/recaptcha/api.js" async defer></script>




    


    
       

  <script id="hatena-counter-script" type="text/javascript"><!--
      hatena_counter_name = "nipe880324";
      hatena_counter_id = "102";
      hatena_counter_ref = document.referrer+"";
      hatena_counter_screen = screen.width + "x" + screen.height+","+screen.colorDepth;
  //--></script>
  <script type="text/javascript" src="http://counter.hatena.ne.jp/js/counter.js"></script>
  <noscript><img src="http://counter.hatena.ne.jp/nipe880324/102" border="0" alt="counter"></noscript>


    

  </body>
</html>
